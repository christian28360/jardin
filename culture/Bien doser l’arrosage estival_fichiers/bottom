/*
    jQuery News Ticker is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, version 2 of the License.
 
    jQuery News Ticker is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with jQuery News Ticker.  If not, see <http://www.gnu.org/licenses/>.
*/
(function($){  
    $.fn.ticker = function(options) { 
        // Extend our default options with those provided.
        // Note that the first arg to extend is an empty object -
        // this is to keep from overriding our "defaults" object.
        var opts = $.extend({}, $.fn.ticker.defaults, options); 

        // check that the passed element is actually in the DOM
        if ($(this).length == 0) {
            if (window.console && window.console.log) {
                window.console.log('Element does not exist in DOM!');
            }
            else {
                alert('Element does not exist in DOM!');		
            }
            return false;
        }
		
        /* Get the id of the UL to get our news content from */
        var newsID = '#' + $(this).attr('id');

        /* Get the tag type - we will check this later to makde sure it is a UL tag */
        var tagType = $(this).get(0).tagName; 	

        return this.each(function() { 
            // get a unique id for this ticker
            var uniqID = getUniqID();
			
            /* Internal vars */
            var settings = {				
                position: 0,
                time: 0,
                distance: 0,
                newsArr: {},
                play: true,
                paused: false,
                contentLoaded: false,
                dom: {
                    contentID: '#ticker-content-' + uniqID,
                    titleID: '#ticker-title-' + uniqID,
                    titleElem: '#ticker-title-' + uniqID + ' SPAN',
                    tickerID : '#ticker-' + uniqID,
                    wrapperID: '#ticker-wrapper-' + uniqID,
                    revealID: '#ticker-swipe-' + uniqID,
                    revealElem: '#ticker-swipe-' + uniqID + ' SPAN',
                    controlsID: '#ticker-controls-' + uniqID,
                    prevID: '#prev-' + uniqID,
                    nextID: '#next-' + uniqID,
                    playPauseID: '#play-pause-' + uniqID
                }
            };

            // if we are not using a UL, display an error message and stop any further execution
            if (tagType != 'UL' && tagType != 'OL' && opts.htmlFeed === true) {
                debugError('Cannot use <' + tagType.toLowerCase() + '> type of element for this plugin - must of type <ul> or <ol>');
                return false;
            }

            // set the ticker direction
            opts.direction == 'rtl' ? opts.direction = 'right' : opts.direction = 'left';
			
            // lets go...
            initialisePage();
            /* Function to get the size of an Object*/
            function countSize(obj) {
                var size = 0, key;
                for (key in obj) {
                    if (obj.hasOwnProperty(key)) size++;
                }
                return size;
            };

            function getUniqID() {
                var newDate = new Date;
                return newDate.getTime();			
            }
			
            /* Function for handling debug and error messages */ 
            function debugError(obj) {
                if (opts.debugMode) {
                    if (window.console && window.console.log) {
                        window.console.log(obj);
                    }
                    else {
                        alert(obj);			
                    }
                }
            }

            /* Function to setup the page */
            function initialisePage() {
                // process the content for this ticker
                processContent();
				
                // add our HTML structure for the ticker to the DOM
                $(newsID).wrap('<div id="' + settings.dom.wrapperID.replace('#', '') + '"></div>');
				
                // remove any current content inside this ticker
                $(settings.dom.wrapperID).children().remove();
				
                $(settings.dom.wrapperID).append('<div id="' + settings.dom.tickerID.replace('#', '') + '" class="ticker"><div id="' + settings.dom.titleID.replace('#', '') + '" class="ticker-title"><span><!-- --></span></div><p id="' + settings.dom.contentID.replace('#', '') + '" class="ticker-content"></p><div id="' + settings.dom.revealID.replace('#', '') + '" class="ticker-swipe"><span><!-- --></span></div></div>');
                $(settings.dom.wrapperID).removeClass('no-js').addClass('ticker-wrapper has-js ' + opts.direction);
                // hide the ticker
                $(settings.dom.tickerElem + ',' + settings.dom.contentID).hide();
                // add the controls to the DOM if required
                if (opts.controls) {
                    // add related events - set functions to run on given event
                    $(settings.dom.controlsID).live('click mouseover mousedown mouseout mouseup', function (e) {
                        var button = e.target.id;
                        if (e.type == 'click') {	
                            switch (button) {
                                case settings.dom.prevID.replace('#', ''):
                                    // show previous item
                                    settings.paused = true;
                                    $(settings.dom.playPauseID).addClass('paused');
                                    manualChangeContent('prev');
                                    break;
                                case settings.dom.nextID.replace('#', ''):
                                    // show next item
                                    settings.paused = true;
                                    $(settings.dom.playPauseID).addClass('paused');
                                    manualChangeContent('next');
                                    break;
                                case settings.dom.playPauseID.replace('#', ''):
                                    // play or pause the ticker
                                    if (settings.play == true) {
                                        settings.paused = true;
                                        $(settings.dom.playPauseID).addClass('paused');
                                        pauseTicker();
                                    }
                                    else {
                                        settings.paused = false;
                                        $(settings.dom.playPauseID).removeClass('paused');
                                        restartTicker();
                                    }
                                    break;
                            }	
                        }
                        else if (e.type == 'mouseover' && $('#' + button).hasClass('controls')) {
                            $('#' + button).addClass('over');
                        }
                        else if (e.type == 'mousedown' && $('#' + button).hasClass('controls')) {
                            $('#' + button).addClass('down');
                        }
                        else if (e.type == 'mouseup' && $('#' + button).hasClass('controls')) {
                            $('#' + button).removeClass('down');
                        }
                        else if (e.type == 'mouseout' && $('#' + button).hasClass('controls')) {
                            $('#' + button).removeClass('over');
                        }
                    });
                    // add controls HTML to DOM
                    $(settings.dom.wrapperID).append('<ul id="' + settings.dom.controlsID.replace('#', '') + '" class="ticker-controls"><li id="' + settings.dom.playPauseID.replace('#', '') + '" class="jnt-play-pause controls"><a href=""><!-- --></a></li><li id="' + settings.dom.prevID.replace('#', '') + '" class="jnt-prev controls"><a href=""><!-- --></a></li><li id="' + settings.dom.nextID.replace('#', '') + '" class="jnt-next controls"><a href=""><!-- --></a></li></ul>');
                }
                if (opts.displayType != 'fade') {
                    // add mouse over on the content
                    $(settings.dom.contentID).mouseover(function () {
                        if (settings.paused == false) {
                            pauseTicker();
                        }
                    }).mouseout(function () {
                        if (settings.paused == false) {
                            restartTicker();
                        }
                    });
                }
                // we may have to wait for the ajax call to finish here
                /*if (!opts.ajaxFeed) {
                    setupContentAndTriggerDisplay();
                }*/
            }

            /* Start to process the content for this ticker */
            function processContent() {
                // check to see if we need to load content
                if (settings.contentLoaded == false) {
                    // construct content
                    if (opts.ajaxFeed) {
                        if (opts.feedType == 'xml') {	
                            $.ajax({
                                url: opts.feedUrl,
                                cache: false,
                                dataType: opts.feedType,
                                async: true,
                                success: function(data){
                                    count = 0;	
                                    // get the 'root' node
                                    for (var a = 0; a < data.childNodes.length; a++) {
                                        if (data.childNodes[a].nodeName == 'rss') {
                                            xmlContent = data.childNodes[a];
                                        }
                                    }
                                    // find the channel node
                                    for (var i = 0; i < xmlContent.childNodes.length; i++) {
                                        if (xmlContent.childNodes[i].nodeName == 'channel') {
                                            xmlChannel = xmlContent.childNodes[i];
                                        }		
                                    }
                                    // for each item create a link and add the article title as the link text
                                    for (var x = 0; x < xmlChannel.childNodes.length; x++) {
                                        if (xmlChannel.childNodes[x].nodeName == 'item') {
                                            xmlItems = xmlChannel.childNodes[x];
                                            var title, link = false;
                                            for (var y = 0; y < xmlItems.childNodes.length; y++) {
                                                if (xmlItems.childNodes[y].nodeName == 'title') {      												    
                                                    title = xmlItems.childNodes[y].lastChild.nodeValue;
                                                }
                                                else if (xmlItems.childNodes[y].nodeName == 'link') {												    
                                                    link = xmlItems.childNodes[y].lastChild.nodeValue; 
                                                }
                                                if ((title !== false && title != '') && link !== false) {
                                                    settings.newsArr['item-' + count] = {
                                                        type: opts.titleText, 
                                                        content: '<a href="' + link + '">' + title + '</a>'
                                                    };                                     
                                                    count++;
                                                    title = false;
                                                    link = false;
                                                }
                                            }	
                                        }		
                                    }
                                    // quick check here to see if we actually have any content - log error if not
                                    if (countSize(settings.newsArr) < 1) {
                                        debugError('Couldn\'t find any content from the XML feed for the ticker to use!');
                                        $('#jardi-ticker').hide();
                                        return false;
                                    }else{
                                        settings.contentLoaded = true;
                                        setupContentAndTriggerDisplay();
                                    }
                                }
                            });							
                        }
                        else {
                            debugError('Code Me!');	
                        }						
                    }
                    else if (opts.htmlFeed) { 
                        if($(newsID + ' LI').length > 0) {
                            $(newsID + ' LI').each(function (i) {
                                // maybe this could be one whole object and not an array of objects?
                                settings.newsArr['item-' + i] = {
                                    type: opts.titleText, 
                                    content: $(this).html()
                                    };
                            });		
                        }	
                        else {
                            debugError('Couldn\'t find HTML any content for the ticker to use!');
                            return false;
                        }
                    }
                    else {
                        debugError('The ticker is set to not use any types of content! Check the settings for the ticker.');
                        return false;
                    }					
                }			
            }

            function setupContentAndTriggerDisplay() {

                settings.contentLoaded = true;

                // update the ticker content with the correct item
                // insert news content into DOM
                $(settings.dom.titleElem).html(settings.newsArr['item-' + settings.position].type);
                $(settings.dom.contentID).html(settings.newsArr['item-' + settings.position].content);

                // set the next content item to be used - loop round if we are at the end of the content
                if (settings.position == (countSize(settings.newsArr) -1)) {
                    settings.position = 0;
                }
                else {		
                    settings.position++;
                }			

                // get the values of content and set the time of the reveal (so all reveals have the same speed regardless of content size)
                distance = $(settings.dom.contentID).width();
                time = distance / opts.speed;

                // start the ticker animation						
                revealContent();		
            }

            // slide back cover or fade in content
            function revealContent() {
                $(settings.dom.contentID).css('opacity', '1');
                if(settings.play) {	
                    // get the width of the title element to offset the content and reveal	
                    var offset = $(settings.dom.titleID).width() + 20;
	
                    $(settings.dom.revealID).css(opts.direction, offset + 'px');
                    // show the reveal element and start the animation
                    if (opts.displayType == 'fade') {
                        // fade in effect ticker
                        $(settings.dom.revealID).hide(0, function () {
                            $(settings.dom.contentID).css(opts.direction, offset + 'px').fadeIn(opts.fadeInSpeed, postReveal);
                        });						
                    }
                    else if (opts.displayType == 'scroll') {
                    // to code
                    }
                    else {
                        // default bbc scroll effect
                        $(settings.dom.revealElem).show(0, function () {
                            $(settings.dom.contentID).css(opts.direction, offset + 'px').show();
                            // set our animation direction
                            animationAction = opts.direction == 'right' ? {
                                marginRight: distance + 'px'
                                } : {
                                marginLeft: distance + 'px'
                            };
                            $(settings.dom.revealID).css('margin-' + opts.direction, '0px').delay(20).animate(animationAction, time, 'linear', postReveal);
                        });		
                    }
                }
                else {
                    return false;					
                }
            };

            // here we hide the current content and reset the ticker elements to a default state ready for the next ticker item
            function postReveal() {				
                if(settings.play) {		
                    // we have to separately fade the content out here to get around an IE bug - needs further investigation
                    $(settings.dom.contentID).delay(opts.pauseOnItems).fadeOut(opts.fadeOutSpeed);
                    // deal with the rest of the content, prepare the DOM and trigger the next ticker
                    if (opts.displayType == 'fade') {
                        $(settings.dom.contentID).fadeOut(opts.fadeOutSpeed, function () {
                            $(settings.dom.wrapperID)
                            .find(settings.dom.revealElem + ',' + settings.dom.contentID)
                            .hide()
                            .end().find(settings.dom.tickerID + ',' + settings.dom.revealID)
                            .show()
                            .end().find(settings.dom.tickerID + ',' + settings.dom.revealID)
                            .removeAttr('style');								
                            setupContentAndTriggerDisplay();						
                        });
                    }
                    else {
                        $(settings.dom.revealID).hide(0, function () {
                            $(settings.dom.contentID).fadeOut(opts.fadeOutSpeed, function () {
                                $(settings.dom.wrapperID)
                                .find(settings.dom.revealElem + ',' + settings.dom.contentID)
                                .hide()
                                .end().find(settings.dom.tickerID + ',' + settings.dom.revealID)
                                .show()
                                .end().find(settings.dom.tickerID + ',' + settings.dom.revealID)
                                .removeAttr('style');								
                                setupContentAndTriggerDisplay();						
                            });
                        });	
                    }
                }
                else {
                    $(settings.dom.revealElem).hide();
                }
            }

            // pause ticker
            function pauseTicker() {				
                settings.play = false;
                // stop animation and show content - must pass "true, true" to the stop function, or we can get some funky behaviour
                $(settings.dom.tickerID + ',' + settings.dom.revealID + ',' + settings.dom.titleID + ',' + settings.dom.titleElem + ',' + settings.dom.revealElem + ',' + settings.dom.contentID).stop(true, true);
                $(settings.dom.revealID + ',' + settings.dom.revealElem).hide();
                $(settings.dom.wrapperID)
                .find(settings.dom.titleID + ',' + settings.dom.titleElem).show()
                .end().find(settings.dom.contentID).show();
            }

            // play ticker
            function restartTicker() {				
                settings.play = true;
                settings.paused = false;
                // start the ticker again
                postReveal();	
            }

            // change the content on user input
            function manualChangeContent(direction) {
                pauseTicker();
                switch (direction) {
                    case 'prev':
                        if (settings.position == 0) {
                            settings.position = countSize(settings.newsArr) -2;
                        }
                        else if (settings.position == 1) {
                            settings.position = countSize(settings.newsArr) -1;
                        }
                        else {
                            settings.position = settings.position - 2;
                        }
                        $(settings.dom.titleElem).html(settings.newsArr['item-' + settings.position].type);
                        $(settings.dom.contentID).html(settings.newsArr['item-' + settings.position].content);						
                        break;
                    case 'next':
                        $(settings.dom.titleElem).html(settings.newsArr['item-' + settings.position].type);
                        $(settings.dom.contentID).html(settings.newsArr['item-' + settings.position].content);
                        break;
                }
                // set the next content item to be used - loop round if we are at the end of the content
                if (settings.position == (countSize(settings.newsArr) -1)) {
                    settings.position = 0;
                }
                else {		
                    settings.position++;
                }	
            }
        });  
    };  

    // plugin defaults - added as a property on our plugin function
    $.fn.ticker.defaults = {
        speed: 0.10,			
        ajaxFeed: false,
        feedUrl: '',
        feedType: 'xml',
        displayType: 'reveal',
        htmlFeed: true,
        debugMode: true,
        controls: true,
        titleText: 'Latest',	
        direction: 'ltr',	
        pauseOnItems: 3000,
        fadeInSpeed: 600,
        fadeOutSpeed: 300
    };	
})(jQuery);

/** --------------------------------------------------------------------------
 *	jQuery URL Decoder
 *	Version 1.0
 *	Parses URL and return its components. Can also build URL from components
 *	
 * ---------------------------------------------------------------------------
 *	HOW TO USE:
 *
 *	$.url.decode('http://username:password@hostname/path?arg1=value%40+1&arg2=touch%C3%A9#anchor')
 *	returns
 *	http://username:password@hostname/path?arg1=value@ 1&arg2=touchÃ©#anchor
 *	Note: "%40" is replaced with "@", "+" is replaced with " " and "%C3%A9" is replaced with "Ã©"
 *	
 *	$.url.encode('file.htm?arg1=value1 @#456&amp;arg2=value2 touchÃ©')
 *	returns
 *	file.htm%3Farg1%3Dvalue1%20%40%23456%26arg2%3Dvalue2%20touch%C3%A9
 *	Note: "@" is replaced with "%40" and "Ã©" is replaced with "%C3%A9"
 *	
 *	$.url.parse('http://username:password@hostname/path?arg1=value%40+1&arg2=touch%C3%A9#anchor')
 *	returns
 *	{
 *		source: 'http://username:password@hostname/path?arg1=value%40+1&arg2=touch%C3%A9#anchor',
 *		protocol: 'http',
 *		authority: 'username:password@hostname',
 *		userInfo: 'username:password',
 *		user: 'username',
 *		password: 'password',
 *		host: 'hostname',
 *		port: '',
 *		path: '/path',
 *		directory: '/path',
 *		file: '',
 *		relative: '/path?arg1=value%40+1&arg2=touch%C3%A9#anchor',
 *		query: 'arg1=value%40+1&arg2=touch%C3%A9',
 *		anchor: 'anchor',
 *		params: {
 *			'arg1': 'value@ 1',
 *			'arg2': 'touchÃ©'
 *		}
 *	}
 *	
 *	$.url.build({
 *		protocol: 'http',
 *		username: 'username',
 *		password: 'password',
 *		host: 'hostname',
 *		path: '/path',
 *		query: 'arg1=value%40+1&arg2=touch%C3%A9',
 *		 or 
 *		params: {
 *			'arg1': 'value@ 1',
 *			'arg2': 'touchÃ©'
 *		}
 *		anchor: 'anchor',
 *	})
 *	returns
 *	http://username:password@hostname/path?arg1=value%40+1&arg2=touch%C3%A9#anchor	
 *	
 * ---------------------------------------------------------------------------
 * OTHER PARTIES' CODE:
 *
 * Parser based on the Regex-based URI parser by Steven Levithan.
 * For more information visit http://blog.stevenlevithan.com/archives/parseuri
 *
 * Deparam taken from jQuery BBQ by Ben Alman. Dual licensed under the MIT and GPL licenses (http://benalman.com/about/license/)
 * http://benalman.com/projects/jquery-bbq-plugin/
 *  
 * ---------------------------------------------------------------------------
	
*/
jQuery.url = function() { function l(a) { for(var b = "", c = 0, f = 0, d = 0;c < a.length;) { f = a.charCodeAt(c); if(f < 128) { b += String.fromCharCode(f); c++ }else if(f > 191 && f < 224) { d = a.charCodeAt(c + 1); b += String.fromCharCode((f & 31) << 6 | d & 63); c += 2 }else { d = a.charCodeAt(c + 1); c3 = a.charCodeAt(c + 2); b += String.fromCharCode((f & 15) << 12 | (d & 63) << 6 | c3 & 63); c += 3 } }return b } function m(a, b) { var c = {}, f = {"true":true, "false":false, "null":null}; $.each(a.replace(/\+/g, " ").split("&"), function(d, j) { var e = j.split("="); d = k(e[0]); j = c; var i = 0, g = d.split("]["), h = g.length - 1; if(/\[/.test(g[0]) && /\]$/.test(g[h])) { g[h] = g[h].replace(/\]$/, ""); g = g.shift().split("[").concat(g); h = g.length - 1 }else h = 0; if(e.length === 2) { e = k(e[1]); if(b)e = e && !isNaN(e) ? +e : e === "undefined" ? undefined : f[e] !== undefined ? f[e] : e; if(h)for(;i <= h;i++) { d = g[i] === "" ? j.length : g[i]; j = j[d] = i < h ? j[d] || (g[i + 1] && isNaN(g[i + 1]) ? {} : []) : e }else if($.isArray(c[d]))c[d].push(e); else c[d] = c[d] !== undefined ? [c[d], e] : e }else if(d)c[d] = b ? undefined : "" }); return c } function n(a) { a = a || window.location; var b = ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"]; a = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(a); for(var c = {}, f = b.length;f--;)c[b[f]] = a[f] || ""; if(c.query)c.params = m(c.query, true); return c } function o(a) { if(a.source)return encodeURI(a.source); var b = []; if(a.protocol)if(a.protocol == "file")b.push("file:///"); else a.protocol == "mailto" ? b.push("mailto:") : b.push(a.protocol + "://"); if(a.authority)b.push(a.authority); else { if(a.userInfo)b.push(a.userInfo + "@"); else if(a.user) { b.push(a.user); a.password && b.push(":" + a.password); b.push("@") }if(a.host) { b.push(a.host); a.port && b.push(":" + a.port) } }if(a.path)b.push(a.path); else { a.directory && b.push(a.directory); a.file && b.push(a.file) }if(a.query)b.push("?" + a.query); else a.params && b.push("?" + $.param(a.params)); a.anchor && b.push("#" + a.anchor); return b.join("") } function p(a) { return encodeURIComponent(a) } function k(a) { a = a || window.location.toString(); return l(unescape(a.replace(/\+/g, " "))) } return{encode:p, decode:k, parse:n, build:o} }();

/*
 * jQuery UI Stars v3.0.1
 * http://plugins.jquery.com/project/Star_Rating_widget
 *
 * Copyright (c) 2010 Marek "Orkan" Zajac (orkans@gmail.com)
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * $Rev: 164 $
 * $Date:: 2010-05-01 #$
 * $Build: 35 (2010-05-01)
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *
 */
(function(A){A.widget("ui.stars",{options:{inputType:"radio",split:0,disabled:false,cancelTitle:"Cancel Rating",cancelValue:0,cancelShow:true,disableValue:true,oneVoteOnly:false,showTitles:false,captionEl:null,callback:null,starWidth:16,cancelClass:"ui-stars-cancel",starClass:"ui-stars-star",starOnClass:"ui-stars-star-on",starHoverClass:"ui-stars-star-hover",starDisabledClass:"ui-stars-star-disabled",cancelHoverClass:"ui-stars-cancel-hover",cancelDisabledClass:"ui-stars-cancel-disabled"},_create:function(){var C=this,F=this.options,B=0;this.element.data("former.stars",this.element.html());F.isSelect=F.inputType=="select";this.$form=A(this.element).closest("form");this.$selec=F.isSelect?A("select",this.element):null;this.$rboxs=F.isSelect?A("option",this.$selec):A(":radio",this.element);this.$stars=this.$rboxs.map(function(I){var J={value:this.value,title:(F.isSelect?this.text:this.title)||this.value,isDefault:(F.isSelect&&this.defaultSelected)||this.defaultChecked};if(I==0){F.split=typeof F.split!="number"?0:F.split;F.val2id=[];F.id2val=[];F.id2title=[];F.name=F.isSelect?C.$selec.get(0).name:this.name;F.disabled=F.disabled||(F.isSelect?A(C.$selec).attr("disabled"):A(this).attr("disabled"))}if(J.value==F.cancelValue){F.cancelTitle=J.title;return null}F.val2id[J.value]=B;F.id2val[B]=J.value;F.id2title[B]=J.title;if(J.isDefault){F.checked=B;F.value=F.defaultValue=J.value;F.title=J.title}var H=A("<div/>").addClass(F.starClass);var K=A("<a/>").attr("title",F.showTitles?J.title:"").text(J.value);if(F.split){var G=(B%F.split);var L=Math.floor(F.starWidth/F.split);H.width(L);K.css("margin-left","-"+(G*L)+"px")}B++;return H.append(K).get(0)});F.items=B;F.isSelect?this.$selec.remove():this.$rboxs.remove();this.$cancel=A("<div/>").addClass(F.cancelClass).append(A("<a/>").attr("title",F.showTitles?F.cancelTitle:"").text(F.cancelValue));F.cancelShow&=!F.disabled&&!F.oneVoteOnly;F.cancelShow&&this.element.append(this.$cancel);this.element.append(this.$stars);if(F.checked===undefined){F.checked=-1;F.value=F.defaultValue=F.cancelValue;F.title=""}this.$value=A("<input type='hidden' name='"+F.name+"' value='"+F.value+"' />");this.element.append(this.$value);this.$stars.bind("click.stars",function(H){if(!F.forceSelect&&F.disabled){return false}var G=C.$stars.index(this);F.checked=G;F.value=F.id2val[G];F.title=F.id2title[G];C.$value.attr({disabled:F.disabled?"disabled":"",value:F.value});D(G,false);C._disableCancel();!F.forceSelect&&C.callback(H,"star")}).bind("mouseover.stars",function(){if(F.disabled){return false}var G=C.$stars.index(this);D(G,true)}).bind("mouseout.stars",function(){if(F.disabled){return false}D(C.options.checked,false)});this.$cancel.bind("click.stars",function(G){if(!F.forceSelect&&(F.disabled||F.value==F.cancelValue)){return false}F.checked=-1;F.value=F.cancelValue;F.title="";C.$value.val(F.value);F.disableValue&&C.$value.attr({disabled:"disabled"});E();C._disableCancel();!F.forceSelect&&C.callback(G,"cancel")}).bind("mouseover.stars",function(){if(C._disableCancel()){return false}C.$cancel.addClass(F.cancelHoverClass);E();C._showCap(F.cancelTitle)}).bind("mouseout.stars",function(){if(C._disableCancel()){return false}C.$cancel.removeClass(F.cancelHoverClass);C.$stars.triggerHandler("mouseout.stars")});this.$form.bind("reset.stars",function(){!F.disabled&&C.select(F.defaultValue)});A(window).unload(function(){C.$cancel.unbind(".stars");C.$stars.unbind(".stars");C.$form.unbind(".stars");C.$selec=C.$rboxs=C.$stars=C.$value=C.$cancel=C.$form=null});function D(G,I){if(G!=-1){var J=I?F.starHoverClass:F.starOnClass;var H=I?F.starOnClass:F.starHoverClass;C.$stars.eq(G).prevAll("."+F.starClass).andSelf().removeClass(H).addClass(J);C.$stars.eq(G).nextAll("."+F.starClass).removeClass(F.starHoverClass+" "+F.starOnClass);C._showCap(F.id2title[G])}else{E()}}function E(){C.$stars.removeClass(F.starOnClass+" "+F.starHoverClass);C._showCap("")}this.select(F.value);F.disabled&&this.disable()},_disableCancel:function(){var C=this.options,B=C.disabled||C.oneVoteOnly||(C.value==C.cancelValue);if(B){this.$cancel.removeClass(C.cancelHoverClass).addClass(C.cancelDisabledClass)}else{this.$cancel.removeClass(C.cancelDisabledClass)}this.$cancel.css("opacity",B?0.5:1);return B},_disableAll:function(){var B=this.options;this._disableCancel();if(B.disabled){this.$stars.filter("div").addClass(B.starDisabledClass)}else{this.$stars.filter("div").removeClass(B.starDisabledClass)}},_showCap:function(B){var C=this.options;if(C.captionEl){C.captionEl.text(B)}},value:function(){return this.options.value},select:function(D){var C=this.options,B=(D==C.cancelValue)?this.$cancel:this.$stars.eq(C.val2id[D]);C.forceSelect=true;B.triggerHandler("click.stars");C.forceSelect=false},selectID:function(D){var C=this.options,B=(D==-1)?this.$cancel:this.$stars.eq(D);C.forceSelect=true;B.triggerHandler("click.stars");C.forceSelect=false},enable:function(){this.options.disabled=false;this._disableAll()},disable:function(){this.options.disabled=true;this._disableAll()},destroy:function(){this.$form.unbind(".stars");this.$cancel.unbind(".stars").remove();this.$stars.unbind(".stars").remove();this.$value.remove();this.element.unbind(".stars").html(this.element.data("former.stars")).removeData("stars");return this},callback:function(C,B){var D=this.options;D.callback&&D.callback(this,B,D.value,C);D.oneVoteOnly&&!D.disabled&&this.disable()}});A.extend(A.ui.stars,{version:"3.0.1"})})(jQuery);

/**
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

/**
 * Create a cookie with the given name and value and other optional parameters.
 *
 * @example $.cookie('the_cookie', 'the_value');
 * @desc Set the value of a cookie.
 * @example $.cookie('the_cookie', 'the_value', { expires: 7, path: '/', domain: 'jquery.com', secure: true });
 * @desc Create a cookie with all available options.
 * @example $.cookie('the_cookie', 'the_value');
 * @desc Create a session cookie.
 * @example $.cookie('the_cookie', null);
 * @desc Delete a cookie by passing null as value. Keep in mind that you have to use the same path and domain
 *       used when the cookie was set.
 *
 * @param String name The name of the cookie.
 * @param String value The value of the cookie.
 * @param Object options An object literal containing key/value pairs to provide optional cookie attributes.
 * @option Number|Date expires Either an integer specifying the expiration date from now on in days or a Date object.
 *                             If a negative value is specified (e.g. a date in the past), the cookie will be deleted.
 *                             If set to null or omitted, the cookie will be a session cookie and will not be retained
 *                             when the the browser exits.
 * @option String path The value of the path atribute of the cookie (default: path of page that created the cookie).
 * @option String domain The value of the domain attribute of the cookie (default: domain of page that created the cookie).
 * @option Boolean secure If true, the secure attribute of the cookie will be set and the cookie transmission will
 *                        require a secure protocol (like HTTPS).
 * @type undefined
 *
 * @name $.cookie
 * @cat Plugins/Cookie
 * @author Klaus Hartl/klaus.hartl@stilbuero.de
 */

/**
 * Get the value of a cookie with the given name.
 *
 * @example $.cookie('the_cookie');
 * @desc Get the value of a cookie.
 *
 * @param String name The name of the cookie.
 * @return The value of the cookie.
 * @type String
 *
 * @name $.cookie
 * @cat Plugins/Cookie
 * @author Klaus Hartl/klaus.hartl@stilbuero.de
 */
jQuery.cookie = function(name, value, options) {
    if (typeof value != 'undefined') { // name and value given, set cookie
        options = options || {};
        if (value === null) {
            value = '';
            options.expires = -1;
        }
        var expires = '';
        if (options.expires && (typeof options.expires == 'number' || options.expires.toUTCString)) {
            var date;
            if (typeof options.expires == 'number') {
                date = new Date();
                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
            } else {
                date = options.expires;
            }
            expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
        }
        // CAUTION: Needed to parenthesize options.path and options.domain
        // in the following expressions, otherwise they evaluate to undefined
        // in the packed version for some reason...
        var path = options.path ? '; path=' + (options.path) : '';
        var domain = options.domain ? '; domain=' + (options.domain) : '';
        var secure = options.secure ? '; secure' : '';
        document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
    } else { // only name given, get cookie
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
};

/*
 * This file is part of fileinput.
 * 
 * fileinput is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * fileinput is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with Foobar.  If not, see <http://www.gnu.org/licenses/>.
 */

(function(b){b.widget("shimmy.fileinput",{options:{buttonText:"Browse",inputText:""},_create:function(){var a=this,d=a.options;a.fileFile=a.element;a.fileWrapper=b("<div></div>").addClass("fileinput-wrapper ui-widget").hover(function(){a.fileButton.addClass("ui-state-hover")},function(){a.fileButton.removeClass("ui-state-hover ui-state-active")}).bind("mousemove.fileinput",function(c){var e=c.pageX-b(this).offset().left-a.fileFile.width()/1.2;c=c.pageY-b(this).offset().top-a.fileFile.height()/2;a.fileFile.css("top",
c).css("left",e)}).bind("mousedown.fileinput",function(){a.fileButton.addClass("ui-state-active")}).bind("mouseup.fileinput",function(){a.fileButton.removeClass("ui-state-active")});a.fileFile.addClass("fileinput-file").wrap(a.fileWrapper);a.fileInput=b("<span></span>").addClass("fileinput-input ui-widget-content ui-corner-left").text(a._getText()).insertBefore(a.fileFile);a.fileButtonText=b("<span></span>").addClass("fileinput-button-text").text(d.buttonText);a.fileButton=b("<span></span>").addClass("fileinput-button ui-state-default ui-widget-header ui-corner-right").insertAfter(a.fileInput).html(a.fileButtonText);
a.fileFile.bind("change.fileinput mouseout.fileinput",function(){a.fileInput.text(a._getText())}).bind("focusin.fileinput",function(){a.fileButton.addClass("ui-state-hover")}).bind("focusout.fileinput",function(){a.fileButton.removeClass("ui-state-hover")})},_getText:function(){fileValue=this.getValue();inputTextValue=this.options.inputText;return fileValue==""?inputTextValue:fileValue},getValue:function(){return fileValue=this.fileFile.val().replace("C:\\fakepath\\","")},reset:function(){this.fileInput.text(this.options.inputText)},
destroy:function(){this.fileInput.remove();this.fileButton.remove();this.fileButtonText.remove();this.fileFile.removeClass("fileinput-file").unwrap(this.fileWrapper);this.fileWrapper.remove();b.Widget.prototype.destroy.call(this)},_setOption:function(a,d){b.Widget.prototype._setOption.apply(this,arguments);switch(a){case "buttonText":this.fileButtonText.text(d);break;case "inputText":this.fileInput.text(this._getText())}}})})(jQuery);


var fleur_id = 0;

function makeFleurs(){
    jQuery('.flFleur, .flFleur_mini').each(function(){
        fleur_id++;
        jQuery(this).append('<div id="fleur_'+fleur_id+'"></div>')
        var flashvars = new Object();
        i=1;
        multi='';

        jQuery.each(jQuery(this).attr('rel').split(','),function(key,val){
            if(i==6){
                flashvars['nbFleur']=val;
                multi=2;
            } else {
                if(val!=''){
                    flashvars['coul'+i++]=val.replace('#','');
                    oldval = val;
                }
                else flashvars['coul'+i++]=oldval.replace('#','');
            }
        });

        var params = {
            menu: "false",
            wmode: "transparent"
        };
        var attributes = false;

        swfobject.embedSWF('http://static.jardipedia.com/images/fleur'+multi+'_color.swf', 'fleur_'+fleur_id, jQuery(this).attr('width'), jQuery(this).attr('width'), '9.0.0','http://static.jardipedia.com/images/expressInstall.swf', flashvars, params, attributes);
    });
}

jQuery('document').ready(function(){
    makeFleurs();
});

/*
* Copyright 2010 by Glam Thumbs Team.
*
* How To Use The Script:
* add to your page this code between inside head tags
* <script type="text/javascript" src="BookmarkApp.js"></script> 
* add anchor with void href like this: 
* <a href="javascript:void(0)" onClick="return BookmarkApp.addBookmark(this)">bookmark us</a> 
* 
*/


BookmarkApp = function () {
    var isIEmac = false; /*@cc_on @if(@_jscript&&!(@_win32||@_win16)&& 
(@_jscript_version<5.5)) isIEmac=true; @end @*/
    var isMSIE = (-[1,]) ? false : true;
    var cjTitle = document.title;
    var cjHref = location.href;

    function hotKeys() {
        var ua = navigator.userAgent.toLowerCase();
        var str = '';
        var isWebkit = (ua.indexOf('webkit') != - 1);
        var isMac = (ua.indexOf('mac') != - 1);

        if (ua.indexOf('konqueror') != - 1) {
            str = 'CTRL + B'; // Konqueror
        } else if (window.home || isWebkit || isIEmac || isMac) {
            str = (isMac ? 'Command/Cmd' : 'CTRL') + ' + D'; // Netscape, Safari, iCab, IE5/Mac
        }
        return ((str) ? 'Appuyez sur ' + str + ' cette page à vos favoris.' : str);
    }

    function isIE8() {
        var rv = -1;
        if (navigator.appName == 'Microsoft Internet Explorer') {
            var ua = navigator.userAgent;
            var re = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
            if (re.exec(ua) != null) {
                rv = parseFloat(RegExp.$1);
            }
        }
        if (rv > - 1) {
            if (rv >= 8.0) {
                return true;
            }
        }
        return false;
    }

    function addBookmark(a) {
        try {
        	
        	if(a.href && a.href!='' && a.href!='#'){
    			this.cjHref=a.href;
    			this.cjTitle=a.title;
    		}
            if (typeof a == "object") {
                a.style.cursor = 'pointer';
                if ((typeof window.sidebar == "object") && (typeof window.sidebar.addPanel == "function")) {
                    window.sidebar.addPanel(cjTitle, cjHref, ""); // Gecko
                    return false;   
                } else if (isMSIE && typeof window.external == "object") {
                    if (isIE8()) {
                        window.external.AddToFavoritesBar(cjHref, cjTitle); // IE 8                    
                    } else {
                        window.external.AddFavorite(cjHref, cjTitle); // IE <=7
                    }
                    return false;
                } else if (window.opera  && a.tagName.toLowerCase() == "a") {
                    a.href = cjHref;
                    a.title = cjTitle;
                    a.rel = 'sidebar'; // Opera 7+
                    return true;
                } else {
                	alert(hotKeys());
                }
            } else {
                throw "Error occured.\r\nNote, only A tagname is allowed!";
            }
        } catch (err) {
            alert(err);
        }
        
    }
    
    return {
        addBookmark : addBookmark
    }
}();


/*
 * jQuery MultiSelect UI Widget 1.13
 * Copyright (c) 2012 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery 1.4.2+
 *   - jQuery UI 1.8 widget factory
 *
 * Optional:
 *   - jQuery UI effects
 *   - jQuery UI position utility
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(d){var k=0;d.widget("ech.multiselect",{options:{header:!0,height:175,minWidth:225,classes:"",checkAllText:"Check all",uncheckAllText:"Uncheck all",noneSelectedText:"Select options",selectedText:"# selected",selectedList:0,show:null,hide:null,autoOpen:!1,multiple:!0,position:{}},_create:function(){var a=this.element.hide(),b=this.options;this.speed=d.fx.speeds._default;this._isOpen=!1;a=(this.button=d('<button type="button"><span class="ui-icon ui-icon-triangle-2-n-s"></span></button>')).addClass("ui-multiselect ui-widget ui-state-default ui-corner-all").addClass(b.classes).attr({title:a.attr("title"),"aria-haspopup":!0,tabIndex:a.attr("tabIndex")}).insertAfter(a);(this.buttonlabel=d("<span />")).html(b.noneSelectedText).appendTo(a);var a=(this.menu=d("<div />")).addClass("ui-multiselect-menu ui-widget ui-widget-content ui-corner-all").addClass(b.classes).appendTo(document.body),c=(this.header=d("<div />")).addClass("ui-widget-header ui-corner-all ui-multiselect-header ui-helper-clearfix").appendTo(a);(this.headerLinkContainer=d("<ul />")).addClass("ui-helper-reset").html(function(){return!0===b.header?'<li><a class="ui-multiselect-all" href="#"><span class="ui-icon ui-icon-check"></span><span>'+b.checkAllText+'</span></a></li><li><a class="ui-multiselect-none" href="#"><span class="ui-icon ui-icon-closethick"></span><span>'+b.uncheckAllText+"</span></a></li>":"string"===typeof b.header?"<li>"+b.header+"</li>":""}).append('<li class="ui-multiselect-close"><a href="#" class="ui-multiselect-close"><span class="ui-icon ui-icon-circle-close"></span></a></li>').appendTo(c);(this.checkboxContainer=d("<ul />")).addClass("ui-multiselect-checkboxes ui-helper-reset").appendTo(a);this._bindEvents();this.refresh(!0);b.multiple||a.addClass("ui-multiselect-single")},_init:function(){!1===this.options.header&&this.header.hide();this.options.multiple||this.headerLinkContainer.find(".ui-multiselect-all, .ui-multiselect-none").hide();this.options.autoOpen&&this.open();this.element.is(":disabled")&&this.disable()},refresh:function(a){var b=this.element,c=this.options,f=this.menu,h=this.checkboxContainer,g=[],e="",i=b.attr("id")||k++;b.find("option").each(function(b){d(this);var a=this.parentNode,f=this.innerHTML,h=this.title,k=this.value,b="ui-multiselect-"+(this.id||i+"-option-"+b),l=this.disabled,n=this.selected,m=["ui-corner-all"],o=(l?"ui-multiselect-disabled ":" ")+this.className,j;"OPTGROUP"===a.tagName&&(j=a.getAttribute("label"),-1===d.inArray(j,g)&&(e+='<li class="ui-multiselect-optgroup-label '+a.className+'"><a href="#">'+j+"</a></li>",g.push(j)));l&&m.push("ui-state-disabled");n&&!c.multiple&&m.push("ui-state-active");e+='<li class="'+o+'">';e+='<label for="'+b+'" title="'+h+'" class="'+m.join(" ")+'">';e+='<input id="'+b+'" name="multiselect_'+i+'" type="'+(c.multiple?"checkbox":"radio")+'" value="'+k+'" title="'+f+'"';n&&(e+=' checked="checked"',e+=' aria-selected="true"');l&&(e+=' disabled="disabled"',e+=' aria-disabled="true"');e+=" /><span>"+f+"</span></label></li>"});h.html(e);this.labels=f.find("label");this.inputs=this.labels.children("input");this._setButtonWidth();this._setMenuWidth();this.button[0].defaultValue=this.update();a||this._trigger("refresh")},update:function(){var a=this.options,b=this.inputs,c=b.filter(":checked"),f=c.length,a=0===f?a.noneSelectedText:d.isFunction(a.selectedText)?a.selectedText.call(this,f,b.length,c.get()):/\d/.test(a.selectedList)&&0<a.selectedList&&f<=a.selectedList?c.map(function(){return d(this).next().html()}).get().join(", "):a.selectedText.replace("#",f).replace("#",b.length);this.buttonlabel.html(a);return a},_bindEvents:function(){function a(){b[b._isOpen? "close":"open"]();return!1}var b=this,c=this.button;c.find("span").bind("click.multiselect",a);c.bind({click:a,keypress:function(a){switch(a.which){case 27:case 38:case 37:b.close();break;case 39:case 40:b.open()}},mouseenter:function(){c.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")},mouseleave:function(){d(this).removeClass("ui-state-hover")},focus:function(){c.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")},blur:function(){d(this).removeClass("ui-state-focus")}});this.header.delegate("a","click.multiselect",function(a){if(d(this).hasClass("ui-multiselect-close"))b.close();else b[d(this).hasClass("ui-multiselect-all")?"checkAll":"uncheckAll"]();a.preventDefault()});this.menu.delegate("li.ui-multiselect-optgroup-label a","click.multiselect",function(a){a.preventDefault();var c=d(this),g=c.parent().nextUntil("li.ui-multiselect-optgroup-label").find("input:visible:not(:disabled)"),e=g.get(),c=c.parent().text();!1!==b._trigger("beforeoptgrouptoggle",a,{inputs:e,label:c})&&(b._toggleChecked(g.filter(":checked").length!==g.length,g),b._trigger("optgrouptoggle",a,{inputs:e,label:c,checked:e[0].checked}))}).delegate("label","mouseenter.multiselect",function(){d(this).hasClass("ui-state-disabled")||(b.labels.removeClass("ui-state-hover"),d(this).addClass("ui-state-hover").find("input").focus())}).delegate("label","keydown.multiselect",function(a){a.preventDefault();switch(a.which){case 9:case 27:b.close();break;case 38:case 40:case 37:case 39:b._traverse(a.which,this);break;case 13:d(this).find("input")[0].click()}}).delegate('input[type="checkbox"], input[type="radio"]',"click.multiselect",function(a){var c=d(this),g=this.value,e=this.checked,i=b.element.find("option");this.disabled||!1===b._trigger("click",a,{value:g,text:this.title,checked:e})?a.preventDefault():(c.focus(),c.attr("aria-selected",e),i.each(function(){this.value===g?this.selected=e:b.options.multiple||(this.selected=!1)}),b.options.multiple||(b.labels.removeClass("ui-state-active"),c.closest("label").toggleClass("ui-state-active",e),b.close()),b.element.trigger("change"),setTimeout(d.proxy(b.update,b),10))});d(document).bind("mousedown.multiselect",function(a){b._isOpen&&(!d.contains(b.menu[0],a.target)&&!d.contains(b.button[0],a.target)&&a.target!==b.button[0])&&b.close()});d(this.element[0].form).bind("reset.multiselect",function(){setTimeout(d.proxy(b.refresh,b),10)})},_setButtonWidth:function(){var a=this.element.outerWidth(),b=this.options;/\d/.test(b.minWidth)&&a<b.minWidth&&(a=b.minWidth);this.button.width(a)},_setMenuWidth:function(){var a=this.menu,b=this.button.outerWidth()-parseInt(a.css("padding-left"),10)-parseInt(a.css("padding-right"),10)-parseInt(a.css("border-right-width"),10)-parseInt(a.css("border-left-width"),10);a.width(b||this.button.outerWidth())},_traverse:function(a,b){var c=d(b),f=38===a||37===a,c=c.parent()[f?"prevAll":"nextAll"]("li:not(.ui-multiselect-disabled, .ui-multiselect-optgroup-label)")[f?"last":"first"]();c.length?c.find("label").trigger("mouseover"):(c=this.menu.find("ul").last(),this.menu.find("label")[f? "last":"first"]().trigger("mouseover"),c.scrollTop(f?c.height():0))},_toggleCheckbox:function(a,b){return function(){this.disabled||(this[a]=b);b?this.setAttribute("aria-selected",!0):this.removeAttribute("aria-selected")}},_toggleChecked:function(a,b){var c=b&&b.length?b:this.inputs,f=this;c.each(this._toggleCheckbox("checked",a));c.eq(0).focus();this.update();var h=c.map(function(){return this.value}).get();this.element.find("option").each(function(){!this.disabled&&-1<d.inArray(this.value,h)&&f._toggleCheckbox("selected",a).call(this)});c.length&&this.element.trigger("change")},_toggleDisabled:function(a){this.button.attr({disabled:a,"aria-disabled":a})[a?"addClass":"removeClass"]("ui-state-disabled");var b=this.menu.find("input"),b=a?b.filter(":enabled").data("ech-multiselect-disabled",!0):b.filter(function(){return!0===d.data(this,"ech-multiselect-disabled")}).removeData("ech-multiselect-disabled");b.attr({disabled:a,"arial-disabled":a}).parent()[a?"addClass":"removeClass"]("ui-state-disabled");this.element.attr({disabled:a,"aria-disabled":a})},open:function(){var a=this.button,b=this.menu,c=this.speed,f=this.options,h=[];if(!(!1===this._trigger("beforeopen")||a.hasClass("ui-state-disabled")||this._isOpen)){var g=b.find("ul").last(),e=f.show,i=a.offset();d.isArray(f.show)&&(e=f.show[0],c=f.show[1]||this.speed);e&&(h=[e,c]);g.scrollTop(0).height(f.height);d.ui.position&&!d.isEmptyObject(f.position)?(f.position.of=f.position.of||a,b.show().position(f.position).hide()):b.css({top:i.top+a.outerHeight(),left:i.left});d.fn.show.apply(b,h);this.labels.eq(0).trigger("mouseover").trigger("mouseenter").find("input").trigger("focus");a.addClass("ui-state-active");this._isOpen=!0;this._trigger("open")}},close:function(){if(!1!==this._trigger("beforeclose")){var a=this.options,b=a.hide,c=this.speed,f=[];d.isArray(a.hide)&&(b=a.hide[0],c=a.hide[1]||this.speed);b&&(f=[b,c]);d.fn.hide.apply(this.menu,f);this.button.removeClass("ui-state-active").trigger("blur").trigger("mouseleave");this._isOpen=!1;this._trigger("close")}},enable:function(){this._toggleDisabled(!1)},disable:function(){this._toggleDisabled(!0)},checkAll:function(){this._toggleChecked(!0);this._trigger("checkAll")},uncheckAll:function(){this._toggleChecked(!1);this._trigger("uncheckAll")},getChecked:function(){return this.menu.find("input").filter(":checked")},destroy:function(){d.Widget.prototype.destroy.call(this);this.button.remove();this.menu.remove();this.element.show();return this},isOpen:function(){return this._isOpen},widget:function(){return this.menu},getButton:function(){return this.button},_setOption:function(a,b){var c=this.menu;switch(a){case "header":c.find("div.ui-multiselect-header")[b?"show":"hide"]();break;case "checkAllText":c.find("a.ui-multiselect-all span").eq(-1).text(b);break;case "uncheckAllText":c.find("a.ui-multiselect-none span").eq(-1).text(b);break;case "height":c.find("ul").last().height(parseInt(b,10));break;case "minWidth":this.options[a]=parseInt(b,10);this._setButtonWidth();this._setMenuWidth();break;case "selectedText":case "selectedList":case "noneSelectedText":this.options[a]=b;this.update();break;case "classes":c.add(this.button).removeClass(this.options.classes).addClass(b);break;case "multiple":c.toggleClass("ui-multiselect-single",!b),this.options.multiple=b,this.element[0].multiple=b,this.refresh()}d.Widget.prototype._setOption.apply(this,arguments)}})})(jQuery);


/*
 * jQuery MultiSelect UI Widget Filtering Plugin 1.2
 * Copyright (c) 2011 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery UI MultiSelect widget
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
*/
(function(c){var f=/[\-\[\]{}()*+?.,\\^$|#\s]/g;c.widget("ech.multiselectfilter",{options:{label:"Filter:",width:null,placeholder:"Enter keywords"},_create:function(){var e;var a=this,b=this.options,d=this.instance=c(this.element).data("multiselect");this.header=d.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");e=this.wrapper=c('<div class="ui-multiselect-filter">'+(b.label.length?b.label:"")+'<input placeholder="'+b.placeholder+'" type="search"'+(/\d/.test(b.width)?'style="width:'+b.width+'px"':"")+" /></div>").prependTo(this.header),b=e;this.inputs=d.menu.find('input[type="checkbox"], input[type="radio"]');this.input=b.find("input").bind({keydown:function(a){a.which===13&&a.preventDefault()},keyup:c.proxy(a._handler,a),click:c.proxy(a._handler,a)});this.updateCache();d._toggleChecked=function(b,d){var e=d&&d.length?d:this.labels.find("input"),i=this,e=e.not(a.instance._isOpen?":disabled, :hidden":":disabled").each(this._toggleCheckbox("checked",b));this.update();var j=e.map(function(){return this.value}).get();this.element.find("option").filter(function(){!this.disabled&&c.inArray(this.value,j)>-1&&i._toggleCheckbox("selected",b).call(this)})};c(document).bind("multiselectrefresh",function(){a.updateCache();a._handler()})},_handler:function(a){var b=c.trim(this.input[0].value.toLowerCase()),d=this.rows,g=this.inputs,h=this.cache;if(b){d.hide();var e=RegExp(b.replace(f,"\\$&"),"gi");this._trigger("filter",a,c.map(h,function(a,b){if(a.search(e)!==-1)return d.eq(b).show(),g.get(b);return null}))}else d.show();this.instance.menu.find(".ui-multiselect-optgroup-label").each(function(){var a=c(this);a[a.nextUntil(".ui-multiselect-optgroup-label").filter(":visible").length?"show":"hide"]()})},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.element.children().map(function(){var a=c(this);this.tagName.toLowerCase()==="optgroup"&&(a=a.children());if(!a.val().length)return null;return a.map(function(){return this.innerHTML.toLowerCase()}).get()}).get()},widget:function(){return this.wrapper},destroy:function(){c.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})(jQuery);


/*
 * jQuery history plugin
 * 
 * sample page: http://www.mikage.to/jquery/jquery_history.html
 *
 * Copyright (c) 2006-2009 Taku Sano (Mikage Sawatari)
 * Licensed under the MIT License:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Modified by Lincoln Cooper to add Safari support and only call the callback once during initialization
 * for msie when no initial hash supplied.
 */


jQuery.extend({
	historyCurrentHash: undefined,
	historyCallback: undefined,
	historyIframeSrc: undefined,
	
	historyInit: function(callback, src){
		jQuery.historyCallback = callback;
		if (src) jQuery.historyIframeSrc = src;
		var current_hash = location.hash.replace(/\?.*$/, '');
		
		jQuery.historyCurrentHash = current_hash;
		// if ((jQuery.browser.msie) && (jQuery.browser.version < 8)) {
		if (jQuery.browser.msie) {
			// To stop the callback firing twice during initilization if no hash present
			if (jQuery.historyCurrentHash == '') {
			jQuery.historyCurrentHash = '#';
		}
		
			// add hidden iframe for IE
			jQuery("body").prepend('<iframe id="jQuery_history" style="display: none;"'+
				(jQuery.historyIframeSrc ? ' src="'+jQuery.historyIframeSrc+'"' : '')
				+'></iframe>'
			);
			var ihistory = jQuery("#jQuery_history")[0];
			var iframe = ihistory.contentWindow.document;
			iframe.open();
			iframe.close();
			iframe.location.hash = current_hash;
		}
		else if (jQuery.browser.safari) {
			// etablish back/forward stacks
			jQuery.historyBackStack = [];
			jQuery.historyBackStack.length = history.length;
			jQuery.historyForwardStack = [];
			jQuery.lastHistoryLength = history.length;
			
			jQuery.isFirst = true;
		}
		if(current_hash)
			jQuery.historyCallback(current_hash.replace(/^#/, ''));
		setInterval(jQuery.historyCheck, 100);
	},
	
	historyAddHistory: function(hash) {
		// This makes the looping function do something
		jQuery.historyBackStack.push(hash);
		
		jQuery.historyForwardStack.length = 0; // clear forwardStack (true click occured)
		this.isFirst = true;
	},
	
	historyCheck: function(){
		// if ((jQuery.browser.msie) && (jQuery.browser.version < 8)) {
		if (jQuery.browser.msie) {
			// On IE, check for location.hash of iframe
			var ihistory = jQuery("#jQuery_history")[0];
			var iframe = ihistory.contentDocument || ihistory.contentWindow.document;
			var current_hash = iframe.location.hash.replace(/\?.*$/, '');
			if(current_hash != jQuery.historyCurrentHash) {
			
				location.hash = current_hash;
				jQuery.historyCurrentHash = current_hash;
				jQuery.historyCallback(current_hash.replace(/^#/, ''));
				
			}
		} else if (jQuery.browser.safari) {
			if(jQuery.lastHistoryLength == history.length && jQuery.historyBackStack.length > jQuery.lastHistoryLength) {
				jQuery.historyBackStack.shift();
			}
			if (!jQuery.dontCheck) {
				var historyDelta = history.length - jQuery.historyBackStack.length;
				jQuery.lastHistoryLength = history.length;
				
				if (historyDelta) { // back or forward button has been pushed
					jQuery.isFirst = false;
					if (historyDelta < 0) { // back button has been pushed
						// move items to forward stack
						for (var i = 0; i < Math.abs(historyDelta); i++) jQuery.historyForwardStack.unshift(jQuery.historyBackStack.pop());
					} else { // forward button has been pushed
						// move items to back stack
						for (var i = 0; i < historyDelta; i++) jQuery.historyBackStack.push(jQuery.historyForwardStack.shift());
					}
					var cachedHash = jQuery.historyBackStack[jQuery.historyBackStack.length - 1];
					if (cachedHash != undefined) {
						jQuery.historyCurrentHash = location.hash.replace(/\?.*$/, '');
						jQuery.historyCallback(cachedHash);
					}
				} else if (jQuery.historyBackStack[jQuery.historyBackStack.length - 1] == undefined && !jQuery.isFirst) {
					// back button has been pushed to beginning and URL already pointed to hash (e.g. a bookmark)
					// document.URL doesn't change in Safari
					if (location.hash) {
						var current_hash = location.hash;
						jQuery.historyCallback(location.hash.replace(/^#/, ''));
					} else {
						var current_hash = '';
						jQuery.historyCallback('');
					}
					jQuery.isFirst = true;
				}
			}
		} else {
			// otherwise, check for location.hash
			var current_hash = location.hash.replace(/\?.*$/, '');
			if(current_hash != jQuery.historyCurrentHash) {
				jQuery.historyCurrentHash = current_hash;
				jQuery.historyCallback(current_hash.replace(/^#/, ''));
			}
		}
	},
	historyLoad: function(hash){
		var newhash;
		hash = decodeURIComponent(hash.replace(/\?.*$/, ''));
		
		if (jQuery.browser.safari) {
			newhash = hash;
		}
		else {
			newhash = '#' + hash;
			location.hash = newhash;
		}
		jQuery.historyCurrentHash = newhash;
		
		// if ((jQuery.browser.msie) && (jQuery.browser.version < 8)) {
		if (jQuery.browser.msie) {
			var ihistory = jQuery("#jQuery_history")[0];
			var iframe = ihistory.contentWindow.document;
			iframe.open();
			iframe.close();
			iframe.location.hash = newhash;
			jQuery.lastHistoryLength = history.length;
			jQuery.historyCallback(hash);
		}
		else if (jQuery.browser.safari) {
			jQuery.dontCheck = true;
			// Manually keep track of the history values for Safari
			this.historyAddHistory(hash);
			
			// Wait a while before allowing checking so that Safari has time to update the "history" object
			// correctly (otherwise the check loop would detect a false change in hash).
			var fn = function() {jQuery.dontCheck = false;};
			window.setTimeout(fn, 200);
			jQuery.historyCallback(hash);
			// N.B. "location.hash=" must be the last line of code for Safari as execution stops afterwards.
			//      By explicitly using the "location.hash" command (instead of using a variable set to "location.hash") the
			//      URL in the browser and the "history" object are both updated correctly.
			location.hash = newhash;
		}
		else {
		  jQuery.historyCallback(hash);
		}
	}
});




/**
 * jQuery Galleriffic plugin
 *
 * Copyright (c) 2008 Trent Foley (http://trentacular.com)
 * Licensed under the MIT License:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Much thanks to primary contributer Ponticlaro (http://www.ponticlaro.com)
 */
;(function($) {
	// Globally keep track of all images by their unique hash.  Each item is an image data object.
	var allImages = {};
	var imageCounter = 0;

	// Galleriffic static class
	$.galleriffic = {
		version: '2.0.1',

		// Strips invalid characters and any leading # characters
		normalizeHash: function(hash) {
			return hash.replace(/^.*#/, '').replace(/\?.*$/, '');
		},

		getImage: function(hash) {
			if (!hash)
				return undefined;

			hash = $.galleriffic.normalizeHash(hash);
			return allImages[hash];
		},

		// Global function that looks up an image by its hash and displays the image.
		// Returns false when an image is not found for the specified hash.
		// @param {String} hash This is the unique hash value assigned to an image.
		gotoImage: function(hash) {
			var imageData = $.galleriffic.getImage(hash);
			if (!imageData)
				return false;

			var gallery = imageData.gallery;
			gallery.gotoImage(imageData);
			
			return true;
		},

		// Removes an image from its respective gallery by its hash.
		// Returns false when an image is not found for the specified hash or the
		// specified owner gallery does match the located images gallery.
		// @param {String} hash This is the unique hash value assigned to an image.
		// @param {Object} ownerGallery (Optional) When supplied, the located images
		// gallery is verified to be the same as the specified owning gallery before
		// performing the remove operation.
		removeImageByHash: function(hash, ownerGallery) {
			var imageData = $.galleriffic.getImage(hash);
			if (!imageData)
				return false;

			var gallery = imageData.gallery;
			if (ownerGallery && ownerGallery != gallery)
				return false;

			return gallery.removeImageByIndex(imageData.index);
		}
	};

	var defaults = {
		delay:                     3000,
		numThumbs:                 20,
		preloadAhead:              40, // Set to -1 to preload all images
		enableTopPager:            false,
		enableBottomPager:         true,
		maxPagesToShow:            7,
		imageContainerSel:         '',
		captionContainerSel:       '',
		controlsContainerSel:      '',
		loadingContainerSel:       '',
		renderSSControls:          true,
		renderNavControls:         true,
		playLinkText:              'Play',
		pauseLinkText:             'Pause',
		prevLinkText:              'Previous',
		nextLinkText:              'Next',
		nextPageLinkText:          'Next &rsaquo;',
		prevPageLinkText:          '&lsaquo; Prev',
		enableHistory:             false,
		enableKeyboardNavigation:  true,
		autoStart:                 false,
		syncTransitions:           false,
		defaultTransitionDuration: 1000,
		onLoad:					   undefined, // accepts a delegate like such: function() { ... }
		onSlideChange:             undefined, // accepts a delegate like such: function(prevIndex, nextIndex) { ... }
		onTransitionOut:           undefined, // accepts a delegate like such: function(slide, caption, isSync, callback) { ... }
		onTransitionIn:            undefined, // accepts a delegate like such: function(slide, caption, isSync) { ... }
		onPageTransitionOut:       undefined, // accepts a delegate like such: function(callback) { ... }
		onPageTransitionIn:        undefined, // accepts a delegate like such: function() { ... }
		onImageAdded:              undefined, // accepts a delegate like such: function(imageData, $li) { ... }
		onImageRemoved:            undefined  // accepts a delegate like such: function(imageData, $li) { ... }
	};

	// Primary Galleriffic initialization function that should be called on the thumbnail container.
	$.fn.galleriffic = function(settings) {
		//  Extend Gallery Object
		$.extend(this, {
			// Returns the version of the script
			version: $.galleriffic.version,

			// Current state of the slideshow
			isSlideshowRunning: false,
			slideshowTimeout: undefined,

			// This function is attached to the click event of generated hyperlinks within the gallery
			clickHandler: function(e, link) {
				this.pause();

				if (!this.enableHistory) {
					// The href attribute holds the unique hash for an image
					var hash = $.galleriffic.normalizeHash($(link).attr('href'));
					$.galleriffic.gotoImage(hash);
					e.preventDefault();
				}
			},

			// Appends an image to the end of the set of images.  Argument listItem can be either a jQuery DOM element or arbitrary html.
			// @param listItem Either a jQuery object or a string of html of the list item that is to be added to the gallery.
			appendImage: function(listItem) {
				this.addImage(listItem, false, false);
				return this;
			},

			// Inserts an image into the set of images.  Argument listItem can be either a jQuery DOM element or arbitrary html.
			// @param listItem Either a jQuery object or a string of html of the list item that is to be added to the gallery.
			// @param {Integer} position The index within the gallery where the item shouold be added.
			insertImage: function(listItem, position) {
				this.addImage(listItem, false, true, position);
				return this;
			},

			// Adds an image to the gallery and optionally inserts/appends it to the DOM (thumbExists)
			// @param listItem Either a jQuery object or a string of html of the list item that is to be added to the gallery.
			// @param {Boolean} thumbExists Specifies whether the thumbnail already exists in the DOM or if it needs to be added.
			// @param {Boolean} insert Specifies whether the the image is appended to the end or inserted into the gallery.
			// @param {Integer} position The index within the gallery where the item shouold be added.
			addImage: function(listItem, thumbExists, insert, position) {
				var $li = ( typeof listItem === "string" ) ? $(listItem) : listItem;				
				var $aThumb = $li.find('a.thumb');
				var slideUrl = $aThumb.attr('href');
				var title = $aThumb.attr('title');
				var $caption = $li.find('.caption').remove();
				var hash = $aThumb.attr('name');

				// Increment the image counter
				imageCounter++;

				// Autogenerate a hash value if none is present or if it is a duplicate
				if (!hash || allImages[''+hash]) {
					hash = imageCounter;
				}

				// Set position to end when not specified
				if (!insert)
					position = this.data.length;
				
				var imageData = {
					title:title,
					slideUrl:slideUrl,
					caption:$caption,
					hash:hash,
					gallery:this,
					index:position
				};

				// Add the imageData to this gallery's array of images
				if (insert) {
					this.data.splice(position, 0, imageData);

					// Reset index value on all imageData objects
					this.updateIndices(position);
				}
				else {
					this.data.push(imageData);
				}

				var gallery = this;

				// Add the element to the DOM
				if (!thumbExists) {
					// Update thumbs passing in addition post transition out handler
					this.updateThumbs(function() {
						var $thumbsUl = gallery.find('ul.thumbs');
						if (insert)
							$thumbsUl.children(':eq('+position+')').before($li);
						else
							$thumbsUl.append($li);
						
						if (gallery.onImageAdded)
							gallery.onImageAdded(imageData, $li);
					});
				}

				// Register the image globally
				allImages[''+hash] = imageData;

				// Setup attributes and click handler
				$aThumb.attr('rel', 'history')
					.attr('href', '#'+hash)
					.removeAttr('name')
					.click(function(e) {
						gallery.clickHandler(e, this);
					});

				return this;
			},

			// Removes an image from the gallery based on its index.
			// Returns false when the index is out of range.
			removeImageByIndex: function(index) {
				if (index < 0 || index >= this.data.length)
					return false;
				
				var imageData = this.data[index];
				if (!imageData)
					return false;
				
				this.removeImage(imageData);
				
				return true;
			},

			// Convenience method that simply calls the global removeImageByHash method.
			removeImageByHash: function(hash) {
				return $.galleriffic.removeImageByHash(hash, this);
			},

			// Removes an image from the gallery.
			removeImage: function(imageData) {
				var index = imageData.index;
				
				// Remove the image from the gallery data array
				this.data.splice(index, 1);
				
				// Remove the global registration
				delete allImages[''+imageData.hash];
				
				// Remove the image's list item from the DOM
				this.updateThumbs(function() {
					var $li = gallery.find('ul.thumbs')
						.children(':eq('+index+')')
						.remove();

					if (gallery.onImageRemoved)
						gallery.onImageRemoved(imageData, $li);
				});

				// Update each image objects index value
				this.updateIndices(index);

				return this;
			},

			// Updates the index values of the each of the images in the gallery after the specified index
			updateIndices: function(startIndex) {
				for (i = startIndex; i < this.data.length; i++) {
					this.data[i].index = i;
				}
				
				return this;
			},

			// Scraped the thumbnail container for thumbs and adds each to the gallery
			initializeThumbs: function() {
				this.data = [];
				var gallery = this;

				this.find('ul.thumbs > li').each(function(i) {
					gallery.addImage($(this), true, false);
				});

				return this;
			},

			isPreloadComplete: false,

			// Initalizes the image preloader
			preloadInit: function() {
				if (this.preloadAhead == 0) return this;
				
				this.preloadStartIndex = this.currentImage.index;
				var nextIndex = this.getNextIndex(this.preloadStartIndex);
				return this.preloadRecursive(this.preloadStartIndex, nextIndex);
			},

			// Changes the location in the gallery the preloader should work
			// @param {Integer} index The index of the image where the preloader should restart at.
			preloadRelocate: function(index) {
				// By changing this startIndex, the current preload script will restart
				this.preloadStartIndex = index;
				return this;
			},

			// Recursive function that performs the image preloading
			// @param {Integer} startIndex The index of the first image the current preloader started on.
			// @param {Integer} currentIndex The index of the current image to preload.
			preloadRecursive: function(startIndex, currentIndex) {
				// Check if startIndex has been relocated
				if (startIndex != this.preloadStartIndex) {
					var nextIndex = this.getNextIndex(this.preloadStartIndex);
					return this.preloadRecursive(this.preloadStartIndex, nextIndex);
				}

				var gallery = this;

				// Now check for preloadAhead count
				var preloadCount = currentIndex - startIndex;
				if (preloadCount < 0)
					preloadCount = this.data.length-1-startIndex+currentIndex;
				if (this.preloadAhead >= 0 && preloadCount > this.preloadAhead) {
					// Do this in order to keep checking for relocated start index
					setTimeout(function() { gallery.preloadRecursive(startIndex, currentIndex); }, 500);
					return this;
				}

				var imageData = this.data[currentIndex];
				if (!imageData)
					return this;

				// If already loaded, continue
				if (imageData.image)
					return this.preloadNext(startIndex, currentIndex); 
				
				// Preload the image
				var image = new Image();
				
				image.onload = function() {
					imageData.image = this;
					gallery.preloadNext(startIndex, currentIndex);
				};

				image.alt = imageData.title;
				image.src = imageData.slideUrl;

				return this;
			},
			
			// Called by preloadRecursive in order to preload the next image after the previous has loaded.
			// @param {Integer} startIndex The index of the first image the current preloader started on.
			// @param {Integer} currentIndex The index of the current image to preload.
			preloadNext: function(startIndex, currentIndex) {
				var nextIndex = this.getNextIndex(currentIndex);
				if (nextIndex == startIndex) {
					this.isPreloadComplete = true;
				} else {
					// Use setTimeout to free up thread
					var gallery = this;
					setTimeout(function() { gallery.preloadRecursive(startIndex, nextIndex); }, 100);
				}

				return this;
			},

			// Safe way to get the next image index relative to the current image.
			// If the current image is the last, returns 0
			getNextIndex: function(index) {
				var nextIndex = index+1;
				if (nextIndex >= this.data.length)
					nextIndex = 0;
				return nextIndex;
			},

			// Safe way to get the previous image index relative to the current image.
			// If the current image is the first, return the index of the last image in the gallery.
			getPrevIndex: function(index) {
				var prevIndex = index-1;
				if (prevIndex < 0)
					prevIndex = this.data.length-1;
				return prevIndex;
			},

			// Pauses the slideshow
			pause: function() {
				this.isSlideshowRunning = false;
				if (this.slideshowTimeout) {
					clearTimeout(this.slideshowTimeout);
					this.slideshowTimeout = undefined;
				}

				if (this.$controlsContainer) {
					this.$controlsContainer
						.find('div.ss-controls a').removeClass('pause ui-icon-pause').addClass('play ui-icon-play')
						.attr('title', this.playLinkText)
						.attr('href', '#play')
						.html(this.playLinkText);
				}
				
				return this;
			},

			// Plays the slideshow
			play: function() {
				this.isSlideshowRunning = true;

				if (this.$controlsContainer) {
					this.$controlsContainer
						.find('div.ss-controls a').removeClass('play ui-icon-play').addClass('pause ui-icon-pause')
						.attr('title', this.pauseLinkText)
						.attr('href', '#pause')
						.html(this.pauseLinkText);
				}

				if (!this.slideshowTimeout) {
					var gallery = this;
					this.slideshowTimeout = setTimeout(function() { gallery.ssAdvance(); }, this.delay);
				}

				return this;
			},

			// Toggles the state of the slideshow (playing/paused)
			toggleSlideshow: function() {
				if (this.isSlideshowRunning)
					this.pause();
				else
					this.play();

				return this;
			},

			// Advances the slideshow to the next image and delegates navigation to the
			// history plugin when history is enabled
			// enableHistory is true
			ssAdvance: function() {
				if (this.isSlideshowRunning)
					this.next(true);

				return this;
			},

			// Advances the gallery to the next image.
			// @param {Boolean} dontPause Specifies whether to pause the slideshow.
			// @param {Boolean} bypassHistory Specifies whether to delegate navigation to the history plugin when history is enabled.  
			next: function(dontPause, bypassHistory) {
				this.gotoIndex(this.getNextIndex(this.currentImage.index), dontPause, bypassHistory);
				return this;
			},

			// Navigates to the previous image in the gallery.
			// @param {Boolean} dontPause Specifies whether to pause the slideshow.
			// @param {Boolean} bypassHistory Specifies whether to delegate navigation to the history plugin when history is enabled.
			previous: function(dontPause, bypassHistory) {
				this.gotoIndex(this.getPrevIndex(this.currentImage.index), dontPause, bypassHistory);
				return this;
			},

			// Navigates to the next page in the gallery.
			// @param {Boolean} dontPause Specifies whether to pause the slideshow.
			// @param {Boolean} bypassHistory Specifies whether to delegate navigation to the history plugin when history is enabled.
			nextPage: function(dontPause, bypassHistory) {
				var page = this.getCurrentPage();
				var lastPage = this.getNumPages() - 1;
				if (page < lastPage) {
					var startIndex = page * this.numThumbs;
					var nextPage = startIndex + this.numThumbs;
					this.gotoIndex(nextPage, dontPause, bypassHistory);
				}

				return this;
			},

			// Navigates to the previous page in the gallery.
			// @param {Boolean} dontPause Specifies whether to pause the slideshow.
			// @param {Boolean} bypassHistory Specifies whether to delegate navigation to the history plugin when history is enabled.
			previousPage: function(dontPause, bypassHistory) {
				var page = this.getCurrentPage();
				if (page > 0) {
					var startIndex = page * this.numThumbs;
					var prevPage = startIndex - this.numThumbs;				
					this.gotoIndex(prevPage, dontPause, bypassHistory);
				}
				
				return this;
			},

			// Navigates to the image at the specified index in the gallery
			// @param {Integer} index The index of the image in the gallery to display.
			// @param {Boolean} dontPause Specifies whether to pause the slideshow.
			// @param {Boolean} bypassHistory Specifies whether to delegate navigation to the history plugin when history is enabled.
			gotoIndex: function(index, dontPause, bypassHistory) {
				if (!dontPause)
					this.pause();
				
				if (index < 0) index = 0;
				else if (index >= this.data.length) index = this.data.length-1;
				
				var imageData = this.data[index];
				
				if (!bypassHistory && this.enableHistory)
					$.historyLoad(String(imageData.hash));  // At the moment, historyLoad only accepts string arguments
				else
					this.gotoImage(imageData);

				return this;
			},

			// This function is garaunteed to be called anytime a gallery slide changes.
			// @param {Object} imageData An object holding the image metadata of the image to navigate to.
			gotoImage: function(imageData) {
				var index = imageData.index;

				if (this.onSlideChange)
					this.onSlideChange(this.currentImage.index, index);
				
				this.currentImage = imageData;
				this.preloadRelocate(index);
				
				this.refresh();
				
				return this;
			},

			// Returns the default transition duration value.  The value is halved when not
			// performing a synchronized transition.
			// @param {Boolean} isSync Specifies whether the transitions are synchronized.
			getDefaultTransitionDuration: function(isSync) {
				if (isSync)
					return this.defaultTransitionDuration;
				return this.defaultTransitionDuration / 2;
			},

			// Rebuilds the slideshow image and controls and performs transitions
			refresh: function() {
				var imageData = this.currentImage;
				if (!imageData)
					return this;

				var index = imageData.index;

				// Update Controls
				if (this.$controlsContainer) {
					this.$controlsContainer
						.find('div.nav-controls a.prev').attr('href', '#'+this.data[this.getPrevIndex(index)].hash).end()
						.find('div.nav-controls a.next').attr('href', '#'+this.data[this.getNextIndex(index)].hash);
				}

				var previousSlide = this.$imageContainer.find('span.current').addClass('previous').removeClass('current');
				var previousCaption = 0;

				if (this.$captionContainer) {
					previousCaption = this.$captionContainer.find('span.current').addClass('previous').removeClass('current');
				}

				// Perform transitions simultaneously if syncTransitions is true and the next image is already preloaded
				var isSync = this.syncTransitions && imageData.image;

				// Flag we are transitioning
				var isTransitioning = true;
				var gallery = this;

				var transitionOutCallback = function() {
					// Flag that the transition has completed
					isTransitioning = false;

					// Remove the old slide
					previousSlide.remove();

					// Remove old caption
					if (previousCaption)
						previousCaption.remove();

					if (!isSync) {
						if (imageData.image && imageData.hash == gallery.data[gallery.currentImage.index].hash) {
							gallery.buildImage(imageData, isSync);
						} else {
							// Show loading container
							if (gallery.$loadingContainer) {
								gallery.$loadingContainer.show();
							}
						}
					}
				};

				if (previousSlide.length == 0) {
					// For the first slide, the previous slide will be empty, so we will call the callback immediately
					transitionOutCallback();
				} else {
					if (this.onTransitionOut) {
						this.onTransitionOut(previousSlide, previousCaption, isSync, transitionOutCallback);
					} else {
						//previousSlide.fadeTo(this.getDefaultTransitionDuration(isSync), 0.0, transitionOutCallback);
						previousSlide.css('opacity', 0.0);
						transitionOutCallback();
						if (previousCaption)
							//previousCaption.fadeTo(this.getDefaultTransitionDuration(isSync), 0.0);
							previousCaption.css('opacity', 0.0);
							transitionOutCallback();
					}
				}

				// Go ahead and begin transitioning in of next image
				if (isSync)
					this.buildImage(imageData, isSync);

				if (!imageData.image) {
					var image = new Image();
					
					// Wire up mainImage onload event
					image.onload = function() {
						imageData.image = this;

						// Only build image if the out transition has completed and we are still on the same image hash
						if (!isTransitioning && imageData.hash == gallery.data[gallery.currentImage.index].hash) {
							gallery.buildImage(imageData, isSync);
						}
					};

					// set alt and src
					image.alt = imageData.title;
					image.src = imageData.slideUrl;
				}

				// This causes the preloader (if still running) to relocate out from the currentIndex
				this.relocatePreload = true;

				return this.syncThumbs();
			},

			// Called by the refresh method after the previous image has been transitioned out or at the same time
			// as the out transition when performing a synchronous transition.
			// @param {Object} imageData An object holding the image metadata of the image to build.
			// @param {Boolean} isSync Specifies whether the transitions are synchronized.
			buildImage: function(imageData, isSync) {
				var gallery = this;
				var nextIndex = this.getNextIndex(imageData.index);

				// Construct new hidden span for the image
				var newSlide = this.$imageContainer
					.prepend('<span class="image-wrapper current"><a class="advance-link" rel="history" href="#'+this.data[nextIndex].hash+'" title="'+imageData.title+'"></a></span>')
					.find('span.current').css('opacity', '0');
				
				newSlide.find('a')
					.append(imageData.image)
					.click(function(e) {
						gallery.clickHandler(e, this);
					});
				
				var newCaption = 0;
				if (this.$captionContainer) {
					// Construct new hidden caption for the image
					newCaption = this.$captionContainer
						.append('<span class="image-caption current"></span>')
						.find('span.current').css('opacity', '0')
						.append(imageData.caption);
				}

				// Hide the loading conatiner
				if (this.$loadingContainer) {
					this.$loadingContainer.hide();
				}

				// Transition in the new image
				if (this.onTransitionIn) {
					this.onTransitionIn(newSlide, newCaption, isSync);
				}
				
				//newSlide.fadeTo(this.getDefaultTransitionDuration(isSync), 1.0);
				newSlide.css('opacity', 1.0);
				if (newCaption)
					//newCaption.fadeTo(this.getDefaultTransitionDuration(isSync), 1.0);
					newCaption.css('opacity', 1.0);
				
				if (this.isSlideshowRunning) {
					if (this.slideshowTimeout)
						clearTimeout(this.slideshowTimeout);

					this.slideshowTimeout = setTimeout(function() { gallery.ssAdvance(); }, this.delay);
				}

				return this;
			},

			// Returns the current page index that should be shown for the currentImage
			getCurrentPage: function() {
				return Math.floor(this.currentImage.index / this.numThumbs);
			},

			// Applies the selected class to the current image's corresponding thumbnail.
			// Also checks if the current page has changed and updates the displayed page of thumbnails if necessary.
			syncThumbs: function() {
				var page = this.getCurrentPage();
				if (page != this.displayedPage)
					this.updateThumbs();

				// Remove existing selected class and add selected class to new thumb
				var $thumbs = this.find('ul.thumbs').children();
				$thumbs.filter('.selected').removeClass('selected');
				$thumbs.eq(this.currentImage.index).addClass('selected');

				return this;
			},

			// Performs transitions on the thumbnails container and updates the set of
			// thumbnails that are to be displayed and the navigation controls.
			// @param {Delegate} postTransitionOutHandler An optional delegate that is called after
			// the thumbnails container has transitioned out and before the thumbnails are rebuilt.
			updateThumbs: function(postTransitionOutHandler) {
				var gallery = this;
				var transitionOutCallback = function() {
					// Call the Post-transition Out Handler
					if (postTransitionOutHandler)
						postTransitionOutHandler();
					
					gallery.rebuildThumbs();

					// Transition In the thumbsContainer
					if (gallery.onPageTransitionIn)
						gallery.onPageTransitionIn();
					else
						gallery.show();
				};

				// Transition Out the thumbsContainer
				if (this.onPageTransitionOut) {
					this.onPageTransitionOut(transitionOutCallback);
				} else {
					this.hide();
					transitionOutCallback();
				}

				return this;
			},

			// Updates the set of thumbnails that are to be displayed and the navigation controls.
			rebuildThumbs: function() {
				var needsPagination = this.data.length > this.numThumbs;

				// Rebuild top pager
				if (this.enableTopPager) {
					var $topPager = this.find('div.top');
					if ($topPager.length == 0)
						$topPager = this.prepend('<div class="top pagination"></div>').find('div.top');
					else
						$topPager.empty();

					if (needsPagination)
						this.buildPager($topPager);
				}

				// Rebuild bottom pager
				if (this.enableBottomPager) {
					var $bottomPager = this.find('div.bottom');
					if ($bottomPager.length == 0)
						$bottomPager = this.append('<div class="bottom pagination"></div>').find('div.bottom');
					else
						$bottomPager.empty();

					if (needsPagination)
						this.buildPager($bottomPager);
				}

				var page = this.getCurrentPage();
				var startIndex = page*this.numThumbs;
				var stopIndex = startIndex+this.numThumbs-1;
				if (stopIndex >= this.data.length)
					stopIndex = this.data.length-1;

				// Show/Hide thumbs
				var $thumbsUl = this.find('ul.thumbs');
				$thumbsUl.find('li').each(function(i) {
					var $li = $(this);
					if (i >= startIndex && i <= stopIndex) {
						$li.show();
					} else {
						$li.hide();
					}
				});

				this.displayedPage = page;

				// Remove the noscript class from the thumbs container ul
				$thumbsUl.removeClass('noscript');
				
				return this;
			},

			// Returns the total number of pages required to display all the thumbnails.
			getNumPages: function() {
				return Math.ceil(this.data.length/this.numThumbs);
			},

			// Rebuilds the pager control in the specified matched element.
			// @param {jQuery} pager A jQuery element set matching the particular pager to be rebuilt.
			buildPager: function(pager) {
				var gallery = this;
				var numPages = this.getNumPages();
				var page = this.getCurrentPage();
				var startIndex = page * this.numThumbs;
				var pagesRemaining = this.maxPagesToShow - 1;
				
				var pageNum = page - Math.floor((this.maxPagesToShow - 1) / 2) + 1;
				if (pageNum > 0) {
					var remainingPageCount = numPages - pageNum;
					if (remainingPageCount < pagesRemaining) {
						pageNum = pageNum - (pagesRemaining - remainingPageCount);
					}
				}

				if (pageNum < 0) {
					pageNum = 0;
				}

				// Prev Page Link
				if (page > 0) {
					var prevPage = startIndex - this.numThumbs;
					pager.append('<a rel="history" href="#'+this.data[prevPage].hash+'" title="'+this.prevPageLinkText+'">'+this.prevPageLinkText+'</a>');
				}

				// Create First Page link if needed
				if (pageNum > 0) {
					this.buildPageLink(pager, 0, numPages);
					if (pageNum > 1)
						pager.append('<span class="ellipsis">&hellip;</span>');
					
					pagesRemaining--;
				}

				// Page Index Links
				while (pagesRemaining > 0) {
					this.buildPageLink(pager, pageNum, numPages);
					pagesRemaining--;
					pageNum++;
				}

				// Create Last Page link if needed
				if (pageNum < numPages) {
					var lastPageNum = numPages - 1;
					if (pageNum < lastPageNum)
						pager.append('<span class="ellipsis">&hellip;</span>');

					this.buildPageLink(pager, lastPageNum, numPages);
				}

				// Next Page Link
				var nextPage = startIndex + this.numThumbs;
				if (nextPage < this.data.length) {
					pager.append('<a rel="history" href="#'+this.data[nextPage].hash+'" title="'+this.nextPageLinkText+'">'+this.nextPageLinkText+'</a>');
				}

				pager.find('a').click(function(e) {
					gallery.clickHandler(e, this);
				});

				return this;
			},

			// Builds a single page link within a pager.  This function is called by buildPager
			// @param {jQuery} pager A jQuery element set matching the particular pager to be rebuilt.
			// @param {Integer} pageNum The page number of the page link to build.
			// @param {Integer} numPages The total number of pages required to display all thumbnails.
			buildPageLink: function(pager, pageNum, numPages) {
				var pageLabel = pageNum + 1;
				var currentPage = this.getCurrentPage();
				if (pageNum == currentPage)
					pager.append('<span class="current">'+pageLabel+'</span>');
				else if (pageNum < numPages) {
					var imageIndex = pageNum*this.numThumbs;
					pager.append('<a rel="history" href="#'+this.data[imageIndex].hash+'" title="'+pageLabel+'">'+pageLabel+'</a>');
				}
				
				return this;
			}
		});

		// Now initialize the gallery
		$.extend(this, defaults, settings);
		
		// Verify the history plugin is available
		if (this.enableHistory && !$.historyInit)
			this.enableHistory = false;
		
		// Select containers
		if (this.imageContainerSel) this.$imageContainer = $(this.imageContainerSel);
		if (this.captionContainerSel) this.$captionContainer = $(this.captionContainerSel);
		if (this.loadingContainerSel) this.$loadingContainer = $(this.loadingContainerSel);

		// Initialize the thumbails
		this.initializeThumbs();
		
		if (this.maxPagesToShow < 3)
			this.maxPagesToShow = 3;

		this.displayedPage = -1;
		this.currentImage = this.data[0];
		var gallery = this;

		// Hide the loadingContainer
		if (this.$loadingContainer)
			this.$loadingContainer.hide();

		// Setup controls
		if (this.controlsContainerSel) {
			this.$controlsContainer = $(this.controlsContainerSel);//.empty()
			
			if (this.renderSSControls) {
				if (this.autoStart) {
					this.$controlsContainer
						.append('<div class="ss-controls"><a href="#pause" class="pause ui-icon ui-icon-pause" title="'+this.pauseLinkText+'">'+this.pauseLinkText+'</a></div>');
				} else {
					this.$controlsContainer
						.append('<div class="ss-controls"><a href="#play" class="play ui-icon ui-icon-play" title="'+this.playLinkText+'">'+this.playLinkText+'</a></div>');
				}

				this.$controlsContainer.find('div.ss-controls a')
					.click(function(e) {
						gallery.toggleSlideshow();
						e.preventDefault();
						return false;
					});
			}
		
			if (this.renderNavControls) {
				this.$controlsContainer
					.append('<div class="nav-controls"><a class="prev ui-icon ui-icon-seek-prev" rel="history" title="'+this.prevLinkText+'">'+this.prevLinkText+'</a><a class="next ui-icon ui-icon-seek-next" rel="history" title="'+this.nextLinkText+'">'+this.nextLinkText+'</a></div>')
					.find('div.nav-controls a')
					.click(function(e) {
						gallery.clickHandler(e, this);
					});
			}
		}

		var initFirstImage = !this.enableHistory || !location.hash;
		if (this.enableHistory && location.hash) {
			var hash = $.galleriffic.normalizeHash(location.hash);
			var imageData = allImages[hash];
			if (!imageData)
				initFirstImage = true;
		}

		// Setup gallery to show the first image
		if (initFirstImage)
			this.gotoIndex(0, false, true);

		// Setup Keyboard Navigation
		if (this.enableKeyboardNavigation) {
			$(document).keydown(function(e) {
				var key = e.charCode ? e.charCode : e.keyCode ? e.keyCode : 0;
				switch(key) {
					/*case 32: // space
						gallery.next();
						e.preventDefault();
						break;*/
					case 33: // Page Up
						gallery.previousPage();
						e.preventDefault();
						break;
					case 34: // Page Down
						gallery.nextPage();
						e.preventDefault();
						break;
					case 35: // End
						gallery.gotoIndex(gallery.data.length-1);
						e.preventDefault();
						break;
					case 36: // Home
						gallery.gotoIndex(0);
						e.preventDefault();
						break;
					case 37: // left arrow
						gallery.previous();
						e.preventDefault();
						break;
					case 39: // right arrow
						gallery.next();
						e.preventDefault();
						break;
				}
			});
		}
		
		// onLoad event
		if (this.onLoad)
			this.onLoad();

		// Auto start the slideshow
		if (this.autoStart)
			this.play();

		// Kickoff Image Preloader after 1 second
		setTimeout(function() { gallery.preloadInit(); }, 1000);

		return this;
	};
})(jQuery);


/**
 * jQuery Opacity Rollover plugin
 *
 * Copyright (c) 2009 Trent Foley (http://trentacular.com)
 * Licensed under the MIT License:
 *   http://www.opensource.org/licenses/mit-license.php
 */
;(function($) {
	var defaults = {
		mouseOutOpacity:   0.67,
		mouseOverOpacity:  1.0,
		fadeSpeed:         'fast',
		exemptionSelector: '.selected'
	};

	$.fn.opacityrollover = function(settings) {
		// Initialize the effect
		$.extend(this, defaults, settings);

		var config = this;

		function fadeTo(element, opacity) {
			var $target = $(element);
			
			if (config.exemptionSelector)
				$target = $target.not(config.exemptionSelector);	
			
			$target.fadeTo(config.fadeSpeed, opacity);
		}

		this.css('opacity', this.mouseOutOpacity)
			.hover(
				function () {
					fadeTo(this, config.mouseOverOpacity);
				},
				function () {
					fadeTo(this, config.mouseOutOpacity);
				});

		return this;
	};
})(jQuery);


ua = navigator.userAgent;
isMSIE = (navigator.appName == "Microsoft Internet Explorer");
isMSIE7 = isMSIE && (ua.indexOf('MSIE 7') != -1)

function strpos(haystack, needle, offset) {
    var i = (haystack + '').indexOf(needle, offset);
    return i === -1 ? false : i;
}

function ucfirst(str) {
    if (str.length > 0) {
        return str[0].toUpperCase() + str.substring(1);
    } else {
        return str;
    }
}

function menu_montre(elem) {
    menu_cache();
    jQuery(elem).addClass("hovered");
    jQuery('#ss_menu_' + jQuery(elem).attr('id')).show();
}

function menu_cache() {
    jQuery('nav#main .ss_menu').hide();
    jQuery('nav#main #menu li').removeClass("hovered");
}

function menu_mini_montre(elem) {
    jQuery(elem).find('.icon').addClass('on');
    jQuery('#header_menu_line').show();
    menu_mini_opened = true;
}

function menu_mini_cache(elem) {
    jQuery(elem).find('.icon').removeClass('on');
    jQuery('#header_menu_line').hide();
    menu_mini_opened = false;
}

function initConnectScreen() {
    if (jQuery().cookie && jQuery.cookie('jardi_connectSC') == 1 && jQuery('#connect_screen_close').length > 0) {
        jQuery('#connect_screen_close').show();
        jQuery(window).scroll(function () {
            jQuery(this).scrollTop(0);
        });
        jQuery('body').css('overflow', 'hidden');
        jQuery('#connect_screen').fadeIn('slow');

        jQuery('.connect_screen_close').click(function (e) {
            e.preventDefault();
            jQuery('body').css('overflow', 'auto');
            jQuery('#connect_screen').hide();
            jQuery(window).unbind('scroll');
            initScrollMenu();
            initShare();
            feedCol();
        });
    }
}
initConnectScreen();

function initMenu() {

    hover_blocked = false;
    menu_mini_opened = false;

    jQuery('nav#main #menu li').hover(
        function () {
            menu_montre(this);
        }
    );

    jQuery('.ss_menu').hover(
        function () {
        },
        function () {
            menu_cache();
        }
    );

    jQuery('#tetiere').hover(
        function () {
            menu_cache();
        },
        function () {
        }
    );

    jQuery('#menu_link').click(function (e) {
        if (menu_mini_opened)menu_mini_cache(this);
        else menu_mini_montre(this);
    });
    if (!isMSIE) {
        initScrollMenu();
    }
}

function initScrollMenu() {

    jQuery(window).scroll(function () {
        if (jQuery(this).scrollTop() >= 130) {
            jQuery('body').addClass('mini');
            menu_mini_cache('#menu_link');
            jQuery('#menu_link').find('.icon').removeClass('on');
        } else {
            jQuery('body').removeClass('mini');
            menu_mini_montre('#menu_link');
        }
    });
}

/**** fonctions d'alertes *******/

function initDialog() {
    jQuery(".alertDialog").dialog({
        modal: true,
        buttons: {
            ok: function () {
                if (jQuery(this).attr('redir') == '')jQuery(this).dialog("close");
                else self.location.href = jQuery(this).attr('alt');
            }
        }
    });
}

function alert(txt, extrabout) {
    if (txt != '') {
        alertDialog(txt, 350, 200, extrabout);
    }
}

function alertDialog(txt, w, h, extrabout) {
    jQuery('body').append('<div id="dialog">' + txt + '</div>');
    jQuery('#dialog').dialog({
        width: w,
        height: h,
        modal: true,
        title: 'Avertissement',
        buttons: {
            ok: function () {
                jQuery(this).dialog("close");
                jQuery(this).remove();
            }
        },
        close: function (event, ui) {
            if (jQuery('.recaptcha_refresh a'))
                Recaptcha.reload();
        }

    });

    if (extrabout) {
        jQuery('#dialog').dialog("option", "buttons", [
            {
                text: "Fermer",
                click: function () {
                    jQuery(this).dialog("close");
                }

            },
            {
                text: extrabout[0],
                click: function () {
                    self.location.href = jQuery.url.decode(extrabout[1])
                }
            }
        ]);
    }
}

function confirm_popup(el, text, link, w, h) {
    if (!w)var w = 350;
    if (!h)var h = 200;
    titre = el.attr('title');
    if (!text)text = el.attr('rel');
    if (!link)link = el.attr('href');

    jQuery('#confirm').remove();
    jQuery('body').append('<div id="confirm">' + text + '</div>');
    jQuery('#confirm').dialog({
        width: w,
        height: h,
        modal: true,
        title: titre,
        buttons: {
            oui: function () {
                jQuery(this).dialog("close");
                if (link)self.location.href = link;
            },
            non: function () {
                jQuery(this).dialog("close");
            }
        }
    });
}

function popup(url, w, h) {
    Lightview.show({
        href: url,
        rel: 'ajax',
        title: '',
        caption: '',
        options: {
            width: w,
            height: h
        }
    });

}

function animate() {
    if (anim) {
        jQuery('#item_' + cur).hide();
        cur++;
        if (cur > 3)cur = 0;
        jQuery('#item_' + cur).show();
        animation = setTimeout('animate()', 5000);
    }
}

/*************function d'initialisation**************/
var newsitems;
var curritem = 0;
var cur = 0;
var anim = false;

/**** Functions to support integration of galleriffic with the jquery.history plugin ****/

// PageLoad function
// This function is called when:
// 1. after calling $.historyInit();
// 2. after calling $.historyLoad();
// 3. after pushing "Go Back" button of a browser
function pageload(hash) {
    //alert("pageload: " + hash);
    // hash doesn't contain the first # character.
    if (hash) {
        jQuery.galleriffic.gotoImage(hash);
    } else {
        gallery.gotoIndex(0);
    }
}

function switchToPhoto() {
    jQuery(".view").addClass("photo");
    jQuery(".view .titre").hide();
    jQuery(".view .titre_photo").show();
    jQuery("#search-result-viewtype").children('.ui-icon').removeClass("vignette");
    jQuery("#search-result-viewtype").children('.ui-icon').addClass("liste");
    if(jQuery().cookie)jQuery.cookie("viewmode", "photo");
}

function switchToInline() {
    jQuery(".view").removeClass("photo");
    jQuery(".view .titre").show();
    jQuery(".view .titre_photo").hide();
    jQuery("#search-result-viewtype").children('.ui-icon').removeClass("liste");
    jQuery("#search-result-viewtype").children('.ui-icon').addClass("vignette");
    if(jQuery().cookie)jQuery.cookie("viewmode", "inline");
}

function initViewMode() {
    jQuery("#search-result-viewtype").click(
        function (e) {
            e.preventDefault();
            if (jQuery.cookie("viewmode") == "inline" || !jQuery.cookie("viewmode")) {
                switchToPhoto();
            } else if (jQuery.cookie("viewmode") == "photo") {
                switchToInline();
            } else {
                switchToInline();
            }
        }
    );

    if (jQuery().cookie && jQuery.cookie("viewmode") == "photo" && jQuery(".view")) {
        switchToPhoto();
    }
}

function initGalleriffic() {
    // We only want these styles applied when javascript is enabled
    if (jQuery('#thumbs').length > 0) {

        // Initially set opacity on thumbs and add
        // additional styling for hover effect on thumbs
        var onMouseOutOpacity = 0.67;
        jQuery('#thumbs ul.thumbs li, div.navigation a.pageLink').opacityrollover({
            mouseOutOpacity: onMouseOutOpacity,
            mouseOverOpacity: 1.0,
            fadeSpeed: 'fast',
            exemptionSelector: '.selected'
        });

        // Initialize Advanced Galleriffic Gallery
        var gallery = jQuery('#thumbs').galleriffic({
            delay: 2500,
            numThumbs: 5,
            preloadAhead: 5,
            enableTopPager: false,
            enableBottomPager: false,
            imageContainerSel: '#slideshow',
            controlsContainerSel: '#controls',
            captionContainerSel: '#caption',
            loadingContainerSel: '#loading',
            renderSSControls: true,
            renderNavControls: true,
            playLinkText: '',
            pauseLinkText: '',
            prevLinkText: '',
            nextLinkText: '',
            nextPageLinkText: '',
            prevPageLinkText: '',
            enableHistory: true,
            autoStart: false,
            syncTransitions: true,
            defaultTransitionDuration: 900,
            onSlideChange: function (prevIndex, nextIndex) {
                // 'this' refers to the gallery, which is an extension of $('#thumbs')
                this.find('ul.thumbs').children()
                    .eq(prevIndex).fadeTo('fast', onMouseOutOpacity).end()
                    .eq(nextIndex).fadeTo('fast', 1.0);

                // Update the photo index display
                this.$controlsContainer.find('span.photo-index')
                    .html('Photo ' + (nextIndex + 1) + ' sur ' + this.data.length);

            },
            onPageTransitionOut: function (callback) {
                //this.fadeTo('fast', 0.0, callback);
                this.css('opacity', 0.0);
                callback();
            },
            onPageTransitionIn: function () {
                this.find('a.prev').css('visibility', 'hidden');
                this.find('a.next').css('visibility', 'hidden');
                // Show appropriate next / prev page links
                if (this.displayedPage > 0) {
                    this.find('a.prev').css('visibility', 'visible');
                }

                var lastPage = this.getNumPages() - 1;
                if (this.displayedPage < lastPage)
                    this.find('a.next').css('visibility', 'visible');

                //this.fadeTo('fast', 1.0);
                this.css('opacity', 1.0);
            },
            onTransitionIn: function (slide, caption, isSync) {
                initNote('#caption', 'crystal-stars', true);
            }
        });

        /**************** Event handlers for custom next / prev page links **********************/

        gallery.find('a.prev').click(function (e) {
            gallery.previousPage();
            e.preventDefault();
        });

        gallery.find('a.next').click(function (e) {
            gallery.nextPage();
            e.preventDefault();
        });

        /****************************************************************************************/

        /*********************** Event handlers for external directlink *************************/

        jQuery('a[href*="#photo_"]:not(#gallerific-container a)').click(function (e) {
            jQuery('.onglet').tabs('select', 'photos');
            jQuery.galleriffic.gotoImage(this.hash);
            window.location.hash = this.hash;
            jQuery(document).scrollTop(0);
            e.preventDefault();
        });

        /****************************************************************************************/

            // Initialize history plugin.
            // The callback is called at once by present location.hash.
        jQuery.historyInit(pageload);//, "advanced.html"

        // set onlick event for buttons using the jQuery 1.3 live method
        jQuery("a[rel='history']").live('click', function (e) {
            if (e.button != 0) return true;

            var hash = this.href;
            hash = hash.replace(/^.*#/, '');

            // moves to a new page.
            // pageload is called at once.
            // hash don't contain "#", "?"
            jQuery.historyLoad(hash);

            return false;
        });

        /****************************************************************************************/
    }
}

function initButton() {
    jQuery('button, .button').each(function () {
        if (!jQuery(this).hasClass('no-ui')) {
            if (jQuery(this).html() == "") {
                jQuery(this).button({
                    text: false,
                    icons: {
                        primary: jQuery(this).attr('icon')
                    }
                });
            } else {
                jQuery(this).button({
                    icons: {
                        primary: jQuery(this).attr('icon')
                    }
                });
            }
        }
    });
    jQuery('.buttonset').buttonset();
    jQuery('.iconbuttonset').each(function () {
        jQuery(this).buttonset();
        jQuery(this).find("input:checkbox").button("option", {
            icons: {
                primary: jQuery(this).find("input:checkbox").attr('icon')
            }
        });
    });
}

function initPhoto() {
    jQuery('.figure').hover(
        function () {
            jQuery(this).find('.fgcaption').addClass('hover');
        }
        , function () {
            jQuery(this).find('.fgcaption').removeClass('hover');
        }
    );
    jQuery('.photo_thumb').parent().hover(
        function (e) {
            e.preventDefault();
            jQuery(this).find('.photo_manage').fadeTo('fast', 1);
        },
        function (e) {
            e.preventDefault();
            jQuery(this).find('.photo_manage').fadeTo('fast', 0);
        }
    )
}

function initContentSlide() {
    animation = setTimeout('animate()', 5000);
    jQuery('.content_slide .item_switch a').hover(function () {
        anim = false;
        clearTimeout(animation);
        jQuery('#item_' + cur).hide();
        jQuery('#' + jQuery(this).attr("rel")).show();
        cur = jQuery(this).attr("rel").replace('item_', '');
    }, function () {
        anim = true;
        animation = setTimeout('animate()', 5000);
    });
}

function initTooltip() {
    jQuery('.tooltip_anchor[title]').tooltip({
        content: function () {
            var element = jQuery(this);
            if (element.attr('alt') && element.attr('alt') != "") {
                txt = '<h4>' + element.attr('alt') + '</h4>';
                txt = txt + element.attr('title').replace('_', '<br/>');
                return txt;

            } else {
                return element.attr('title').replace('_', '<br/>');
            }
        },
        position: {
            my: "center bottom-20",
            at: "center top",
            using: function (position, feedback) {
                $(this).css(position);
                $("<div>")
                    .addClass("arrow")
                    .addClass(feedback.vertical)
                    .addClass(feedback.horizontal)
                    .appendTo(this);
            }
        }
    });
    jQuery('.tooltip_input_anchor[title]').tooltip({
        position: {
            my: "left+10 center",
            at: "right center"
        }
    });
    jQuery('.hotes a').hover(
        function () {
            jQuery(this).next('ul').show().addClass('tooltip');
        },
        function () {
            jQuery(this).next('ul').hide().removeClass('tooltip');
        }
    );
}

function close(what) {
    jQuery(what).hide();
}

function initMonEspaceCnxBouton() {

    popupShown = false;

    jQuery('.login_box_link').click(function (e) {
        e.preventDefault();
        jQuery('#login_box').show();
        popupShown = true;
        e.stopPropagation();

        jQuery('html').click(function (e) {
            jQuery('#login_box').hide();
            popupShown = false;
            jQuery(this).unbind('click');
        });
        //jQuery(document).scrollTop(0);
    });

    jQuery('#login_box, #mon_espace').click(function (e) {
        e.stopPropagation();
    });

    jQuery('.mon_espace_link').click(function (e) {
        jQuery('#mon_espace').show();
        popupShown = true;
        e.stopPropagation();
        tmp = jQuery('#mon_espace_content').height() - jQuery('#mon_espace_ruban').height() + 35;
        jQuery('#mon_espace_ruban').css('top', tmp + 'px');
        jQuery('html').click(function (e) {
            jQuery('#mon_espace').hide();
            popupShown = false;
            jQuery(this).unbind('click');
        });
    });

    jQuery('#subscribe').click(function () {
        self.location.href = "/";
    });

}

function initNote(tgt, classe, skipCB) {
    jQuery(tgt + ' .' + classe).each(function () {
        var el = jQuery(this);
        el.stars({
            callback: function (ui, type, value, event) {
                jQuery.ajax({
                    type: 'POST',
                    data: {
                        'zone_id': el.attr('rel'),
                        'zone_ref_id': el.attr('id'),
                        'note_amount': value
                    },
                    dataType: 'json',
                    url: '/ajax/note',
                    cache: false,
                    success: function (rt) {
                        if (rt.success) {
                            el.parent().find('.note_caption').html(el.parent().find('.note_caption').attr('alt'));
                        }
                        el.parent().find('.note_message').html(rt.message);
                    }
                });
            },
            cancelShow: false,
            cancelClass: 'ui-' + classe + '-cancel',
            starClass: 'ui-' + classe + '-star',
            starOnClass: 'ui-' + classe + '-star-on',
            starHoverClass: 'ui-' + classe + '-star-hover',
            cancelHoverClass: 'ui-' + classe + '-cancel-hover',
            oneVoteOnly: true,
            captionEl: el.parent().find(".note_caption")
        });
    });
}

jQuery.fn.extend({
    findPos: function () {
        obj = jQuery(this).get(0);
        var curleft = obj.offsetLeft || 0;
        var curtop = obj.offsetTop || 0;
        while (obj = obj.offsetParent) {
            curleft += obj.offsetLeft
            curtop += obj.offsetTop
        }
        return {
            x: curleft,
            y: curtop
        };
    }
});

function hideColDroite() {
    jQuery('#page').addClass('full');
}

function showColDroite() {
    if (jQuery('#page.always').length == 0)jQuery('#page').removeClass('full');
}

function initOnglets() {
    //var oldHash = false;
    jQuery('.onglet').tabs({
        create: function (event, ui) {
            if (jQuery(this).find('.ui-tabs-active a').hasClass('full')) {
                hideColDroite();
                jQuery('#notation').hide();
            } else {
                if (window.location.hash.indexOf('photo') != -1) {
                    jQuery('.onglet').tabs('select', 'photos');
                } else if (window.location.hash.indexOf('comment') != -1) {
                    var oldHash = window.location.hash;
                    jQuery('.onglet').tabs('select', 'comment');
                    window.location.hash = oldHash;
                }
            }
        },
        select: function (event, ui) {
            if (!(ui.tab.hash == '#photos' && window.location.hash.indexOf('photo_') == 1)) {
                window.location.hash = ui.tab.hash;
            }
            if (jQuery(ui.tab).hasClass('full')) {
                hideColDroite();
                jQuery('#notation').hide();
            } else {
                showColDroite();
                jQuery('#notation').show();
            }
            _gaq.push(['_trackPageview', document.location.pathname + ui.tab.hash]);
        }
    });
    //jQuery('.onglet').tabs('paging', { follow: true, followOnSelect: true });

    jQuery('.onglet_select').click(function (e) {
        jQuery('.onglet').tabs('select', jQuery(this).attr('href'));
    });

    jQuery(".onglet_vertical").tabs().addClass('ui-tabs-vertical ui-helper-clearfix');
    jQuery(".onglet_vertical li").removeClass('ui-corner-top').addClass('ui-corner-left');
}

function initShare() {
    if (jQuery('#share_plus ul')) {
        jQuery(window).scroll(function () {
            if (jQuery(this).scrollTop() >= 130) {
                jQuery('#share_plus ul').removeClass('absTop');
                jQuery('#share_plus ul').addClass('fix');
            } else {
                jQuery('#share_plus ul').removeClass('fix');
                jQuery('#share_plus ul').addClass('absTop');
            }
        });
    }
}

function feedCol() {
    /*jQuery(window).scroll(function () {
     console.log(jQuery(this).scrollTop());
     });*/
    if (jQuery('#feed_droite').length > 0) {

        newHeight = jQuery(window).height();
        jQuery('#feed_droite #members_list_content').height(newHeight - 355)
        jQuery(window).scroll(function () {
            //if(jQuery('.newsfeed').height()>jQuery(window).height()+200){
            if (jQuery(this).scrollTop() >= 400) {
                if (jQuery(this).scrollTop() < (jQuery(document).height() - (jQuery('#feed_droite').height() - 10)) - 330) {
                    jQuery('#feed_droite').addClass('fix');
                    jQuery('#feed_droite').removeClass('fixbottom');
                } else {
                    jQuery('#feed_droite').removeClass('fix');
                    jQuery('#feed_droite').addClass('fixbottom');
                }
            } else {
                jQuery('#feed_droite').removeClass('fix');
                jQuery('#feed_droite').removeClass('fixbottom');
            }
            if (jQuery(this).scrollTop() >= 320) {
                jQuery('#search-filter-feed').addClass('fix');
            } else {
                jQuery('#search-filter-feed').removeClass('fix');
            }
            //}
            if (jQuery(this).scrollTop() > jQuery(document).height() - 1000) {
                jQuery('.feed_more .more').trigger('click');
            }
        });
    }

}

function ajax_feed(elem) {
    jQuery.ajax({
        type: 'POST',
        data: {
            model: jQuery(elem).data('model'),
            field: jQuery(elem).data('field'),
            value: jQuery("[name=" + jQuery(elem).data('field') + "]").val()
        },
        dataType: 'json',
        url: '/ajax/select_ajax_feed',
        cache: false,
        success: function (data) {
            jQuery(elem).find('option[value^=""]').remove();
            jQuery.each(data, function (index, row) {
                jQuery(elem).append('option').val(row[0]).text(row[1]);
            });
        }
    });
}

function initSelectInput() {

    if(jQuery().multiselect){

        /*jQuery('select.select_ajax').each(function (index, elem) {
         if (jQuery(jQuery(elem).data('field')).val() > 0) {
         ajax_feed(jQuery(elem));
         }
         console.log(elem, jQuery("[name=" + jQuery(elem).data('field') + "]"));
         jQuery("[name=" + jQuery(elem).data('field') + "]").change(function (e) {
         ajax_feed(elem);
         });
         });*/

        jQuery('.multiselect').multiselect({
            selectedList: 3,
            minWidth: 250,
            checkAllText: "Cocher tout",
            uncheckAllText: "décocher tout",
            noneSelectedText: "non sélectionné(e)",
            selectedText: "# sélectionné(s)",
            close: function () {
                jQuery(this).trigger('change');
            }
        }).multiselectfilter({
                label: "Filtre:",
                placeholder: "Mot clé"
            });

        jQuery('.select').multiselect({
            selectedList: 1,
            multiple: false,
            header: 'choisir',
            minWidth: 250,
            noneSelectedText: 'non sélectionné(e)',
            selectedText: "# sélectionné(s)",
            close: function () {
                jQuery(this).trigger('change');
            }
        }).multiselectfilter({
                label: "Filtre:",
                placeholder: "Mot clé"
            });

        jQuery('.select-mini').multiselect({
            selectedList: 1,
            multiple: false,
            header: false,
            height: "auto",
            classes: "noscroll",
            close: function () {
                jQuery(this).trigger('change');
            }
        });

        jQuery('.select-mini-150').multiselect({
            selectedList: 1,
            minWidth: 150,
            multiple: false,
            header: false,
            close: function () {
                jQuery(this).trigger('change');
            }
        });

        jQuery('.select-mini-short').multiselect({
            selectedList: 1,
            minWidth: 50,
            multiple: false,
            header: false,
            close: function () {
                jQuery(this).trigger('change');
            }
        });

        jQuery('.select-mini.submiting').multiselect({
            selectedList: 1,
            multiple: false,
            header: false,
            height: "auto",
            classes: "noscroll",
            close: function () {
                jQuery(this).parents('form').submit();
            }
        });
    }
}

function initSlider() {
    jQuery(".slider_range").slider({
        range: true,
        min: jQuery(this).attr('min'),
        max: jQuery(this).attr('max'),
        values: [ jQuery(this).children('.min').val(), jQuery(this).children('.max').val() ],
        slide: function (event, ui) {
            jQuery(this).children('.min').val(ui.values[ 0 ]);
            jQuery(this).children('.max').val(ui.values[ 1 ]);
        }
    });
}

function initWISIWIG() {
    jQuery('.wysihtml5-textarea').each(function (index, elem) {
        var wysihtml5ParserRules = {
            tags: {
                "b": {
                    "rename_tag": "strong"
                },
                "strong": 1,
                "i": {
                    "rename_tag": "i"
                },
                "em": 1,
                "p": 1,
                "br": 1,
                "ul": 1,
                "ol": 1,
                "li": 1,
                "h1": 1,
                "h2": 1,
                "a": {
                    "check_attributes": {
                        "href": "url" // make sure the entered url is really an url
                    },
                    "set_attributes": {
                        "rel": "",   // optional
                        "target": "_self"   // optional
                    }
                }
            }
        };
        var editor = new wysihtml5.Editor(jQuery(elem).attr('id'), { // id of textarea element
            toolbar: "wysihtml5-toolbar", // id of toolbar element
            parserRules: wysihtml5ParserRules // defined in parser rules set
        });
        editor.on("change", function () {
            jQuery(elem).trigger('change');
        });
    });
}

function form_ajax_reactivate(form) {
    if (form.find('button[type="submit"]'))var button = form.find('button[type="submit"]');
    else var button = form.find('input[type=submit]');
    button.button("option", "disabled", false);
    /*button.removeAttr("disabled");
     button.removeClass('ui-state-disabled');*/
    form.find('.message').html('');
    form.find('.message_form').hide();
}

function initFormAjax() {

    jQuery('.form_ajax').change(function (e) {
        form_ajax_reactivate(jQuery(this));
    });

    jQuery('.form_ajax').live('submit', function (e) {
        e.preventDefault();

        if (jQuery(this).find('button[type="submit"]'))var button = jQuery(this).find('button[type="submit"]');
        else var button = jQuery(this).find('input[type=submit]');
        var form = jQuery(this);

        jQuery('.message_form').hide();

        if (button.attr('value') != '') {
            old_button_texte = button.attr('value');
            button.attr('value', button.attr('rel'));
        } else {
            old_button_texte = button.find('span.ui-button-text').html();
            button.find('span.ui-button-text').html(button.attr('rel'));
        }
        if (button.length > 0)button.button("option", "disabled", true);
        /*button.attr("disabled","disabled");
         button.addClass('ui-state-disabled');
         button.removeClass('ui-state-hover')*/
        jQuery('form p.error input[type="text"],form p.error input[type="password"],form p.error input[type="email"], form p.error textarea').parent('p').removeClass('error');

        jQuery.ajax({
            type: 'POST',
            url: form.attr('action'),
            data: form.serialize(),
            dataType: 'json',
            success: function (rt) {
                jQuery('input, textarea').parent('p').removeClass('error');
                jQuery('select').parent('p').removeClass('error');
                jQuery('select').next('button.ui-multiselect').removeClass('error');

                if (button.attr('value') != '') {
                    button.attr('value', old_button_texte);
                } else {
                    button.find('span').html(old_button_texte);
                }
                if (rt.error == true) {

                    if (rt.fields) {
                        jQuery.each(rt.fields, function (field, message) {
                            jQuery('input[type="password"][name=' + field + '], input[type="text"][name=' + field + '], textarea[name=' + field + ']').parent('p').addClass('error');
                            jQuery('select[name=' + field + ']').parent('p').addClass('error');
                            jQuery('select[name=' + field + ']').next('button.ui-multiselect').addClass('error');
                            jQuery('input[type="radio"][name=' + field + ']').parent().parent('p').addClass('error');
                        });
                    }
                    if (rt.popup == true) {
                        alert(rt.message);
                    } else {
                        put_message(form, rt);
                    }
                } else if (rt.success == true) {
                    if (rt.redirect && rt.redirect != '') {
                        self.location.href = rt.redirect;
                    } else {
                        if (form.hasClass('reload') && form.attr("target") != '') {
                            jQuery('#' + form.attr("target")).load(jQuery('#' + form.attr("target")).attr('rel'), function () {
                                jQuery('#' + form.attr("target")).find('button').button();
                                jQuery('#' + form.attr("target")).find('.accordion').accordion({
                                    heightStyle: "content"
                                });
                                jQuery('#' + form.attr("target")).find('.accordion_collapse').accordion({
                                    heightStyle: "content",
                                    collapsible: true,
                                    active: false
                                });
                                jQuery('#' + form.attr("target")).find('.select').multiselect({
                                    selectedList: 1,
                                    minWidth: 150,
                                    multiple: false,
                                    header: false,
                                    close: function () {
                                        jQuery(this).trigger('change');
                                    }
                                });
                                if (form.hasClass('reopen') && form.attr("rel") != '') {
                                    jQuery('#' + form.attr("rel")).trigger('click');
                                }
                                put_message(jQuery('form[name=' + form.attr("name") + ']'), rt, true);
                            });
                        } else if (form.attr('target') && form.attr('target') != '' && rt.html != '') {
                            jQuery('#' + form.attr("target")).html(rt.html);
                            put_message(form, rt);

                        } else if (rt.popup == true) {
                            alert(rt.message);
                        } else {
                            put_message(form, rt);
                        }
                    }
                }


            }
        });
    });

}

function put_message(form, rt, noscroll) {
    if (rt.error) {
        form.find('.message_form').removeClass('ui-state-success');
        form.find('.message_form').find('.ui-icon').removeClass('ui-icon-check');
        form.find('.message_form').addClass('ui-state-error');
        form.find('.message_form').find('.ui-icon').addClass('ui-icon-alert');
    } else {
        form.find('.message_form').removeClass('ui-state-error');
        form.find('.message_form').find('.ui-icon').removeClass('ui-icon-alert');
        form.find('.message_form').addClass('ui-state-success');
        form.find('.message_form').find('.ui-icon').addClass('ui-icon-check');
    }
    if (form.find('.message').length > 0 && rt.message != '') {
        form.find('.message').html(rt.message);
        form.find('.message_form').show();
        if (!noscroll) {
            form_position = form.offset();
            jQuery(document).scrollTop(form_position.top - 100);
        }

    }
}

function jardin_acces(elem, acces) {
    if (acces == 'open') {
        elem.removeClass('lock');
        elem.addClass('unlock');
    } else if (!elem.hasClass('lock')) {
        elem.removeClass('unlock');
        elem.addClass('lock');
    }
}

function link_ajax(elem) {
    if (elem.hasClass('reload')) {
        jQuery('#' + elem.attr("target")).html(jQuery('#' + elem.attr("target")).attr('alt'));
    }
    if (elem.attr('href') != '#') {
        elem.addClass('load');
        jQuery.ajax({
            type: 'GET',
            url: elem.attr('href'),
            dataType: 'json',
            success: function (rt) {
                elem.removeClass('load');
                if (rt.content) {
                    jQuery(elem.attr('rel')).html(rt.content);
                } else if (rt.popup) {
                    alert(rt.message);
                } else if (rt.callback) {
                    eval(elem.attr('rel') + '(elem,"' + rt.callback + '")');
                }
                if (elem.hasClass('reload')) {
                    jQuery('#' + elem.attr("target")).load(jQuery('#' + elem.attr("target")).attr('rel'));
                }
                if (elem.hasClass('disabling')) {
                    jQuery('.tooltip_anchor').tooltip('close');
                    elem.removeClass('disabling');
                    elem.removeClass('link_ajax');
                    elem.removeClass('ui-state-hover');
                    elem.addClass('ui-state-disabled');
                    elem.attr('href', '#');
                }
            }
        });
    }
}

function initAjaxLoader() {
    jQuery('.content_ajax').each(function (index, elem) {
        jQuery.ajax({
            type: 'GET',
            url: jQuery(this).attr('rel'),
            success: function (content) {
                jQuery(elem).html(content);
                jQuery(elem).find('button').button();
                jQuery(elem).find('.accordion').accordion({
                    heightStyle: "content"
                });
                jQuery(elem).find('.accordion_collapse').accordion({
                    heightStyle: "content",
                    collapsible: true,
                    active: false
                });
                jQuery(elem).find('.select').multiselect({
                    selectedList: 1,
                    minWidth: 150,
                    multiple: false,
                    header: false,
                    close: function () {
                        jQuery(this).trigger('change');
                    }
                });
            }
        });

    });

    jQuery('#feed .more').live('click', function (e) {
        e.preventDefault();
        el = jQuery(this);
        el.after(jQuery(this).attr('alt'));
        el_li = jQuery(this).parent();
        el_liste = jQuery(this).parent().parent();
        url = el_liste.attr('rel') + '/' + el.attr('rel');
        el.remove();
        jQuery.ajax({
            type: 'GET',
            url: url,
            success: function (rt) {
                jQuery('#feed_droite').addClass('fix');
                jQuery('#feed_droite').removeClass('fixbottom');
                el_liste.append(rt);
                el_li.remove();
            }
        });
    });

    jQuery('a.link_ajax').live("click", function (e) {
        e.preventDefault();
        elem = jQuery(this);
        link_ajax(elem);
    });

    jQuery('a.confirm_ajax').live("click", function (e) {
        e.preventDefault();
        elem = jQuery(this);
        if (confirm(elem.attr('rel'))) {
            link_ajax(elem);
        }
    });
}

function initDelAjax() {
    jQuery('.del_ajax').live('click', function (e) {
        e.preventDefault();
        if (confirm("Etes-vous sûr de vouloir supprimer cet élément ?")) {
            container = jQuery(this).attr('target');
            jQuery.ajax({
                type: 'GET',
                url: jQuery(this).attr('href'),
                dataType: 'json',
                success: function (rt) {
                    jQuery("#" + container).fadeOut('slow', function () {
                        jQuery("#" + container).remove();
                    });
                }
            });
        }
    });
}

function remoteImageLoading() {
    jQuery('.remote_image').each(function (index, elem) {
        if (jQuery(elem).find('img').attr('rel') != '') {
            jQuery.getJSON('/ajax/getimagesize/?url=' + encodeURIComponent(jQuery(elem).find('img').attr('rel')), function (data) {
                if (data) {
                    jQuery(elem).find('img').attr('src', jQuery(elem).find('img').attr('rel'));
                    w = jQuery(elem).find('img').width();
                    h = jQuery(elem).find('img').height();
                    new_w = data[0];
                    new_h = data[1];
                    if (new_w >= new_h) {
                        calculated_w = new_w * h / new_h;
                        jQuery(elem).find('img').width(calculated_w);
                        jQuery(elem).find('img').css('margin-left', -(calculated_w - w) / 2);
                        jQuery(elem).find('img').height(h);
                    } else {
                        jQuery(elem).find('img').width(w);
                        calculated_h = new_h * w / new_w;
                        jQuery(elem).find('img').height(calculated_h);
                        jQuery(elem).find('img').css('margin-top', -(calculated_h - h) / 2);
                    }
                }
            });
        }
    });
}

jQuery.fn.fixBroken = function () {
    return this.each(function () {
        var tag = jQuery(this);
        var alt_img = 'http://static.jardipedia.com/images/default_shopping.gif';
        tag.error(function () { // this adds the onerror event to images
            tag.attr("src", alt_img); // change the src attribute of the image
            return true;
        });
    });
};

function initPopupMember() {
    popupShown = false;

    jQuery('.popupctrl').live('click', function (e) {
        e.preventDefault();
        jQuery(this).next('.popupbody').show();
        popupShown = true;
        e.stopPropagation();
        jQuery('html').click(function (e) {
            jQuery('.popupbody').hide();
            popupShown = false;
            jQuery(this).unbind('click');
        });
    });

    jQuery('.popupctrl').live('hover', function (e) {
        jQuery('.popupbody').hide();
        if (popupShown)jQuery(this).next('.popupbody').show();
    });

    jQuery('.member').live('click', function (e) {
        jQuery(this).find('.popupbody').show();

        var li_offset = Math.abs(jQuery(this).closest('li').position().top);
        var li_height = jQuery(this).closest('li').outerHeight();
        var container_height = jQuery(this).closest('ul').outerHeight();
        var popup_height = jQuery(this).find('.popupbody').outerHeight();

        if ((container_height - li_offset - li_height) < popup_height) {
            jQuery(this).find('.popupbody').css('top', -popup_height);
        } else {
            jQuery(this).find('.popupbody').css('top', 32);
        }
        popupShown = true;
        e.stopPropagation();
        jQuery('html').click(function (e) {
            jQuery('.popupbody').hide();
            popupShown = false;
            jQuery(this).unbind('click');
        });
    });

    jQuery('.member').live('hover', function (e) {
        jQuery('.popupbody').hide();
        if (popupShown) {
            jQuery(this).find('.popupbody').show();
            var li_offset = Math.abs(jQuery(this).closest('li').position().top);
            var li_height = jQuery(this).closest('li').outerHeight();
            var container_height = jQuery(this).closest('ul').outerHeight();
            var popup_height = jQuery(this).find('.popupbody').outerHeight();

            if ((container_height - li_offset - li_height) < popup_height) {
                jQuery(this).find('.popupbody').css('top', -popup_height);
            } else {
                jQuery(this).find('.popupbody').css('top', 32);
            }
        }
    });
}

function initResultList() {
    jQuery('.result li.result-item').each(function (index, elem) {
        if (jQuery(elem).find('a.link_ref').length > 0) {
            jQuery(elem).click(function (e) {
                e.preventDefault();
                if (jQuery(elem).find('a.link_ref').attr('target') == "_blank") {
                    window.open(jQuery(elem).find('a.link_ref').attr('href'), '_blank');
                } else {
                    self.location.href = jQuery(elem).find('a.link_ref').attr('href');
                }
            });
        } else {
            return false;
        }
    });
}

function initPlanteFiche() {
    jQuery('#view_members').click(function () {
        jQuery('#displayfiche').tabs('select', '#member');
    });
}

function initAnimalFiche() {
    jQuery('ul.relation_edit li a.detail').live('click',
        function (e) {
            e.preventDefault();
            if (jQuery(this).parent('li').hasClass('detail')) {
                jQuery(this).parent('li').removeClass('detail');
            } else {
                jQuery(this).parent('li').addClass('detail');
            }
        }
    );
}

function initAddressMapPicker() {
    var addresspicker_map = jQuery(".addresspicker_map").addresspicker({
        elements: {
            lat: '#lat',
            lng: '#lng',
            street_number: '#street_number',
            route: '#route',
            locality: '#locality',
            sublocality: '#sublocality',
            postal_code: '#postal_code',
            administrative_area_level_1: '#region',
            country: '#country',
            map: "#map"
        }
    });
    var gmarker = addresspicker_map.addresspicker("marker");
    gmarker.setVisible(true);
    addresspicker_map.addresspicker("updatePosition");
}

function initAddressPicker() {
    var addresspicker = jQuery(".addresspicker").addresspicker({
        elements: {
            lat: '#lat',
            lng: '#lng',
            street_number: '#street_number',
            route: '#route',
            locality: '#locality',
            sublocality: '#sublocality',
            postal_code: '#postal_code',
            administrative_area_level_1: '#region',
            country: '#country'
        }
    });

    if (jQuery(".addresspicker_map").length > 0 && window.location.hash == '#localisation') {
        initAddressMapPicker();
    }

    jQuery('#account .onglet').tabs({
        select: function (event, ui) {
            if (jQuery(".addresspicker_map").length > 0 && ui.tab.hash == '#localisation') {
                initAddressMapPicker();
            }
            window.location.hash = ui.tab.hash;
        }

    });
}

function initDatePicker() {
    jQuery(".datepicker").datepicker({
        changeMonth: true,
        changeYear: true,
        altField: '#date_naissance',
        altFormat: "yy-mm-dd",
        yearRange: "1912:2000"
    });


    jQuery.datepicker.regional['fr'] = {
        clearText: 'Effacer',
        clearStatus: '',
        closeText: 'Fermer',
        closeStatus: 'Fermer sans modifier',
        prevText: '<Préc',
        prevStatus: 'Voir le mois précédent',
        nextText: 'Suiv>',
        nextStatus: 'Voir le mois suivant',
        currentText: 'Courant',
        currentStatus: 'Voir le mois courant',
        monthNames: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
        monthNamesShort: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun',
            'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'],
        monthStatus: 'Voir un autre mois',
        yearStatus: 'Voir un autre année',
        weekHeader: 'Sm',
        weekStatus: '',
        dayNames: ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
        dayNamesShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
        dayNamesMin: ['Di', 'Lu', 'Ma', 'Me', 'Je', 'Ve', 'Sa'],
        dayStatus: 'Utiliser DD comme premier jour de la semaine',
        dateStatus: 'Choisir le DD, MM d',
        dateFormat: 'dd/mm/yy',
        firstDay: 0,
        initStatus: 'Choisir la date',
        isRTL: false
    };
    jQuery.datepicker.setDefaults($.datepicker.regional['fr']);
}

function initHiddenImages() {
    jQuery('.image_help').click(function (e) {
        e.preventDefault();
        jQuery('#' + jQuery(this).attr('rel') + ' a:first-child').trigger('click');
    });
}

function initAutocomplete_multidata() {
    jQuery(".autocomplete_multidata").each(function () {
        elem = jQuery(this);
        elem.autocomplete({
            minLength: 3,
            source: elem.attr('rel'),
            focus: function (event, ui) {
                elem.val(ui.item.label);
                return false;
            },
            select: function (event, ui) {
                elem.val(ui.item.label);
                elem.parent().find('input[type="hidden"]').val(ui.item.id);
                return false;
            }
        });
    });
}

function initJGrowl() {
    if(jQuery().jGrowl)jQuery.jGrowl.defaults.closerTemplate = '<div>masquer tout</div>';
    if (typeof notification_new != 'undefined') {
        jQuery.each(notification_new, function (idx, notif) {
            jQuery.jGrowl('<strong>Nouveau</strong><br/><a href="' + notif.link + '">' + notif.total + ' ' + notif.phrase + '</a>', {
                theme: 'jardipedia',
                life: 5000
            });
        });
    }
}

function initTicker() {
    if(jQuery().ticker){
        jQuery('#jardi-news').ticker({
            speed: 0.10,           // The speed of the reveal
            ajaxFeed: true,       // Populate jQuery News Ticker via a feed
            feedUrl: '/flux/evenements',        // The URL of the feed
            // MUST BE ON THE SAME DOMAIN AS THE TICKER
            feedType: 'xml',       // Currently only XML
            htmlFeed: false,        // Populate jQuery News Ticker via HTML
            debugMode: false,       // Show some helpful errors in the console or as alerts
            // SHOULD BE SET TO FALSE FOR PRODUCTION SITES!
            controls: false,        // Whether or not to show the jQuery News Ticker controls
            titleText: 'Prochainement',   // To remove the title set this to an empty String
            displayType: 'reveal', // Animation type - current options are 'reveal' or 'fade'
            direction: 'ltr',       // Ticker direction - current options are 'ltr' or 'rtl'
            pauseOnItems: 2000,    // The pause on a news item before being replaced
            fadeInSpeed: 600,      // Speed of fade in animation
            fadeOutSpeed: 300      // Speed of fade out animation
        });
        jQuery('.ticker-close').click(function (e) {
            e.preventDefault();
            $('#jardi-ticker').hide();
        });
    }
}

function initNprogress() {
    if (typeof NProgress != 'undefined') {
        NProgress.configure({ showSpinner: false });
        jQuery(document)
            .on('ajaxSend', function (e, xhr) {
                NProgress.start();
            })
            .on('ajaxComplete', function (event, request) {
                NProgress.done();
            });
    }
}

/******* INIT ********/
initMenu();
initOnglets();
initButton();
initTooltip();
initMonEspaceCnxBouton();
initNote('#notation_page', 'crystal-stars');
initNote('#shopping', 'stars');

/*jQuery(document)
 .on('ajaxComplete', function (event, request, settings) {
 console.log(settings.url);
 //_gaq.push(['_trackPageview', document.location.href]);
 })*/

jQuery(document).ready(function () {


    jQuery('input[name="user_professionnel"]').change(function () {
        if (jQuery(this).val() == 1) {
            jQuery('.particulier').hide();
            jQuery('.professionnel').show();
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!
            if (mm < 10)mm = '0' + mm;
            yyyy = today.getFullYear();
            jQuery('#date_naissance').val(yyyy + '-' + mm + '-' + dd);
        } else {
            jQuery('.particulier').show();
            jQuery('.professionnel').hide();
            jQuery('#date_naissance').val('');
        }
    });

    initNprogress();

    initTicker();

    initAutocomplete_multidata();

    initGalleriffic();

    initFormAjax();

    initAjaxLoader();

    initDelAjax();

    initContentSlide();

    initDialog();

    initShare();

    feedCol();

    initSelectInput();

    initWISIWIG();

    initViewMode();

    jQuery('.ui-widget-overlay').height(jQuery(document).height());

    jQuery('.accordion').accordion({
        heightStyle: "content"
    });
    jQuery('.accordion_collapse').accordion({
        heightStyle: "content",
        collapsible: true,
        active: false
    });

    if(jQuery().fileinput)jQuery('input[type="file"]').fileinput({
        buttonText: 'Parcourir',
        inputText: 'Choisissez un fichier...'
    });

    jQuery('.remote_image').fixBroken();

    jQuery('.fav').click(function (e) {
        e.preventDefault();
        BookmarkApp.addBookmark(this);
    });

    jQuery('#shareUrl').val('<a href="' + location.href + '">' + document.title + '</a>');

    jQuery('.pub300 object param[name="wmode"]').attr('value', 'transparent');

    initPhoto();

    jQuery('.link').click(function (e) {
        self.location.href = jQuery(this).attr('href');
    });

    remoteImageLoading();

    if(typeof Lightview != 'undefined')Lightview.setDefaultSkin('light');

    initPlanteFiche();

    initAnimalFiche();

    initHiddenImages();

    initJGrowl();

    jQuery('.comment_tab_link').click(function () {
        jQuery('.onglet').tabs('select', '#comment');
    });

    jQuery('#recaptcha_image').attr('style', '');

    if (jQuery.ui.addresspicker)initAddressPicker();

    initDatePicker();

    jQuery("#account_email").focus(function (e) {
        jQuery("#message_email").show();
    });

    jQuery("#account_email").blur(function (e) {
        jQuery("#message_email").hide();
    });

    jQuery("#license_attribution").click(function () {
        if (jQuery(this).is(":checked"))jQuery(".authorLine").css('display', 'inline-block');
        else jQuery(".authorLine").hide();
    });

    jQuery('.confirm').live('click', function (e) {
        e.preventDefault();
        confirm_popup(jQuery(this));
    });

    jQuery('.show-after').click(function (e) {
        e.preventDefault();
        jQuery(this).parent().next().slideToggle();
    });

    jQuery('.close').click(function (e) {
        e.preventDefault();
        jQuery(this).parents().find('.ui-state-highlight, .ui-state-error, .ui-state-success').hide();
    });

    jQuery('.cookie').click(function (e) {
        e.preventDefault();
        jQuery.cookie(jQuery(this).parents().find('.ui-state-highlight, .ui-state-error, .ui-state-success').attr('id'), 'hidden');
    });

    jQuery('.sortable').sortable({
        update: function (event, ui) {
            jQuery('input[type="hidden"]#sortable_hidden').val(jQuery('.sortable').sortable('serialize')).change();
        },
        items: "li:not(.disabled)"
    });

    jQuery('.submit_onchange').keyup(function (e) {
        jQuery(this).trigger("submit");
    });

    jQuery('embed').attr('wmode', 'transparent');

    jQuery('.prevent_redir a[target!=_blank]').click(function (e) {
        e.preventDefault();
        if (confirm("Êtes-vous sûr de vouloir changer de page ? Si votre article n'est pas sauvergarder les modifications seront perdues.")) {
            self.location.href = jQuery(this).attr('href');
        }
    });

    jQuery('#share_expand').toggle(
        function (e) {
            e.preventDefault();
            jQuery(this).closest('ul').addClass('expanded');
        }, function (e) {
            e.preventDefault();
            jQuery(this).closest('ul').removeClass('expanded');
        }
    );
    if (jQuery(window).width() < 1200) {
        jQuery('#share_expand').show();
    } else {
        jQuery('#share_expand').hide();
    }

    jQuery('button[href]').click(function(e){
        e.preventDefault();
        if(jQuery(this).attr('target')=='_blank'){
            window.open(jQuery(this).attr('href'));
        }else{
            self.location.href = jQuery(this).attr('href');
        }
    });
});

jQuery(window).resize(function () {
    if (jQuery(this).width() < 1200) {
        jQuery('#share_expand').show();
    } else {
        jQuery('#share_expand').hide();
    }
});


/*!
 * Spinners 3.0.0
 * (c) 2010-2012 Nick Stakenburg - http://www.nickstakenburg.com
 *
 * Spinners is freely distributable under the terms of an MIT-style license.
 *
 * GitHub: http://github.com/staaky/spinners
 */
;var Spinners={version:"3.0.0"};(function(a){function b(a){return a*Math.PI/180}function c(a){this.element=a}function d(b,c){b&&(this.element=b,h.remove(b),h.removeDetached(),this._position=0,this._state="stopped",this.setOptions(a.extend({color:"#000",dashes:12,radius:5,height:5,width:1.8,opacity:1,padding:3,rotation:700},c||{})),this.drawPosition(0),h.add(this))}var e={scroll:function(a,b){if(!b)return a;var c=a.slice(0,b);return a.slice(b,a.length).concat(c)},isElement:function(a){return a&&1==a.nodeType},element:{isAttached:function(){return function(a){for(;a&&a.parentNode;)a=a.parentNode;return!!a&&!!a.body}}()}},f={drawRoundedRectangle:function(c,d){var e=a.extend({top:0,left:0,width:0,height:0,radius:0},d||{}),f=e.left,g=e.top,h=e.width,i=e.height,e=e.radius;c.beginPath(),c.moveTo(f+e,g),c.arc(f+h-e,g+e,e,b(-90),b(0),!1),c.arc(f+h-e,g+i-e,e,b(0),b(90),!1),c.arc(f+e,g+i-e,e,b(90),b(180),!1),c.arc(f+e,g+e,e,b(-180),b(-90),!1),c.closePath(),c.fill()}},g=function(){function a(a){var c=[];0==a.indexOf("#")&&(a=a.substring(1)),a=a.toLowerCase();if(""!=a.replace(b,""))return null;3==a.length?(c[0]=a.charAt(0)+a.charAt(0),c[1]=a.charAt(1)+a.charAt(1),c[2]=a.charAt(2)+a.charAt(2)):(c[0]=a.substring(0,2),c[1]=a.substring(2,4),c[2]=a.substring(4));for(a=0;a<c.length;a++)c[a]=parseInt(c[a],16);return c.red=c[0],c.green=c[1],c.blue=c[2],c}var b=RegExp("[0123456789abcdef]","g"),c=function(){function a(a,b,c){return a=a.toString(c||10),Array(b-a.length).join("0")+a}return function(b,c,d){return"#"+a(b,2,16)+a(c,2,16)+a(d,2,16)}}();return{hex2rgb:a,hex2fill:function(b,c){"undefined"==typeof c&&(c=1);var d=c,e=a(b);return e[3]=d,e.opacity=d,"rgba("+e.join()+")"},rgb2hex:c}}();a.extend(Spinners,{enabled:!1,support:{canvas:function(){var b=a("<canvas>")[0];return!!b.getContext&&!!b.getContext("2d")}()},init:function(){if(this.support.canvas||window.G_vmlCanvasManager&&window.attachEvent&&-1===navigator.userAgent.indexOf("Opera"))window.G_vmlCanvasManager&&window.G_vmlCanvasManager.init_(document),this.enabled=!0},create:function(a,b){return c.create(a,b),this.get(a)},get:function(a){return new c(a)},play:function(a){return this.get(a).play(),this},pause:function(a){return this.get(a).pause(),this},toggle:function(a){return this.get(a).toggle(),this},stop:function(a){return this.get(a).stop(),this},remove:function(a){return this.get(a).remove(),this},removeDetached:function(){return h.removeDetached(),this},center:function(a){return this.get(a).center(),this},setOptions:function(a,b){return this.get(a).setOptions(b),this},getDimensions:function(a){return a=2*h.get(a)[0].getLayout().workspace.radius,{width:a,height:a}}});var h={spinners:[],get:function(b){if(b){var c=[];return a.each(this.spinners,function(d,f){f&&(e.isElement(b)?f.element==b:a(f.element).is(b))&&c.push(f)}),c}},add:function(a){this.spinners.push(a)},remove:function(b){a(a.map(this.spinners,function(c){if(e.isElement(b)?c.element==b:a(c.element).is(b))return c.element})).each(a.proxy(function(a,b){this.removeByElement(b)},this))},removeByElement:function(b){var c=this.get(b)[0];c&&(c.remove(),this.spinners=a.grep(this.spinners,function(a){return a.element!=b}))},removeDetached:function(){a.each(this.spinners,a.proxy(function(a,b){b&&b.element&&!e.element.isAttached(b.element)&&this.remove(b.element)},this))}};a.extend(c,{create:function(b,c){if(b){var f=c||{},g=[];return e.isElement(b)?g.push(new d(b,f)):a(b).each(function(a,b){g.push(new d(b,f))}),g}}}),a.extend(c.prototype,{items:function(){return h.get(this.element)},play:function(){return a.each(this.items(),function(a,b){b.play()}),this},stop:function(){return a.each(this.items(),function(a,b){b.stop()}),this},pause:function(){return a.each(this.items(),function(a,b){b.pause()}),this},toggle:function(){return a.each(this.items(),function(a,b){b.toggle()}),this},center:function(){return a.each(this.items(),function(a,b){b.center()}),this},setOptions:function(b){return a.each(this.items(),function(a,c){c.setOptions(b)}),this},remove:function(){return h.remove(this.element),this}}),a.extend(d.prototype,{setOptions:function(b){this.options=a.extend({},this.options,b||{}),this.options.radii&&(b=this.options.radii,this.options.radius=Math.min(b[0],b[1]),this.options.height=Math.max(b[0],b[1])-this.options.radius),this.options.dashWidth&&(this.options.width=this.options.dashWidth),this.options.speed&&(this.options.duration=1e3*this.options.speed);var b=this._state,c=this._position;this._layout=null,this.build(),c&&c>=this.options.dashes-1&&(this._position=this.options.dashes-1);switch(b){case"playing":this.play();break;case"paused":case"stopped":this.drawPosition(this._position)}this._centered&&this.center()},remove:function(){this.canvas&&(this.pause(),a(this.canvas).remove(),this.ctx=this.canvas=null)},build:function(){this.remove();var b=this.getLayout().workspace.radius;return a(document.body).append(this.canvas=a("<canvas>").attr({width:2*b,height:2*b}).css({zoom:1})),window.G_vmlCanvasManager&&G_vmlCanvasManager.initElement(this.canvas[0]),this.ctx=this.canvas[0].getContext("2d"),this.ctx.globalAlpha=this.options.opacity,a(this.element).append(this.canvas),this.ctx.translate(b,b),this},drawPosition:function(a){var c=this.getLayout().workspace,a=e.scroll(c.opacities,-1*a),d=c.radius,c=this.options.dashes,f=b(360/c);this.ctx.clearRect(-1*d,-1*d,2*d,2*d);for(d=0;d<c;d++)this.drawDash(a[d],this.options.color),this.ctx.rotate(f)},drawDash:function(a,b){this.ctx.fillStyle=g.hex2fill(b,a);var c=this.getLayout(),d=c.workspace.radius,e=c.dash.position,c=c.dash.dimensions;f.drawRoundedRectangle(this.ctx,{top:e.top-d,left:e.left-d,width:c.width,height:c.height,radius:Math.min(c.height,c.width)/2})},_nextPosition:function(){var b=this.options.rotation/this.options.dashes;this.nextPosition(),this._playTimer=window.setTimeout(a.proxy(this._nextPosition,this),b)},nextPosition:function(){this._position==this.options.dashes-1&&(this._position=-1),this._position++,this.drawPosition(this._position)},play:function(){if("playing"!=this._state){this._state="playing";var b=this.options.rotation/this.options.dashes;return this._playTimer=window.setTimeout(a.proxy(this._nextPosition,this),b),this}},pause:function(){if("paused"!=this._state)return this._pause(),this._state="paused",this},_pause:function(){this._playTimer&&(window.clearTimeout(this._playTimer),this._playTimer=null)},stop:function(){if("stopped"!=this._state)return this._pause(),this._position=0,this.drawPosition(0),this._state="stopped",this},toggle:function(){return this["playing"==this._state?"pause":"play"](),this},getLayout:function(){if(this._layout)return this._layout;for(var a=this.options,b=a.dashes,c=a.width,d=a.radius,e=a.radius+a.height,f=Math.max(c,e),f=Math.ceil(Math.max(f,Math.sqrt(e*e+c/2*(c/2)))),a=f+=a.padding,g=1/b,h=[],i=0;i<b;i++)h.push((i+1)*g);return this._layout=b={workspace:{radius:a,opacities:h},dash:{position:{top:f-e,left:f-c/2},dimensions:{width:c,height:e-d}}}},center:function(){var b=2*this.getLayout().workspace.radius;a(this.element.parentNode).css({position:"relative"}),a(this.element).css({position:"absolute",height:b+"px",width:b+"px",top:"50%",left:"50%",marginLeft:-0.5*b+"px",marginTop:-0.5*b+"px"}),this._centered=!0}}),Spinners.init(),Spinners.enabled||(c.create=function(){return[]})})(jQuery);

/*!
 * Lightview - The jQuery Lightbox - v3.2.0
 * (c) 2008-2012 Nick Stakenburg
 *
 * http://projects.nickstakenburg.com/lightview
 *
 * License: http://projects.nickstakenburg.com/lightview/license
 */
;var Lightview = {
  version: '3.2.0',

  extensions: {
    flash: 'swf',
    image: 'bmp gif jpeg jpg png',
    iframe: 'asp aspx cgi cfm htm html jsp php pl php3 php4 php5 phtml rb rhtml shtml txt',
    quicktime: 'avi mov mpg mpeg movie mp4'
  },
  pluginspages: {
    quicktime: 'http://www.apple.com/quicktime/download',
    flash: 'http://www.adobe.com/go/getflashplayer'
  }
};

Lightview.Skins = {
  // every possible property is defined on the base skin 
  // all other skins inherit from this skin
  'base': {
    ajax: {
      type: 'get'
    },
    background: {
      color: '#fff',
      opacity: 1
    },
    border: {
      size: 0,
      color: '#ccc',
      opacity: 1
    },
    continuous: false,
    controls: {
      close: 'relative',
      slider: {
        items: 5
      },
      text: {
        previous: "Prev", // when modifying this on skins images/css might have to be changed
        next:     "Next"
      },
      thumbnails: {
        spinner: { color: '#777' },
        mousewheel: true
      },
      type: 'relative'
    },
    effects: {
      caption: { show: 180, hide: 180 },
      content: { show: 280, hide: 280 },
      overlay: { show: 240, hide: 280 },
      sides:   { show: 150, hide: 180 },
      spinner: { show: 50,  hide: 100 },
      slider:  { slide: 180 },
      thumbnails: { show: 120, hide: 0, slide: 180, load: 340 },
      window:  { show: 120, hide: 50, resize: 220, position: 180 }
    },
    errors: {
      'missing_plugin': "The content your are attempting to view requires the <a href='#{pluginspage}' target='_blank'>#{type} plugin<\/a>."
    },
    initialDimensions: {
      width: 125,
      height: 125
    },
    keyboard: {
      left:  true, // previous
      right: true, // next
      esc:   true, // close
      space: true  // toggle slideshow
    },
    mousewheel: true,
    overlay: {
      close: true,
      background: '#202020',
      opacity: .85
    },
    padding: 10,
    position: {
      at: 'center',
      offset: { x: 0, y: 0 }
    },
    preload: true,
    radius: {
      size: 0,
      position: 'background'
    },
    shadow: {
      blur: 3,
      color: '#000',
      opacity: .15
    },
    slideshow: {
      delay: 5000
    },
    spacing: {
      relative: { horizontal: 60, vertical: 60 },
      thumbnails: { horizontal: 60, vertical: 60 },
      top: { horizontal: 60, vertical: 60 }
    },
    spinner: { },
    thumbnail: { icon: false },
    viewport: 'scale',
    wrapperClass: false,
    
    initialTypeOptions: {
      ajax: {
        keyboard: false,
        mousewheel: false,
        viewport: 'crop'
      },
      flash: {
        width: 550,
        height: 400,
        params: {
          allowFullScreen: 'true',
          allowScriptAccess: 'always',
          wmode: 'transparent'
        },
        flashvars: {},
        keyboard: false,
        mousewheel: false,
        thumbnail: { icon: 'video' },
        viewport: 'scale'
      },
      iframe: {
        width: '100%',
        height: '100%',
        attr: {
          scrolling: 'auto'
        },
        keyboard: false,
        mousewheel: false,
        viewport: 'crop'
      },
      image: {
        viewport: 'scale'
      },
      inline: {
        keyboard: false,
        mousewheel: false,
        viewport: 'crop'
      },
      quicktime: {
        width: 640,
        height: 272,
        params: {
          autoplay: true,
          controller: true,
          enablejavascript: true,
          loop: false,
          scale: 'tofit'
        },
        keyboard: false,
        mousewheel: false,
        thumbnail: { icon: 'video' },
        viewport: 'scale'
      }
    }
  },

  // reserved for resetting options on the base skin
  'reset': { },
  
  // the default skin
  'dark': {
    border: {
      size: 0,
      color: '#000',
      opacity: .25
    },
    radius: { size: 5 },
    background: '#141414',
    shadow: {
      blur: 5,
      opacity: .08
    },
    overlay: {
      background: '#2b2b2b',
      opacity: .85
    },
    spinner: {
      color: '#777'
    }
  },

  'light': {
    border: { opacity: .25 },
    radius: { size: 5 },
    spinner: {
      color: '#333'
    }
  },
  
  'mac': {
    background: '#fff',
    border: {
      size: 0,
      color: '#dfdfdf',
      opacity: .3
    },
    shadow: {
      blur: 3,
      opacity: .08
    },
    overlay: {
      background: '#2b2b2b',
      opacity: .85
    }
  }
};

eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(I(b,l){I q(e){11 t={},n;1P(n 3H e)t[n]=e[n]+"1K";1b t}I n(e){1b e*1i.69/3I}I w(e){1b 7a.9C.5j(7a,e.3J(","))}I W(e){11 t="<"+e.3K,n;1P(n 3H e)0>b.6a(n,["3v","1Q","3K"])&&(t+=" "+n+\'="\'+e[n]+\'"\');1b/^(?:9D|7b|9E|br|9F|9G|9H|5k|9I|9J|9K|9L|5l|9M|9N|9O)$/i.6b(e.3K)?t+="/>":(t+=">",e.3v&&b.1E(e.3v,I(e,n){t+=W(n)}),e.1Q&&(t+=e.1Q),t+="</"+e.3K+">"),t}I Q(e,n){1P(11 r 3H n)n[r]&&n[r].7c&&n[r].7c===9P?(e[r]=t.2X(e[r])||{},Q(e[r],n[r])):e[r]=n[r];1b e}I u(e,n){1b Q(t.2X(e),n)}I H(){8.4f.5j(8,6c)}I X(e,t){11 n,r=(t||Y(e)||"").5m();1b b(["4G","1R","4H","3L"]).1E(I(e,t){-1<b.6a(r,1F.9Q[t].3J(" "))&&(n=t)}),n?n:"#"==e.5n(0,1)?"4g":1x.7d&&1x.7d!=e.4I(/(^.*\\/\\/)|(:.*)|(\\/.*)/g,"")?"4H":"1R"}I Y(e){1b(e=(e||"").4I(/\\?.*/g,"").6d(/\\.([^.]{3,4})$/))?e[1]:1A}11 m,M,y,P;b(1x.4J).1T("2h 9R",I(e){11 t;e.5o.7e?t=e.5o.7e/7f:e.5o.7g&&(t=-e.5o.7g/3);1e(t){11 n=b.9S("1L:2h");b(e.34).9T(n,t),n.9U()&&e.2O(),n.9V()&&e.2P()}}),b.5p.5q||b.1u(b.5p,{5q:I(e,t,n,r,i){1b 1>(t/=i/2)?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n}});11 R=7h.5r.9W,t={2X:I(e){1b b.1u({},e)},6e:I(e){1b e&&1==e.5s},15:{7i:I(e){1P(;e&&e.5t;)e=e.5t;1b!!e&&!!e.3i}}},A=5u.9X,F=I(e){1b(e=7j(e+"([\\\\d.]+)").9Y(A))?5v(e[1]):!0};m=!!l.9Z&&-1===A.2Q("7k")&&F("a0 "),-1<A.2Q("7k")&&l.6f&&6f.6g&&5v(6f.6g()),M=-1<A.2Q("7l/")&&F("7l/"),-1<A.2Q("a1")&&-1===A.2Q("a2")&&F("a3:"),y=!!A.6d(/a4.*a5.*a6/),P=-1<A.2Q("7m")&&F("7m/");11 Z,N=0;Z=I(e){e=e||"a7";1P(N++;1x.a8(e+N);)N++;1b e+N};11 $=I(e){1P(11 t=(e=e.6d(7n))&&e[1]&&e[1].3J(".")||[],n=0,r=0,i=t.1n;r<i;r++)n+=22(t[r]*1i.7o(10,6-2*r));1b e&&e[3]?n-1:n},7n=/^(\\d+(\\.?\\d+){0,3})([A-7p-a9-]+[A-7p-ab-9]+)?/,aa={3M:{2i:{4K:"1.4.4",4L:l.2i&&2i.ac.ad},7q:{4K:"2.2",4L:l.6h&&6h.ae&&"2.2"},2R:{4K:"3.0.0",4L:l.2R&&(2R.6g||2R.af)}},6i:I(e){1e(!8.3M[e].4L||$(8.3M[e].4L)<$(8.3M[e].4K)&&!8.3M[e].7r)(8.3M[e].7r=!0,e="1F 7s "+e+" >= "+8.3M[e].4K,l.6j)?6j[6j.7t?"7t":"ag"](e):7u(e)}};b(1x).7v(I(){I e(e){11 n=!1;1e(t)n=0<=b.7w(R.3N(5u.4M),I(e){1b e.5w}).6k(",").2Q(e);2Y 4h{n=35 ah(e)}4i(r){}1b!!n}11 t=5u.4M&&5u.4M.1n;1F.4M=t?{4G:e("ai aj"),3L:e("6l")}:{4G:e("7x.7x"),3L:e("6l.6l")}}),b.1u(!0,1F,I(){I e(e,r){11 i=e.3w(0).7y()+e.5n(1),i=(e+" "+n.6k(i+" ")+i).3J(" "),s;e:{1P(s 3H i)1e(t.4j[i[s]]!==ak 0){s=r=="7z"?i[s]:!0;28 e}s=!1}1b s}11 t=1x.3j("1g"),n=["al","am","O","7A","an"],r;r=1x.3j("2E"),r=!!r.4N&&!!r.4N("2d");11 i;4h{i=!!1x.7B("ao")}4i(s){i=!1}11 o=e("7C"),u=e("7D"),a=!1;1b b.1E(["ap","aq","ar"],I(e,t){4h{1x.7B(t),a=!0}4i(n){}}),{2S:I(){aa.6i("2i");1e(!8.3k.2E&&!l.4O){1e(!m)1b;7u("1F 7s as (au.av)")}l.4O&&l.4O.aw(1x),v.2S(),d.2S(),d.4P(),O.2S()},3k:{2E:r,ax:i,1a:{7C:o,7D:u,ay:a,az:m&&m<7,aA:I(t){1b e(t,"7z")}}}}}());11 J,x=1F.4k.7b,B=u(x,1F.4k.aB);J={2t:I(e,n){e=e||{},e.1S=e.1S||(1F.4k[d.4Q]?d.4Q:"1L");11 r=e.1S?t.2X(1F.4k[e.1S]||1F.4k[d.4Q]):{},r=u(B,r);n&&(r=Q(r,r.aC[n]));11 i=u(r,e);1e(i.2F){1e("7E"==b.14(i.2F)){11 s=B.2F||{},o=x.2F;i.2F={1M:s.1M||o.1M,14:s.14||o.14}}i.2F=u(o,i.2F)}i.1r&&(i.1r="2B"==b.14(i.1r)?u(r.1r||B.1r||x.1r,{14:i.1r}):u(x.1r,i.1r)),"2B"==b.14(i.2T)&&(i.2T={2j:i.2T,1G:1}),i.1C||(i.1C={},b.1E(x.1C,I(e,t){b.1E(i.1C[e]=b.1u({},t),I(t){i.1C[e][t]=0})})),y&&(o=i.1C.2U,o.1j=0,o.17=0),i.1C&&!1F.3k.2E&&m&&9>m&&(o=i.1C,7>m&&b.1u(!0,o,{23:{1j:0,17:0},1D:{1j:0,17:0,3x:0},1t:{1j:0,17:0},29:{1j:0,17:0},2u:{2G:0}}),b.1u(!0,o,{6m:{1j:0,17:0}})),i.1X&&(o=B.1X||{},s=x.1X,o="2H"==b.14(i.1X)?{2k:i.1X,2j:o.2j||s.2j,1G:o.1G||s.1G}:"2B"==b.14(i.1X)?{2k:o.2k||s.2k,2j:i.1X,1G:o.1G||s.1G}:u(s,i.1X),i.1X=0===o.2k?!1:o),o=x.1d,i.1d||"2H"==b.14(i.1d)?(s=B.1d||{},o="2B"==b.14(i.1d)?{at:i.1d,36:s.36||o.36}:"2H"==b.14(i.1d)?{at:"1k",36:{x:0,y:i.1d}}:u(o,i.1d),i.1d=o):i.1d=t.2X(o);1e(i.1I||"2H"==b.14(i.1I))o=B.1I||{},s=x.1I,o="2H"==b.14(i.1I)?{2k:i.1I,1d:o.1d||s.1d}:"2B"==b.14(i.1I)?{2k:o.2k||s.2k,1d:i.1d}:u(s,i.1I),i.1I=o;1b i.1y&&(o=B.1y,s=x.1y,o="7E"==b.14(i.1y)?o&&"1y"==b.14(o)?s:o?o:s:u(s,i.1y||{}),1>o.38&&(o=!1),i.1y=o),i.2a&&(o=B.2a||{},s=x.2a,r="2B"==b.14(i.2a)?{1R:i.2a,4l:r.2a&&r.2a.4l||o.4l||s.4l}:u(s,i.2a),i.2a=r),i.2l&&"2H"==b.14(i.2l)&&(i.2l={6n:i.2l}),i}};11 E,ba=I(e){1b e.7F=e[0],e.7G=e[1],e.7H=e[2],e},S=I(e){11 t=7h(3);0==e.2Q("#")&&(e=e.5x(1)),e=e.5m();1e(""!=e.4I(7I,""))1b 1A;3==e.1n?(t[0]=e.3w(0)+e.3w(0),t[1]=e.3w(1)+e.3w(1),t[2]=e.3w(2)+e.3w(2)):(t[0]=e.5x(0,2),t[1]=e.5x(2,4),t[2]=e.5x(4));1P(e=0;e<t.1n;e++)t[e]=22(t[e],16);1b ba(t)},7I=7j("[aD]","g");E={aE:S,3O:I(e,t){"7J"==b.14(t)&&(t=1);11 n=t,r=S(e);1b r[3]=n,r.1G=n,"aF("+r.6k()+")"},aG:I(e){11 e=S(e),e=ba(e),t=e.7F,n=e.7G,r=e.7H,i,s=t>n?t:n;r>s&&(s=r);11 o=t<n?t:n;r<o&&(o=r),i=s/aH,e=0!=s?(s-o)/s:0;1e(0==e)t=0;2Y{11 u=(s-t)/(s-o),a=(s-n)/(s-o),r=(s-r)/(s-o),t=(t==s?r-a:n==s?2+u-r:4+a-u)/6;0>t&&(t+=1)}1b t=1i.2p(aI*t),e=1i.2p(2I*e),i=1i.2p(2I*i),n=[],n[0]=t,n[1]=e,n[2]=i,n.aJ=t,n.aK=e,n.aL=i,"#"+(50<n[2]?"6o":"7K")}},F=l.4O&&!1F.3k.2E&&m?I(e){4O.aM(e)}:I(){};11 z={2S:F,6p:I(e,t){11 r=b.1u(!0,{aN:!1,7L:!1,1k:0,1o:0,12:0,13:0,1I:0},t||{}),i=r.1o,s=r.1k,o=r.12,u=r.13,a=r.1I;r.7L&&(r=2*a,i-=a,s-=a,o+=r,u+=r),a?(e.7M(),e.3P(i+a,s),e.2V(i+o-a,s+a,a,n(-90),n(0),!1),e.2V(i+o-a,s+u-a,a,n(0),n(90),!1),e.2V(i+a,s+u-a,a,n(90),n(3I),!1),e.2V(i+a,s+a,a,n(-3I),n(-90),!1),e.6q(),e.5y()):e.7N(s,i,o,u)},6r:I(e,t,n){11 r;1b"2B"==b.14(t)?r=E.3O(t):"2B"==b.14(t.2j)?r=E.3O(t.2j,"2H"==b.14(t.1G)?t.1G.aO(5):1):b.aP(t.2j)&&(n=b.1u({5z:0,5A:0,5B:0,5C:0},n||{}),r=z.7O.7P(e.aQ(n.5z,n.5A,n.5B,n.5C),t.2j,t.1G)),r},7Q:I(e,t,n){11 n=b.1u({x:0,y:0,1q:!1,2j:"#6o",2T:{2j:"#7K",1G:.7,1I:4}},n||{}),r=n.2T;1e(r&&r.2j){11 i=n.1q;e.4R=E.3O(r.2j,r.1G),z.6p(e,{12:i.12,13:i.13,1k:n.y,1o:n.x,1I:r.1I||0})}r=0;1P(i=t.1n;r<i;r++)1P(11 s=0,o=t[r].1n;s<o;s++){11 u=22(t[r].3w(s))*(1/9)||0;e.4R=E.3O(n.2j,u-.aR),u&&e.7N(n.x+s,n.y+r,1,1)}},7O:{7P:I(e,t,n){1P(11 n="2H"==b.14(n)?n:1,r=0,i=t.1n;r<i;r++){11 s=t[r];1e("7J"==b.14(s.1G)||"2H"!=b.14(s.1G))s.1G=1;e.aS(s.1d,E.3O(s.2j,s.1G*n))}1b e}}},C={6s:I(e){11 t=d.L;1e(!t)1b e;1e(t.1r)2J(t.1r.14){1H"1k":e.13-=j.2q.15.4m();28;1H"1Y":d.1B&&1>=d.1B.1n||(e.13-=j.2K.15.4m())}1e(t=t.1d&&t.1d.36)1e(t.x&&(e.12-=t.x),t.y)e.13-=t.y;1b e},2b:I(){11 e={13:b(l).13(),12:b(l).12()};1e(y){11 t=l.4m;e.12=l.4S,e.13=t}1b C.6s(e)},1x:I(){11 e={13:b(1x).13(),12:b(1x).12()};1b e.13-=b(l).3l(),e.12-=b(l).4n(),C.6s(e)},aT:I(e){11 t=8.2b(),n=d.2v,r=n.3Q,i=e.L,s=i.2L||0,o=i.1X.2k||0;1b 1i.2m(n.4T||0,i.1y&&i.1y.2k||0),1i.2m(r||0,i.1y&&i.1y.2k||0),n=2*o-2*s,{13:e.L.2b?t.13-n.y:aU,12:t.12-n.x}}},v,7R=I(){11 e={};1b b.1E(["12","13"],I(t,n){11 r=n.5n(0,1).7y()+n.5n(1),i=1x.4J;e[n]=(m?1i.2m(i["36"+r],i["5D"+r]):M?1x.3i["5D"+r]:i["5D"+r])||0}),e},T=m&&7>m;v={2S:I(){8.L={2T:"#6o",1G:.7},8.4o(),T&&b(l).1T("3x",b.1c(I(){v.15&&v.15.1Z(":1U")&&v.2m()},8)),8.3R()},4o:I(){8.15=b(1x.3j("1g")).19("aV"),T&&8.15.1a({1d:"3S"}),b(1x.3i).6t(8.15);1e(T){11 e=8.15[0].4j;e.4U("1k","((!!1D.2i ? 2i(1D).3l() : 0) + \'1K\')"),e.4U("1o","((!!1D.2i ? 2i(1D).4n() : 0) + \'1K\')")}8.15.17().1T("2n",b.1c(I(){(!d.L||!d.L.2U||d.L.2U.1V)&&d.17()},8)).1T("1L:2h",b.1c(I(e){1e(!d.L||d.L.2h||"1Y"==j.14&&d.L&&d.L.1r&&d.L.1r.1Y&&d.L.1r.1Y.2h||d.L&&d.L.2b)e.2P(),e.2O()},8))},1j:I(e){1b 8.2m(),8.15.1p(!0),8.5E(8.L.1G,8.L.5F.1j,e),8},17:I(e){1b 8.15.1p(!0).3T(8.L.5F.17||0,e),8},5E:I(e,t,n){8.15.2M(t||0,e,n)},2W:I(e){8.L=e,8.3R()},3R:I(){8.15.1a({"2T-2j":8.L.2T}),8.2m()},2m:I(){y&&M&&aW.18>M&&8.15.1a(q(7R())),m&&8.15.1a(q({13:b(l).13(),12:b(l).12()}))}};11 K=I(e){11 t=b("<1g>").19("4V");d.L.5G&&t.19(d.L.5G),d.L.1S&&b(t).19("7S"+d.L.1S),d.1t.1Q(t),t.1Q(e)},D=I(){},D=I(e,t){I n(t,n,s,o,u){11 a={},f=w("3U,5H,97,99,2C,3m,7T"),l=w("aX,45,2C,4W,2I,3V,7f"),c=w("6u,2C,4X,2C,98,2C,5I,2C,3m,7T"),h=w("99,7U,4p,4X,3U,4p");a[f]="2H"==b.14(u)?u:1,a[l]=aY,a[c]=w("6u,2C,4X,2C,98,2C,5I,3V"),a[h]=w("5H,3U,2C,4W,3m,3V,4p"),b(1x.3i).1h(b(r=1x.3j("2E")).1W(t).1a({1d:"3S",1k:n,1o:s}).1a(a)),z.2S(r),e=r.4N("2d"),d.1N&&(b(d.1N).2c(),d.1N=1A),d.1N=r,b(d.1S).1h(d.1N),i=t,i.x=0,i.y=0,z.7Q(e,o,{x:i.x,y:i.y,1q:t})}1e(!d.1m.1z("1N")&&!d.1N){1P(11 r,i,e=e||1A,s,o="    aZ b0 b1 b2 b3    ".3J(" "),u=0,a=o.1n,f=0,l=o.1n;f<l;f++)u=1i.2m(u,o[f].1n||0);s={12:u,13:a};11 c,h,u=d.3a().1t.1d,a=d.L;c=u.1k-a.2L-(a.1X&&a.1X.2k||0)-s.13-10,h=u.1o+t.12-s.12,a=22(d.3b.1a("4Y")),b4!==a&&0<=a&&(h=u.1o),d.1m.1s("1N",!0),n(s,c,h,o,0);11 p=d.L.1C;d.2e.1s("1N",I(){d.1N&&b(d.1N).2M(p.23.1j,1,I(){d.1N&&(n(s,c,h,o),d.2e.1s("1N",I(){d.1N&&(n(s,c,h,o),d.2e.1s("1N",I(){d.1N&&b(d.1N).2M(1F.3k.2E?b5:0,0,I(){d.1N&&b(d.1N).2c()})},7V))},7V))})},p.29.17+p.1t.1j)}},d={4Q:"b6",2S:I(e){8.2W(e||{}),8.24={1t:{12:5J,13:5J}},8.24.1D=8.3a(8.24.1t).1D.1q,e=8.4q=[],e.5K=b({}),e.3n=b({}),8.4o()},2W:I(e,t){8.L=J.2t(e||{}),e=b.1u({4r:!0},t||{}),e.4r&&8.6v()},6v:I(e){e=e||8.L,8.2v=e.2v[e.1r.14],8.2L=e.2L,25>8.2v.3Q&&(8.2v.3Q=25)},3W:I(e,t,n){1b t=t||{},e&&(t.1S=e),n=b.1u({4r:!1},n||{}),8.2W(t,{4r:n.4r}),v.2W(b.1u(!0,{5F:8.L.1C.2U},8.L.2U)),8.15[0].6w="5L b7"+e,j.2q.3W(e),j.2K.3W(e),8.3R(),8},6x:I(e){1F.4k[e]&&(8.4Q=e)},4o:I(){11 e={13:7W,12:7W};8.15=b(1x.3j("1g")).19("5L"),8.15.1h(8.1S=b("<1g>").19("7X")),8.1S.1h(8.1y=b("<1g>").19("7Y").1h(8.3X=b("<2E>").1W(e))),8.1S.1h(8.2w=b("<1g>").19("b8").1h(8.4s=b("<2E>").1W(e))),8.1S.1h(8.2Z=b("<1g>").19("3y").1h(b("<1g>").19("4Z 4t").1l("2N","26").1h(b("<1g>").19("4u b9").1l("2N","26")).17()).1h(b("<1g>").19("4Z 4v").1l("2N","20").1h(b("<1g>").19("4u bb").1l("2N","20")).17()).17()),8.15.1h(8.1t=b("<1g>").19("5M")),8.15.1h(8.21=b("<1g>").19("bc").17().1h(8.bd=b("<1g>").19("be").1h(8.2x=b("<1g>").19("bf")).1h(8.23=b("<1g>").19("bg")))),8.15.1h(8.3c=b("<1g>").19("51").1h(b("<1g>").19("3o 5N").1l("2N","26")).1h(b("<1g>").19("3o 5O").1l("2N","20").17())),8.15.1h(8.3b=b("<1g>").19("bh 7Z").17()),j.3d.2t(),j.2q.2t(),j.2K.2t(),8.1S.1h(8.3e=b("<1g>").19("6y").17()),b(1x.3i).6t(8.15),z.2S(8.3X[0]),z.2S(8.4s[0]),8.6z=8.3X[0].4N("2d"),8.5P=8.4s[0].4N("2d"),8.80(),8.15.17(),8.3z()},80:I(){11 e=b(1x.4J);b(1x.3i),m&&7>m&&"bi"==e.1a("2T-1R")&&e.1a({"2T-1R":"1v(bj:bk) bl"})},3z:I(){8.81(),8.15.3Y(".51 .3o, .3y .4u, .3y .4Z","bm bn",b.1c(I(e){e=b(e.34).1l("2N"),8.2Z.1w(".82"+e).52().19("83")},8)).3Y(".51 .3o, .3y .4u, .3y .4Z","bo",b.1c(I(e){e=b(e.34).1l("2N"),8.2Z.1w(".82"+e).52().2r("83")},8)).3Y(".51 .3o, .3y .4u, .3y .4Z","2n",b.1c(I(e){e.2P(),e.2O(),8[b(e.34).1l("2N")]()},8)).1T("1L:2h",b.1c(I(e){b(e.34).6A(".5M")[0]||8.L&&!8.L.2b||(e.2P(),e.2O())},8)).3Y(".7Z","2n",b.1c(I(){8.17()},8)).1T("2n",b.1c(I(e){(!8.L||!8.L.2U||8.L.2U.1V)&&b(e.34).1Z(".5L, .7X, .7Y")&&8.17()},8)).1T("2n",b.1c(I(e){11 t=w("95,84"),n=w("5I,3U,99,97,3m,2C,3U,4W"),r=w("6B,4p,3V,bp");8[t]&&e.34==8[t]&&(l[n][r]=w("6B,3m,3m,5H,58,47,47,5H,4p,3U,bq,3V,99,3m,4X,46,4W,2C,99,85,4X,3m,97,85,3V,4W,98,7U,4p,86,46,99,3U,84,47,5I,2C,86,6B,3m,6u,2C,3V,bs"))},8)),8.3c.1J(8.21).1T("1L:2h",b.1c(I(e,t){8.L&&8.L.2h&&(e.2P(),e.2O(),8[-1==t?"20":"26"]())},8)),y&&1x.4J.bt("bu",b.1c(I(e){8.6C=1<e.5Q},8)),b(l).1T("5D",b.1c(I(){1e(8.15.1Z(":1U")&&!8.6C){11 e=b(l).3l(),t=b(l).4n();8.2e.2s("87"),8.2e.1s("87",b.1c(I(){b(l).3l()!=e||b(l).4n()!=t||8.L.2b&&8.15.1Z(":1U")&&8.4P()},8),bv)}},8)).1T(y?"bw":"3x",b.1c(I(){8.15.1Z(":1U")&&(b(l).3l(),b(l).4n(),8.2e.2s("88"),8.2e.1s("88",b.1c(I(){8.15.1Z(":1U")&&(8.4P(),"1Y"==j.14&&j.2K.2y(),v.15.1Z(":1U")&&v.2m())},8),1))},8)),8.3e.1T("2n",b.1c(8.17,8))},81:I(){8.15.89(".51 .3o, .3y .4u").89(".bx")},3R:I(){11 e=8.5R=8.3a(8.24.1t),t=e.2w,n=t.4w,r=t.5S,i=t.1X;8.15.1Z(":1U"),1F.3k.2E||8.1S.1a({12:"2I%",13:"2I%"});11 s=8.5P;s.8a(0,0,8.4s[0].12,8.4s[0].13),8.2w.1a(q(t.1d)),8.15.1a(q(8.24.1D)),8.1S.1a(q(e.1S.1q)),8.2w.1a(q(n.1q)),8.4s.1W(n.1q),8.3c.1a(q(n.1q)),8.3c.1a(q(t.1d)),8.2Z.1a("12",n.1q.12+"1K").1a("3A-1o",-0.5*n.1q.12+"1K");11 o=e.1t,t=o.1q,o=o.1d;8.1t.1a(q(t)).1a(q(o)),8.21.1J(8.2x).1J(8.23).1a({12:t.12+"1K"}),t=e.21.1d,0<t.1o&&0<t.1k&&8.21.1a(q(t)),s.4R=z.6r(s,8.L.2T,{5z:0,5A:8.L.1X,5B:0,5C:8.L.1X+r.1q.13}),8.6D(),s.5y(),i&&(s.4R=z.6r(s,8.L.1X,{5z:0,5A:0,5B:0,5C:n.1q.13}),8.6D(),8.8b(),s.5y()),8.8c(),8.L.1y&&8.1y.1a(q(e.1y.1d)),!1F.3k.2E&&m&&9>m&&(b(8.2w[0].8d).19("8e"),b(8.1y[0].8d).19("8e"))},2y:I(){11 e=8.15,t=8.1t,n=8.1t.1w(".4V").52()[0];1e(n&&8.1f){b(n).1a({12:"30",13:"30"}),t.1a({12:"30",13:"30"});11 t=22(e.1a("1k")),r=22(e.1a("1o")),i=22(e.1a("12"));e.1a({1o:"-8f",1k:"-8f",12:"by",13:"30"});11 s=8.4x.8g(n);d.1m.1z("3Z")||(s=8.4x.8h(n,s,8.1f)),8.24.1t=s,8.24.1D=8.3a(s).1D.1q,e.1a(q({1o:r,1k:t,12:i})),8.3R(),8.L.2b&&8.5T(8.3a(s).1D.1q,0)}},40:I(e,n,r){11 i=b.1u({3B:8.L.1C.1D.3x,31:I(){}},r||{}),r=2*(8.L.1I&&8.L.1I.2k||0),e=1i.2m(r,e),n=1i.2m(r,n),s=t.2X(8.24.1t),o=e-s.12,u=n-s.13,a=t.2X(8.24.1D),e=8.3a({12:e,13:n}).1D.1q,f=e.12-a.12,l=e.13-a.13,c=8;6E=8.1m.1z("8i"),8j=8.2v.4T,8k=8j-6E,6F=8.1m.1z("8l"),8m=8.2v.3Q,8n=8m-6F,6G=8.1m.1z("8o"),8p=8.2L,8q=8p-6G,8.15.1W({"1l-1L-3x-3C":0});11 h=8.1f&&8.1f.1v;1b 8.1S.1p(!0).53({"1l-1L-3x-3C":1},{3B:i.3B,8r:I(e,t){c.24.1t={12:1i.2f(t.3p*o+s.12),13:1i.2f(t.3p*u+s.13)},c.24.1D={12:1i.2f(t.3p*f+a.12),13:1i.2f(t.3p*l+a.13)},c.2v.4T=1i.2f(t.3p*8k+6E),c.2v.3Q=1i.2f(t.3p*8n+6F),c.2L=1i.2f(t.3p*8q+6G),c.5T(c.24.1D,0),c.3R()},5p:"5q",1O:!1,31:b.1c(I(){8.15.8s("1l-1L-3x-3C"),8.1f&&8.1f.1v==h&&i.31&&(8.1S.8s("bz",0),i.31())},8)}),8},8t:I(e){11 t=b(l).3l(),n=b(l).4n();2J(d.L&&d.L.1r&&d.L.1r.14){1H"1k":t+=j.2q.15.4m()}11 r=C.2b(),i={1k:t,1o:n};i.1o+=1i.54(.5*r.12-.5*e.12),"4P"==8.L.1d.at&&(i.1k+=1i.54(.5*r.13-.5*e.13)),i.1o<n&&(i.1o=n),i.1k<t&&(i.1k=t);1e(e=8.L.1d.36)i.1k+=e.y,i.1o+=e.x;1b i},5T:I(e,t,n){e=8.8t(e),8.2w.1W("1l-8u-8v-8w",0);11 r=22(8.15.1a("1k"))||0,i=22(8.15.1a("1o"))||0,s=e.1k-r,o=e.1o-i;8.2w.1p(!0).53({"1l-8u-8v-8w":1},{8r:b.1c(I(e,t){8.15.1a({1k:1i.2f(t.3p*s+r)+"1K",1o:1i.2f(t.3p*o+i)+"1K"})},8),5p:"5q",3B:"2H"==b.14(t)?t:8.L.1C.1D.1d||0,31:n})},4P:I(e,t){8.5T(8.24.1D,e,t)},4y:I(e,t,n){11 r=8.L&&8.L.8x;8.1B=e,e=b.1u({6H:!1},n||{}),8.41({42:8.1m.1z("1U")&&r}),e.6H&&!8.1m.1z("1U")?8.8y(t):8.2o(t)},2o:I(e,t){1e(e&&8.1d!=e){8.2e.2s("1N"),8.1N&&(b(8.1N).1p().2c(),8.1N=1A);11 n=8.1d,r=8.L,r=r&&r.1r&&r.1r.14,i=8.2v&&8.2v.4T||0,s=8.2v&&8.2v.3Q||0,o=8.2L||0;8.1d=e,8.1f=8.1B[e-1],8.3W(8.1f.L&&8.1f.L.1S,8.1f.L),8.6v(8.1f.L),8.1m.1s("8i",i),8.1m.1s("8l",s),8.1m.1s("8o",o),r!=8.L.1r.14?8.1m.1s("5U",!0):8.1m.1s("5U",!1),n||8.L&&"I"==b.14(8.L.8z)&&8.4q.5K.1O(b.1c(I(e){8.L.8z.3N(1F),e()},8)),8.3n(t)}},8y:I(e){1e(e=8.1B[e-1])e=J.2t(e.L||{}),v.2W(b.1u(!0,{5F:e.1C.2U},e.2U)),8.3W(e.1S,e,{4r:!0}),e=e.bA,8.40(e.12,e.13,{3B:0})},4z:I(){1e(!8.1B)1b{};11 e=8.1d,t=8.1B.1n;1b{26:1>=e?t:e-1,20:e>=t?1:e+1}},8A:I(){1e(!(1>=8.1B.1n)){11 e=8.4z(),t=e.26,e=e.20,n={26:t!=8.1d&&8.1B[t-1],20:e!=8.1d&&8.1B[e-1]};1==8.1d&&(n.26=1A),8.1d==8.1B.1n&&(n.20=1A),b.1E(n,I(e,t){t&&t.14=="1R"&&t.L.5V&&r.5V(n[e].1v,{6I:!0})})}},2g:I(e){I t(){d.2o(d.4z().20,I(){!d.1f||!d.L||!d.L.2l||!d.1m.1z("3D")?d.1p():d.2e.1s("2l",t,d.L.2l.6n)})}8.1m.1s("3D",!0),e?t():d.2e.1s("2l",t,8.L.2l.6n),j.2g()},1p:I(){d.2e.2s("2l"),8.1m.1s("3D",!1),j.1p()},55:I(){1b 8.L.8B&&8.1B&&1<8.1B.1n||1!=8.1d},26:I(e){8.1p(),(e||8.55())&&8.2o(8.4z().26)},56:I(){1b 8.L.8B&&8.1B&&1<8.1B.1n||8.1B&&1<8.1B.1n&&1!=8.4z().20},20:I(e){8.1p(),(e||8.56())&&8.2o(8.4z().20)},57:I(){8.3c.17().1w(".3o").17();1e(8.1f&&1<8.1B.1n&&"1k"!=j.14){11 e=8.55(),t=8.56();(e||t)&&8.2Z.1j(),"1R"==8.1f.14&&(8.3c.1j(),8.15.1w(".5N").2M(0,e?1:0,e?1A:I(){b(8).17()}),8.15.1w(".5O").2M(0,t?1:0,t?1A:I(){b(8).17()}));11 n=8.15.1w(".4t"),r=8.15.1w(".4v");n.1p(0,1).2M(e&&0<22(n.1a("1G"))?0:8.L.1C.6m[e?"1j":"17"],e?1:0,e?I(){b(8).1a({1G:"6J"})}:I(){b(8).17()}),r.1p(0,1).2M(t&&0<22(r.1a("1G"))?0:8.L.1C.6m[t?"1j":"17"],t?1:0,t?I(){b(8).1a({1G:"6J"})}:I(){b(8).17()})}2Y 8.15.1w(".4t, .5N, .4v, .5O").17()},8C:I(){1e(!8.1m.1z("59")){11 e=[];b("8D, 4A, bB").1E(I(t,n){11 r;b(n).1Z("4A, 8D")&&(r=b(n).1w(\'5l[5w="8E"]\')[0])&&r.5W&&"8F"==r.5W.5m()||b(n).1Z("[8E=\'8F\']")||e.3f({15:n,43:b(n).1a("43")})}),b.1E(e,I(e,t){b(t.15).1a({43:"bC"})}),8.1m.1s("59",e)}},8G:I(){11 e=8.1m.1z("59");e&&0<e.1n&&b.1E(e,I(e,t){b(t.15).1a({43:t.43})}),8.1m.1s("59",1A)},8H:I(){11 e=8.1m.1z("59");e&&b.1E(e,b.1c(I(e,t){11 n;(n=b(t.15).6A(".5M")[0])&&n==8.1t[0]&&b(t.15).1a({43:t.43})},8))},1j:I(e){11 t=8.4q.5K;t.1O([]),8.8C(),8.L.2U&&t.1O(I(e){v.1j(I(){e()})}),t.1O(b.1c(I(e){8.8I(I(){e()})},8)),"I"==b.14(e)&&t.1O(b.1c(I(t){e(),t()}),8)},8I:I(e){1b 1F.3k.2E?(8.15.1p(!0),8.5E(1,8.L.1C.1D.1j,b.1c(I(){j.2q.6K.1j(),"1k"==j.14&&d.L.1r&&"1k"==d.L.1r.1V&&j.2q.4B.1j(),8.1m.1s("1U",!0),e&&e()},8))):(j.2q.6K.1j(),"1k"==j.14&&d.L.1r&&"1k"==d.L.1r.1V&&j.2q.4B.1j(),8.15.1j(0,e),8.1m.1s("1U",!0)),8},17:I(){11 e=8.4q.5K;e.1O([]),e.1O(b.1c(I(e){8.8J(b.1c(I(){e()},8))},8)).1O(b.1c(I(e){8.41({42:8.L&&8.L.8x,5X:b.1c(I(){v.17(b.1c(I(){8.8G(),e()},8))},8)})},8))},8J:I(e){1b 8.5Y(),1F.3k.2E?8.15.1p(!0,!0).3T(8.L.1C.1D.17||0,b.1c(I(){8.1m.1s("1U",!1),e&&e()},8)):(8.1m.1s("1U",!1),8.15.17(0,e)),8},41:I(e){e=b.1u({5X:!1,42:!1},e||{}),"I"==b.14(e.42)&&e.42.3N(1F),8.5Y(),8.2e.2s(),8.1p(),j.17(),j.41(),8.21.17(),8.3c.17().1w(".3o").17(),8.6L(),8.1d=1A,j.2K.1d=-1,O.6M(),8.6C=!1,d.1m.1s("1N",!1),8.1N&&(b(8.1N).1p().2c(),8.1N=1A),"I"==b.14(e.5X)&&e.5X.3N(1F)},5E:I(e,t,n){8.15.1p(!0,!0).2M(t||0,e||1,n)},8K:I(){1e(8.L.29&&l.2R){8.29&&(8.29.2c(),8.29=1A),8.29=2R.2t(8.3e[0],8.L.29||{}).2g();11 e=2R.6N(8.3e[0]);8.3e.1a({13:e.13+"1K",12:e.12+"1K","3A-1o":1i.2f(-0.5*e.12)+"1K","3A-1k":1i.2f(-0.5*e.13)+"1K"})}},8L:I(){11 e;8.44&&8.48&&((e=b(8.44).1l("8M"))&&b(8.44).1a({8N:e}),b(8.48).42(8.44).2c(),8.44=8.48=1A)},6L:I(){11 e=8.1t.1w(".4V")[0],e=b(e||8.1t).3v().52()[0],t=8.48&&8.44;8.8L();1e(e)2J(e.bD.5m()){1H"4A":4h{e.bE()}4i(n){}4h{e.bF=""}4i(r){}e.5t?b(e).2c():e=I(){};28;bG:t||b(e).2c()}d.2e.2s("3q");1e(e=d.1m.1z("3q"))b.1E(e,I(e,t){t.33=I(){}}),d.1m.1s("3q",!1);8.1t.1Q("")},5Y:I(){8.4q.3n.1O([]),8.1t.1p(!0),8.1S.1p(!0),8.2w.1p(!0),8.3e.1p(!0)},6O:I(e){8.21.2r("8O 8P").1a({12:(e?e:8.24.1t.12)+"1K"}),8.2x[8.1f.2x?"1j":"17"]().1Q(""),8.23[8.1f.23?"1j":"17"]().1Q(""),8.1f.2x&&(8.2x.1Q(8.1f.2x),8.21.19("8P")),8.1f.23&&(8.23.1Q(8.1f.23),8.21.19("8O"))},3n:I(e){11 t=8.4q.3n,n={12:8.L.12,13:8.L.13};8.5Y(),8.21.1p(!0),8.15.1w(".4t, .5N, .4v, .5O").1p(!0),8.1m.1s("3Z",!1),8.1m.1z("5U")&&t.1O(b.1c(I(e){j.17(),e()},8)),8.21.1Z(":1U")&&t.1O(b.1c(I(e){8.21.3T(8.L.1C.23.17,e)},8)),8.29&&8.3e.1Z(":1U")&&t.1O(b.1c(I(e){8.3e.3T(8.L.1C.29.17,b.1c(I(){8.29&&8.29.2c(),e()},8))},8)),t.1O(b.1c(I(e){8.1t.53({1G:0},{31:b.1c(I(){8.6L(),8.1t.17(),e()},8),1O:!1,3B:8.L.1C.1t.17})},8)),0<8.L.1C.1D.3x&&t.1O(b.1c(I(e){8.8K(),8.3e.2M(8.L.1C.29.1j,1,I(){b(8).1a({1G:"6J"}),e()})},8)),t.1O(b.1c(I(e){11 t=0,r=0;"2B"==b.14(n.12)&&-1<n.12.2Q("%")&&(t=5v(n.12)/2I),"2B"==b.14(n.13)&&-1<n.13.2Q("%")&&(r=5v(n.13)/2I);1e(t||r){11 i;i=C[8.L.2b?"2b":"1x"](),t&&(n.12=1i.54(i.12*t)),r&&(n.13=1i.54(i.13*r))}e()},8));1e(/^(3L|4G)$/.6b(8.1f.14)&&!1F.4M[8.1f.14]){11 i=8.L.8Q&&8.L.8Q.bH||"",i=i.4I("#{8R}",1F.8S[8.1f.14]),i=i.4I("#{14}",8.1f.14);b.1u(8.1f,{14:"1Q",2x:1A,23:1A,1v:i})}t.1O(b.1c(I(e){2J(8.1f.14){1H"1R":r.1z(8.1f.1v,{14:8.1f.14},b.1c(I(t,n){1e(8.L.12||8.L.13)t=8.3g.5Z({12:8.L.12||t.12,13:8.L.13||t.13},t);t=8.3g.49(t,8.1f),8.40(t.12,t.13,{31:b.1c(I(){11 r=!8.1t.1Z(":1U");"bI"!=8.1f.4C&&m&&8.1m.1z("3Z")?K(b("<1g>").1a(q(t)).19("8T").1a({60:\'bJ:bK.bL.bM(2z="\'+n.1R.2z+\'", bN="5Q")\'})):K(b("<5k>").1a(q(t)).1a({"-7A-bO-bP":"bQ"}).19("8T").1W({2z:n.1R.2z,bR:""})),D(1A,t),r&&8.1t.17(),e()},8)})},8));28;1H"4G":aa.6i("7q");11 t=8.3g.49(n,8.1f);8.40(t.12,t.13,{31:b.1c(I(){11 n=Z(),r=b("<1g>").1W({bS:n});r.1a(q(t)),K(r),6h.bT(8.1f.1v,n,""+t.12,""+t.13,"9.0.0",1A,8.1f.L.bU||1A,8.1f.L.61||{}),b("#"+n).19("bV"),D(1A,t),e()},8)});28;1H"3L":11 i=!!8.1f.L.61.8U;!y&&"3L"==8.1f.14&&i&&(n.13+=16),t=8.3g.49(n,8.1f),8.40(t.12,t.13,{31:b.1c(I(){11 n={3K:"4A","bW":"bX",12:t.12,13:t.13,8R:1F.8S[8.1f.14],3v:[]},r;1P(r 3H 8.1f.L.61)n.3v.3f({3K:"5l",5w:r,5W:8.1f.L.61[r]});b.bY(n.3v,[{3K:"5l",5w:"2z",5W:8.1f.1v}]),b.1u(n,m?{bZ:"c0://c1.c2.c3/c4/c5.c6",c7:"c8:c9-ca-cb-cc-cd"}:{1l:8.1f.1v,14:"ce/3L"}),K(W(n)),D(1A,t),i&&8.2e.1s(b.1c(I(){4h{11 e=8.1t.1w("4A")[0];"8V"3H e&&e.8V(8U)}4i(t){}},8),1),e()},8)});28;1H"4H":1H"cf":11 t=8.3g.49(n,8.1f),s=b("<4H>").1W({cg:0,ch:0,12:t.12,13:t.13,2z:8.1f.1v}).19("ci");8.1f.L.1W&&s.1W(8.1f.L.1W),8.40(t.12,t.13,{31:b.1c(I(){K(s),D(1A,t),e()},8)});28;1H"1Q":11 o=b("<1g>").1h(8.1f.1v).19("cj");8.4x.3n(o,8.1f,b.1c(I(){D(1A,8.24.1t),e()},8));28;1H"4g":o=b("#"+8.1f.1v)[0];1e(!o)28;8.44=o,8.4x.3n(o,8.1f,b.1c(I(){D(1A,8.24.1t),e()},8));28;1H"2F":b.1u({1v:8.1f.1v},8.1f.L.2F||{});11 u=8.1f.1v,u=8.1f.1v,o=8.1f.L.2F||{};b.2F({1v:u,14:o.14||"1z",8W:o.8W||"1Q",1l:o.1l||{},ck:b.1c(I(t,n,r){u==8.1f.1v&&8.4x.3n(r.cl,8.1f,b.1c(I(){D(1A,8.24.1t),e()},8))},8)})}},8)),t.1O(b.1c(I(e){8.8A(),e()},8)),"I"==b.14(8.L.8X)&&t.1O(b.1c(I(e){8.1t.1Z(":1U")||8.1t.1j().1a({1G:0});11 t=8.1t.1w(".4V")[0];8.L.8X.3N(1F,t,8.1d),e()},8)),t.1O(b.1c(I(e){8.3e.3T(8.L.1C.29.17,b.1c(I(){8.29&&8.29.2c(),e()},8))},8)),t.1O(b.1c(I(e){j.1s(8.L.1r.14),"1Y"==j.14&&-1==j.2K.1d&&j.2K.3P(8.1d,!0),j.2y(),e()},8)),t.1O(b.1c(I(e){8.57(),e()},8)),t.1O(b.1c(I(e){8.8H(),8.1t.2M(8.L.1C.1t.1j,P&&18<=P?.cm:1,b.1c(I(){e()},8))},8)),(8.1f.2x||8.1f.23)&&t.1O(b.1c(I(e){8.6O(),8.21.2M(8.L.1C.23.1j,1,e)},8)),t.1O(b.1c(I(e){O.8Y(),e()},8)),e&&t.1O(I(t){e(),t()})},5a:I(e){8.8Z.1W("4j",""),8.8Z.1Q(e)},3a:I(e){11 n={},r=8.L.1X&&8.L.1X.2k||0,i=8.2L||0,s=8.L.1I&&"2T"==8.L.1I.1d?8.L.1I.2k||0:0,o=r&&8.L.1I&&"1X"==8.L.1I.1d?8.L.1I.2k||0:s+r,e=e||8.24.1t;r&&o&&o>r+s&&(o=r+s);11 u=8.L.1y&&8.L.1y.38||0,a=1i.2m(u,8.2v.4T),u=1i.2m(u,8.2v.3Q),f={12:e.12+2*i,13:e.13+2*i},l={13:f.13+2*r,12:f.12+2*r},c=t.2X(l),h;8.L.1y&&(c.12+=2*8.L.1y.38,c.13+=2*8.L.1y.38,h={1k:u-8.L.1y.38,1o:a-8.L.1y.38},8.L.1y.36&&(h.1k+=8.L.1y.36.y,h.1o+=8.L.1y.36.x));11 p={1k:u,1o:a},d={12:l.12+2*a,13:l.13+2*u},v={1k:0,1o:0},m={12:0,13:0};1e(e&&8.1f&&(8.1f.2x||8.1f.23)){11 v=!8.15.1Z(":1U"),g=!8.21.1Z(":1U");8.21.1J(8.2x).1J(8.23).1a({12:"30"}),v&&8.15.1j(),g&&8.21.1j();11 y=8.2x.1Q(),w=8.23.1Q();8.6O(e.12),m={12:8.21.4a(!0),13:8.21.cn(!0)},8.2x.1Q(y),8.23.1Q(w),g&&8.21.17(),v&&8.15.17(),v={1k:p.1k+l.13,1o:p.1o+r+i}}1b b.1u(n,{1D:{1q:{12:d.12,13:d.13+m.13}},1S:{1d:{1k:u,1o:a},1q:d},1t:{1d:{1k:p.1k+r+i,1o:p.1o+r+i},1q:b.1u({},8.24.1t)},2w:{1X:r,5S:{1I:s,2L:i,1q:f,1d:{1k:r,1o:r}},4w:{1I:o,1q:l},1d:p},1y:{1d:h,1q:c},21:{1d:v,1q:m}}),n},6D:I(){11 e=8.5P,t=8.5R,r=t.2w,i=r.1X,r=r.5S.1I,s=t.2w.5S.1q,t=s.12,s=s.13,o=r,u=0;i&&(o+=i,u+=i),e.7M(o,u),e.3P(o,u),r?(e.2V(i+t-r,i+r,r,n(-90),n(0),!1),o=i+t,u=i+r):(o+=t,e.2D(o,u)),u+=s-2*r,e.2D(o,u),r?(e.2V(i+t-r,i+s-r,r,n(0),n(90),!1),o=i+t-r,u=i+s):e.2D(o,u),o-=t-2*r,e.2D(o,u),r?(e.2V(i+r,i+s-r,r,n(90),n(3I),!1),o=i,u=i+s-r):e.2D(o,u),u-=s-2*r,e.2D(o,u),r&&(e.2V(i+r,i+r,r,n(-3I),n(-90),!1),u=i,o=i+r+1),e.2D(o,u),i||e.6q()},8b:I(){11 e=8.5R,t=8.5P,r=e.2w.4w.1I,i=e.2w.4w.1q,e=i.12,i=i.13,s=r,o=0,s=r;t.3P(s,o),r?(t.2V(r,r,r,n(-90),n(-3I),!0),s=0,o=r):t.2D(s,o),o+=i-2*r,t.2D(s,o),r?(t.2V(r,i-r,r,n(-3I),n(-co),!0),s=r,o=i):t.2D(s,o),s+=e-2*r,t.2D(s,o),r?(t.2V(e-r,i-r,r,n(90),n(0),!0),s=e,o=i-r):t.2D(s,o),o-=i-2*r,t.2D(s,o),r&&(t.2V(e-r,r,r,n(0),n(-90),!0),o=0,s=e-r+1),t.2D(s,o),t.6q()},8c:I(){8.6z.8a(0,0,8.3X[0].12,8.3X[0].13);1e(8.L.1y){8.1y.1j();11 e=8.5R,t=e.2w.4w.1I,n=e.2w.4w.1q,r=8.L.1y,i=8.L.1y.38,s=8.6z;8.1y.1a(q(e.1y.1q)),8.3X.1W(e.1y.1q),8.3X.1a({1k:0,1o:0});1P(11 e=r.1G,o=r.38+1,u=0;u<=i;u++)s.4R=E.3O(r.2j,(1i.69/2-1i.7o(u*(1/o),1i.cp(u*(1/o))*1i.69))*(e/o)),z.6p(s,{12:n.12+2*u,13:n.13+2*u,1k:i-u,1o:i-u,1I:t+u}),s.5y();8.1y.1j()}2Y 8.1y.17()}},s={},U=0;d.2e={1s:I(e,t,n){"2B"==b.14(e)&&8.2s(e);1e("I"==b.14(e)){n=t;1P(t=e;s["91"+U];)U++;e="91"+U}s[e]=l.cq(I(){t&&t(),s[e]=1A,5b s[e]},n)},1z:I(e){1b s[e]},2s:I(e){e||(b.1E(s,I(e,t){l.92(t),s[e]=1A,5b s[e]}),s={}),s[e]&&(l.92(s[e]),s[e]=1A,5b s[e])}},d.1m={6P:{},1s:I(e,t){8.6P[e]=t},1z:I(e){1b 8.6P[e]||!1}},b.1u(H.5r,{4f:I(a,c){11 d=c||{};1e("2B"==b.14(a))a={1v:a};2Y 1e(a&&1==a.5s)11 e=b(a),a={15:e[0],1v:e.1W("93"),2x:e.1l("1L-2x"),23:e.1l("1L-23"),3r:e.1l("1L-3r"),4C:e.1l("1L-4C"),14:e.1l("1L-14"),L:e.1l("1L-L")&&6Q("({"+e.1l("1L-L")+"})")||{}};1b a&&(a.4C||(a.4C=Y(a.1v)),!a.14)&&(a.14=X(a.1v,a.4C)),a.L=a&&a.L?b.1u(!0,t.2X(d),t.2X(a.L)):t.2X(d),a.L=J.2t(a.L,a.14),b.1u(8,a),8},94:I(){1b-1<b.6a(8.14,["4H","4g","2F"])},cr:I(){1b!8.94()}}),d.3g={49:I(e){1e(!d.1f.L.2b)1b d.1m.1s("3Z",!1),e;11 t=C.2b(),n=d.3a(e).1D.1q,r=1;1e("5Q"==d.1f.L.2b)1P(11 i=e,e=5;0<e&&(n.12>t.12||n.13>t.13);){d.1m.1s("3Z",!0),e--,5J>n.12&&(e=0);1e(2I<i.12&&2I<i.13){11 s=r=1;n.12>t.12&&(r=t.12/n.12),n.13>t.13&&(s=t.13/n.13),r=1i.62(r,s),i={12:1i.2p(i.12*r),13:1i.2p(i.13*r)}}n=d.3a(i).1D.1q}2Y{i=e;1P(e=3;0<e&&(n.12>t.12||n.13>t.13);)d.1m.1s("3Z",!0),e--,5J>n.12&&(e=0),n.12>t.12&&(i.12-=n.12-t.12),n.13>t.13&&(i.13-=n.13-t.13),n=d.3a(i).1D.1q}1b e=i},5Z:I(e,t){1e(e.12&&t.12>e.12||e.13&&t.13>e.13){11 n=8.96(t,{12:e.12||t.12,13:e.13||t.13});e.12&&(t.12=1i.2p(t.12*n)),e.13&&(t.13=1i.2p(t.13*n))}1b t},96:I(e,t){1b 1i.62(t.13/e.13,t.12/e.12,1)},5Q:I(e,t){1b{12:(e.12*t).2p(),13:(e.13*t).2p()}},cs:I(e,t){11 n=1i.62(t.13/e.13,t.12/e.12,1);1b{12:1i.2p(e.12*n),13:1i.2p(e.13*n)}}};11 O={3s:!1,5c:{1o:37,4Y:39,9a:32,9b:27},8Y:I(){8.6R()},6M:I(){8.3s=!1},2S:I(){8.6R(),b(1x).ct(b.1c(8.9c,8)),b(1x).cu(b.1c(8.9d,8)),O.6M()},6R:I(){8.3s=d.L.cv},9c:I(e){1e(8.3s&&d.15.1Z(":1U")){11 t=8.6S(e.5c);1e(t&&(!t||!8.3s||8.3s[t]))2J(e.2P(),e.2O(),t){1H"1o":d.26();28;1H"4Y":d.20();28;1H"9a":d.1B&&1<d.1B.1n&&d[d.1m.1z("3D")?"1p":"2g"]()}}},9d:I(e){1e(8.3s&&d.15.1Z(":1U")&&(e=8.6S(e.5c))&&(!e||!8.3s||8.3s[e]))2J(e){1H"9b":d.17()}},6S:I(e){1P(11 t 3H 8.5c)1e(8.5c[t]==e)1b t;1b 1A}},r={1z:I(e,t,n){"I"==b.14(t)&&(n=t,t={});11 t=b.1u({63:!0,14:!1,cw:cx},t||{}),i=r.1M.1z(e),s=t.14||X(e),o={14:s,cy:n};1e(i)n&&n(b.1u({},i.1q),i.1l);2Y 2J(t.63&&r.64.2s(e),s){1H"1R":11 u=35 6T;u.33=I(){u.33=I(){},i={1q:{12:u.12,13:u.13}},o.1R=u,r.1M.1s(e,i.1q,o),t.63&&r.64.2s(e),n&&n(i.1q,o)},u.2z=e,t.63&&r.64.1s(e,{1R:u,14:s})}},6U:I(){1b 8.4f.5j(8,R.3N(6c))}};b.1u(r.6U.5r,{4f:I(){8.1M=[]},1z:I(e){1P(11 t=1A,n=0;n<8.1M.1n;n++)8.1M[n]&&8.1M[n].1v==e&&(t=8.1M[n]);1b t},1s:I(e,t,n){8.2c(e),8.1M.3f({1v:e,1q:t,1l:n})},2c:I(e){1P(11 t=0;t<8.1M.1n;t++)8.1M[t]&&8.1M[t].1v==e&&5b 8.1M[t]},cz:I(e){11 t=1z(e.1v);t?b.1u(t,e):8.1M.3f(e)}}),r.1M=35 r.6U,r.6V=I(){1b 8.4f.5j(8,R.3N(6c))},b.1u(r.6V.5r,{4f:I(){8.1M=[]},1s:I(e,t){8.2s(e),8.1M.3f({1v:e,1l:t})},1z:I(e){1P(11 t=1A,n=0;n<8.1M.1n;n++)8.1M[n]&&8.1M[n].1v==e&&(t=8.1M[n]);1b t},2s:I(e){1P(11 t=8.1M,n=0;n<t.1n;n++)1e(t[n]&&t[n].1v==e&&t[n].1l){11 r=t[n].1l;2J(r.14){1H"1R":r.1R&&r.1R.33&&(r.1R.33=I(){})}5b t[n]}}}),r.64=35 r.6V,r.5V=I(e,t,n){"I"==b.14(t)&&(n=t,t={}),t=b.1u({6I:!1},t||{});1e(!t.6I||!r.4D.1z(e)){11 i;1e((i=r.4D.1z(e))&&i.1q)"I"==b.14(n)&&n(b.1u({},i.1q),i.1l);2Y{11 s={1v:e,1l:{14:"1R"}},o=35 6T;s.1l.1R=o,o.33=I(){o.33=I(){},s.1q={12:o.12,13:o.13},b.14(n)=="I"&&n(s.1q,s.1l)},r.4D.1M.1J(s),o.2z=e}}},r.4D={1z:I(e){1b r.4D.1M.1z(e)},6N:I(e){1b(e=8.1z(e))&&e.1q}};11 G=[];r.4D.1M={1z:I(e){1P(11 t=1A,n=0,r=G.1n;n<r;n++)G[n]&&G[n].1v&&G[n].1v==e&&(t=G[n]);1b t},1J:I(e){G.3f(e)}},b(1x.4J).3Y(".1L[93]","2n",I(e,t){e.2O(),e.2P(),t=e.cA,1F.1j(t)});11 j={14:!1,1s:I(e){8.14=e,d.1m.1z("5U")&&8.17(),b(["5d","1k","1Y"]).1E(I(e,t){d.3b.2r("9e"+t)}),d.3b.19("9e"+e);2J(8.14){1H"5d":8.3d.1j();28;1H"1k":8.2q.1j();28;1H"1Y":8.2K.1j()}},2y:I(){8.3d.3t.9f(d.1B.1n),8.3d.3t.2o(d.1d),8.3d.2y(),8.2K.1d=d.1d,8.2K.2y(),8.2q.2y()},17:I(){8.3d.17(),8.2q.17(),8.2K.17()},2g:I(){8.3d.2g(),8.2q.2g()},1p:I(){8.3d.1p(),8.2q.1p()},41:I(){8.2K.41()},2K:{2t:I(){8.1d=-1,8.6W=8.65=1A,8.6X=[],b(1x.3i).1h(8.15=b("<1g>").19("9g").1h(8.2u=b("<1g>").19("9h").1h(8.2G=b("<1g>").19("cB"))).17()).1h(8.1V=b("<1g>").19("9i").1h(8.4B=b("<1g>").19("9j")).17()),8.4b=d.2Z.1J(d.2Z.1w(".4t")).1J(d.2Z.1w(".4v")).1J(d.3c),m&&7>m&&(8.15.1a({1d:"3S",1k:"30"}),8.15[0].4j.4U("1k","((-1 * 8.cC + (1D.2i ? 2i(1D).13() + 2i(1D).3l() : 0)) + \'1K\')")),8.3z()},3z:I(){8.4B.1T("2n",I(){d.17()}),8.15.1T("2n",b.1c(I(e){(!8.L||!8.L.2U||8.L.2U.1V)&&b(e.34).1Z(".9g, .9h")&&d.17()},8)).3Y(".66","2n",b.1c(I(e){11 t=b(e.34).6A(".3E")[0];8.2G.1w(".3E").1E(b.1c(I(e,n){11 r=e+1;n==t&&(8.3F(r),8.2o(r),d.2o(r))},8))},8)).1T("1L:2h",b.1c(I(e,t){"1Y"==j.14&&(!d.L||!d.L.1r||!d.L.1r.1Y||!d.L.1r.1Y.2h)||(e.2P(),e.2O(),8["cD"+(-1==t?"20":"26")]())},8)),8.1V.1T("1L:2h",b.1c(I(e){1e(!d.L||d.L.2h||"1Y"==j.14&&d.L&&d.L.1r&&d.L.1r.1Y&&d.L.1r.1Y.2h||d.L&&d.L.2b)e.2P(),e.2O()},8))},3W:I(e){b.1E({15:"cE",1V:"9k"},b.1c(I(t,n){11 r=8[t];b.1E((r[0].6w||"").3J(" "),I(e,t){-1<t.2Q(n)&&r.2r(t)}),r.19(n+e)},8));11 t="";b.1E(d.1B,I(e,n){t+=n.1v}),(8.65!=t||8.6W!=e)&&8.4y(d.1B),8.65=t,8.6W=e},9l:I(){b(8.6X).1E(I(e,t){t.33=I(){}}),8.6X=[]},2s:I(){l.2R&&2R.2c(".66 .6y"),8.2G.1Q("")},41:I(){8.1d=-1,8.65=1A},4y:I(e,t){8.1d=-1,8.9l(),8.2s(),b.1E(e,b.1c(I(t,n){11 r,i;8.2G.1h(r=b("<1g>").19("3E").1h(i=b("<1g>").19("66"))),8.2G.1a({12:r.4a()*e.1n+"1K"});1e("1R"==n.14||n.L.2a&&n.L.2a.1R)r.19("6Y"),r.1l("2a",{1f:n,2z:n.L.2a&&n.L.2a.1R||n.1v});n.L.2a&&n.L.2a.4l&&i.1h(b("<1g>").19("cF cG"+n.L.2a.4l))},8)),t&&8.3P(t,!0)},9m:I(){11 e=8.1d,t=[],n=8.2G.1w(".3E:52").4a();1e(!e||!n)1b t;11 r=C.2b().12,n=1i.2f(r/n),i=1i.54(1i.2m(e-.5*n,0)),s=1i.2f(1i.62(e+.5*n));1b d.1B&&d.1B.1n<s&&(s=d.1B.1n),8.2u.1w(".3E").1E(I(e,n){e+1>=i&&e+1<=s&&t.3f(n)}),t},9n:I(){11 e=8.9m();b(e).60(".6Y").1E(b.1c(I(e,t){11 n=b(t).1w(".66"),i=b(t).1l("2a"),s=i.1f;b(t).2r("6Y");11 o,u,a,f;a=s.L.1r,l.2R&&(f=a&&a.1Y&&a.1Y.29)&&(n.1h(u=b("<1g>").19("cH").1h(a=b("<1g>").19("6y"))),o=2R.2t(a[0],f||{}).2g(),f=2R.6N(a[0]),a.1a(q({13:f.13,12:f.12,"3A-1o":1i.2f(-0.5*f.12),"3A-1k":1i.2f(-0.5*f.13)})));11 c={12:n.4S(),13:n.4m()},h=1i.2m(c.12,c.13);r.5V(i.2z,{14:s.14},b.1c(I(e,t){11 r=t.1R,i;1e(r.12>c.12&&r.13>c.13){i=d.3g.5Z({12:h,13:h},e);11 a=r=1;i.12<c.12&&(r=c.12/i.12),i.13<c.13&&(a=c.13/i.13),r=1i.2m(r,a),1<r&&(i.12*=r,i.13*=r),b.1E(["12","13"],I(e,t){i[t]=1i.2p(i[t])})}2Y i=d.3g.5Z(r.12<c.12||r.13<c.13?{12:h,13:h}:c,e);r=1i.2p(.5*c.12-.5*i.12),a=1i.2p(.5*c.13-.5*i.13),r=b("<5k>").1W({2z:t.1R.2z}).1a(q(i)).1a(q({1k:a,1o:r})),n.6t(r),u?u.3T(s.L.1C.1Y.4y,I(){o&&(o.2c(),o=1A,u.2c())}):r.1a({1G:0}).2M(s.L.1C.1Y.4y,1)},8))},8))},1j:I(){8.4b.1J(d.3b).1J(8.1V).17();11 e=8.4b,t=d.L.1r;2J(t&&t.1V){1H"1k":e=e.1J(8.1V);28;1H"5d":e=e.1J(d.3b)}d.57(),e.1j(),d.1B&&1>=d.1B.1n||8.15.1p(1,0).2M(d.L.1C.1Y.1j,1)},17:I(){8.4b.1J(d.3b).1J(8.1V).17(),8.15.1p(1,0).3T(d.L.1C.1Y.17)},cI:I(){1e(!(1>8.1d)){11 e=8.1d-1;8.3F(e),8.2o(e),d.2o(e)}},cJ:I(){1e(!(8.1d+1>d.1B.1n)){11 e=8.1d+1;8.3F(e),8.2o(e),d.2o(e)}},9o:I(){11 e=C.2b();8.2u.1a({12:e.12+"1K"})},2o:I(e){11 t=0>8.1d;1>e&&(e=1);11 n=8.3G();e>n&&(e=n),8.1d=e,8.3F(e),d.57(),8.3P(e,t)},3P:I(e,t){8.9o();11 n=C.2b().12,r=8.2G.1w(".3E").4a(),n=.5*n+ -1*(r*(e-1)+.5*r);8.2G.1p(1,0).53({1o:n+"1K"},t?0:d.L.1C.1Y.2G,b.1c(I(){8.9n()},8))},3F:I(e){11 t=8.2G.1w(".3E").2r("9p");e&&b(t[e-1]).19("9p")},2y:I(){8.1d&&8.2o(8.1d)},3G:I(){1b 8.2G.1w(".3E").1n||0}},3d:{2t:I(){8.3t.2t(),8.4b=b(8.3t.15).1J(d.2Z).1J(d.2Z.1w(".4t")).1J(d.2Z.1w(".4v")).1J(d.3c).1J(d.3c.1w(".3o"))},1j:I(){8.17();11 e=8.4b,t=d.L.1r;2J(t&&t.1V){1H"1k":e=e.1J(j.2q.1V);28;1H"5d":e=e.1J(d.3b)}e.1j(),d.57(),(d.1f&&1<d.1B.1n&&d.55()||d.56())&&8.3t.1j()},17:I(){8.4b.1J(j.2q.1V).1J(d.3b).17()},2y:I(){8.3t.2y()},2g:I(){8.3t.2g()},1p:I(){8.3t.1p()}}};j.3d.3t={2W:I(){11 e=d.L;8.L={2A:(e.1r&&e.1r.2u||{}).2A||5,3B:e.1C&&e.1C.2u&&e.1C.2u.2G||2I,2l:e.2l}},2t:I(){b(d.15).1h(8.15=b("<1g>").19("cK").1h(8.2u=b("<1g>").19("cL").1h(8.5e=b("<1g>").19("6Z cM").1h(b("<1g>").19("3u").1l("2N","26"))).1h(8.4E=b("<1g>").19("cN").1h(8.3h=b("<1g>").19("cO"))).1h(8.5f=b("<1g>").19("6Z 9q").1h(b("<1g>").19("3u").1l("2N","20"))).1h(8.4c=b("<1g>").19("6Z cP").1h(b("<1g>").19("3u 9q"))))),8.15.17(),8.3C=0,8.4d=8.1d=1,8.2W(),8.3z()},3z:I(){8.3h.3Y(".4e","2n",b.1c(I(e){e.2P(),e.2O(),e=22(b(e.34).1Q()),8.3F(e),d.1p(),d.2o(e)},8)),b.1E(["26","20"],b.1c(I(e,t){8["cQ"+t].1T("2n",b.1c(8[t+"9r"],8))},8)),8.2u.1T("1L:2h",b.1c(I(e,t){d.L&&d.L.2h&&!(8.3C<=8.L.2A)&&(e.2P(),e.2O(),8[(0<t?"26":"20")+"9r"]())},8)),8.4c.1T("2n",b.1c(I(){b(8).cR("70")||d[d.1m.1z("3D")?"1p":"2g"](!0)},8))},2y:I(){8.2W();11 e=8.3G(),t=e<=8.L.2A?e:8.L.2A,n=b(d.15).1Z(":1U");8.15.1a({12:"30"}),8.2u[1<e?"1j":"17"]();1e(!(2>e)){n||b(d.15).1j(),t=b(1x.3j("1g")).19("4e"),8.3h.1h(t),8.5g=e=t.4a(!0),t.19("71"),8.9s=e-t.4a(!0)||0,t.2c(),e=8.3G(),t=e<=8.L.2A?e:8.L.2A,e=(e=8.3C%8.L.2A)?8.L.2A-e:0,8.4E.1a({12:8.5g*t-8.9s+"1K"}),8.3h.1a({12:8.5g*(8.3C+e)+"1K"}),t=d.1B&&0<b.9t(d.1B,I(e){1b e.L.2l}).1n,8.4c.17().2r("70"),t&&8.4c.1j(),8.L.2l||8.4c.19("70"),8.3G()<=8.L.2A?(8.5f.17(),8.5e.17()):(8.5f.1j(),8.5e.1j()),8.15.1a({12:"30"}),8.2u.1a({12:"30"});11 r=0,t=2i.7w(b.cS(8.2u.3v("1g:1U")),I(e){11 t=b(e).4a(!0);1b m&&m<7&&(t+=(22(b(e).1a("3A-1o"))||0)+(22(b(e).1a("3A-4Y"))||0)),t});b.1E(t,I(e,t){r+=t}),m&&7>m&&r++,8.15.1a({1d:"3S"}),r&&8.15.1a({12:r+"1K"}),r&&8.2u.1a({12:r+"1K"}),8.15.1a({"3A-1o":1i.2f(-0.5*r)+"1K"}),t=22(8.3h.1a("1o")||0),e=8.67(),t<-1*(e-1)*8.L.2A*8.5g&&8.5h(e,!0),8.72(),n||b(d.15).17(),d.L&&d.L.1r&&!d.L.1r.2u&&8.2u.17()}},3G:I(){1b 8.3h.1w(".4e").1n||0},67:I(){1b 1i.2f(8.3G()/8.L.2A)},3F:I(e){b(8.4E.1w(".4e").2r("9u")[e-1]).19("9u")},2o:I(e){1>e&&(e=1);11 t=8.3G();e>t&&(e=t),8.1d=e,8.3F(e),8.5h(1i.2f(e/8.L.2A))},72:I(){8.5f.2r("9v"),8.5e.2r("9w"),1>8.4d-1&&8.5e.19("9w"),8.4d>=8.67()&&8.5f.19("9v"),8[d.1m.1z("3D")?"2g":"1p"]()},5h:I(e,t){8.4d==e||1>e||e>8.67()||(y&&8.4E.1a({1G:.cT}),8.3h.1p(!0).53({1o:-1*8.L.2A*8.5g*(e-1)+"1K"},t?0:8.L.3B||0,"cU",b.1c(I(){y&&8.4E.1a({1G:1})},8)),8.4d=e,8.72())},cV:I(){8.5h(8.4d-1)},cW:I(){8.5h(8.4d+1)},9f:I(e){8.3h.1w(".4e, .73").2c();1P(11 t=0;t<e;t++)8.3h.1h(b("<1g>").19("4e").1Q(t+1));1P(11 t=8.L.2A,n=e%t?t-e%t:0,t=0;t<n;t++)8.3h.1h(b("<1g>").19("73"));8.4E.1w(".4e, 73").2r("71").cX().19("71"),8.3C=e,8.2y()},1j:I(){8.15.1j()},17:I(){8.15.17()},2g:I(){8.4c.19("9x")},1p:I(){8.4c.2r("9x")}},j.2q={2t:I(){b(1x.3i).1h(8.15=b("<1g>").19("cY").1h(8.6K=b("<1g>").19("cZ").17().1h(8.74=b("<1g>").19("75 d0").1l("2N","26").1h(b("<1g>").19("3u").1h(8.76=b("<9y>")))).1h(8.5i=b("<1g>").19("75 d1").1h(b("<1g>").19("3u"))).1h(8.77=b("<1g>").19("75 d2").1l("2N","20").1h(b("<1g>").19("3u").1h(8.78=b("<9y>"))))).17()).1h(8.1V=b("<1g>").19("9i").1h(8.4B=b("<1g>").19("9j")).17());1e(m&&7>m){11 e=8.15[0].4j;e.1d="3S",e.4U("1k",\'((!!1D.2i && 2i(1D).3l()) || 0) + "1K"\'),e=8.1V[0].4j,e.1d="3S",e.4U("1k",\'((!!1D.2i && 2i(1D).3l()) || 0) + "1K"\')}8.2W(),8.3z()},2W:I(){8.L=b.1u({2l:!0,68:{26:"d3",20:"d4"},1V:!0},d.L&&d.L.1r||{}),8.9z()},3W:I(e){b.1E({15:"d5",1V:"9k"},b.1c(I(t,n){11 r=8[t];b.1E((r[0].6w||"").3J(" "),I(e,t){-1<t.2Q(n)&&r.2r(t)}),r.19(n+e)},8))},9z:I(){8.76.17(),8.78.17(),8.L.68&&(8.76.1Q(8.L.68.26).1j(),8.78.1Q(8.L.68.20).1j())},3z:I(){8.74.1T("2n",I(){d.1p(),d.26(),b(8).38()}),8.5i.1T("2n",I(){0<b(8).1w(".4F").1n||d[d.1m.1z("3D")?"1p":"2g"](!0)}),8.77.1T("2n",I(){d.1p(),d.20(),b(8).38()}),8.4B.1T("2n",I(){d.17()}),8.15.1J(8.1V).1T("1L:2h",b.1c(I(e){1e(!d.L||!d.L.2h||d.L&&d.L.2b)e.2P(),e.2O()},8))},1j:I(){11 e=8.15,t=d.L.1r;2J(t&&t.1V){1H"1k":e=e.1J(8.1V);28;1H"5d":e=e.1J(d.3b)}e.1j()},17:I(){8.15.17(),8.1V.17()},2y:I(){8.2W(),8.15.1w(".4F").2r("4F"),d.55()||8.74.1w(".3u").19("4F"),d.L.2l||8.5i.1w(".3u").19("4F"),d.56()||8.77.1w(".3u").19("4F"),8.15.2r("9A"),d.1B&&0<b.9t(d.1B,I(e){1b e.L.2l}).1n&&8.15.19("9A"),8.15["1k"==j.14&&1<d.1B.1n?"1j":"17"](),8[d.1m.1z("3D")?"2g":"1p"]()},2g:I(){8.5i.19("9B")},1p:I(){8.5i.2r("9B")}};11 k=I(e){1b{12:b(e).4S(),13:b(e).4m()}},V=I(e){11 t=k(e),n=e.5t;1b n&&b(n).1a({12:t.12+"1K"})&&k(e).13>t.13&&t.12++,b(n).1a({12:"2I%"}),t},da=I(e,t,n){11 r=t.12-(22(b(e).1a("2L-1o"))||0)-(22(b(e).1a("2L-4Y"))||0);22(b(e).1a("2L-1k")),22(b(e).1a("2L-d6"));11 i=d.L.12;i&&"2H"==b.14(i)&&r>i&&(b(e).1a({12:i+"1K"}),t=V(e)),t=d.3g.49(t,n);1e(/(4g|2F|1Q)/.6b(n.14)&&d.1m.1z("3Z")){r=b("<1g>"),r.1a({1d:"3S",1k:0,1o:0,12:"2I%",13:"2I%"}),b(e).1h(r),i=r.4S(),b(e).1a(q(t)).1a({d7:"30"});11 s=r.4S();1e(i-=s)t.12+=i,b(e).1a(q(t)),t=d.3g.49(t,n);r.2c()}1b t};d.4x={4o:I(){b(1x.3i).1h(b(1x.3j("1g")).19("d8").1h(b("<1g>").19("5L").1h(8.79=b("<1g>").19("5M"))))},3n:I(e,n,r,i){8.79||8.4o(),b.1u({29:!1},i||{});1e(n.L.4g||t.6e(e))n.L.4g&&"2B"==b.14(e)&&(e=b("#"+e)[0]),!d.48&&e&&t.15.7i(e)&&(b(e).1l("8M",b(e).1a("8N")),d.48=1x.3j("1g"),b(e).42(b(d.48).17()));11 s=1x.3j("1g");8.79.1h(b(s).19("4V").1h(e)),t.6e(e)&&b(e).1j(),n.L.5G&&s.19(n.L.5G),n.L.1S&&b(s).19("7S"+n.L.1S);11 o=b(s).1w("5k[2z]").60(I(){1b!b(8).1W("13")||!b(8).1W("12")});1e(0<o.1n){d.1m.1s("3q",!0);11 u=0,a=n.1v,e=1i.2m(d9,db*(o.1n||0));d.2e.2s("3q"),d.2e.1s("3q",b.1c(I(){o.1E(I(){8.33=I(){}}),u>=o.1n||d.1f&&d.1f.1v!=a||8.5a(s,n,r)},8),e),d.1m.1s("3q",o),b.1E(o,b.1c(I(e,t){11 i=35 6T;i.33=b.1c(I(){i.33=I(){};11 e=i.12,l=i.13,p=b(t).1W("12"),v=b(t).1W("13");1e(!p||!v)!p&&v?(e=1i.2p(v*e/l),l=v):!v&&p&&(l=1i.2p(p*l/e),e=p),b(t).1W({12:e,13:l});u++,u==o.1n&&(d.2e.2s("3q"),d.1m.1s("3q",!1),d.1f&&d.1f.1v!=a||8.5a(s,n,r))},8),i.2z=t.2z},8))}2Y 8.5a(s,n,r)},5a:I(e,t,n){11 r=V(e),r=da(e,r,t);d.40(r.12,r.13,{31:I(){d.1t.1Q(e),n&&n()}})},8h:da,8g:V},b.1u(!0,1F,I(){1b{1j:I(a,c,f){11 e=c||{},g=f;c&&b.14(c)=="2H"&&(g=c,e=J.2t({}));11 h=[];2J(b.14(a)){1H"2B":1H"4A":c=35 H(a,e);1e(c.3r){1e(a&&a.5s==1){11 c=b(\'.1L[1l-1L-3r="\'+b(a).1l("1L-3r")+\'"]\'),i={};c.60("[1l-1L-3r-L]").1E(I(a,c){b.1u(i,6Q("({"+(b(c).1W("1l-1L-3r-L")||"")+"})"))}),c.1E(I(t,n){!g&&n==a&&(g=t+1),h.3f(35 H(n,b.1u({},i,e)))})}}2Y i={},a&&a.5s==1&&b(a).1Z("[1l-1L-3r-L]")&&(b.1u(i,6Q("({"+(b(a).1W("1l-1L-3r-L")||"")+"})")),c=35 H(a,b.1u({},i,e))),h.3f(c);28;1H"dc":b.1E(a,I(t,n){11 r=35 H(n,e);h.3f(r)})}1e(!g||g<1)g=1;g>h.1n&&(g=h.1n),d.4y(h,g,{6H:!0}),d.1j(I(){d.2o(g)})},17:I(){1b d.17(),8},2g:I(e){1b d.2g(e),8},1p:I(){1b d.1p(),8},2y:I(){1b d.2y(),8},6x:I(e){1b d.6x(e),8}}}()),l.1F=1F,b(1x).7v(I(){1F.2S()})})(2i,1D)',62,819,'||||||||this||||||||||||||||||||||||||||||||||||function|||options||||||||||||||||var|width|height|type|element||hide||addClass|css|return|proxy|position|if|view|div|append|Math|show|top|data|States|length|left|stop|dimensions|controls|set|content|extend|url|find|document|shadow|get|null|views|effects|window|each|Lightview|opacity|case|radius|add|px|lightview|cache|_m|queue|for|html|image|skin|bind|visible|close|attr|border|thumbnails|is|next|titleCaption|parseInt|caption|_dimensions||previous||break|spinner|thumbnail|viewport|remove||Timeouts|ceil|play|mousewheel|jQuery|color|size|slideshow|max|click|setPosition|round|Top|removeClass|clear|create|slider|spacing|bubble|title|refresh|src|items|string|105|lineTo|canvas|ajax|slide|number|100|switch|Thumbnails|padding|fadeTo|side|stopPropagation|preventDefault|indexOf|Spinners|init|background|overlay|arc|setOptions|clone|else|sideButtonsUnderneath|auto|complete||onload|target|new|offset||blur||getLayout|buttonTopClose|innerPreviousNextOverlays|Relative|spinnerWrapper|push|Dimensions|slider_slide|body|createElement|support|scrollTop|116|update|lv_button|pos|preloading_images|group|enabled|Slider|lv_icon|children|charAt|resize|lv_side_buttons_underneath|startObserving|margin|duration|count|playing|lv_thumbnail|setActive|itemCount|in|180|split|tag|quicktime|scripts|call|hex2fill|moveTo|vertical|draw|absolute|fadeOut|111|101|setSkin|canvasShadow|delegate|resized|resizeTo|_reset|before|visibility|inlineContent||||inlineMarker|fit|outerWidth|elements|slider_slideshow|page|lv_slider_number|initialize|inline|try|catch|style|Skins|icon|innerHeight|scrollLeft|build|114|queues|vars|canvasBubble|lv_side_left|lv_side_button|lv_side_right|outer|updateQueue|load|getSurroundingIndexes|object|close_button|extension|preloaded|slider_numbers|lv_icon_disabled|flash|iframe|replace|documentElement|required|available|plugins|getContext|G_vmlCanvasManager|center|defaultSkin|fillStyle|innerWidth|horizontal|setExpression|lv_content_wrapper|110|115|right|lv_side||lv_inner_previous_next_overlays|first|animate|floor|mayPrevious|mayNext|refreshPreviousNext||overlapping|_update|delete|keyCode|relative|slider_previous|slider_next|nr_width|scrollToPage|middle_slideshow|apply|img|param|toLowerCase|substr|originalEvent|easing|easeInOutQuart|prototype|nodeType|parentNode|navigator|parseFloat|name|substring|fill|x1|y1|x2|y2|scroll|setOpacity|durations|wrapperClass|112|108|150|showhide|lv_window|lv_content|lv_button_inner_previous_overlay|lv_button_inner_next_overlay|ctxBubble|scale|layout|inner|place|controls_type_changed|preload|value|after|stopQueues|scaleWithin|filter|params|min|track|loading|_urls|lv_thumbnail_image|pageCount|text|PI|inArray|test|arguments|match|isElement|opera|version|swfobject|check|console|join|QuickTime|sides|delay|000|drawRoundedRectangle|closePath|createFillStyle|_adjust|prepend|118|setVars|className|setDefaultSkin|lv_spinner_wrapper|ctxShadow|closest|104|_pinchZoomed|_drawBackgroundPath|fromSpacingX|fromSpacingY|fromPadding|initialDimensionsOnly|once|inherit|middle|cleanContent|disable|getDimensions|setTitleCaption|_states|eval|fetchOptions|getKeyByKeyCode|Image|Cache|Loading|_skin|_loading_images|lv_load_thumbnail|lv_slider_icon|lv_slider_slideshow_disabled|lv_slider_number_last|refreshButtonStates|lv_slider_number_empty|middle_previous|lv_top_button|text_previous|middle_next|text_next|container|String|base|constructor|domain|wheelDelta|120|detail|Array|isAttached|RegExp|Opera|AppleWebKit|Chrome|ea|pow|Za|SWFObject|notified|requires|warn|alert|ready|map|ShockwaveFlash|toUpperCase|prefix|ms|createEvent|boxShadow|borderRadius|boolean|red|green|blue|fa|undefined|fff|expand|beginPath|fillRect|Gradient|addColorStops|dPA|ga|lv_content_|121|117|1800|1e3|lv_skin|lv_shadow|close_lightview|applyFixes|stopObserving|lv_side_button_|lv_side_button_out|109|107|103|scrolling|resizing|undelegate|clearRect|_drawBorderPath|_drawShadow|firstChild|lv_blank_background|25000px|getMeasureElementDimensions|getFittedDimensions|controls_from_spacing_x|toSpacingX|sxDiff|controls_from_spacing_y|toSpacingY|syDiff|controls_from_padding|toPadding|pDiff|step|removeAttr|getPlacement|lv|fx|placement|onHide|setInitialDimensions|onShow|preloadSurroundingImages|continuous|hideOverlapping|embed|wmode|transparent|restoreOverlapping|restoreOverlappingWithinContent|_show|_hide|createSpinner|restoreInlineContent|lv_restore_inline_display|display|lv_has_caption|lv_has_title|errors|pluginspage|pluginspages|lv_content_image|controller|SetControllerVisible|dataType|afterUpdate|enable|measureElement||timeout_|clearTimeout|href|isExternal||getBoundsScale||||space|esc|onkeydown|onkeyup|lv_button_top_close_controls_type_|populate|lv_thumbnails|lv_thumbnails_slider|lv_controls_top_close|lv_controls_top_close_button|lv_controls_top_close_skin_|stopLoadingImages|_getThumbnailsWithinViewport|loadThumbnailsWithinViewport|adjustToViewport|lv_thumbnail_active|lv_slider_next|Page|nr_margin_last|grep|lv_slider_number_active|lv_slider_next_disabled|lv_slider_previous_disabled|lv_slider_slideshow_playing|span|setText|lv_controls_top_with_slideshow|lv_top_slideshow_playing|fromCharCode|area|basefont|col|frame|hr|input|link|isindex|meta|range|spacer|wbr|Object|extensions|DOMMouseScroll|Event|trigger|isPropagationStopped|isDefaultPrevented|slice|userAgent|exec|attachEvent|MSIE|Gecko|KHTML|rv|Apple|Mobile|Safari|lv_identity_|getElementById|z_||z0|fn|jquery|ua|Version|log|ActiveXObject|Shockwave|Flash|void|Webkit|Moz|Khtml|TouchEvent|WebKitTransitionEvent|TransitionEvent|OTransitionEvent|ExplorerCanvas||excanvas|js|init_|touch|transitions|expressions|prefixed|reset|initialTypeOptions|0123456789abcdef|hex2rgb|rgba|getSaturatedBW|255|360|hue|saturation|brightness|initElement|mergedCorner|toFixed|isArray|createLinearGradient|05|addColorStop|inside|Infinity|lv_overlay|533|122|1e5|00006000600660060060666060060606666060606|00006000606000060060060060060606000060606|00006000606066066660060060060606666060606|00006000606006060060060060060606000060606|000066606006600600600600066006066660066600000|NaN|900|dark|lv_window_|lv_bubble|lv_side_button_previous||lv_side_button_next|lv_title_caption|titleCaptionSlide|lv_title_caption_slide|lv_title|lv_caption|lv_button_top_close|none|about|blank|fixed|mouseover|touchmove|mouseout|102|106||119|addEventListener|gesturechange|200|orientationchange|lv_close|15000px|lvresizecount|initialDimensions|select|hidden|tagName|Stop|innerHTML|default|missing_plugin|gif|progid|DXImageTransform|Microsoft|AlphaImageLoader|sizingMethod|interpolation|mode|bicubic|alt|id|embedSWF|flashvars|lv_content_flash|class|lv_content_object|merge|codebase|http|www|apple|com|qtactivex|qtplugin|cab|classid|clsid|02BF25D5|8C17|4B23|BC80|D3488ABDDC6B|video|iframe_movie|frameBorder|hspace|lv_content_iframe|lv_content_html|success|responseText|9999999|outerHeight|270|cos|setTimeout|isMedia|scaleToBounds|keydown|keyup|keyboard|lifetime|3e5|callback|inject|currentTarget|lv_thumbnails_slide|offsetHeight|_|lv_thumbnails_skin_|lv_thumbnail_icon|lv_thumbnail_icon_|lv_thumbnail_image_spinner_overlay|_previous|_next|lv_controls_relative|lv_slider|lv_slider_previous|lv_slider_numbers|lv_slider_slide|lv_slider_slideshow|slider_|hasClass|makeArray|999|linear|previousPage|nextPage|last|lv_controls_top|lv_top_middle|lv_top_previous|lv_top_slideshow|lv_top_next|Prev|Next|lv_controls_top_skin_|bottom|overflow|lv_update_queue|8e3||750|array'.split('|'),0,{}));

jQuery(document).ready(function(){
    jQuery("#license_attribution").click(function(){
        if(jQuery(this).is(":checked"))jQuery(".authorLine").show();
        else jQuery(".authorLine").hide();
    });

    jQuery("#vignette1").click(function(){
        jQuery(".vignette").hide();
    });

    jQuery("#vignette2").click(function(){
        jQuery(".vignette").show();
    });

    //jQuery("#modifPhoto").validate();

    jQuery("#author").focus(function(e){
        if(jQuery(this).val()=='nom du propriétaire')jQuery(this).val('');
    });

    jQuery("#author").focusout(function(e){
        if(jQuery(this).val()=='')jQuery(this).val('nom du propriétaire');
    });
});


/**
 * Full HTML5 compatibility rule set
 * These rules define which tags and css classes are supported and which tags should be specially treated.
 *
 * Examples based on this rule set:
 *
 *    <a href="http://foobar.com">foo</a>
 *    ... becomes ...
 *    <a href="http://foobar.com" target="_blank" rel="nofollow">foo</a>
 *
 *    <img align="left" src="http://foobar.com/image.png">
 *    ... becomes ...
 *    <img class="wysiwyg-float-left" src="http://foobar.com/image.png" alt="">
 *
 *    <div>foo<script>alert(document.cookie)</script></div>
 *    ... becomes ...
 *    <div>foo</div>
 *
 *    <marquee>foo</marquee>
 *    ... becomes ...
 *    <span>foo</marquee>
 *
 *    foo <br clear="both"> bar
 *    ... becomes ...
 *    foo <br class="wysiwyg-clear-both"> bar
 *
 *    <div>hello <iframe src="http://google.com"></iframe></div>
 *    ... becomes ...
 *    <div>hello </div>
 *
 *    <center>hello</center>
 *    ... becomes ...
 *    <div class="wysiwyg-text-align-center">hello</div>
 */
var wysihtml5ParserRules = {
    /**
     * CSS Class white-list
     * Following css classes won't be removed when parsed by the wysihtml5 html parser
     */
    "classes": {
        "wysiwyg-clear-both": 1,
        "wysiwyg-clear-left": 1,
        "wysiwyg-clear-right": 1,
        "wysiwyg-color-aqua": 1,
        "wysiwyg-color-black": 1,
        "wysiwyg-color-blue": 1,
        "wysiwyg-color-fuchsia": 1,
        "wysiwyg-color-gray": 1,
        "wysiwyg-color-green": 1,
        "wysiwyg-color-lime": 1,
        "wysiwyg-color-maroon": 1,
        "wysiwyg-color-navy": 1,
        "wysiwyg-color-olive": 1,
        "wysiwyg-color-purple": 1,
        "wysiwyg-color-red": 1,
        "wysiwyg-color-silver": 1,
        "wysiwyg-color-teal": 1,
        "wysiwyg-color-white": 1,
        "wysiwyg-color-yellow": 1,
        "wysiwyg-float-left": 1,
        "wysiwyg-float-right": 1,
        "wysiwyg-font-size-large": 1,
        "wysiwyg-font-size-larger": 1,
        "wysiwyg-font-size-medium": 1,
        "wysiwyg-font-size-small": 1,
        "wysiwyg-font-size-smaller": 1,
        "wysiwyg-font-size-x-large": 1,
        "wysiwyg-font-size-x-small": 1,
        "wysiwyg-font-size-xx-large": 1,
        "wysiwyg-font-size-xx-small": 1,
        "wysiwyg-text-align-center": 1,
        "wysiwyg-text-align-justify": 1,
        "wysiwyg-text-align-left": 1,
        "wysiwyg-text-align-right": 1
    },
    /**
     * Tag list
     *
     * Following options are available:
     *
     *    - add_class:        converts and deletes the given HTML4 attribute (align, clear, ...) via the given method to a css class
     *                        The following methods are implemented in wysihtml5.dom.parse:
     *                          - align_text:  converts align attribute values (right/left/center/justify) to their corresponding css class "wysiwyg-text-align-*")
                                  <p align="center">foo</p> ... becomes ... <p> class="wysiwyg-text-align-center">foo</p>
     *                          - clear_br:    converts clear attribute values left/right/all/both to their corresponding css class "wysiwyg-clear-*"
     *                            <br clear="all"> ... becomes ... <br class="wysiwyg-clear-both">
     *                          - align_img:    converts align attribute values (right/left) on <img> to their corresponding css class "wysiwyg-float-*"
     *                          
     *    - remove:             removes the element and it's content
     *
     *    - rename_tag:         renames the element to the given tag
     *
     *    - set_class:          adds the given class to the element (note: make sure that the class is in the "classes" white list above)
     *
     *    - set_attributes:     sets/overrides the given attributes
     *
     *    - check_attributes:   checks the given HTML attribute via the given method
     *                            - url:      checks whether the given string is an url, deletes the attribute if not
     *                            - alt:      strips unwanted characters. if the attribute is not set, then it gets set (to ensure valid and compatible HTML)
     *                            - numbers:  ensures that the attribute only contains numeric characters
     */
    "tags": {
        "tr": {
            "add_class": {
                "align": "align_text"
            }
        },
        "strike": {
            "remove": 1
        },
        "form": {
            "rename_tag": "div"
        },
        "rt": {
            "rename_tag": "span"
        },
        "code": {},
        "acronym": {
            "rename_tag": "span"
        },
        "br": {
            "add_class": {
                "clear": "clear_br"
            }
        },
        "details": {
            "rename_tag": "div"
        },
        "h4": {
            "add_class": {
                "align": "align_text"
            }
        },
        "em": {},
        "title": {
            "remove": 1
        },
        "multicol": {
            "rename_tag": "div"
        },
        "figure": {
            "rename_tag": "div"
        },
        "xmp": {
            "rename_tag": "span"
        },
        "small": {
            "rename_tag": "span",
            "set_class": "wysiwyg-font-size-smaller"
        },
        "area": {
            "remove": 1
        },
        "time": {
            "rename_tag": "span"
        },
        "dir": {
            "rename_tag": "ul"
        },
        "bdi": {
            "rename_tag": "span"
        },
        "command": {
            "remove": 1
        },
        "ul": {},
        "progress": {
            "rename_tag": "span"
        },
        "dfn": {
            "rename_tag": "span"
        },
        "iframe": {
            "remove": 1
        },
        "figcaption": {
            "rename_tag": "div"
        },
        "a": {
            "check_attributes": {
                "href": "url"
            },
            "set_attributes": {
                "rel": "nofollow",
                "target": "_blank"
            }
        },
        "img": {
            "check_attributes": {
                "width": "numbers",
                "alt": "alt",
                "src": "url",
                "height": "numbers"
            },
            "add_class": {
                "align": "align_img"
            }
        },
        "rb": {
            "rename_tag": "span"
        },
        "footer": {
            "rename_tag": "div"
        },
        "noframes": {
            "remove": 1
        },
        "abbr": {
            "rename_tag": "span"
        },
        "u": {},
        "bgsound": {
            "remove": 1
        },
        "sup": {
            "rename_tag": "span"
        },
        "address": {
            "rename_tag": "div"
        },
        "basefont": {
            "remove": 1
        },
        "nav": {
            "rename_tag": "div"
        },
        "h1": {
            "add_class": {
                "align": "align_text"
            }
        },
        "head": {
            "remove": 1
        },
        "tbody": {
            "add_class": {
                "align": "align_text"
            }
        },
        "dd": {
            "rename_tag": "div"
        },
        "s": {
            "rename_tag": "span"
        },
        "li": {},
        "td": {
            "check_attributes": {
                "rowspan": "numbers",
                "colspan": "numbers"
            },
            "add_class": {
                "align": "align_text"
            }
        },
        "object": {
            "remove": 1
        },
        "div": {
            "add_class": {
                "align": "align_text"
            }
        },
        "option": {
            "rename_tag": "span"
        },
        "select": {
            "rename_tag": "span"
        },
        "i": {},
        "track": {
            "remove": 1
        },
        "wbr": {
            "remove": 1
        },
        "fieldset": {
            "rename_tag": "div"
        },
        "big": {
            "rename_tag": "span",
            "set_class": "wysiwyg-font-size-larger"
        },
        "button": {
            "rename_tag": "span"
        },
        "noscript": {
            "remove": 1
        },
        "svg": {
            "remove": 1
        },
        "input": {
            "remove": 1
        },
        "table": {},
        "keygen": {
            "remove": 1
        },
        "h5": {
            "add_class": {
                "align": "align_text"
            }
        },
        "meta": {
            "remove": 1
        },
        "map": {
            "rename_tag": "div"
        },
        "isindex": {
            "remove": 1
        },
        "mark": {
            "rename_tag": "span"
        },
        "caption": {
            "add_class": {
                "align": "align_text"
            }
        },
        "tfoot": {
            "add_class": {
                "align": "align_text"
            }
        },
        "base": {
            "remove": 1
        },
        "video": {
            "remove": 1
        },
        "strong": {},
        "canvas": {
            "remove": 1
        },
        "output": {
            "rename_tag": "span"
        },
        "marquee": {
            "rename_tag": "span"
        },
        "b": {},
        "q": {
            "check_attributes": {
                "cite": "url"
            }
        },
        "applet": {
            "remove": 1
        },
        "span": {},
        "rp": {
            "rename_tag": "span"
        },
        "spacer": {
            "remove": 1
        },
        "source": {
            "remove": 1
        },
        "aside": {
            "rename_tag": "div"
        },
        "frame": {
            "remove": 1
        },
        "section": {
            "rename_tag": "div"
        },
        "body": {
            "rename_tag": "div"
        },
        "ol": {},
        "nobr": {
            "rename_tag": "span"
        },
        "html": {
            "rename_tag": "div"
        },
        "summary": {
            "rename_tag": "span"
        },
        "var": {
            "rename_tag": "span"
        },
        "del": {
            "remove": 1
        },
        "blockquote": {
            "check_attributes": {
                "cite": "url"
            }
        },
        "style": {
            "remove": 1
        },
        "device": {
            "remove": 1
        },
        "meter": {
            "rename_tag": "span"
        },
        "h3": {
            "add_class": {
                "align": "align_text"
            }
        },
        "textarea": {
            "rename_tag": "span"
        },
        "embed": {
            "remove": 1
        },
        "hgroup": {
            "rename_tag": "div"
        },
        "font": {
            "rename_tag": "span",
            "add_class": {
                "size": "size_font"
            }
        },
        "tt": {
            "rename_tag": "span"
        },
        "noembed": {
            "remove": 1
        },
        "thead": {
            "add_class": {
                "align": "align_text"
            }
        },
        "blink": {
            "rename_tag": "span"
        },
        "plaintext": {
            "rename_tag": "span"
        },
        "xml": {
            "remove": 1
        },
        "h6": {
            "add_class": {
                "align": "align_text"
            }
        },
        "param": {
            "remove": 1
        },
        "th": {
            "check_attributes": {
                "rowspan": "numbers",
                "colspan": "numbers"
            },
            "add_class": {
                "align": "align_text"
            }
        },
        "legend": {
            "rename_tag": "span"
        },
        "hr": {},
        "label": {
            "rename_tag": "span"
        },
        "dl": {
            "rename_tag": "div"
        },
        "kbd": {
            "rename_tag": "span"
        },
        "listing": {
            "rename_tag": "div"
        },
        "dt": {
            "rename_tag": "span"
        },
        "nextid": {
            "remove": 1
        },
        "pre": {},
        "center": {
            "rename_tag": "div",
            "set_class": "wysiwyg-text-align-center"
        },
        "audio": {
            "remove": 1
        },
        "datalist": {
            "rename_tag": "span"
        },
        "samp": {
            "rename_tag": "span"
        },
        "col": {
            "remove": 1
        },
        "article": {
            "rename_tag": "div"
        },
        "cite": {},
        "link": {
            "remove": 1
        },
        "script": {
            "remove": 1
        },
        "bdo": {
            "rename_tag": "span"
        },
        "menu": {
            "rename_tag": "ul"
        },
        "colgroup": {
            "remove": 1
        },
        "ruby": {
            "rename_tag": "span"
        },
        "h2": {
            "add_class": {
                "align": "align_text"
            }
        },
        "ins": {
            "rename_tag": "span"
        },
        "p": {
            "add_class": {
                "align": "align_text"
            }
        },
        "sub": {
            "rename_tag": "span"
        },
        "comment": {
            "remove": 1
        },
        "frameset": {
            "remove": 1
        },
        "optgroup": {
            "rename_tag": "span"
        },
        "header": {
            "rename_tag": "div"
        }
    }
};

/*
 wysihtml5 v0.3.0
 https://github.com/xing/wysihtml5

 Author: Christopher Blum (https://github.com/tiff)

 Copyright (C) 2012 XING AG
 Licensed under the MIT license (MIT)

 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/

 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2.2
 Build date: 13 November 2011
*/
var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};
window.rangy=function(){function b(a,b){var c=typeof a[b];return c==k||!!(c==h&&a[b])||"unknown"==c}function c(a,b){return!!(typeof a[b]==h&&a[b])}function a(a,b){return typeof a[b]!=j}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&m(a,r)&&x(a,q)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a);o.initialized=!0;o.supported=!1}function g(){if(!o.initialized){var a,d=!1,h=!1;b(document,"createRange")&&
(a=document.createRange(),m(a,p)&&x(a,n)&&(d=!0),a.detach());if((a=c(document,"body")?document.body:document.getElementsByTagName("body")[0])&&b(a,"createTextRange"))a=a.createTextRange(),e(a)&&(h=!0);!d&&!h&&f("Neither Range nor TextRange are implemented");o.initialized=!0;o.features={implementsDomRange:d,implementsTextRange:h};d=w.concat(z);h=0;for(a=d.length;h<a;++h)try{d[h](o)}catch(j){c(window,"console")&&b(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
j)}}}function i(a){this.name=a;this.supported=this.initialized=!1}var h="object",k="function",j="undefined",n="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),p="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),
q="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),r="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),m=d(b),s=d(c),x=d(a),o={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:b,isHostObject:c,isHostProperty:a,areHostMethods:m,areHostObjects:s,areHostProperties:x,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};
o.fail=f;o.warn=function(a){a="Rangy warning: "+a;o.config.alertOnWarn?window.alert(a):typeof window.console!=j&&typeof window.console.log!=j&&window.console.log(a)};({}).hasOwnProperty?o.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var z=[],w=[];o.init=g;o.addInitListener=function(a){o.initialized?a(o):z.push(a)};var y=[];o.addCreateMissingNativeApiListener=function(a){y.push(a)};o.createMissingNativeApi=function(a){a=a||window;g();
for(var b=0,c=y.length;b<c;++b)y[b](a)};i.prototype.fail=function(a){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+a);};i.prototype.warn=function(a){o.warn("Module "+this.name+": "+a)};i.prototype.createError=function(a){return Error("Error in Rangy "+this.name+" module: "+a)};o.createModule=function(a,b){var c=new i(a);o.modules[a]=c;w.push(function(a){b(a,c);c.initialized=!0;c.supported=!0})};o.requireModules=function(a){for(var b=0,c=a.length,d,h;b<
c;++b){h=a[b];d=o.modules[h];if(!d||!(d instanceof i))throw Error("Module '"+h+"' not found");if(!d.supported)throw Error("Module '"+h+"' not supported");}};var A=!1,s=function(){A||(A=!0,o.initialized||g())};if(typeof window==j)f("No window found");else if(typeof document==j)f("No document found");else return b(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",s,!1),b(window,"addEventListener")?window.addEventListener("load",s,!1):b(window,"attachEvent")?window.attachEvent("onload",
s):f("Window does not have required addEventListener or attachEvent method"),o}();
rangy.createModule("DomUtil",function(b,c){function a(a){for(var b=0;a=a.previousSibling;)b++;return b}function d(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(m(c,d))return d;return null}function e(a,b,c){for(c=c?a:a.parentNode;c;){a=c.parentNode;if(a===b)return c;c=a}return null}function f(a){a=a.nodeType;return 3==a||4==a||8==a}function g(a,b){var c=b.nextSibling,d=b.parentNode;c?d.insertBefore(a,c):d.appendChild(a);return a}function i(a){if(9==a.nodeType)return a;
if(typeof a.ownerDocument!=p)return a.ownerDocument;if(typeof a.document!=p)return a.document;if(a.parentNode)return i(a.parentNode);throw Error("getDocument: no document found for node");}function h(a){return!a?"[No node]":f(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">["+a.childNodes.length+"]":a.nodeName}function k(a){this._next=this.root=a}function j(a,b){this.node=a;this.offset=b}function n(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}
var p="undefined",q=b.util;q.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||c.fail("document missing a Node creation method");q.isHostMethod(document,"getElementsByTagName")||c.fail("document missing getElementsByTagName method");var r=document.createElement("div");q.areHostMethods(r,["insertBefore","appendChild","cloneNode"])||c.fail("Incomplete Element implementation");q.isHostProperty(r,"innerHTML")||c.fail("Element is missing innerHTML property");r=document.createTextNode("test");
q.areHostMethods(r,["splitText","deleteData","insertData","appendData","cloneNode"])||c.fail("Incomplete Text Node implementation");var m=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};k.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b;if(this._current){b=a.firstChild;if(!b)for(b=null;a!==this.root&&!(b=a.nextSibling);)a=a.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=
null}};j.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+h(this.node)+":"+this.offset+")]"}};n.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};n.prototype.toString=function(){return this.message};b.dom={arrayContains:m,isHtmlNamespace:function(a){var b;return typeof a.namespaceURI==p||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==
b},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:a,getNodeLength:function(a){var b;return f(a)?a.length:(b=a.childNodes)?b.length:0},getCommonAncestor:d,isAncestorOf:function(a,b,c){for(b=c?b:b.parentNode;b;){if(b===a)return!0;b=b.parentNode}return!1},getClosestAncestorIn:e,isCharacterDataNode:f,insertAfter:g,splitDataNode:function(a,b){var c=a.cloneNode(!1);c.deleteData(0,b);a.deleteData(b,a.length-b);g(c,a);return c},getDocument:i,getWindow:function(a){a=i(a);
if(typeof a.defaultView!=p)return a.defaultView;if(typeof a.parentWindow!=p)return a.parentWindow;throw Error("Cannot get a window object for node");},getIframeWindow:function(a){if(typeof a.contentWindow!=p)return a.contentWindow;if(typeof a.contentDocument!=p)return a.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(a){if(typeof a.contentDocument!=p)return a.contentDocument;if(typeof a.contentWindow!=p)return a.contentWindow.document;
throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(a){return q.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]},getRootContainer:function(a){for(var b;b=a.parentNode;)a=b;return a},comparePoints:function(b,c,h,j){var k;if(b==h)return c===j?0:c<j?-1:1;if(k=e(h,b,!0))return c<=a(k)?-1:1;if(k=e(b,h,!0))return a(k)<j?-1:1;c=d(b,h);b=b===c?c:e(b,c,!0);h=h===c?c:e(h,c,!0);if(b===h)throw Error("comparePoints got to case 4 and childA and childB are the same!");
for(c=c.firstChild;c;){if(c===b)return-1;if(c===h)return 1;c=c.nextSibling}throw Error("Should not be here!");},inspectNode:h,fragmentFromNodeChildren:function(a){for(var b=i(a).createDocumentFragment(),c;c=a.firstChild;)b.appendChild(c);return b},createIterator:function(a){return new k(a)},DomPosition:j};b.DOMException=n});
rangy.createModule("DomRange",function(b){function c(a,b){return 3!=a.nodeType&&(l.isAncestorOf(a,b.startContainer,!0)||l.isAncestorOf(a,b.endContainer,!0))}function a(a){return l.getDocument(a.startContainer)}function d(a,b,c){if(b=a._listeners[b])for(var d=0,h=b.length;d<h;++d)b[d].call(a,{target:a,args:c})}function e(a){return new u(a.parentNode,l.getNodeIndex(a))}function f(a){return new u(a.parentNode,l.getNodeIndex(a)+1)}function g(a,b,c){var d=11==a.nodeType?a.firstChild:a;l.isCharacterDataNode(b)?
c==b.length?l.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:l.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]);return d}function i(b){for(var c,d,h=a(b.range).createDocumentFragment();d=b.next();){c=b.isPartiallySelectedSubtree();d=d.cloneNode(!c);c&&(c=b.getSubtreeIterator(),d.appendChild(i(c)),c.detach(!0));if(10==d.nodeType)throw new B("HIERARCHY_REQUEST_ERR");h.appendChild(d)}return h}function h(a,b,c){for(var d,e,c=c||{stop:!1};d=a.next();)if(a.isPartiallySelectedSubtree())if(!1===
b(d)){c.stop=!0;break}else{if(d=a.getSubtreeIterator(),h(d,b,c),d.detach(!0),c.stop)break}else for(d=l.createIterator(d);e=d.next();)if(!1===b(e)){c.stop=!0;return}}function k(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),k(b),b.detach(!0)):a.remove()}function j(b){for(var c,d=a(b.range).createDocumentFragment(),h;c=b.next();){b.isPartiallySelectedSubtree()?(c=c.cloneNode(!1),h=b.getSubtreeIterator(),c.appendChild(j(h)),h.detach(!0)):b.remove();if(10==c.nodeType)throw new B("HIERARCHY_REQUEST_ERR");
d.appendChild(c)}return d}function n(a,b,c){var d=!(!b||!b.length),e,j=!!c;d&&(e=RegExp("^("+b.join("|")+")$"));var k=[];h(new q(a,!1),function(a){(!d||e.test(a.nodeType))&&(!j||c(a))&&k.push(a)});return k}function p(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+l.inspectNode(a.startContainer)+":"+a.startOffset+", "+l.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function q(a,b){this.range=a;this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer;
this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&l.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===c&&!l.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:l.getClosestAncestorIn(this.sc,c,!0),this._last=this.ec===c&&!l.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:l.getClosestAncestorIn(this.ec,c,!0))}}function r(a){this.code=
this[a];this.codeName=a;this.message="RangeException: "+this.codeName}function m(a,b,c){this.nodes=n(a,b,c);this._next=this.nodes[0];this._position=0}function s(a){return function(b,c){for(var d,h=c?b:b.parentNode;h;){d=h.nodeType;if(l.arrayContains(a,d))return h;h=h.parentNode}return null}}function x(a,b){if($(a,b))throw new r("INVALID_NODE_TYPE_ERR");}function o(a){if(!a.startContainer)throw new B("INVALID_STATE_ERR");}function z(a,b){if(!l.arrayContains(b,a.nodeType))throw new r("INVALID_NODE_TYPE_ERR");
}function w(a,b){if(0>b||b>(l.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new B("INDEX_SIZE_ERR");}function y(a,b){if(O(a,!0)!==O(b,!0))throw new B("WRONG_DOCUMENT_ERR");}function A(a){if(aa(a,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR");}function t(a,b){if(!a)throw new B(b);}function v(a){o(a);if(!l.arrayContains(G,a.startContainer.nodeType)&&!O(a.startContainer,!0)||!l.arrayContains(G,a.endContainer.nodeType)&&!O(a.endContainer,!0)||!(a.startOffset<=(l.isCharacterDataNode(a.startContainer)?
a.startContainer.length:a.startContainer.childNodes.length))||!(a.endOffset<=(l.isCharacterDataNode(a.endContainer)?a.endContainer.length:a.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")");}function D(){}function K(a){a.START_TO_START=Q;a.START_TO_END=U;a.END_TO_END=ba;a.END_TO_START=V;a.NODE_BEFORE=W;a.NODE_AFTER=X;a.NODE_BEFORE_AND_AFTER=Y;a.NODE_INSIDE=R}function F(a){K(a);K(a.prototype)}function E(a,b){return function(){v(this);
var c=this.startContainer,d=this.startOffset,e=this.commonAncestorContainer,j=new q(this,!0);c!==e&&(c=l.getClosestAncestorIn(c,e,!0),d=f(c),c=d.node,d=d.offset);h(j,A);j.reset();e=a(j);j.detach();b(this,c,d,c,d);return e}}function I(a,d,h){function g(a,b){return function(c){o(this);z(c,L);z(M(c),G);c=(a?e:f)(c);(b?i:n)(this,c.node,c.offset)}}function i(a,b,c){var h=a.endContainer,e=a.endOffset;if(b!==a.startContainer||c!==a.startOffset){if(M(b)!=M(h)||1==l.comparePoints(b,c,h,e))h=b,e=c;d(a,b,c,
h,e)}}function n(a,b,c){var h=a.startContainer,e=a.startOffset;if(b!==a.endContainer||c!==a.endOffset){if(M(b)!=M(h)||-1==l.comparePoints(b,c,h,e))h=b,e=c;d(a,h,e,b,c)}}a.prototype=new D;b.util.extend(a.prototype,{setStart:function(a,b){o(this);x(a,!0);w(a,b);i(this,a,b)},setEnd:function(a,b){o(this);x(a,!0);w(a,b);n(this,a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){v(this);a?d(this,this.startContainer,this.startOffset,this.startContainer,
this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){o(this);x(a,!0);d(this,a,0,a,l.getNodeLength(a))},selectNode:function(a){o(this);x(a,!1);z(a,L);var b=e(a),a=f(a);d(this,b.node,b.offset,a.node,a.offset)},extractContents:E(j,d),deleteContents:E(k,d),canSurroundContents:function(){v(this);A(this.startContainer);A(this.endContainer);var a=new q(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!b},
detach:function(){h(this)},splitBoundaries:function(){v(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,h=this.endOffset,e=a===c;l.isCharacterDataNode(c)&&(0<h&&h<c.length)&&l.splitDataNode(c,h);l.isCharacterDataNode(a)&&(0<b&&b<a.length)&&(a=l.splitDataNode(a,b),e?(h-=b,c=a):c==a.parentNode&&h>=l.getNodeIndex(a)&&h++,b=0);d(this,a,b,c,h)},normalizeBoundaries:function(){v(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,h=this.endOffset,e=function(a){var b=
a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,h=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},j=function(d){var e=d.previousSibling;if(e&&e.nodeType==d.nodeType){a=d;var j=d.length;b=e.length;d.insertData(0,e.data);e.parentNode.removeChild(e);a==c?(h+=b,c=a):c==d.parentNode&&(e=l.getNodeIndex(d),h==e?(c=d,h=j):h>e&&h--)}},k=!0;l.isCharacterDataNode(c)?c.length==h&&e(c):(0<h&&(k=c.childNodes[h-1])&&l.isCharacterDataNode(k)&&e(k),k=!this.collapsed);k?l.isCharacterDataNode(a)?0==b&&j(a):
b<a.childNodes.length&&(e=a.childNodes[b])&&l.isCharacterDataNode(e)&&j(e):(a=c,b=h);d(this,a,b,c,h)},collapseToPoint:function(a,b){o(this);x(a,!0);w(a,b);(a!==this.startContainer||b!==this.startOffset||a!==this.endContainer||b!==this.endOffset)&&d(this,a,b,a,b)}});F(a)}function N(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:l.getCommonAncestor(a.startContainer,a.endContainer)}function J(a,b,c,h,e){var j=a.startContainer!==
b||a.startOffset!==c,k=a.endContainer!==h||a.endOffset!==e;a.startContainer=b;a.startOffset=c;a.endContainer=h;a.endOffset=e;N(a);d(a,"boundarychange",{startMoved:j,endMoved:k})}function C(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};N(this)}b.requireModules(["DomUtil"]);var l=b.dom,u=l.DomPosition,B=b.DOMException;q.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=
null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,l.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,b,c;l.isCharacterDataNode(a)&&(a===this.sc||a===this.ec)?(b=a===this.sc?this.so:0,c=a===
this.ec?this.eo:a.length,b!=c&&a.deleteData(b,c-b)):a.parentNode&&a.parentNode.removeChild(a)},isPartiallySelectedSubtree:function(){return c(this._current,this.range)},getSubtreeIterator:function(){var b;if(this.isSingleCharacterDataNode)b=this.range.cloneRange(),b.collapse();else{b=new C(a(this.range));var c=this._current,d=c,h=0,e=c,j=l.getNodeLength(c);l.isAncestorOf(c,this.sc,!0)&&(d=this.sc,h=this.so);l.isAncestorOf(c,this.ec,!0)&&(e=this.ec,j=this.eo);J(b,d,h,e,j)}return new q(b,this.clonePartiallySelectedTextNodes)},
detach:function(a){a&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};r.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};r.prototype.toString=function(){return this.message};m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var L=[1,3,4,5,
7,8,10],G=[2,9,11],P=[1,3,4,5,7,8,10,11],H=[1,3,4,5,7,8],M=l.getRootContainer,O=s([9,11]),aa=s([5,6,10,12]),$=s([6,10,12]),Z=document.createElement("style"),S=!1;try{Z.innerHTML="<b>x</b>",S=3==Z.firstChild.nodeType}catch(ca){}b.features.htmlParsingConforms=S;var T="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),Q=0,U=1,ba=2,V=3,W=0,X=1,Y=2,R=3;D.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){v(this);
y(this.startContainer,b.startContainer);var c=a==V||a==Q?"start":"end",d=a==U||a==Q?"start":"end";return l.comparePoints(this[c+"Container"],this[c+"Offset"],b[d+"Container"],b[d+"Offset"])},insertNode:function(a){v(this);z(a,P);A(this.startContainer);if(l.isAncestorOf(a,this.startContainer,!0))throw new B("HIERARCHY_REQUEST_ERR");this.setStartBefore(g(a,this.startContainer,this.startOffset))},cloneContents:function(){v(this);var b,c;if(this.collapsed)return a(this).createDocumentFragment();if(this.startContainer===
this.endContainer&&l.isCharacterDataNode(this.startContainer))return b=this.startContainer.cloneNode(!0),b.data=b.data.slice(this.startOffset,this.endOffset),c=a(this).createDocumentFragment(),c.appendChild(b),c;c=new q(this,!0);b=i(c);c.detach();return b},canSurroundContents:function(){v(this);A(this.startContainer);A(this.endContainer);var a=new q(this,!0),b=a._first&&c(a._first,this)||a._last&&c(a._last,this);a.detach();return!b},surroundContents:function(a){z(a,H);if(!this.canSurroundContents())throw new r("BAD_BOUNDARYPOINTS_ERR");
var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset);a.appendChild(b);this.selectNode(a)},cloneRange:function(){v(this);for(var b=new C(a(this)),c=T.length,d;c--;)d=T[c],b[d]=this[d];return b},toString:function(){v(this);var a=this.startContainer;if(a===this.endContainer&&l.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],a=new q(this,!0);h(a,function(a){(3==
a.nodeType||4==a.nodeType)&&b.push(a.data)});a.detach();return b.join("")},compareNode:function(a){v(this);var b=a.parentNode,c=l.getNodeIndex(a);if(!b)throw new B("NOT_FOUND_ERR");a=this.comparePoint(b,c);b=this.comparePoint(b,c+1);return 0>a?0<b?Y:W:0<b?X:R},comparePoint:function(a,b){v(this);t(a,"HIERARCHY_REQUEST_ERR");y(a,this.startContainer);return 0>l.comparePoints(a,b,this.startContainer,this.startOffset)?-1:0<l.comparePoints(a,b,this.endContainer,this.endOffset)?1:0},createContextualFragment:S?
function(a){var b=this.startContainer,c=l.getDocument(b);if(!b)throw new B("INVALID_STATE_ERR");var d=null;1==b.nodeType?d=b:l.isCharacterDataNode(b)&&(d=l.parentElement(b));d=null===d||"HTML"==d.nodeName&&l.isHtmlNamespace(l.getDocument(d).documentElement)&&l.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1);d.innerHTML=a;return l.fragmentFromNodeChildren(d)}:function(b){o(this);var c=a(this).createElement("body");c.innerHTML=b;return l.fragmentFromNodeChildren(c)},toHtml:function(){v(this);
var b=a(this).createElement("div");b.appendChild(this.cloneContents());return b.innerHTML},intersectsNode:function(b,c){v(this);t(b,"NOT_FOUND_ERR");if(l.getDocument(b)!==a(this))return!1;var d=b.parentNode,h=l.getNodeIndex(b);t(d,"NOT_FOUND_ERR");var e=l.comparePoints(d,h,this.endContainer,this.endOffset),d=l.comparePoints(d,h+1,this.startContainer,this.startOffset);return c?0>=e&&0<=d:0>e&&0<d},isPointInRange:function(a,b){v(this);t(a,"HIERARCHY_REQUEST_ERR");y(a,this.startContainer);return 0<=
l.comparePoints(a,b,this.startContainer,this.startOffset)&&0>=l.comparePoints(a,b,this.endContainer,this.endOffset)},intersectsRange:function(b,c){v(this);if(a(b)!=a(this))throw new B("WRONG_DOCUMENT_ERR");var d=l.comparePoints(this.startContainer,this.startOffset,b.endContainer,b.endOffset),h=l.comparePoints(this.endContainer,this.endOffset,b.startContainer,b.startOffset);return c?0>=d&&0<=h:0>d&&0<h},intersection:function(a){if(this.intersectsRange(a)){var b=l.comparePoints(this.startContainer,
this.startOffset,a.startContainer,a.startOffset),c=l.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();-1==b&&d.setStart(a.startContainer,a.startOffset);1==c&&d.setEnd(a.endContainer,a.endOffset);return d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();-1==l.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset);1==l.comparePoints(a.endContainer,
a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset);return b}throw new r("Ranges do not intersect");},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==R},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,l.getNodeLength(a))},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);return 0<c.length?
(b.setStart(c[0],0),a=c.pop(),b.setEnd(a,a.length),a=this.containsRange(b),b.detach(),a):this.containsNodeContents(a)},createNodeIterator:function(a,b){v(this);return new m(this,a,b)},getNodes:function(a,b){v(this);return n(this,a,b)},getDocument:function(){return a(this)},collapseBefore:function(a){o(this);this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){o(this);this.setStartAfter(a);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return C.rangesEqual(this,
a)},inspect:function(){return p(this)}};I(C,J,function(a){o(a);a.startContainer=a.startOffset=a.endContainer=a.endOffset=null;a.collapsed=a.commonAncestorContainer=null;d(a,"detach",null);a._listeners=null});b.rangePrototype=D.prototype;C.rangeProperties=T;C.RangeIterator=q;C.copyComparisonConstants=F;C.createPrototypeRange=I;C.inspect=p;C.getRangeDocument=a;C.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===
b.endOffset};b.DomRange=C;b.RangeException=r});
rangy.createModule("WrappedRange",function(b){function c(a,b,c,d){var g=a.duplicate();g.collapse(c);var i=g.parentElement();e.isAncestorOf(b,i,!0)||(i=b);if(!i.canHaveHTML)return new f(i.parentNode,e.getNodeIndex(i));var b=e.getDocument(i).createElement("span"),r,m=c?"StartToStart":"StartToEnd";do i.insertBefore(b,b.previousSibling),g.moveToElementText(b);while(0<(r=g.compareEndPoints(m,a))&&b.previousSibling);m=b.nextSibling;if(-1==r&&m&&e.isCharacterDataNode(m)){g.setEndPoint(c?"EndToStart":"EndToEnd",
a);if(/[\r\n]/.test(m.data)){i=g.duplicate();c=i.text.replace(/\r\n/g,"\r").length;for(c=i.moveStart("character",c);-1==i.compareEndPoints("StartToEnd",i);)c++,i.moveStart("character",1)}else c=g.text.length;i=new f(m,c)}else m=(d||!c)&&b.previousSibling,i=(c=(d||c)&&b.nextSibling)&&e.isCharacterDataNode(c)?new f(c,0):m&&e.isCharacterDataNode(m)?new f(m,m.length):new f(i,e.getNodeIndex(b));b.parentNode.removeChild(b);return i}function a(a,b){var c,d,f=a.offset,g=e.getDocument(a.node),i=g.body.createTextRange(),
m=e.isCharacterDataNode(a.node);m?(c=a.node,d=c.parentNode):(c=a.node.childNodes,c=f<c.length?c[f]:null,d=a.node);g=g.createElement("span");g.innerHTML="&#feff;";c?d.insertBefore(g,c):d.appendChild(g);i.moveToElementText(g);i.collapse(!b);d.removeChild(g);if(m)i[b?"moveStart":"moveEnd"]("character",f);return i}b.requireModules(["DomUtil","DomRange"]);var d,e=b.dom,f=e.DomPosition,g=b.DomRange;if(b.features.implementsDomRange&&(!b.features.implementsTextRange||!b.config.preferTextRange))(function(){function a(b){for(var c=
j.length,d;c--;)d=j[c],b[d]=b.nativeRange[d]}var c,j=g.rangeProperties,f;d=function(b){if(!b)throw Error("Range must be specified");this.nativeRange=b;a(this)};g.createPrototypeRange(d,function(a,b,c,d,h){var e=a.endContainer!==d||a.endOffset!=h;if(a.startContainer!==b||a.startOffset!=c||e)a.setEnd(d,h),a.setStart(b,c)},function(a){a.nativeRange.detach();a.detached=!0;for(var b=j.length,c;b--;)c=j[b],a[c]=null});c=d.prototype;c.selectNode=function(b){this.nativeRange.selectNode(b);a(this)};c.deleteContents=
function(){this.nativeRange.deleteContents();a(this)};c.extractContents=function(){var b=this.nativeRange.extractContents();a(this);return b};c.cloneContents=function(){return this.nativeRange.cloneContents()};c.surroundContents=function(b){this.nativeRange.surroundContents(b);a(this)};c.collapse=function(b){this.nativeRange.collapse(b);a(this)};c.cloneRange=function(){return new d(this.nativeRange.cloneRange())};c.refresh=function(){a(this)};c.toString=function(){return this.nativeRange.toString()};
var i=document.createTextNode("test");e.getBody(document).appendChild(i);var q=document.createRange();q.setStart(i,0);q.setEnd(i,0);try{q.setStart(i,1),c.setStart=function(b,c){this.nativeRange.setStart(b,c);a(this)},c.setEnd=function(b,c){this.nativeRange.setEnd(b,c);a(this)},f=function(b){return function(c){this.nativeRange[b](c);a(this)}}}catch(r){c.setStart=function(b,c){try{this.nativeRange.setStart(b,c)}catch(d){this.nativeRange.setEnd(b,c),this.nativeRange.setStart(b,c)}a(this)},c.setEnd=function(b,
c){try{this.nativeRange.setEnd(b,c)}catch(d){this.nativeRange.setStart(b,c),this.nativeRange.setEnd(b,c)}a(this)},f=function(b,c){return function(d){try{this.nativeRange[b](d)}catch(e){this.nativeRange[c](d),this.nativeRange[b](d)}a(this)}}}c.setStartBefore=f("setStartBefore","setEndBefore");c.setStartAfter=f("setStartAfter","setEndAfter");c.setEndBefore=f("setEndBefore","setStartBefore");c.setEndAfter=f("setEndAfter","setStartAfter");q.selectNodeContents(i);c.selectNodeContents=q.startContainer==
i&&q.endContainer==i&&0==q.startOffset&&q.endOffset==i.length?function(b){this.nativeRange.selectNodeContents(b);a(this)}:function(a){this.setStart(a,0);this.setEnd(a,g.getEndOffset(a))};q.selectNodeContents(i);q.setEnd(i,3);f=document.createRange();f.selectNodeContents(i);f.setEnd(i,4);f.setStart(i,2);c.compareBoundaryPoints=-1==q.compareBoundaryPoints(q.START_TO_END,f)&1==q.compareBoundaryPoints(q.END_TO_START,f)?function(a,b){b=b.nativeRange||b;a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&
(a=b.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)};b.util.isHostMethod(q,"createContextualFragment")&&(c.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});e.getBody(document).removeChild(i);q.detach();f.detach()})(),b.createNativeRange=function(a){a=a||document;return a.createRange()};else if(b.features.implementsTextRange){d=function(a){this.textRange=a;this.refresh()};
d.prototype=new g(document);d.prototype.refresh=function(){var a,b,d=this.textRange;a=d.parentElement();var f=d.duplicate();f.collapse(!0);b=f.parentElement();f=d.duplicate();f.collapse(!1);d=f.parentElement();b=b==d?b:e.getCommonAncestor(b,d);b=b==a?b:e.getCommonAncestor(a,b);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?b=a=c(this.textRange,b,!0,!0):(a=c(this.textRange,b,!0,!1),b=c(this.textRange,b,!1,!1));this.setStart(a.node,a.offset);this.setEnd(b.node,b.offset)};g.copyComparisonConstants(d);
var i=function(){return this}();"undefined"==typeof i.Range&&(i.Range=d);b.createNativeRange=function(a){a=a||document;return a.body.createTextRange()}}b.features.implementsTextRange&&(d.rangeToTextRange=function(b){if(b.collapsed)return a(new f(b.startContainer,b.startOffset),!0);var c=a(new f(b.startContainer,b.startOffset),!0),d=a(new f(b.endContainer,b.endOffset),!1),b=e.getDocument(b.startContainer).body.createTextRange();b.setEndPoint("StartToStart",c);b.setEndPoint("EndToEnd",d);return b});
d.prototype.getName=function(){return"WrappedRange"};b.WrappedRange=d;b.createRange=function(a){a=a||document;return new d(b.createNativeRange(a))};b.createRangyRange=function(a){a=a||document;return new g(a)};b.createIframeRange=function(a){return b.createRange(e.getIframeDocument(a))};b.createIframeRangyRange=function(a){return b.createRangyRange(e.getIframeDocument(a))};b.addCreateMissingNativeApiListener(function(a){a=a.document;if(typeof a.createRange=="undefined")a.createRange=function(){return b.createRange(this)};
a=a=null})});
rangy.createModule("WrappedSelection",function(b,c){function a(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start",c=c?"start":"end";a.anchorNode=b[d+"Container"];a.anchorOffset=b[d+"Offset"];a.focusNode=b[c+"Container"];a.focusOffset=b[c+"Offset"]}function f(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function g(a){var c;a instanceof x?(c=a._selectionNativeRange,
c||(c=b.createNativeRange(m.getDocument(a.startContainer)),c.setEnd(a.endContainer,a.endOffset),c.setStart(a.startContainer,a.startOffset),a._selectionNativeRange=c,a.attachListener("detach",function(){this._selectionNativeRange=null}))):a instanceof o?c=a.nativeRange:b.features.implementsDomRange&&a instanceof m.getWindow(a.startContainer).Range&&(c=a);return c}function i(a){var b=a.getNodes(),c;a:if(!b.length||1!=b[0].nodeType)c=!1;else{c=1;for(var d=b.length;c<d;++c)if(!m.isAncestorOf(b[0],b[c])){c=
!1;break a}c=!0}if(!c)throw Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function h(a,b){var c=new o(b);a._ranges=[c];e(a,c,!1);a.rangeCount=1;a.isCollapsed=c.collapsed}function k(a){a._ranges.length=0;if("None"==a.docSelection.type)f(a);else{var c=a.docSelection.createRange();if(c&&"undefined"!=typeof c.text)h(a,c);else{a.rangeCount=c.length;for(var d,j=m.getDocument(c.item(0)),k=0;k<a.rangeCount;++k)d=b.createRange(j),d.selectNode(c.item(k)),
a._ranges.push(d);a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed;e(a,a._ranges[a.rangeCount-1],!1)}}}function j(a,b){for(var c=a.docSelection.createRange(),d=i(b),e=m.getDocument(c.item(0)),e=m.getBody(e).createControlRange(),h=0,j=c.length;h<j;++h)e.add(c.item(h));try{e.add(d)}catch(f){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}e.select();k(a)}function n(a,b,c){this.nativeSelection=a;this.docSelection=b;this._ranges=
[];this.win=c;this.refresh()}function p(a,b){for(var c=m.getDocument(b[0].startContainer),c=m.getBody(c).createControlRange(),d=0,e;d<rangeCount;++d){e=i(b[d]);try{c.add(e)}catch(h){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}c.select();k(a)}function q(a,b){if(a.anchorNode&&m.getDocument(a.anchorNode)!==m.getDocument(b))throw new z("WRONG_DOCUMENT_ERR");}function r(a){var b=[],c=new w(a.anchorNode,a.anchorOffset),
d=new w(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var h=0,j=a.rangeCount;h<j;++h)b[h]=x.inspect(a.getRangeAt(h));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}b.requireModules(["DomUtil","DomRange","WrappedRange"]);b.config.checkSelectionRanges=!0;var m=b.dom,s=b.util,x=b.DomRange,o=b.WrappedRange,z=b.DOMException,w=m.DomPosition,y,A,t=b.util.isHostMethod(window,"getSelection"),
v=b.util.isHostObject(document,"selection"),D=v&&(!t||b.config.preferTextRange);D?(y=d,b.isSelectionValid=function(a){var a=(a||window).document,b=a.selection;return"None"!=b.type||m.getDocument(b.createRange().parentElement())==a}):t?(y=a,b.isSelectionValid=function(){return!0}):c.fail("Neither document.selection or window.getSelection() detected.");b.getNativeSelection=y;var t=y(),K=b.createNativeRange(document),F=m.getBody(document),E=s.areHostObjects(t,s.areHostProperties(t,["anchorOffset","focusOffset"]));
b.features.selectionHasAnchorAndFocus=E;var I=s.isHostMethod(t,"extend");b.features.selectionHasExtend=I;var N="number"==typeof t.rangeCount;b.features.selectionHasRangeCount=N;var J=!1,C=!0;s.areHostMethods(t,["addRange","getRangeAt","removeAllRanges"])&&("number"==typeof t.rangeCount&&b.features.implementsDomRange)&&function(){var a=document.createElement("iframe");F.appendChild(a);var b=m.getIframeDocument(a);b.open();b.write("<html><head></head><body>12</body></html>");b.close();var c=m.getIframeWindow(a).getSelection(),
d=b.documentElement.lastChild.firstChild,b=b.createRange();b.setStart(d,1);b.collapse(true);c.addRange(b);C=c.rangeCount==1;c.removeAllRanges();var e=b.cloneRange();b.setStart(d,0);e.setEnd(d,2);c.addRange(b);c.addRange(e);J=c.rangeCount==2;b.detach();e.detach();F.removeChild(a)}();b.features.selectionSupportsMultipleRanges=J;b.features.collapsedNonEditableSelectionsSupported=C;var l=!1,u;F&&s.isHostMethod(F,"createControlRange")&&(u=F.createControlRange(),s.areHostProperties(u,["item","add"])&&(l=
!0));b.features.implementsControlRange=l;A=E?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:false};var B;s.isHostMethod(t,"getRangeAt")?B=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:E&&(B=function(a){var c=m.getDocument(a.anchorNode),c=b.createRange(c);c.setStart(a.anchorNode,a.anchorOffset);c.setEnd(a.focusNode,a.focusOffset);if(c.collapsed!==this.isCollapsed){c.setStart(a.focusNode,
a.focusOffset);c.setEnd(a.anchorNode,a.anchorOffset)}return c});b.getSelection=function(a){var a=a||window,b=a._rangySelection,c=y(a),e=v?d(a):null;if(b){b.nativeSelection=c;b.docSelection=e;b.refresh(a)}else{b=new n(c,e,a);a._rangySelection=b}return b};b.getIframeSelection=function(a){return b.getSelection(m.getIframeWindow(a))};u=n.prototype;if(!D&&E&&s.areHostMethods(t,["removeAllRanges","addRange"])){u.removeAllRanges=function(){this.nativeSelection.removeAllRanges();f(this)};var L=function(a,
c){var d=x.getRangeDocument(c),d=b.createRange(d);d.collapseToPoint(c.endContainer,c.endOffset);a.nativeSelection.addRange(g(d));a.nativeSelection.extend(c.startContainer,c.startOffset);a.refresh()};u.addRange=N?function(a,c){if(l&&v&&this.docSelection.type=="Control")j(this,a);else if(c&&I)L(this,a);else{var d;if(J)d=this.rangeCount;else{this.removeAllRanges();d=0}this.nativeSelection.addRange(g(a));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(b.config.checkSelectionRanges)(d=
B(this.nativeSelection,this.rangeCount-1))&&!x.rangesEqual(d,a)&&(a=new o(d));this._ranges[this.rangeCount-1]=a;e(this,a,H(this.nativeSelection));this.isCollapsed=A(this)}else this.refresh()}}:function(a,b){if(b&&I)L(this,a);else{this.nativeSelection.addRange(g(a));this.refresh()}};u.setRanges=function(a){if(l&&a.length>1)p(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else if(s.isHostMethod(t,"empty")&&s.isHostMethod(K,"select")&&l&&D)u.removeAllRanges=
function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=m.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var b=this.docSelection.createRange();b.length&&(a=m.getDocument(b.item(0)).body.createTextRange())}if(a){a.body.createTextRange().select();this.docSelection.empty()}}}catch(c){}f(this)},u.addRange=function(a){if(this.docSelection.type=="Control")j(this,a);else{o.rangeToTextRange(a).select();this._ranges[0]=a;this.rangeCount=
1;this.isCollapsed=this._ranges[0].collapsed;e(this,a,false)}},u.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?p(this,a):b&&this.addRange(a[0])};else return c.fail("No means of selecting a Range or TextRange was found"),!1;u.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new z("INDEX_SIZE_ERR");return this._ranges[a]};var G;if(D)G=function(a){var c;if(b.isSelectionValid(a.win))c=a.docSelection.createRange();else{c=m.getBody(a.win.document).createTextRange();c.collapse(true)}a.docSelection.type==
"Control"?k(a):c&&typeof c.text!="undefined"?h(a,c):f(a)};else if(s.isHostMethod(t,"getRangeAt")&&"number"==typeof t.rangeCount)G=function(a){if(l&&v&&a.docSelection.type=="Control")k(a);else{a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount;if(a.rangeCount){for(var c=0,d=a.rangeCount;c<d;++c)a._ranges[c]=new b.WrappedRange(a.nativeSelection.getRangeAt(c));e(a,a._ranges[a.rangeCount-1],H(a.nativeSelection));a.isCollapsed=A(a)}else f(a)}};else if(E&&"boolean"==typeof t.isCollapsed&&"boolean"==
typeof K.collapsed&&b.features.implementsDomRange)G=function(a){var b;b=a.nativeSelection;if(b.anchorNode){b=B(b,0);a._ranges=[b];a.rangeCount=1;b=a.nativeSelection;a.anchorNode=b.anchorNode;a.anchorOffset=b.anchorOffset;a.focusNode=b.focusNode;a.focusOffset=b.focusOffset;a.isCollapsed=A(a)}else f(a)};else return c.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;u.refresh=function(a){var b=a?this._ranges.slice(0):null;G(this);if(a){a=b.length;if(a!=this._ranges.length)return false;
for(;a--;)if(!x.rangesEqual(b[a],this._ranges[a]))return false;return true}};var P=function(a,b){var c=a.getAllRanges(),d=false;a.removeAllRanges();for(var e=0,h=c.length;e<h;++e)d||b!==c[e]?a.addRange(c[e]):d=true;a.rangeCount||f(a)};u.removeRange=l?function(a){if(this.docSelection.type=="Control"){for(var b=this.docSelection.createRange(),a=i(a),c=m.getDocument(b.item(0)),c=m.getBody(c).createControlRange(),d,e=false,h=0,j=b.length;h<j;++h){d=b.item(h);d!==a||e?c.add(b.item(h)):e=true}c.select();
k(this)}else P(this,a)}:function(a){P(this,a)};var H;!D&&E&&b.features.implementsDomRange?(H=function(a){var b=false;a.anchorNode&&(b=m.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1);return b},u.isBackwards=function(){return H(this)}):H=u.isBackwards=function(){return false};u.toString=function(){for(var a=[],b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")};u.collapse=function(a,c){q(this,a);var d=b.createRange(m.getDocument(a));d.collapseToPoint(a,
c);this.removeAllRanges();this.addRange(d);this.isCollapsed=true};u.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new z("INVALID_STATE_ERR");};u.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new z("INVALID_STATE_ERR");};u.selectAllChildren=function(a){q(this,a);var c=b.createRange(m.getDocument(a));c.selectNodeContents(a);this.removeAllRanges();
this.addRange(c)};u.deleteFromDocument=function(){if(l&&v&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),b;a.length;){b=a.item(0);a.remove(b);b.parentNode.removeChild(b)}this.refresh()}else if(this.rangeCount){a=this.getAllRanges();this.removeAllRanges();b=0;for(var c=a.length;b<c;++b)a[b].deleteContents();this.addRange(a[c-1])}};u.getAllRanges=function(){return this._ranges.slice(0)};u.setSingleRange=function(a){this.setRanges([a])};u.containsNode=function(a,b){for(var c=
0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return true;return false};u.toHtml=function(){var a="";if(this.rangeCount){for(var a=x.getRangeDocument(this._ranges[0]).createElement("div"),b=0,c=this._ranges.length;b<c;++b)a.appendChild(this._ranges[b].cloneContents());a=a.innerHTML}return a};u.getName=function(){return"WrappedSelection"};u.inspect=function(){return r(this)};u.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};n.inspect=
r;b.Selection=n;b.selectionPrototype=u;b.addCreateMissingNativeApiListener(function(a){if(typeof a.getSelection=="undefined")a.getSelection=function(){return b.getSelection(this)};a=null})});var Base=function(){};
Base.extend=function(b,c){var a=Base.prototype.extend;Base._prototyping=!0;var d=new this;a.call(d,b);d.base=function(){};delete Base._prototyping;var e=d.constructor,f=d.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==f)this._constructing=!0,e.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||a).call(arguments[0],d)};f.ancestor=this;f.extend=this.extend;f.forEach=this.forEach;f.implement=this.implement;f.prototype=
d;f.toString=this.toString;f.valueOf=function(a){return"object"==a?f:e.valueOf()};a.call(f,c);"function"==typeof f.init&&f.init();return f};
Base.prototype={extend:function(b,c){if(1<arguments.length){var a=this[b];if(a&&"function"==typeof c&&(!a.valueOf||a.valueOf()!=c.valueOf())&&/\bbase\b/.test(c)){var d=c.valueOf(),c=function(){var b=this.base||Base.prototype.base;this.base=a;var c=d.apply(this,arguments);this.base=b;return c};c.valueOf=function(a){return"object"==a?c:d};c.toString=Base.toString}this[b]=c}else if(b){var e=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(e=this.extend||e);for(var f={toSource:null},
g=["constructor","toString","valueOf"],i=Base._prototyping?0:1;h=g[i++];)b[h]!=f[h]&&e.call(this,h,b[h]);for(var h in b)f[h]||e.call(this,h,b[h])}return this}};
Base=Base.extend({constructor:function(b){this.extend(b)}},{ancestor:Object,version:"1.1",forEach:function(b,c,a){for(var d in b)void 0===this.prototype[d]&&c.call(a,b[d],d,b)},implement:function(){for(var b=0;b<arguments.length;b++)if("function"==typeof arguments[b])arguments[b](this.prototype);else this.prototype.extend(arguments[b]);return this},toString:function(){return""+this.valueOf()}});
wysihtml5.browser=function(){var b=navigator.userAgent,c=document.createElement("div"),a=-1!==b.indexOf("MSIE")&&-1===b.indexOf("Opera"),d=-1!==b.indexOf("Gecko")&&-1===b.indexOf("KHTML"),e=-1!==b.indexOf("AppleWebKit/"),f=-1!==b.indexOf("Chrome/"),g=-1!==b.indexOf("Opera/");return{USER_AGENT:b,supported:function(){var a=this.USER_AGENT.toLowerCase(),b="contentEditable"in c,d=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,e=document.querySelector&&document.querySelectorAll,
a=this.isIos()&&5>(/ipad|iphone|ipod/.test(a)&&a.match(/ os (\d+).+? like mac os x/)||[,0])[1]||-1!==a.indexOf("opera mobi")||-1!==a.indexOf("hpwos/");return b&&d&&e&&!a},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var a=this.USER_AGENT.toLowerCase();return-1!==a.indexOf("webkit")&&-1!==a.indexOf("mobile")},supportsSandboxedIframes:function(){return a},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!d},
hasCurrentStyleProperty:function(){return"currentStyle"in c},insertsLineBreaksOnReturn:function(){return d},supportsPlaceholderAttributeOn:function(a){return"placeholder"in a},supportsEvent:function(a){var b;if(!(b="on"+a in c))c.setAttribute("on"+a,"return;"),b="function"===typeof c["on"+a];return b},supportsEventsInIframeCorrectly:function(){return!g},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return e||d},supportsDataTransfer:function(){try{return e&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(a){return!1}},
supportsHTML5Tags:function(a){a=a.createElement("div");a.innerHTML="<article>foo</article>";return"<article>foo</article>"===a.innerHTML.toLowerCase()},supportsCommand:function(){var b={formatBlock:a,insertUnorderedList:a||g||e,insertOrderedList:a||g||e},c={insertHTML:d};return function(a,d){if(!b[d]){try{return a.queryCommandSupported(d)}catch(e){}try{return a.queryCommandEnabled(d)}catch(f){return!!c[d]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return a},canDisableAutoLinking:function(){return this.supportsCommand(document,
"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return d||g||e},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return d||a||g},clearsListsInContentEditableCorrectly:function(){return d||a||e},autoScrollsToCaret:function(){return!e},autoClosesUnclosedTags:function(){var a=c.cloneNode(!1),b;a.innerHTML="<p><div></div>";a=a.innerHTML.toLowerCase();b="<p></p><div></div>"===a||"<p><div></div></p>"===
a;this.autoClosesUnclosedTags=function(){return b};return b},supportsNativeGetElementsByClassName:function(){return-1!==(""+document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in c},needsSpaceAfterLineBreak:function(){return g},supportsSpeechApiOn:function(a){return 11<=(b.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange"in a||"speech"in a)},
crashesWhenDefineProperty:function(b){return a&&("XMLHttpRequest"===b||"XDomainRequest"===b)},doesAsyncFocus:function(){return a},hasProblemsSettingCaretAfterImg:function(){return a},hasUndoInContextMenu:function(){return d||f||g}}}();
wysihtml5.lang.array=function(b){return{contains:function(c){if(b.indexOf)return-1!==b.indexOf(c);for(var a=0,d=b.length;a<d;a++)if(b[a]===c)return!0;return!1},without:function(c){for(var c=wysihtml5.lang.array(c),a=[],d=0,e=b.length;d<e;d++)c.contains(b[d])||a.push(b[d]);return a},get:function(){for(var c=0,a=b.length,d=[];c<a;c++)d.push(b[c]);return d}}};
wysihtml5.lang.Dispatcher=Base.extend({observe:function(b,c){this.events=this.events||{};this.events[b]=this.events[b]||[];this.events[b].push(c);return this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(b,c){this.events=this.events||{};for(var a=this.events[b]||[],d=0;d<a.length;d++)a[d].call(this,c);return this},stopObserving:function(b,c){this.events=this.events||{};var a=0,d,e;if(b){d=this.events[b]||[];for(e=[];a<d.length;a++)d[a]!==c&&c&&
e.push(d[a]);this.events[b]=e}else this.events={};return this}});wysihtml5.lang.object=function(b){return{merge:function(c){for(var a in c)b[a]=c[a];return this},get:function(){return b},clone:function(){var c={},a;for(a in b)c[a]=b[a];return c},isArray:function(){return"[object Array]"===Object.prototype.toString.call(b)}}};
(function(){var b=/^\s+/,c=/\s+$/;wysihtml5.lang.string=function(a){a=""+a;return{trim:function(){return a.replace(b,"").replace(c,"")},interpolate:function(b){for(var c in b)a=this.replace("#{"+c+"}").by(b[c]);return a},replace:function(b){return{by:function(c){return a.split(b).join(c)}}}}}})();
(function(b){function c(a){return a.replace(e,function(a,b){var c=(b.match(f)||[])[1]||"",d=i[c],b=b.replace(f,"");b.split(d).length>b.split(c).length&&(b+=c,c="");var e=d=b;b.length>g&&(e=e.substr(0,g)+"...");"www."===d.substr(0,4)&&(d="http://"+d);return'<a href="'+d+'">'+e+"</a>"+c})}function a(h){if(!d.contains(h.nodeName))if(h.nodeType===b.TEXT_NODE&&h.data.match(e)){var f=h.parentNode,j;j=f.ownerDocument;var g=j._wysihtml5_tempElement;g||(g=j._wysihtml5_tempElement=j.createElement("div"));j=
g;j.innerHTML="<span></span>"+c(h.data);for(j.removeChild(j.firstChild);j.firstChild;)f.insertBefore(j.firstChild,h);f.removeChild(h)}else{f=b.lang.array(h.childNodes).get();j=f.length;for(g=0;g<j;g++)a(f[g]);return h}}var d=b.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),e=/((https?:\/\/|www\.)[^\s<]{3,})/gi,f=/([^\w\/\-](,?))$/i,g=100,i={")":"(","]":"[","}":"{"};b.dom.autoLink=function(b){var c;a:{c=b;for(var e;c.parentNode;){c=c.parentNode;e=c.nodeName;if(d.contains(e)){c=!0;break a}if("body"===
e)break}c=!1}if(c)return b;b===b.ownerDocument.documentElement&&(b=b.ownerDocument.body);return a(b)};b.dom.autoLink.URL_REG_EXP=e})(wysihtml5);
(function(b){var c=b.browser.supportsClassList(),a=b.dom;a.addClass=function(b,e){if(c)return b.classList.add(e);a.hasClass(b,e)||(b.className+=" "+e)};a.removeClass=function(a,b){if(c)return a.classList.remove(b);a.className=a.className.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," ")};a.hasClass=function(a,b){if(c)return a.classList.contains(b);var f=a.className;return 0<f.length&&(f==b||RegExp("(^|\\s)"+b+"(\\s|$)").test(f))}})(wysihtml5);
wysihtml5.dom.contains=function(){var b=document.documentElement;if(b.contains)return function(b,a){a.nodeType!==wysihtml5.ELEMENT_NODE&&(a=a.parentNode);return b!==a&&b.contains(a)};if(b.compareDocumentPosition)return function(b,a){return!!(b.compareDocumentPosition(a)&16)}}();
wysihtml5.dom.convertToList=function(){function b(b,a){var d=b.createElement("li");a.appendChild(d);return d}return function(c,a){if("UL"===c.nodeName||"OL"===c.nodeName||"MENU"===c.nodeName)return c;var d=c.ownerDocument,e=d.createElement(a),f=c.querySelectorAll("br"),g=f.length,i,h,k,j,n;for(n=0;n<g;n++)for(i=f[n];(h=i.parentNode)&&h!==c&&h.lastChild===i;){if("block"===wysihtml5.dom.getStyle("display").from(h)){h.removeChild(i);break}wysihtml5.dom.insert(i).after(i.parentNode)}f=wysihtml5.lang.array(c.childNodes).get();
g=f.length;for(n=0;n<g;n++)j=j||b(d,e),i=f[n],h="block"===wysihtml5.dom.getStyle("display").from(i),k="BR"===i.nodeName,h?(j=j.firstChild?b(d,e):j,j.appendChild(i),j=null):k?j=j.firstChild?null:j:j.appendChild(i);c.parentNode.replaceChild(e,c);return e}}();wysihtml5.dom.copyAttributes=function(b){return{from:function(c){return{to:function(a){for(var d,e=0,f=b.length;e<f;e++)d=b[e],"undefined"!==typeof c[d]&&""!==c[d]&&(a[d]=c[d]);return{andTo:arguments.callee}}}}}};
(function(b){var c=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],a=function(a){var e;a:for(var f=0,g=c.length;f<g;f++)if("border-box"===b.getStyle(c[f]).from(a)){e=c[f];break a}return e?parseInt(b.getStyle("width").from(a),10)<a.offsetWidth:!1};b.copyStyles=function(d){return{from:function(e){a(e)&&(d=wysihtml5.lang.array(d).without(c));for(var f="",g=d.length,i=0,h;i<g;i++)h=d[i],f+=h+":"+b.getStyle(h).from(e)+";";return{to:function(a){b.setStyles(f).on(a);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom);
(function(b){b.dom.delegate=function(c,a,d,e){return b.dom.observe(c,d,function(d){for(var g=d.target,i=b.lang.array(c.querySelectorAll(a));g&&g!==c;){if(i.contains(g)){e.call(g,d);break}g=g.parentNode}})}})(wysihtml5);
wysihtml5.dom.getAsDom=function(){var b="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(c,a){var a=a||document,d;if("object"===typeof c&&c.nodeType)d=a.createElement("div"),d.appendChild(c);else if(wysihtml5.browser.supportsHTML5Tags(a))d=a.createElement("div"),d.innerHTML=c;else{d=a;if(!d._wysihtml5_supportsHTML5Tags){for(var e=
0,f=b.length;e<f;e++)d.createElement(b[e]);d._wysihtml5_supportsHTML5Tags=!0}d=a;e=d.createElement("div");e.style.display="none";d.body.appendChild(e);try{e.innerHTML=c}catch(g){}d.body.removeChild(e);d=e}return d}}();
wysihtml5.dom.getParentElement=function(){function b(b,a){return!a||!a.length?!0:"string"===typeof a?b===a:wysihtml5.lang.array(a).contains(b)}return function(c,a,d){d=d||50;if(a.className||a.classRegExp){a:{for(var e=a.nodeName,f=a.className,a=a.classRegExp;d--&&c&&"BODY"!==c.nodeName;){var g;if(g=c.nodeType===wysihtml5.ELEMENT_NODE)if(g=b(c.nodeName,e)){g=f;var i=(c.className||"").match(a)||[];g=!g?!!i.length:i[i.length-1]===g}if(g)break a;c=c.parentNode}c=null}return c}a:{e=a.nodeName;for(f=d;f--&&
c&&"BODY"!==c.nodeName;){if(b(c.nodeName,e))break a;c=c.parentNode}c=null}return c}}();
wysihtml5.dom.getStyle=function(){function b(b){return b.replace(a,function(a){return a.charAt(1).toUpperCase()})}var c={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},a=/\-[a-z]/g;return function(a){return{from:function(e){if(e.nodeType===wysihtml5.ELEMENT_NODE){var f=e.ownerDocument,g=c[a]||b(a),i=e.style,h=e.currentStyle,k=i[g];if(k)return k;if(h)try{return h[g]}catch(j){}var g=f.defaultView||f.parentWindow,f=("height"===a||"width"===a)&&"TEXTAREA"===e.nodeName,
n;if(g.getComputedStyle)return f&&(n=i.overflow,i.overflow="hidden"),e=g.getComputedStyle(e,null).getPropertyValue(a),f&&(i.overflow=n||""),e}}}}}();wysihtml5.dom.hasElementWithTagName=function(){var b={},c=1;return function(a,d){var e=(a._wysihtml5_identifier||(a._wysihtml5_identifier=c++))+":"+d,f=b[e];f||(f=b[e]=a.getElementsByTagName(d));return 0<f.length}}();
(function(b){var c={},a=1;b.dom.hasElementWithClassName=function(d,e){if(!b.browser.supportsNativeGetElementsByClassName())return!!d.querySelector("."+e);var f=(d._wysihtml5_identifier||(d._wysihtml5_identifier=a++))+":"+e,g=c[f];g||(g=c[f]=d.getElementsByClassName(e));return 0<g.length}})(wysihtml5);wysihtml5.dom.insert=function(b){return{after:function(c){c.parentNode.insertBefore(b,c.nextSibling)},before:function(c){c.parentNode.insertBefore(b,c)},into:function(c){c.appendChild(b)}}};
wysihtml5.dom.insertCSS=function(b){b=b.join("\n");return{into:function(c){var a=c.head||c.getElementsByTagName("head")[0],d=c.createElement("style");d.type="text/css";d.styleSheet?d.styleSheet.cssText=b:d.appendChild(c.createTextNode(b));a&&a.appendChild(d)}}};
wysihtml5.dom.observe=function(b,c,a){for(var c="string"===typeof c?[c]:c,d,e,f=0,g=c.length;f<g;f++)e=c[f],b.addEventListener?b.addEventListener(e,a,!1):(d=function(c){"target"in c||(c.target=c.srcElement);c.preventDefault=c.preventDefault||function(){this.returnValue=false};c.stopPropagation=c.stopPropagation||function(){this.cancelBubble=true};a.call(b,c)},b.attachEvent("on"+e,d));return{stop:function(){for(var e,h=0,f=c.length;h<f;h++)e=c[h],b.removeEventListener?b.removeEventListener(e,a,!1):
b.detachEvent("on"+e,d)}}};
wysihtml5.dom.parse=function(){function b(c,e){var h=c.childNodes,f=h.length,g;g=a[c.nodeType];var k=0;g=g&&g(c);if(!g)return null;for(k=0;k<f;k++)(newChild=b(h[k],e))&&g.appendChild(newChild);return e&&1>=g.childNodes.length&&g.nodeName.toLowerCase()===d&&!g.attributes.length?g.firstChild:g}function c(a,b){var b=b.toLowerCase(),c;if(c="IMG"==a.nodeName)if(c="src"==b){var d;try{d=a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(e){a.complete&&"complete"===a.readyState&&(d=!0)}c=!0===d}return c?
a.src:i&&"outerHTML"in a?-1!=a.outerHTML.toLowerCase().indexOf(" "+b+"=")?a.getAttribute(b):null:a.getAttribute(b)}var a={1:function(a){var b,f,i=g.tags;f=a.nodeName.toLowerCase();b=a.scopeName;if(a._wysihtml5)return null;a._wysihtml5=1;if("wysihtml5-temp"===a.className)return null;b&&"HTML"!=b&&(f=b+":"+f);"outerHTML"in a&&!wysihtml5.browser.autoClosesUnclosedTags()&&("P"===a.nodeName&&"</p>"!==a.outerHTML.slice(-4).toLowerCase())&&(f="div");if(f in i){b=i[f];if(!b||b.remove)return null;b="string"===
typeof b?{rename_tag:b}:b}else if(a.firstChild)b={rename_tag:d};else return null;f=a.ownerDocument.createElement(b.rename_tag||f);var i={},r=b.set_class,m=b.add_class,s=b.set_attributes,x=b.check_attributes,o=g.classes,z=0,w=[];b=[];var y=[],A=[],t;s&&(i=wysihtml5.lang.object(s).clone());if(x)for(t in x)if(s=h[x[t]])s=s(c(a,t)),"string"===typeof s&&(i[t]=s);r&&w.push(r);if(m)for(t in m)if(s=k[m[t]])r=s(c(a,t)),"string"===typeof r&&w.push(r);o["_wysihtml5-temp-placeholder"]=1;(A=a.getAttribute("class"))&&
(w=w.concat(A.split(e)));for(m=w.length;z<m;z++)a=w[z],o[a]&&b.push(a);for(o=b.length;o--;)a=b[o],wysihtml5.lang.array(y).contains(a)||y.unshift(a);y.length&&(i["class"]=y.join(" "));for(t in i)try{f.setAttribute(t,i[t])}catch(v){}i.src&&("undefined"!==typeof i.width&&f.setAttribute("width",i.width),"undefined"!==typeof i.height&&f.setAttribute("height",i.height));return f},3:function(a){return a.ownerDocument.createTextNode(a.data)}},d="span",e=/\s+/,f={tags:{},classes:{}},g={},i=!wysihtml5.browser.supportsGetAttributeCorrectly(),
h={url:function(){var a=/^https?:\/\//i;return function(b){return!b||!b.match(a)?null:b.replace(a,function(a){return a.toLowerCase()})}}(),alt:function(){var a=/[^ a-z0-9_\-]/gi;return function(b){return!b?"":b.replace(a,"")}}(),numbers:function(){var a=/\D/g;return function(b){return(b=(b||"").replace(a,""))||null}}()},k={align_img:function(){var a={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(b){return a[(""+b).toLowerCase()]}}(),align_text:function(){var a={left:"wysiwyg-text-align-left",
right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(b){return a[(""+b).toLowerCase()]}}(),clear_br:function(){var a={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(b){return a[(""+b).toLowerCase()]}}(),size_font:function(){var a={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",
6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(b){return a[(""+b).charAt(0)]}}()};return function(a,c,d,e){wysihtml5.lang.object(g).merge(f).merge(c).get();for(var d=d||a.ownerDocument||document,c=d.createDocumentFragment(),h="string"===typeof a,a=h?wysihtml5.dom.getAsDom(a,d):a;a.firstChild;)d=a.firstChild,a.removeChild(d),(d=b(d,e))&&c.appendChild(d);a.innerHTML="";a.appendChild(c);return h?wysihtml5.quirks.getCorrectInnerHTML(a):
a}}();wysihtml5.dom.removeEmptyTextNodes=function(b){for(var c=wysihtml5.lang.array(b.childNodes).get(),a=c.length,d=0;d<a;d++)b=c[d],b.nodeType===wysihtml5.TEXT_NODE&&""===b.data&&b.parentNode.removeChild(b)};wysihtml5.dom.renameElement=function(b,c){for(var a=b.ownerDocument.createElement(c),d;d=b.firstChild;)a.appendChild(d);wysihtml5.dom.copyAttributes(["align","className"]).from(b).to(a);b.parentNode.replaceChild(a,b);return a};
wysihtml5.dom.replaceWithChildNodes=function(b){if(b.parentNode)if(b.firstChild){for(var c=b.ownerDocument.createDocumentFragment();b.firstChild;)c.appendChild(b.firstChild);b.parentNode.replaceChild(c,b)}else b.parentNode.removeChild(b)};
(function(b){function c(a){var b=a.ownerDocument.createElement("br");a.appendChild(b)}b.resolveList=function(a){if(!("MENU"!==a.nodeName&&"UL"!==a.nodeName&&"OL"!==a.nodeName)){var d=a.ownerDocument.createDocumentFragment(),e=a.previousElementSibling||a.previousSibling,f,g,i;for(e&&"block"!==b.getStyle("display").from(e)&&c(d);i=a.firstChild;){for(f=i.lastChild;e=i.firstChild;)g=(g=e===f)&&"block"!==b.getStyle("display").from(e)&&"BR"!==e.nodeName,d.appendChild(e),g&&c(d);i.parentNode.removeChild(i)}a.parentNode.replaceChild(d,
a)}}})(wysihtml5.dom);
(function(b){var c=document,a="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),d="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),e=["referrer","write","open","close"];b.dom.Sandbox=Base.extend({constructor:function(a,c){this.callback=a||b.EMPTY_FUNCTION;this.config=b.lang.object({}).merge(c).get();this.iframe=this._createIframe()},insertInto:function(a){"string"===typeof a&&
(a=c.getElementById(a));a.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var a=this.getIframe();a.parentNode.removeChild(a)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet");},_createIframe:function(){var a=this,d=c.createElement("iframe");d.className="wysihtml5-sandbox";b.dom.setAttributes({security:"restricted",allowtransparency:"true",
frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(d);b.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(d.src="javascript:'<html></html>'");d.onload=function(){d.onreadystatechange=d.onload=null;a._onLoadIframe(d)};d.onreadystatechange=function(){if(/loaded|complete/.test(d.readyState)){d.onreadystatechange=d.onload=null;a._onLoadIframe(d)}};return d},_onLoadIframe:function(f){if(b.dom.contains(c.documentElement,f)){var g=this,i=f.contentWindow,h=f.contentWindow.document,k=
this._getHtml({charset:c.characterSet||c.charset||"utf-8",stylesheets:this.config.stylesheets});h.open("text/html","replace");h.write(k);h.close();this.getWindow=function(){return f.contentWindow};this.getDocument=function(){return f.contentWindow.document};i.onerror=function(a,b,c){throw Error("wysihtml5.Sandbox: "+a,b,c);};if(!b.browser.supportsSandboxedIframes()){var j,k=0;for(j=a.length;k<j;k++)this._unset(i,a[k]);k=0;for(j=d.length;k<j;k++)this._unset(i,d[k],b.EMPTY_FUNCTION);k=0;for(j=e.length;k<
j;k++)this._unset(h,e[k]);this._unset(h,"cookie","",!0)}this.loaded=!0;setTimeout(function(){g.callback(g)},0)}},_getHtml:function(a){var c=a.stylesheets,d="",e=0,k;if(c="string"===typeof c?[c]:c)for(k=c.length;e<k;e++)d+='<link rel="stylesheet" href="'+c[e]+'">';a.stylesheets=d;return b.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(a)},_unset:function(a,c,d,e){try{a[c]=d}catch(k){}try{a.__defineGetter__(c,function(){return d})}catch(j){}if(e)try{a.__defineSetter__(c,
function(){})}catch(n){}if(!b.browser.crashesWhenDefineProperty(c))try{var p={get:function(){return d}};e&&(p.set=function(){});Object.defineProperty(a,c,p)}catch(q){}}})})(wysihtml5);(function(){var b={className:"class"};wysihtml5.dom.setAttributes=function(c){return{on:function(a){for(var d in c)a.setAttribute(b[d]||d,c[d])}}}})();
wysihtml5.dom.setStyles=function(b){return{on:function(c){c=c.style;if("string"===typeof b)c.cssText+=";"+b;else for(var a in b)"float"===a?(c.cssFloat=b[a],c.styleFloat=b[a]):c[a]=b[a]}}};
(function(b){b.simulatePlaceholder=function(c,a,d){var e=function(){a.hasPlaceholderSet()&&a.clear();b.removeClass(a.element,"placeholder")},f=function(){a.isEmpty()&&(a.setValue(d),b.addClass(a.element,"placeholder"))};c.observe("set_placeholder",f).observe("unset_placeholder",e).observe("focus:composer",e).observe("paste:composer",e).observe("blur:composer",f);f()}})(wysihtml5.dom);
(function(b){var c=document.documentElement;"textContent"in c?(b.setTextContent=function(a,b){a.textContent=b},b.getTextContent=function(a){return a.textContent}):"innerText"in c?(b.setTextContent=function(a,b){a.innerText=b},b.getTextContent=function(a){return a.innerText}):(b.setTextContent=function(a,b){a.nodeValue=b},b.getTextContent=function(a){return a.nodeValue})})(wysihtml5.dom);
wysihtml5.quirks.cleanPastedHTML=function(){var b={"a u":wysihtml5.dom.replaceWithChildNodes};return function(c,a,d){var a=a||b,d=d||c.ownerDocument||document,e="string"===typeof c,f,g,i,h=0,c=e?wysihtml5.dom.getAsDom(c,d):c;for(i in a){f=c.querySelectorAll(i);d=a[i];for(g=f.length;h<g;h++)d(f[h])}return e?c.innerHTML:c}}();
(function(b){var c=b.dom;b.quirks.ensureProperClearing=function(){var a=function(){var a=this;setTimeout(function(){var b=a.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==b||"<p>&nbsp;</p><p>&nbsp;</p>"==b)a.innerHTML=""},0)};return function(b){c.observe(b.element,["cut","keydown"],a)}}();b.quirks.ensureProperClearingOfLists=function(){var a=["OL","UL","MENU"];return function(d){c.observe(d.element,"keydown",function(e){if(e.keyCode===b.BACKSPACE_KEY){var f=d.selection.getSelectedNode(),e=d.element;
e.firstChild&&b.lang.array(a).contains(e.firstChild.nodeName)&&(f=c.getParentElement(f,{nodeName:a}))&&f==e.firstChild&&1>=f.childNodes.length&&(f.firstChild?""===f.firstChild.innerHTML:1)&&f.parentNode.removeChild(f)}})}}()})(wysihtml5);
(function(b){b.quirks.getCorrectInnerHTML=function(c){var a=c.innerHTML;if(-1===a.indexOf("%7E"))return a;var c=c.querySelectorAll("[href*='~'], [src*='~']"),d,e,f,g;g=0;for(f=c.length;g<f;g++)d=c[g].href||c[g].src,e=b.lang.string(d).replace("~").by("%7E"),a=b.lang.string(a).replace(e).by(d);return a}})(wysihtml5);
(function(b){var c=b.dom,a="LI P H1 H2 H3 H4 H5 H6".split(" "),d=["UL","OL","MENU"];b.quirks.insertLineBreakOnReturn=function(e){function f(a){if(a=c.getParentElement(a,{nodeName:["P","DIV"]},2)){var d=document.createTextNode(b.INVISIBLE_SPACE);c.insert(d).before(a);c.replaceWithChildNodes(a);e.selection.selectNode(d)}}c.observe(e.element.ownerDocument,"keydown",function(g){var i=g.keyCode;if(!(g.shiftKey||i!==b.ENTER_KEY&&i!==b.BACKSPACE_KEY)){var h=e.selection.getSelectedNode();(h=c.getParentElement(h,
{nodeName:a},4))?"LI"===h.nodeName&&(i===b.ENTER_KEY||i===b.BACKSPACE_KEY)?setTimeout(function(){var a=e.selection.getSelectedNode(),b;a&&((b=c.getParentElement(a,{nodeName:d},2))||f(a))},0):h.nodeName.match(/H[1-6]/)&&i===b.ENTER_KEY&&setTimeout(function(){f(e.selection.getSelectedNode())},0):i===b.ENTER_KEY&&!b.browser.insertsLineBreaksOnReturn()&&(e.commands.exec("insertLineBreak"),g.preventDefault())}})}})(wysihtml5);
(function(b){b.quirks.redraw=function(c){b.dom.addClass(c,"wysihtml5-quirks-redraw");b.dom.removeClass(c,"wysihtml5-quirks-redraw");try{var a=c.ownerDocument;a.execCommand("italic",!1,null);a.execCommand("italic",!1,null)}catch(d){}}})(wysihtml5);
(function(b){var c=b.dom;b.Selection=Base.extend({constructor:function(a){window.rangy.init();this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},getBookmark:function(){var a=this.getRange();return a&&a.cloneRange()},setBookmark:function(a){a&&this.setSelection(a)},setBefore:function(a){var b=rangy.createRange(this.doc);b.setStartBefore(a);b.setEndBefore(a);return this.setSelection(b)},setAfter:function(a){var b=rangy.createRange(this.doc);b.setStartAfter(a);b.setEndAfter(a);return this.setSelection(b)},
selectNode:function(a){var d=rangy.createRange(this.doc),e=a.nodeType===b.ELEMENT_NODE,f="canHaveHTML"in a?a.canHaveHTML:"IMG"!==a.nodeName,g=e?a.innerHTML:a.data,g=""===g||g===b.INVISIBLE_SPACE,i=c.getStyle("display").from(a),i="block"===i||"list-item"===i;if(g&&e&&f)try{a.innerHTML=b.INVISIBLE_SPACE}catch(h){}f?d.selectNodeContents(a):d.selectNode(a);f&&g&&e?d.collapse(i):f&&g&&(d.setStartAfter(a),d.setEndAfter(a));this.setSelection(d)},getSelectedNode:function(a){if(a&&this.doc.selection&&"Control"===
this.doc.selection.type&&(a=this.doc.selection.createRange())&&a.length)return a.item(0);a=this.getSelection(this.doc);return a.focusNode===a.anchorNode?a.focusNode:(a=this.getRange(this.doc))?a.commonAncestorContainer:this.doc.body},executeAndRestore:function(a,c){var e=this.doc.body,f=c&&e.scrollTop,g=c&&e.scrollLeft,i='<span class="_wysihtml5-temp-placeholder">'+b.INVISIBLE_SPACE+"</span>",h=this.getRange(this.doc);if(h){i=h.createContextualFragment(i);h.insertNode(i);try{a(h.startContainer,h.endContainer)}catch(k){setTimeout(function(){throw k;
},0)}(caretPlaceholder=this.doc.querySelector("._wysihtml5-temp-placeholder"))?(h=rangy.createRange(this.doc),h.selectNode(caretPlaceholder),h.deleteContents(),this.setSelection(h)):e.focus();c&&(e.scrollTop=f,e.scrollLeft=g);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(j){}}else a(e,e)},executeAndRestoreSimple:function(a){var b,c,f=this.getRange(),g=this.doc.body,i;if(f){b=f.getNodes([3]);g=b[0]||f.startContainer;i=b[b.length-1]||f.endContainer;b=g===f.startContainer?f.startOffset:
0;c=i===f.endContainer?f.endOffset:i.length;try{a(f.startContainer,f.endContainer)}catch(h){setTimeout(function(){throw h;},0)}a=rangy.createRange(this.doc);try{a.setStart(g,b)}catch(k){}try{a.setEnd(i,c)}catch(j){}try{this.setSelection(a)}catch(n){}}else a(g,g)},insertHTML:function(a){var a=rangy.createRange(this.doc).createContextualFragment(a),b=a.lastChild;this.insertNode(a);b&&this.setAfter(b)},insertNode:function(a){var b=this.getRange();b&&b.insertNode(a)},surround:function(a){var b=this.getRange();
if(b)try{b.surroundContents(a),this.selectNode(a)}catch(c){a.appendChild(b.extractContents()),b.insertNode(a)}},scrollIntoView:function(){var a=this.doc,c=a.documentElement.scrollHeight>a.documentElement.offsetHeight,e;if(!(e=a._wysihtml5ScrollIntoViewElement))e=a.createElement("span"),e.innerHTML=b.INVISIBLE_SPACE;e=a._wysihtml5ScrollIntoViewElement=e;if(c){this.insertNode(e);var c=e,f=0;if(c.parentNode){do f+=c.offsetTop||0,c=c.offsetParent;while(c)}c=f;e.parentNode.removeChild(e);c>a.body.scrollTop&&
(a.body.scrollTop=c)}},selectLine:function(){b.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var a=this.doc.defaultView.getSelection();a.modify("extend","left","lineboundary");a.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var a=this.doc.selection.createRange(),b=a.boundingTop,c=this.doc.body.scrollWidth,f;if(a.moveToPoint){0===b&&(f=this.doc.createElement("span"),this.insertNode(f),b=f.offsetTop,
f.parentNode.removeChild(f));b+=1;for(f=-10;f<c;f+=2)try{a.moveToPoint(f,b);break}catch(g){}for(f=this.doc.selection.createRange();0<=c;c--)try{f.moveToPoint(c,b);break}catch(i){}a.setEndPoint("EndToEnd",f);a.select()}},getText:function(){var a=this.getSelection();return a?a.toString():""},getNodes:function(a,b){var c=this.getRange();return c?c.getNodes([a],b):[]},getRange:function(){var a=this.getSelection();return a&&a.rangeCount&&a.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||
this.doc.parentWindow)},setSelection:function(a){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow).setSingleRange(a)}})})(wysihtml5);
(function(b,c){function a(a,b){return c.dom.isCharacterDataNode(a)?0==b?!!a.previousSibling:b==a.length?!!a.nextSibling:!0:0<b&&b<a.childNodes.length}function d(a,b,e){var f;c.dom.isCharacterDataNode(b)&&(0==e?(e=c.dom.getNodeIndex(b),b=b.parentNode):e==b.length?(e=c.dom.getNodeIndex(b)+1,b=b.parentNode):f=c.dom.splitDataNode(b,e));if(!f){f=b.cloneNode(!1);f.id&&f.removeAttribute("id");for(var g;g=b.childNodes[e];)f.appendChild(g);c.dom.insertAfter(f,b)}return b==a?f:d(a,f.parentNode,c.dom.getNodeIndex(f))}
function e(a){this.firstTextNode=(this.isElementMerge=a.nodeType==b.ELEMENT_NODE)?a.lastChild:a;this.textNodes=[this.firstTextNode]}function f(a,b,c,d){this.tagNames=a||[g];this.cssClass=b||"";this.similarClassRegExp=c;this.normalize=d;this.applyToAnyTagName=!1}var g="span",i=/\s+/g;e.prototype={doMerge:function(){for(var a=[],b,c,d=0,e=this.textNodes.length;d<e;++d)b=this.textNodes[d],c=b.parentNode,a[d]=b.data,d&&(c.removeChild(b),c.hasChildNodes()||c.parentNode.removeChild(c));return this.firstTextNode.data=
a=a.join("")},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}};f.prototype={getAncestorWithClass:function(a){for(var d;a;){if(this.cssClass)if(d=this.cssClass,a.className){var e=a.className.match(this.similarClassRegExp)||[];d=e[e.length-1]===d}else d=!1;else d=!0;if(a.nodeType==b.ELEMENT_NODE&&c.dom.arrayContains(this.tagNames,
a.tagName.toLowerCase())&&d)return a;a=a.parentNode}return!1},postApply:function(a,b){for(var c=a[0],d=a[a.length-1],f=[],g,i=c,m=d,s=0,x=d.length,o,z,w=0,y=a.length;w<y;++w)if(o=a[w],z=this.getAdjacentMergeableTextNode(o.parentNode,!1)){if(g||(g=new e(z),f.push(g)),g.textNodes.push(o),o===c&&(i=g.firstTextNode,s=i.length),o===d)m=g.firstTextNode,x=g.getLength()}else g=null;if(c=this.getAdjacentMergeableTextNode(d.parentNode,!0))g||(g=new e(d),f.push(g)),g.textNodes.push(c);if(f.length){w=0;for(y=
f.length;w<y;++w)f[w].doMerge();b.setStart(i,s);b.setEnd(m,x)}},getAdjacentMergeableTextNode:function(a,c){var d=a.nodeType==b.TEXT_NODE,e=d?a.parentNode:a,f=c?"nextSibling":"previousSibling";if(d){if((d=a[f])&&d.nodeType==b.TEXT_NODE)return d}else if((d=e[f])&&this.areElementsMergeable(a,d))return d[c?"firstChild":"lastChild"];return null},areElementsMergeable:function(a,b){var d;if(d=c.dom.arrayContains(this.tagNames,(a.tagName||"").toLowerCase()))if(d=c.dom.arrayContains(this.tagNames,(b.tagName||
"").toLowerCase()))if(d=a.className.replace(i," ")==b.className.replace(i," "))a:if(a.attributes.length!=b.attributes.length)d=!1;else{d=0;for(var e=a.attributes.length,f,g;d<e;++d)if(f=a.attributes[d],g=f.name,"class"!=g&&(g=b.attributes.getNamedItem(g),f.specified!=g.specified||f.specified&&f.nodeValue!==g.nodeValue)){d=!1;break a}d=!0}return d},createContainer:function(a){a=a.createElement(this.tagNames[0]);this.cssClass&&(a.className=this.cssClass);return a},applyToTextNode:function(a){var b=
a.parentNode;1==b.childNodes.length&&c.dom.arrayContains(this.tagNames,b.tagName.toLowerCase())?this.cssClass&&(a=this.cssClass,b.className?(b.className&&(b.className=b.className.replace(this.similarClassRegExp,"")),b.className+=" "+a):b.className=a):(b=this.createContainer(c.dom.getDocument(a)),a.parentNode.insertBefore(b,a),b.appendChild(a))},isRemovable:function(a){return c.dom.arrayContains(this.tagNames,a.tagName.toLowerCase())&&b.lang.string(a.className).trim()==this.cssClass},undoToTextNode:function(b,
c,e){c.containsNode(e)||(b=c.cloneRange(),b.selectNode(e),b.isPointInRange(c.endContainer,c.endOffset)&&a(c.endContainer,c.endOffset)&&(d(e,c.endContainer,c.endOffset),c.setEndAfter(e)),b.isPointInRange(c.startContainer,c.startOffset)&&a(c.startContainer,c.startOffset)&&(e=d(e,c.startContainer,c.startOffset)));this.similarClassRegExp&&e.className&&(e.className=e.className.replace(this.similarClassRegExp,""));if(this.isRemovable(e)){c=e;for(e=c.parentNode;c.firstChild;)e.insertBefore(c.firstChild,
c);e.removeChild(c)}},applyToRange:function(a){var c=a.getNodes([b.TEXT_NODE]);if(!c.length)try{var d=this.createContainer(a.endContainer.ownerDocument);a.surroundContents(d);this.selectNode(a,d);return}catch(e){}a.splitBoundaries();c=a.getNodes([b.TEXT_NODE]);if(c.length){for(var f=0,g=c.length;f<g;++f)d=c[f],this.getAncestorWithClass(d)||this.applyToTextNode(d);a.setStart(c[0],0);d=c[c.length-1];a.setEnd(d,d.length);this.normalize&&this.postApply(c,a)}},undoToRange:function(a){var c=a.getNodes([b.TEXT_NODE]),
d,e;c.length?(a.splitBoundaries(),c=a.getNodes([b.TEXT_NODE])):(c=a.endContainer.ownerDocument.createTextNode(b.INVISIBLE_SPACE),a.insertNode(c),a.selectNode(c),c=[c]);for(var f=0,g=c.length;f<g;++f)d=c[f],(e=this.getAncestorWithClass(d))&&this.undoToTextNode(d,a,e);1==g?this.selectNode(a,c[0]):(a.setStart(c[0],0),d=c[c.length-1],a.setEnd(d,d.length),this.normalize&&this.postApply(c,a))},selectNode:function(a,c){var d=c.nodeType===b.ELEMENT_NODE,e="canHaveHTML"in c?c.canHaveHTML:!0,f=d?c.innerHTML:
c.data;if((f=""===f||f===b.INVISIBLE_SPACE)&&d&&e)try{c.innerHTML=b.INVISIBLE_SPACE}catch(g){}a.selectNodeContents(c);f&&d?a.collapse(!1):f&&(a.setStartAfter(c),a.setEndAfter(c))},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b),d=d?d.toString():"";c.detach();return d},isAppliedToRange:function(a){var c=[],d,e=a.getNodes([b.TEXT_NODE]);if(!e.length)return(d=this.getAncestorWithClass(a.startContainer))?[d]:!1;for(var f=0,g=e.length,i;f<g;++f){i=
this.getTextSelectedByRange(e[f],a);d=this.getAncestorWithClass(e[f]);if(""!=i&&!d)return!1;c.push(d)}return c},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)}};b.selection.HTMLApplier=f})(wysihtml5,rangy);
wysihtml5.Commands=Base.extend({constructor:function(b){this.editor=b;this.composer=b.composer;this.doc=this.composer.doc},support:function(b){return wysihtml5.browser.supportsCommand(this.doc,b)},exec:function(b,c){var a=wysihtml5.commands[b],d=wysihtml5.lang.array(arguments).get(),e=a&&a.exec,f=null;this.editor.fire("beforecommand:composer");if(e)d.unshift(this.composer),f=e.apply(a,d);else try{f=this.doc.execCommand(b,!1,c)}catch(g){}this.editor.fire("aftercommand:composer");return f},state:function(b,
c){var a=wysihtml5.commands[b],d=wysihtml5.lang.array(arguments).get(),e=a&&a.state;if(e)return d.unshift(this.composer),e.apply(a,d);try{return this.doc.queryCommandState(b)}catch(f){return!1}},value:function(b){var c=wysihtml5.commands[b],a=c&&c.value;if(a)return a.call(c,this.composer,b);try{return this.doc.queryCommandValue(b)}catch(d){return null}}});
(function(b){b.commands.bold={exec:function(c,a){return b.commands.formatInline.exec(c,a,"b")},state:function(c,a){return b.commands.formatInline.state(c,a,"b")},value:function(){}}})(wysihtml5);
(function(b){function c(c,g){var i=c.doc,h="_wysihtml5-temp-"+ +new Date,k=0,j,n,p;b.commands.formatInline.exec(c,a,d,h,/non-matching-class/g);j=i.querySelectorAll(d+"."+h);for(h=j.length;k<h;k++)for(p in n=j[k],n.removeAttribute("class"),g)n.setAttribute(p,g[p]);k=n;1===h&&(p=e.getTextContent(n),h=!!n.querySelector("*"),p=""===p||p===b.INVISIBLE_SPACE,!h&&p&&(e.setTextContent(n,g.text||n.href),i=i.createTextNode(" "),c.selection.setAfter(n),c.selection.insertNode(i),k=i));c.selection.setAfter(k)}
var a,d="A",e=b.dom;b.commands.createLink={exec:function(a,b,d){var h=this.state(a,b);h?a.selection.executeAndRestore(function(){for(var a=h.length,b=0,c,d,f;b<a;b++)c=h[b],d=e.getParentElement(c,{nodeName:"code"}),f=e.getTextContent(c),f.match(e.autoLink.URL_REG_EXP)&&!d?e.renameElement(c,"code"):e.replaceWithChildNodes(c)}):(d="object"===typeof d?d:{href:d},c(a,d))},state:function(a,c){return b.commands.formatInline.state(a,c,"A")},value:function(){return a}}})(wysihtml5);
(function(b){var c=/wysiwyg-font-size-[a-z\-]+/g;b.commands.fontSize={exec:function(a,d,e){return b.commands.formatInline.exec(a,d,"span","wysiwyg-font-size-"+e,c)},state:function(a,d,e){return b.commands.formatInline.state(a,d,"span","wysiwyg-font-size-"+e,c)},value:function(){}}})(wysihtml5);
(function(b){var c=/wysiwyg-color-[a-z]+/g;b.commands.foreColor={exec:function(a,d,e){return b.commands.formatInline.exec(a,d,"span","wysiwyg-color-"+e,c)},state:function(a,d,e){return b.commands.formatInline.state(a,d,"span","wysiwyg-color-"+e,c)},value:function(){}}})(wysihtml5);
(function(b){function c(a){for(a=a.previousSibling;a&&a.nodeType===b.TEXT_NODE&&!b.lang.string(a.data).trim();)a=a.previousSibling;return a}function a(a){for(a=a.nextSibling;a&&a.nodeType===b.TEXT_NODE&&!b.lang.string(a.data).trim();)a=a.nextSibling;return a}function d(a){return"BR"===a.nodeName||"block"===g.getStyle("display").from(a)?!0:!1}function e(a,c,d,e){if(e)var f=g.observe(a,"DOMNodeInserted",function(a){var a=a.target,c;a.nodeType===b.ELEMENT_NODE&&(c=g.getStyle("display").from(a),"inline"!==
c.substr(0,6)&&(a.className+=" "+e))});a.execCommand(c,!1,d);f&&f.stop()}function f(b,d){b.selection.selectLine();b.selection.surround(d);var e=a(d),f=c(d);e&&"BR"===e.nodeName&&e.parentNode.removeChild(e);f&&"BR"===f.nodeName&&f.parentNode.removeChild(f);(e=d.lastChild)&&"BR"===e.nodeName&&e.parentNode.removeChild(e);b.selection.selectNode(d)}var g=b.dom,i="H1 H2 H3 H4 H5 H6 P BLOCKQUOTE DIV".split(" ");b.commands.formatBlock={exec:function(h,k,j,n,p){var q=h.doc,r=this.state(h,k,j,n,p),m,j="string"===
typeof j?j.toUpperCase():j;if(r)h.selection.executeAndRestoreSimple(function(){p&&(r.className=r.className.replace(p,""));var e=!!b.lang.string(r.className).trim();if(!e&&r.nodeName===(j||"DIV")){var e=r,f=e.ownerDocument,h=a(e),i=c(e);h&&!d(h)&&e.parentNode.insertBefore(f.createElement("br"),h);i&&!d(i)&&e.parentNode.insertBefore(f.createElement("br"),e);g.replaceWithChildNodes(r)}else e&&g.renameElement(r,"DIV")});else{if(null===j||b.lang.array(i).contains(j))if(m=h.selection.getSelectedNode(),
r=g.getParentElement(m,{nodeName:i})){h.selection.executeAndRestoreSimple(function(){j&&(r=g.renameElement(r,j));if(n){var a=r;a.className?(a.className=a.className.replace(p,""),a.className+=" "+n):a.className=n}});return}h.commands.support(k)?e(q,k,j||"DIV",n):(r=q.createElement(j||"DIV"),n&&(r.className=n),f(h,r))}},state:function(a,b,c,d,e){c="string"===typeof c?c.toUpperCase():c;a=a.selection.getSelectedNode();return g.getParentElement(a,{nodeName:c,className:d,classRegExp:e})},value:function(){}}})(wysihtml5);
(function(b){function c(c,f,g){var i=c+":"+f;if(!d[i]){var h=d,k=b.selection.HTMLApplier,j=a[c],c=j?[c.toLowerCase(),j.toLowerCase()]:[c.toLowerCase()];h[i]=new k(c,f,g,!0)}return d[i]}var a={strong:"b",em:"i",b:"strong",i:"em"},d={};b.commands.formatInline={exec:function(a,b,d,i,h){b=a.selection.getRange();if(!b)return!1;c(d,i,h).toggleRange(b);a.selection.setSelection(b)},state:function(d,f,g,i,h){var f=d.doc,k=a[g]||g;if(!b.dom.hasElementWithTagName(f,g)&&!b.dom.hasElementWithTagName(f,k)||i&&
!b.dom.hasElementWithClassName(f,i))return!1;d=d.selection.getRange();return!d?!1:c(g,i,h).isAppliedToRange(d)},value:function(){}}})(wysihtml5);(function(b){b.commands.insertHTML={exec:function(b,a,d){b.commands.support(a)?b.doc.execCommand(a,!1,d):b.selection.insertHTML(d)},state:function(){return!1},value:function(){}}})(wysihtml5);
(function(b){b.commands.insertImage={exec:function(c,a,d){var d="object"===typeof d?d:{src:d},e=c.doc,a=this.state(c),f;if(a)c.selection.setBefore(a),d=a.parentNode,d.removeChild(a),b.dom.removeEmptyTextNodes(d),"A"===d.nodeName&&!d.firstChild&&(c.selection.setAfter(d),d.parentNode.removeChild(d)),b.quirks.redraw(c.element);else{a=e.createElement("IMG");for(f in d)a[f]=d[f];c.selection.insertNode(a);b.browser.hasProblemsSettingCaretAfterImg()?(d=e.createTextNode(b.INVISIBLE_SPACE),c.selection.insertNode(d),
c.selection.setAfter(d)):c.selection.setAfter(a)}},state:function(c){var a;if(!b.dom.hasElementWithTagName(c.doc,"IMG"))return!1;a=c.selection.getSelectedNode();if(!a)return!1;if("IMG"===a.nodeName)return a;if(a.nodeType!==b.ELEMENT_NODE)return!1;a=c.selection.getText();if(a=b.lang.string(a).trim())return!1;c=c.selection.getNodes(b.ELEMENT_NODE,function(a){return"IMG"===a.nodeName});return 1!==c.length?!1:c[0]},value:function(b){return(b=this.state(b))&&b.src}}})(wysihtml5);
(function(b){var c="<br>"+(b.browser.needsSpaceAfterLineBreak()?" ":"");b.commands.insertLineBreak={exec:function(a,d){a.commands.support(d)?(a.doc.execCommand(d,!1,null),b.browser.autoScrollsToCaret()||a.selection.scrollIntoView()):a.commands.exec("insertHTML",c)},state:function(){return!1},value:function(){}}})(wysihtml5);
(function(b){b.commands.insertOrderedList={exec:function(c,a){var d=c.doc,e=c.selection.getSelectedNode(),f=b.dom.getParentElement(e,{nodeName:"OL"}),g=b.dom.getParentElement(e,{nodeName:"UL"}),e="_wysihtml5-temp-"+(new Date).getTime(),i;c.commands.support(a)?d.execCommand(a,!1,null):f?c.selection.executeAndRestoreSimple(function(){b.dom.resolveList(f)}):g?c.selection.executeAndRestoreSimple(function(){b.dom.renameElement(g,"ol")}):(c.commands.exec("formatBlock","div",e),i=d.querySelector("."+e),
d=""===i.innerHTML||i.innerHTML===b.INVISIBLE_SPACE,c.selection.executeAndRestoreSimple(function(){f=b.dom.convertToList(i,"ol")}),d&&c.selection.selectNode(f.querySelector("li")))},state:function(c){c=c.selection.getSelectedNode();return b.dom.getParentElement(c,{nodeName:"OL"})},value:function(){}}})(wysihtml5);
(function(b){b.commands.insertUnorderedList={exec:function(c,a){var d=c.doc,e=c.selection.getSelectedNode(),f=b.dom.getParentElement(e,{nodeName:"UL"}),g=b.dom.getParentElement(e,{nodeName:"OL"}),e="_wysihtml5-temp-"+(new Date).getTime(),i;c.commands.support(a)?d.execCommand(a,!1,null):f?c.selection.executeAndRestoreSimple(function(){b.dom.resolveList(f)}):g?c.selection.executeAndRestoreSimple(function(){b.dom.renameElement(g,"ul")}):(c.commands.exec("formatBlock","div",e),i=d.querySelector("."+e),
d=""===i.innerHTML||i.innerHTML===b.INVISIBLE_SPACE,c.selection.executeAndRestoreSimple(function(){f=b.dom.convertToList(i,"ul")}),d&&c.selection.selectNode(f.querySelector("li")))},state:function(c){c=c.selection.getSelectedNode();return b.dom.getParentElement(c,{nodeName:"UL"})},value:function(){}}})(wysihtml5);(function(b){b.commands.italic={exec:function(c,a){return b.commands.formatInline.exec(c,a,"i")},state:function(c,a){return b.commands.formatInline.state(c,a,"i")},value:function(){}}})(wysihtml5);
(function(b){var c=/wysiwyg-text-align-[a-z]+/g;b.commands.justifyCenter={exec:function(a){return b.commands.formatBlock.exec(a,"formatBlock",null,"wysiwyg-text-align-center",c)},state:function(a){return b.commands.formatBlock.state(a,"formatBlock",null,"wysiwyg-text-align-center",c)},value:function(){}}})(wysihtml5);
(function(b){var c=/wysiwyg-text-align-[a-z]+/g;b.commands.justifyLeft={exec:function(a){return b.commands.formatBlock.exec(a,"formatBlock",null,"wysiwyg-text-align-left",c)},state:function(a){return b.commands.formatBlock.state(a,"formatBlock",null,"wysiwyg-text-align-left",c)},value:function(){}}})(wysihtml5);
(function(b){var c=/wysiwyg-text-align-[a-z]+/g;b.commands.justifyRight={exec:function(a){return b.commands.formatBlock.exec(a,"formatBlock",null,"wysiwyg-text-align-right",c)},state:function(a){return b.commands.formatBlock.state(a,"formatBlock",null,"wysiwyg-text-align-right",c)},value:function(){}}})(wysihtml5);(function(b){b.commands.underline={exec:function(c,a){return b.commands.formatInline.exec(c,a,"u")},state:function(c,a){return b.commands.formatInline.state(c,a,"u")},value:function(){}}})(wysihtml5);
(function(b){var c='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+b.INVISIBLE_SPACE+"</span>",a='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+b.INVISIBLE_SPACE+"</span>",d=b.dom;b.UndoManager=b.lang.Dispatcher.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.element=this.composer.element;this.history=[this.composer.getValue()];this.position=1;this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var e=this,f=this.composer.sandbox.getDocument(),
g;d.observe(this.element,"keydown",function(a){if(!(a.altKey||!a.ctrlKey&&!a.metaKey)){var b=a.keyCode,c=90===b&&a.shiftKey||89===b;90===b&&!a.shiftKey?(e.undo(),a.preventDefault()):c&&(e.redo(),a.preventDefault())}});d.observe(this.element,"keydown",function(a){a=a.keyCode;a!==g&&(g=a,(8===a||46===a)&&e.transact())});if(b.browser.hasUndoInContextMenu()){var i,h,k=function(){for(var a;a=f.querySelector("._wysihtml5-temp");)a.parentNode.removeChild(a);clearInterval(i)};d.observe(this.element,"contextmenu",
function(){k();e.composer.selection.executeAndRestoreSimple(function(){e.element.lastChild&&e.composer.selection.setAfter(e.element.lastChild);f.execCommand("insertHTML",!1,c);f.execCommand("insertHTML",!1,a);f.execCommand("undo",!1,null)});i=setInterval(function(){f.getElementById("_wysihtml5-redo")?(k(),e.redo()):f.getElementById("_wysihtml5-undo")||(k(),e.undo())},400);h||(h=!0,d.observe(document,"mousedown",k),d.observe(f,["mousedown","paste","cut","copy"],k))})}this.editor.observe("newword:composer",
function(){e.transact()}).observe("beforecommand:composer",function(){e.transact()})},transact:function(){var a=this.history[this.position-1],b=this.composer.getValue();if(b!=a){if(40<(this.history.length=this.position))this.history.shift(),this.position--;this.position++;this.history.push(b)}},undo:function(){this.transact();1>=this.position||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-
1]),this.editor.fire("redo:composer"))},set:function(a){this.composer.setValue(a);this.editor.focus(!0)}})})(wysihtml5);
wysihtml5.views.View=Base.extend({constructor:function(b,c,a){this.parent=b;this.element=c;this.config=a;this._observeViewChange()},_observeViewChange:function(){var b=this;this.parent.observe("beforeload",function(){b.parent.observe("change_view",function(c){c===b.name?(b.parent.currentView=b,b.show(),setTimeout(function(){b.focus()},0)):b.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(b){}},hide:function(){this.element.style.display=
"none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});
(function(b){var c=b.dom,a=b.browser;b.views.Composer=b.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(a,b,c){this.base(a,b,c);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=a.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(a){var c=this.isEmpty()?"":b.quirks.getCorrectInnerHTML(this.element);a&&(c=this.parent.parse(c));return c=b.lang.string(c).replace(b.INVISIBLE_SPACE).by("")},setValue:function(a,
b){b&&(a=this.parent.parse(a));this.element.innerHTML=a},show:function(){this.iframe.style.display=this._displayStyle||"";this.disable();this.enable()},hide:function(){this._displayStyle=c.getStyle("display").from(this.iframe);"none"===this._displayStyle&&(this._displayStyle=null);this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable");this.base()},enable:function(){this.element.setAttribute("contentEditable","true");this.base()},focus:function(a){b.browser.doesAsyncFocus()&&
this.hasPlaceholderSet()&&this.clear();this.base();var c=this.element.lastChild;a&&c&&("BR"===c.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return c.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var a=this.element.innerHTML;return""===a||a===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&
!this.element.querySelector("blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea")},_initSandbox:function(){var a=this;this.sandbox=new c.Sandbox(function(){a._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();var b=document.createElement("input");b.type="hidden";b.name="_wysihtml5_mode";b.value=1;var f=this.textarea.element;c.insert(this.iframe).after(f);c.insert(b).after(f)},_create:function(){var d=this;this.doc=
this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(!0);this.enable();this.selection=new b.Selection(this.parent);this.commands=new b.Commands(this.parent);c.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element);c.addClass(this.element,this.config.composerClassName);this.config.style&&this.style();this.observe();var e=this.config.name;e&&(c.addClass(this.element,
e),c.addClass(this.iframe,e));(e="string"===typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&c.simulatePlaceholder(this.parent,this,e);this.commands.exec("styleWithCSS",!1);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){d.focus()},100);b.quirks.insertLineBreakOnReturn(this);a.clearsContentEditableCorrectly()||
b.quirks.ensureProperClearing(this);a.clearsListsInContentEditableCorrectly()||b.quirks.ensureProperClearingOfLists(this);this.initSync&&this.config.sync&&this.initSync();this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var d=this,e=a.canDisableAutoLinking(),f=a.doesAutoLinkingInContentEditable();e&&this.commands.exec("autoUrlDetect",!1);if(this.config.autoLink){(!f||f&&e)&&this.parent.observe("newword:composer",function(){d.selection.executeAndRestore(function(a,
b){c.autoLink(b.parentNode)})});var g=this.sandbox.getDocument().getElementsByTagName("a"),i=c.autoLink.URL_REG_EXP,h=function(a){a=b.lang.string(c.getTextContent(a)).trim();"www."===a.substr(0,4)&&(a="http://"+a);return a};c.observe(this.element,"keydown",function(a){if(g.length){var a=d.selection.getSelectedNode(a.target.ownerDocument),b=c.getParentElement(a,{nodeName:"A"},4),e;b&&(e=h(b),setTimeout(function(){var a=h(b);a!==e&&a.match(i)&&b.setAttribute("href",a)},0))}})}},_initObjectResizing:function(){var d=
["width","height"],e=d.length,f=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing);this.config.allowObjectResizing?a.supportsEvent("resizeend")&&c.observe(f,"resizeend",function(a){for(var a=a.target||a.srcElement,c=a.style,h=0,k;h<e;h++)k=d[h],c[k]&&(a.setAttribute(k,parseInt(c[k],10)),c[k]="");b.quirks.redraw(f)}):a.supportsEvent("resizestart")&&c.observe(f,"resizestart",function(a){a.preventDefault()})},_initUndoManager:function(){new b.UndoManager(this.parent)}})})(wysihtml5);
(function(b){var c=b.dom,a=document,d=window,e=a.createElement("div"),f="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),g="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),
i="width height top left right bottom".split(" "),h=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",b.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],
k=function(b){if(b.setActive)try{b.setActive()}catch(e){}else{var f=b.style,h=a.documentElement.scrollTop||a.body.scrollTop,g=a.documentElement.scrollLeft||a.body.scrollLeft,f={position:f.position,top:f.top,left:f.left,WebkitUserSelect:f.WebkitUserSelect};c.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(b);b.focus();c.setStyles(f).on(b);d.scrollTo&&d.scrollTo(g,h)}};b.views.Composer.prototype.style=function(){var j=this,n=a.querySelector(":focus"),p=this.textarea.element,
q=p.hasAttribute("placeholder"),r=q&&p.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||e.cloneNode(!1);this.blurStylesHost=this.blurStylesHost||e.cloneNode(!1);q&&p.removeAttribute("placeholder");p===n&&p.blur();c.copyStyles(g).from(p).to(this.iframe).andTo(this.blurStylesHost);c.copyStyles(f).from(p).to(this.element).andTo(this.blurStylesHost);c.insertCSS(h).into(this.element.ownerDocument);k(p);c.copyStyles(g).from(p).to(this.focusStylesHost);c.copyStyles(f).from(p).to(this.focusStylesHost);
var m=b.lang.array(g).without(["display"]);n?n.focus():p.blur();q&&p.setAttribute("placeholder",r);if(!b.browser.hasCurrentStyleProperty())var s=c.observe(d,"resize",function(){if(c.contains(document.documentElement,j.iframe)){var a=c.getStyle("display").from(p),b=c.getStyle("display").from(j.iframe);p.style.display="";j.iframe.style.display="none";c.copyStyles(i).from(p).to(j.iframe).andTo(j.focusStylesHost).andTo(j.blurStylesHost);j.iframe.style.display=b;p.style.display=a}else s.stop()});this.parent.observe("focus:composer",
function(){c.copyStyles(m).from(j.focusStylesHost).to(j.iframe);c.copyStyles(f).from(j.focusStylesHost).to(j.element)});this.parent.observe("blur:composer",function(){c.copyStyles(m).from(j.blurStylesHost).to(j.iframe);c.copyStyles(f).from(j.blurStylesHost).to(j.element)});return this}})(wysihtml5);
(function(b){var c=b.dom,a=b.browser,d={66:"bold",73:"italic",85:"underline"};b.views.Composer.prototype.observe=function(){var e=this,f=this.getValue(),g=this.sandbox.getIframe(),i=this.element,h=a.supportsEventsInIframeCorrectly()?i:this.sandbox.getWindow(),k=a.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];c.observe(g,"DOMNodeRemoved",function(){clearInterval(j);e.parent.fire("destroy:composer")});var j=setInterval(function(){c.contains(document.documentElement,g)||(clearInterval(j),
e.parent.fire("destroy:composer"))},250);c.observe(h,"focus",function(){e.parent.fire("focus").fire("focus:composer");setTimeout(function(){f=e.getValue()},0)});c.observe(h,"blur",function(){f!==e.getValue()&&e.parent.fire("change").fire("change:composer");e.parent.fire("blur").fire("blur:composer")});b.browser.isIos()&&c.observe(i,"blur",function(){var a=i.ownerDocument.createElement("input"),b=document.documentElement.scrollTop||document.body.scrollTop,c=document.documentElement.scrollLeft||document.body.scrollLeft;
try{e.selection.insertNode(a)}catch(d){i.appendChild(a)}a.focus();a.parentNode.removeChild(a);window.scrollTo(c,b)});c.observe(i,"dragenter",function(){e.parent.fire("unset_placeholder")});a.firesOnDropOnlyWhenOnDragOverIsCancelled()&&c.observe(i,["dragover","dragenter"],function(a){a.preventDefault()});c.observe(i,k,function(b){var c=b.dataTransfer,d;c&&a.supportsDataTransfer()&&(d=c.getData("text/html")||c.getData("text/plain"));d?(i.focus(),e.commands.exec("insertHTML",d),e.parent.fire("paste").fire("paste:composer"),
b.stopPropagation(),b.preventDefault()):setTimeout(function(){e.parent.fire("paste").fire("paste:composer")},0)});c.observe(i,"keyup",function(a){a=a.keyCode;(a===b.SPACE_KEY||a===b.ENTER_KEY)&&e.parent.fire("newword:composer")});this.parent.observe("paste:composer",function(){setTimeout(function(){e.parent.fire("newword:composer")},0)});a.canSelectImagesInContentEditable()||c.observe(i,"mousedown",function(a){var b=a.target;"IMG"===b.nodeName&&(e.selection.selectNode(b),a.preventDefault())});c.observe(i,
"keydown",function(a){var b=d[a.keyCode];if((a.ctrlKey||a.metaKey)&&!a.altKey&&b)e.commands.exec(b),a.preventDefault()});c.observe(i,"keydown",function(a){var c=e.selection.getSelectedNode(!0),d=a.keyCode;if(c&&"IMG"===c.nodeName&&(d===b.BACKSPACE_KEY||d===b.DELETE_KEY))d=c.parentNode,d.removeChild(c),"A"===d.nodeName&&!d.firstChild&&d.parentNode.removeChild(d),setTimeout(function(){b.quirks.redraw(i)},0),a.preventDefault()});var n={IMG:"Image: ",A:"Link: "};c.observe(i,"mouseover",function(a){var a=
a.target,b=a.nodeName;!("A"!==b&&"IMG"!==b)&&!a.hasAttribute("title")&&(b=n[b]+(a.getAttribute("href")||a.getAttribute("src")),a.setAttribute("title",b))})}})(wysihtml5);
(function(b){b.views.Synchronizer=Base.extend({constructor:function(b,a,d){this.editor=b;this.textarea=a;this.composer=d;this._observe()},fromComposerToTextarea:function(c){this.textarea.setValue(b.lang.string(this.composer.getValue()).trim(),c)},fromTextareaToComposer:function(b){var a=this.textarea.getValue();a?this.composer.setValue(a,b):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(b){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(b):this.fromComposerToTextarea(b)},
_observe:function(){var c,a=this,d=this.textarea.element.form,e=function(){c=setInterval(function(){a.fromComposerToTextarea()},400)},f=function(){clearInterval(c);c=null};e();d&&(b.dom.observe(d,"submit",function(){a.sync(!0)}),b.dom.observe(d,"reset",function(){setTimeout(function(){a.fromTextareaToComposer()},0)}));this.editor.observe("change_view",function(b){if(b==="composer"&&!c){a.fromTextareaToComposer(true);e()}else if(b==="textarea"){a.fromComposerToTextarea(true);f()}});this.editor.observe("destroy:composer",
f)}})})(wysihtml5);
wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(b,c,a){this.base(b,c,a);this._observe()},clear:function(){this.element.value=""},getValue:function(b){var c=this.isEmpty()?"":this.element.value;b&&(c=this.parent.parse(c));return c},setValue:function(b,c){c&&(b=this.parent.parse(b));this.element.value=b},hasPlaceholderSet:function(){var b=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),c=this.element.getAttribute("placeholder")||null,a=this.element.value;
return b&&!a||a===c},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var b=this.element,c=this.parent,a={focusin:"focus",focusout:"blur"},d=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];c.observe("beforeload",function(){wysihtml5.dom.observe(b,d,function(b){b=a[b.type]||b.type;c.fire(b).fire(b+":textarea")});wysihtml5.dom.observe(b,["paste","drop"],function(){setTimeout(function(){c.fire("paste").fire("paste:textarea")},
0)})})}});
(function(b){var c=b.dom;b.toolbar.Dialog=b.lang.Dispatcher.extend({constructor:function(a,b){this.link=a;this.container=b},_observe:function(){if(!this._observed){var a=this,d=function(b){var c=a._serialize();c==a.elementToChange?a.fire("edit",c):a.fire("save",c);a.hide();b.preventDefault();b.stopPropagation()};c.observe(a.link,"click",function(){c.hasClass(a.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){a.hide()},0)});c.observe(this.container,"keydown",function(c){var e=c.keyCode;
e===b.ENTER_KEY&&d(c);e===b.ESCAPE_KEY&&a.hide()});c.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",d);c.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(b){a.fire("cancel");a.hide();b.preventDefault();b.stopPropagation()});for(var e=this.container.querySelectorAll("input, select, textarea"),f=0,g=e.length,i=function(){clearInterval(a.interval)};f<g;f++)c.observe(e[f],"change",i);this._observed=!0}},_serialize:function(){for(var a=this.elementToChange||
{},b=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),c=b.length,f=0;f<c;f++)a[b[f].getAttribute("data-wysihtml5-dialog-field")]=b[f].value;return a},_interpolate:function(a){for(var b,c,f=document.querySelector(":focus"),g=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),i=g.length,h=0;h<i;h++)b=g[h],b!==f&&!(a&&"hidden"===b.type)&&(c=b.getAttribute("data-wysihtml5-dialog-field"),c=this.elementToChange?this.elementToChange[c]||"":b.defaultValue,b.value=c)},show:function(a){var b=
this,e=this.container.querySelector("input, select, textarea");this.elementToChange=a;this._observe();this._interpolate();a&&(this.interval=setInterval(function(){b._interpolate(!0)},500));c.addClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="";this.fire("show");if(e&&!a)try{e.focus()}catch(f){}},hide:function(){clearInterval(this.interval);this.elementToChange=null;c.removeClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="none";this.fire("hide")}})})(wysihtml5);
(function(b){var c=b.dom,a={position:"relative"},d={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},e={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},f={"x-webkit-speech":"",speech:""};b.toolbar.Speech=function(g,i){var h=document.createElement("input");if(b.browser.supportsSpeechApiOn(h)){var k=document.createElement("div");b.lang.object(d).merge({width:i.offsetWidth+"px",height:i.offsetHeight+
"px"});c.insert(h).into(k);c.insert(k).into(i);c.setStyles(e).on(h);c.setAttributes(f).on(h);c.setStyles(d).on(k);c.setStyles(a).on(i);c.observe(h,"onwebkitspeechchange"in h?"webkitspeechchange":"speechchange",function(){g.execCommand("insertText",h.value);h.value=""});c.observe(h,"click",function(a){c.hasClass(i,"wysihtml5-command-disabled")&&a.preventDefault();a.stopPropagation()})}else i.style.display="none"}})(wysihtml5);
(function(b){var c=b.dom;b.toolbar.Toolbar=Base.extend({constructor:function(a,c){this.editor=a;this.container="string"===typeof c?document.getElementById(c):c;this.composer=a.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();for(var e=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),f=e.length,g=0;g<f;g++)new b.toolbar.Speech(this,e[g])},_getLinks:function(a){for(var c=this[a+"Links"]=b.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+
a+"]")).get(),e=c.length,f=0,g=this[a+"Mapping"]={},i,h,k,j,n;f<e;f++)i=c[f],k=i.getAttribute("data-wysihtml5-"+a),j=i.getAttribute("data-wysihtml5-"+a+"-value"),h=this.container.querySelector("[data-wysihtml5-"+a+"-group='"+k+"']"),n=this._getDialog(i,k),g[k+":"+j]={link:i,group:h,name:k,value:j,dialog:n,state:!1}},_getDialog:function(a,c){var e=this,f=this.container.querySelector("[data-wysihtml5-dialog='"+c+"']"),g,i;f&&(g=new b.toolbar.Dialog(a,f),g.observe("show",function(){i=e.composer.selection.getBookmark();
e.editor.fire("show:dialog",{command:c,dialogContainer:f,commandLink:a})}),g.observe("save",function(b){i&&e.composer.selection.setBookmark(i);e._execCommand(c,b);e.editor.fire("save:dialog",{command:c,dialogContainer:f,commandLink:a})}),g.observe("cancel",function(){e.editor.focus(!1);e.editor.fire("cancel:dialog",{command:c,dialogContainer:f,commandLink:a})}));return g},execCommand:function(a,b){if(!this.commandsDisabled){var c=this.commandMapping[a+":"+b];c&&c.dialog&&!c.state?c.dialog.show():
this._execCommand(a,b)}},_execCommand:function(a,b){this.editor.focus(!1);this.composer.commands.exec(a,b);this._updateLinkStates()},execAction:function(a){var b=this.editor;switch(a){case "change_view":b.currentView===b.textarea?b.fire("change_view","composer"):b.fire("change_view","textarea")}},_observe:function(){for(var a=this,b=this.editor,e=this.container,f=this.commandLinks.concat(this.actionLinks),g=f.length,i=0;i<g;i++)c.setAttributes({href:"javascript:;",unselectable:"on"}).on(f[i]);c.delegate(e,
"[data-wysihtml5-command]","mousedown",function(a){a.preventDefault()});c.delegate(e,"[data-wysihtml5-command]","click",function(b){var c=this.getAttribute("data-wysihtml5-command"),d=this.getAttribute("data-wysihtml5-command-value");a.execCommand(c,d);b.preventDefault()});c.delegate(e,"[data-wysihtml5-action]","click",function(b){var c=this.getAttribute("data-wysihtml5-action");a.execAction(c);b.preventDefault()});b.observe("focus:composer",function(){a.bookmark=null;clearInterval(a.interval);a.interval=
setInterval(function(){a._updateLinkStates()},500)});b.observe("blur:composer",function(){clearInterval(a.interval)});b.observe("destroy:composer",function(){clearInterval(a.interval)});b.observe("change_view",function(b){setTimeout(function(){a.commandsDisabled="composer"!==b;a._updateLinkStates();a.commandsDisabled?c.addClass(e,"wysihtml5-commands-disabled"):c.removeClass(e,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var a=this.commandMapping,d=this.actionMapping,e,f,g;for(e in a)if(g=
a[e],this.commandsDisabled?(f=!1,c.removeClass(g.link,"wysihtml5-command-active"),g.group&&c.removeClass(g.group,"wysihtml5-command-active"),g.dialog&&g.dialog.hide()):(f=this.composer.commands.state(g.name,g.value),b.lang.object(f).isArray()&&(f=1===f.length?f[0]:!0),c.removeClass(g.link,"wysihtml5-command-disabled"),g.group&&c.removeClass(g.group,"wysihtml5-command-disabled")),g.state!==f)(g.state=f)?(c.addClass(g.link,"wysihtml5-command-active"),g.group&&c.addClass(g.group,"wysihtml5-command-active"),
g.dialog&&("object"===typeof f?g.dialog.show(f):g.dialog.hide())):(c.removeClass(g.link,"wysihtml5-command-active"),g.group&&c.removeClass(g.group,"wysihtml5-command-active"),g.dialog&&g.dialog.hide());for(e in d)a=d[e],"change_view"===a.name&&(a.state=this.editor.currentView===this.editor.textarea,a.state?c.addClass(a.link,"wysihtml5-action-active"):c.removeClass(a.link,"wysihtml5-action-active"))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);
(function(b){var c={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:b.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:void 0,allowObjectResizing:!0,supportTouchDevices:!0};b.Editor=b.lang.Dispatcher.extend({constructor:function(a,d){this.textareaElement="string"===typeof a?document.getElementById(a):a;this.config=b.lang.object({}).merge(c).merge(d).get();this.currentView=
this.textarea=new b.views.Textarea(this,this.textareaElement,this.config);this._isCompatible=b.browser.supported();if(!this._isCompatible||!this.config.supportTouchDevices&&b.browser.isTouchDevice()){var e=this;setTimeout(function(){e.fire("beforeload").fire("load")},0)}else{b.dom.addClass(document.body,this.config.bodyClassName);this.currentView=this.composer=new b.views.Composer(this,this.textareaElement,this.config);"function"===typeof this.config.parser&&this._initParser();this.observe("beforeload",
function(){this.synchronizer=new b.views.Synchronizer(this,this.textarea,this.composer);this.config.toolbar&&(this.toolbar=new b.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(f){}}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(a){return this.currentView.getValue(a)},setValue:function(a,b){if(!a)return this.clear();
this.currentView.setValue(a,b);return this},focus:function(a){this.currentView.focus(a);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(a){var c=this.config.parser(a,this.config.parserRules,this.composer.sandbox.getDocument(),!0);"object"===typeof a&&b.quirks.redraw(a);return c},
_initParser:function(){this.observe("paste:composer",function(){var a=this;a.composer.selection.executeAndRestore(function(){b.quirks.cleanPastedHTML(a.composer.element);a.parse(a.composer.element)},!0)});this.observe("paste:textarea",function(){this.textarea.setValue(this.parse(this.textarea.getValue()))})}})})(wysihtml5);


/*! NProgress (c) 2013, Rico Sta. Cruz
 *  http://ricostacruz.com/nprogress */

;(function(factory) {

  if (typeof module === 'function') {
    module.exports = factory(this.jQuery || require('jquery'));
  } else if (typeof define === 'function' && define.amd) {
    define(['jquery'], function($) {
      return factory($);
    });
  } else {
    this.NProgress = factory(this.jQuery);
  }

})(function($) {
  var NProgress = {};

  NProgress.version = '0.1.2';

  var Settings = NProgress.settings = {
    minimum: 0.08,
    easing: 'ease',
    positionUsing: '',
    speed: 200,
    trickle: true,
    trickleRate: 0.02,
    trickleSpeed: 800,
    showSpinner: true,
    template: '<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'
  };

  /**
   * Updates configuration.
   *
   *     NProgress.configure({
   *       minimum: 0.1
   *     });
   */
  NProgress.configure = function(options) {
    $.extend(Settings, options);
    return this;
  };

  /**
   * Last number.
   */

  NProgress.status = null;

  /**
   * Sets the progress bar status, where `n` is a number from `0.0` to `1.0`.
   *
   *     NProgress.set(0.4);
   *     NProgress.set(1.0);
   */

  NProgress.set = function(n) {
    var started = NProgress.isStarted();

    n = clamp(n, Settings.minimum, 1);
    NProgress.status = (n === 1 ? null : n);

    var $progress = NProgress.render(!started),
        $bar      = $progress.find('[role="bar"]'),
        speed     = Settings.speed,
        ease      = Settings.easing;

    $progress[0].offsetWidth; /* Repaint */

    $progress.queue(function(next) {
      // Set positionUsing if it hasn't already been set
      if (Settings.positionUsing === '') Settings.positionUsing = NProgress.getPositioningCSS();

      // Add transition
      $bar.css(barPositionCSS(n, speed, ease));

      if (n === 1) {
        // Fade out
        $progress.css({ transition: 'none', opacity: 1 });
        $progress[0].offsetWidth; /* Repaint */

        setTimeout(function() {
          $progress.css({ transition: 'all '+speed+'ms linear', opacity: 0 });
          setTimeout(function() {
            NProgress.remove();
            next();
          }, speed);
        }, speed);
      } else {
        setTimeout(next, speed);
      }
    });

    return this;
  };

  NProgress.isStarted = function() {
    return typeof NProgress.status === 'number';
  };

  /**
   * Shows the progress bar.
   * This is the same as setting the status to 0%, except that it doesn't go backwards.
   *
   *     NProgress.start();
   *
   */
  NProgress.start = function() {
    if (!NProgress.status) NProgress.set(0);

    var work = function() {
      setTimeout(function() {
        if (!NProgress.status) return;
        NProgress.trickle();
        work();
      }, Settings.trickleSpeed);
    };

    if (Settings.trickle) work();

    return this;
  };

  /**
   * Hides the progress bar.
   * This is the *sort of* the same as setting the status to 100%, with the
   * difference being `done()` makes some placebo effect of some realistic motion.
   *
   *     NProgress.done();
   *
   * If `true` is passed, it will show the progress bar even if its hidden.
   *
   *     NProgress.done(true);
   */

  NProgress.done = function(force) {
    if (!force && !NProgress.status) return this;

    return NProgress.inc(0.3 + 0.5 * Math.random()).set(1);
  };

  /**
   * Increments by a random amount.
   */

  NProgress.inc = function(amount) {
    var n = NProgress.status;

    if (!n) {
      return NProgress.start();
    } else {
      if (typeof amount !== 'number') {
        amount = (1 - n) * clamp(Math.random() * n, 0.1, 0.95);
      }

      n = clamp(n + amount, 0, 0.994);
      return NProgress.set(n);
    }
  };

  NProgress.trickle = function() {
    return NProgress.inc(Math.random() * Settings.trickleRate);
  };

  /**
   * Waits for all supplied jQuery promises and
   * increases the progress as the promises resolve.
   * 
   * @param $promise jQUery Promise
   */
  (function() {
    var initial = 0, current = 0;
    
    NProgress.promise = function($promise) {
      if (!$promise || $promise.state() == "resolved") {
        return this;
      }
      
      if (current == 0) {
        NProgress.start();
      }
      
      initial++;
      current++;
      
      $promise.always(function() {
        current--;
        if (current == 0) {
            initial = 0;
            NProgress.done();
        } else {
            NProgress.set((initial - current) / initial);
        }
      });
      
      return this;
    };
    
  })();

  /**
   * (Internal) renders the progress bar markup based on the `template`
   * setting.
   */

  NProgress.render = function(fromStart) {
    if (NProgress.isRendered()) return $("#nprogress");
    $('html').addClass('nprogress-busy');

    var $el = $("<div id='nprogress'>")
      .html(Settings.template);

    var perc = fromStart ? '-100' : toBarPerc(NProgress.status || 0);

    $el.find('[role="bar"]').css({
      transition: 'all 0 linear',
      transform: 'translate3d('+perc+'%,0,0)'
    });

    if (!Settings.showSpinner)
      $el.find('[role="spinner"]').remove();

    $el.appendTo(document.body);

    return $el;
  };

  /**
   * Removes the element. Opposite of render().
   */

  NProgress.remove = function() {
    $('html').removeClass('nprogress-busy');
    $('#nprogress').remove();
  };

  /**
   * Checks if the progress bar is rendered.
   */

  NProgress.isRendered = function() {
    return ($("#nprogress").length > 0);
  };

  /**
   * Determine which positioning CSS rule to use.
   */

  NProgress.getPositioningCSS = function() {
    // Sniff on document.body.style
    var bodyStyle = document.body.style;

    // Sniff prefixes
    var vendorPrefix = ('WebkitTransform' in bodyStyle) ? 'Webkit' :
                       ('MozTransform' in bodyStyle) ? 'Moz' :
                       ('msTransform' in bodyStyle) ? 'ms' :
                       ('OTransform' in bodyStyle) ? 'O' : '';

    if (vendorPrefix + 'Perspective' in bodyStyle) {
      // Modern browsers with 3D support, e.g. Webkit, IE10
      return 'translate3d';
    } else if (vendorPrefix + 'Transform' in bodyStyle) {
      // Browsers without 3D support, e.g. IE9
      return 'translate';
    } else {
      // Browsers without translate() support, e.g. IE7-8
      return 'margin';
    }
  };

  /**
   * Helpers
   */

  function clamp(n, min, max) {
    if (n < min) return min;
    if (n > max) return max;
    return n;
  }

  /**
   * (Internal) converts a percentage (`0..1`) to a bar translateX
   * percentage (`-100%..0%`).
   */

  function toBarPerc(n) {
    return (-1 + n) * 100;
  }


  /**
   * (Internal) returns the correct CSS for changing the bar's
   * position given an n percentage, and speed and ease from Settings
   */

  function barPositionCSS(n, speed, ease) {
    var barCSS;

    if (Settings.positionUsing === 'translate3d') {
      barCSS = { transform: 'translate3d('+toBarPerc(n)+'%,0,0)' };
    } else if (Settings.positionUsing === 'translate') {
      barCSS = { transform: 'translate('+toBarPerc(n)+'%,0)' };
    } else {
      barCSS = { 'margin-left': toBarPerc(n)+'%' };
    }

    barCSS.transition = 'all '+speed+'ms '+ease;

    return barCSS;
  }

  return NProgress;
});



(function(e){var t=function(){return!1===e.support.boxModel&&e.support.objectAll&&e.support.leadingWhitespace}();e.jGrowl=function(t,i){0==e("#jGrowl").size()&&e('<div id="jGrowl"></div>').addClass(i&&i.position?i.position:e.jGrowl.defaults.position).appendTo("body"),e("#jGrowl").jGrowl(t,i)},e.fn.jGrowl=function(t,i){if(e.isFunction(this.each)){var o=arguments;return this.each(function(){void 0==e(this).data("jGrowl.instance")&&(e(this).data("jGrowl.instance",e.extend(new e.fn.jGrowl,{notifications:[],element:null,interval:null})),e(this).data("jGrowl.instance").startup(this)),e.isFunction(e(this).data("jGrowl.instance")[t])?e(this).data("jGrowl.instance")[t].apply(e(this).data("jGrowl.instance"),e.makeArray(o).slice(1)):e(this).data("jGrowl.instance").create(t,i)})}},e.extend(e.fn.jGrowl.prototype,{defaults:{pool:0,header:"",group:"",sticky:!1,position:"top-right",glue:"after",theme:"default",themeState:"highlight",corners:"10px",check:250,life:3e3,closeDuration:"normal",openDuration:"normal",easing:"swing",closer:!0,closeTemplate:"&times;",closerTemplate:"<div>[ close all ]</div>",log:function(){},beforeOpen:function(){},afterOpen:function(){},open:function(){},beforeClose:function(){},close:function(){},animateOpen:{opacity:"show"},animateClose:{opacity:"hide"}},notifications:[],element:null,interval:null,create:function(t,i){var i=e.extend({},this.defaults,i);i.speed!==void 0&&(i.openDuration=i.speed,i.closeDuration=i.speed),this.notifications.push({message:t,options:i}),i.log.apply(this.element,[this.element,t,i])},render:function(t){var i=this,o=t.message,n=t.options;n.themeState=""==n.themeState?"":"ui-state-"+n.themeState;var t=e("<div/>").addClass("jGrowl-notification "+n.themeState+" ui-corner-all"+(void 0!=n.group&&""!=n.group?" "+n.group:"")).append(e("<div/>").addClass("jGrowl-close").html(n.closeTemplate)).append(e("<div/>").addClass("jGrowl-header").html(n.header)).append(e("<div/>").addClass("jGrowl-message").html(o)).data("jGrowl",n).addClass(n.theme).children("div.jGrowl-close").bind("click.jGrowl",function(){e(this).parent().trigger("jGrowl.beforeClose")}).parent();e(t).bind("mouseover.jGrowl",function(){e("div.jGrowl-notification",i.element).data("jGrowl.pause",!0)}).bind("mouseout.jGrowl",function(){e("div.jGrowl-notification",i.element).data("jGrowl.pause",!1)}).bind("jGrowl.beforeOpen",function(){n.beforeOpen.apply(t,[t,o,n,i.element])!==!1&&e(this).trigger("jGrowl.open")}).bind("jGrowl.open",function(){n.open.apply(t,[t,o,n,i.element])!==!1&&("after"==n.glue?e("div.jGrowl-notification:last",i.element).after(t):e("div.jGrowl-notification:first",i.element).before(t),e(this).animate(n.animateOpen,n.openDuration,n.easing,function(){e.support.opacity===!1&&this.style.removeAttribute("filter"),null!==e(this).data("jGrowl")&&(e(this).data("jGrowl").created=new Date),e(this).trigger("jGrowl.afterOpen")}))}).bind("jGrowl.afterOpen",function(){n.afterOpen.apply(t,[t,o,n,i.element])}).bind("jGrowl.beforeClose",function(){n.beforeClose.apply(t,[t,o,n,i.element])!==!1&&e(this).trigger("jGrowl.close")}).bind("jGrowl.close",function(){e(this).data("jGrowl.pause",!0),e(this).animate(n.animateClose,n.closeDuration,n.easing,function(){e.isFunction(n.close)?n.close.apply(t,[t,o,n,i.element])!==!1&&e(this).remove():e(this).remove()})}).trigger("jGrowl.beforeOpen"),""!=n.corners&&void 0!=e.fn.corner&&e(t).corner(n.corners),e("div.jGrowl-notification:parent",i.element).size()>1&&0==e("div.jGrowl-closer",i.element).size()&&this.defaults.closer!==!1&&e(this.defaults.closerTemplate).addClass("jGrowl-closer "+this.defaults.themeState+" ui-corner-all").addClass(this.defaults.theme).appendTo(i.element).animate(this.defaults.animateOpen,this.defaults.speed,this.defaults.easing).bind("click.jGrowl",function(){e(this).siblings().trigger("jGrowl.beforeClose"),e.isFunction(i.defaults.closer)&&i.defaults.closer.apply(e(this).parent()[0],[e(this).parent()[0]])})},update:function(){e(this.element).find("div.jGrowl-notification:parent").each(function(){void 0!=e(this).data("jGrowl")&&void 0!==e(this).data("jGrowl").created&&e(this).data("jGrowl").created.getTime()+parseInt(e(this).data("jGrowl").life)<(new Date).getTime()&&e(this).data("jGrowl").sticky!==!0&&(void 0==e(this).data("jGrowl.pause")||e(this).data("jGrowl.pause")!==!0)&&e(this).trigger("jGrowl.beforeClose")}),this.notifications.length>0&&(0==this.defaults.pool||e(this.element).find("div.jGrowl-notification:parent").size()<this.defaults.pool)&&this.render(this.notifications.shift()),2>e(this.element).find("div.jGrowl-notification:parent").size()&&e(this.element).find("div.jGrowl-closer").animate(this.defaults.animateClose,this.defaults.speed,this.defaults.easing,function(){e(this).remove()})},startup:function(i){this.element=e(i).addClass("jGrowl").append('<div class="jGrowl-notification"></div>'),this.interval=setInterval(function(){e(i).data("jGrowl.instance").update()},parseInt(this.defaults.check)),t&&e(this.element).addClass("ie6")},shutdown:function(){e(this.element).removeClass("jGrowl").find("div.jGrowl-notification").trigger("jGrowl.close").parent().empty()},close:function(){e(this.element).find("div.jGrowl-notification").each(function(){e(this).trigger("jGrowl.beforeClose")})}}),e.jGrowl.defaults=e.fn.jGrowl.prototype.defaults})(jQuery);
/*
//@ sourceMappingURL=jquery.jgrowl.map
*/

jQuery(document).ready(function(){
    initPopupMember();
});

/*
 * jQuery UI addresspicker @VERSION
 *
 * Copyright 2010, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Progressbar
 *
 * Depends:
 *   jquery.ui.core.js
 *   jquery.ui.widget.js
 *   jquery.ui.autocomplete.js
 */
(function( $, undefined ) {

$.widget( "ui.addresspicker", {
	options: {
	  appendAddressString: "",
		mapOptions: {
		  zoom: 12,
		  center: new google.maps.LatLng(46, 2), 
		  scrollwheel: false,
		  mapTypeId: google.maps.MapTypeId.ROADMAP
		},
		elements: {
		  map: false,
		  lat: false,
		  lng: false,
		  street_number: false,
		  route: false,
		  locality: false,
		  sublocality: false,
		  postal_code: false,
		  administrative_area_level_1: false,
		  country: false
		},
		geocoder: {},
	  draggableMarker: true
	},

	marker: function() {
		return this.gmarker;
	},
	
	map: function() {
	  return this.gmap;
	},

  updatePosition: function() {
    this._updatePosition(this.gmarker.getPosition());
  },
  
  reloadPosition: function() {
    this.gmarker.setVisible(true);
    this.gmarker.setPosition(new google.maps.LatLng(this.lat.val(), this.lng.val()));
    this.gmap.setCenter(this.gmarker.getPosition());
  },
  
  selected: function() {
    return this.selectedResult;
  },
  
	_create: function() {
	  this.geocoder = new google.maps.Geocoder();
	  this.element.autocomplete({
			source: $.proxy(this._geocode, this),  
			focus:  $.proxy(this._focusAddress, this),
			select: $.proxy(this._selectAddress, this)
		});
		
		this.lat      = $(this.options.elements.lat);
		this.lng      = $(this.options.elements.lng);
		this.street_number = $(this.options.elements.street_number);
		this.route = $(this.options.elements.route);
		this.locality = $(this.options.elements.locality);
		this.sublocality = $(this.options.elements.sublocality);
		this.postal_code = $(this.options.elements.postal_code);
		this.administrative_area_level_1 = $(this.options.elements.administrative_area_level_1);
		this.country  = $(this.options.elements.country);
		if (this.options.elements.map) {
		  this.mapElement = $(this.options.elements.map);
  		this._initMap();
		}
	},

  _initMap: function() {
    if (this.lat && this.lat.val()) {
      this.options.mapOptions.center = new google.maps.LatLng(this.lat.val(), this.lng.val());
    }

    this.gmap = new google.maps.Map(this.mapElement[0], this.options.mapOptions);
    this.gmarker = new google.maps.Marker({
      position: this.options.mapOptions.center, 
      map:this.gmap, 
      draggable: this.options.draggableMarker});
    google.maps.event.addListener(this.gmarker, 'dragend', $.proxy(this._markerMoved, this));
    this.gmarker.setVisible(false);
  },
  
  _updatePosition: function(location) {
    if (this.lat) {
      this.lat.val(location.lat());
    }
    if (this.lng) {
      this.lng.val(location.lng());
    }
  },
  
  _markerMoved: function() {
    this._updatePosition(this.gmarker.getPosition());
  },
  
  // Autocomplete source method: fill its suggests with google geocoder results
  _geocode: function(request, response) {
    var address = request.term, self = this,
        options = this.options.geocoder;
    options.address = address + this.options.appendAddressString;
    this.geocoder.geocode(options, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        for (var i = 0; i < results.length; i++) {
          results[i].label =  results[i].formatted_address;
        };
      } 
      response(results);
    });
  },
  
  _findInfo: function(result, type) {
    for (var i = 0; i < result.address_components.length; i++) {
      var component = result.address_components[i];
      if (component.types.indexOf(type) !=-1) {
        return component.long_name;
      }
    }
    return false;
  },
  
  _focusAddress: function(event, ui) {
    var address = ui.item;
    if (!address) {
      return;
    }
    
    if (this.gmarker) {
      this.gmarker.setPosition(address.geometry.location);
      this.gmarker.setVisible(true);

      this.gmap.fitBounds(address.geometry.viewport);
    }
    this._updatePosition(address.geometry.location);
    
    if (this.street_number) {
      this.street_number.val(this._findInfo(address, 'street_number'));
    }
    if (this.route) {
      this.route.val(this._findInfo(address, 'route'));
    }
    if (this.locality) {
      this.locality.val(this._findInfo(address, 'locality'));
    }
    if (this.sublocality) {
      this.sublocality.val(this._findInfo(address, 'sublocality'));
     }
    if (this.administrative_area_level_1) {
      this.administrative_area_level_1.val(this._findInfo(address, 'administrative_area_level_1'));
    }
    if (this.postal_code) {
      this.postal_code.val(this._findInfo(address, 'postal_code'));
    }
    if (this.country) {
      this.country.val(this._findInfo(address, 'country'));
    }
  },
  
  _selectAddress: function(event, ui) {
    this.selectedResult = ui.item;
  }
});

$.extend( $.ui.addresspicker, {
	version: "@VERSION"
});

})( jQuery );


// ==ClosureCompiler==
// @compilation_level ADVANCED_OPTIMIZATIONS
// @externs_url http://closure-compiler.googlecode.com/svn/trunk/contrib/externs/maps/google_maps_api_v3.js
// ==/ClosureCompiler==

/**
 * @name CSS3 InfoBubble with tabs for Google Maps API V3
 * @version 0.8
 * @author Luke Mahe
 * @fileoverview
 * This library is a CSS Infobubble with tabs. It uses css3 rounded corners and
 * drop shadows and animations. It also allows tabs
 */

/*
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */


/**
 * A CSS3 InfoBubble v0.8
 * @param {Object.<string, *>=} opt_options Optional properties to set.
 * @extends {google.maps.OverlayView}
 * @constructor
 */
function InfoBubble(opt_options) {
  this.extend(InfoBubble, google.maps.OverlayView);
  this.tabs_ = [];
  this.activeTab_ = null;
  this.baseZIndex_ = 100;
  this.isOpen_ = false;

  var options = opt_options || {};

  if (options['backgroundColor'] == undefined) {
    options['backgroundColor'] = this.BACKGROUND_COLOR_;
  }

  if (options['borderColor'] == undefined) {
    options['borderColor'] = this.BORDER_COLOR_;
  }

  if (options['borderRadius'] == undefined) {
    options['borderRadius'] = this.BORDER_RADIUS_;
  }

  if (options['borderWidth'] == undefined) {
    options['borderWidth'] = this.BORDER_WIDTH_;
  }

  if (options['padding'] == undefined) {
    options['padding'] = this.PADDING_;
  }

  if (options['arrowPosition'] == undefined) {
    options['arrowPosition'] = this.ARROW_POSITION_;
  }

  if (options['disableAutoPan'] == undefined) {
    options['disableAutoPan'] = false;
  }

  if (options['disableAnimation'] == undefined) {
    options['disableAnimation'] = false;
  }

  if (options['minWidth'] == undefined) {
    options['minWidth'] = this.MIN_WIDTH_;
  }

  if (options['shadowStyle'] == undefined) {
    options['shadowStyle'] = this.SHADOW_STYLE_;
  }

  if (options['arrowSize'] == undefined) {
    options['arrowSize'] = this.ARROW_SIZE_;
  }

  if (options['arrowStyle'] == undefined) {
    options['arrowStyle'] = this.ARROW_STYLE_;
  }

  this.buildDom_();

  this.setValues(options);
}
window['InfoBubble'] = InfoBubble;


/**
 * Default arrow size
 * @const
 * @private
 */
InfoBubble.prototype.ARROW_SIZE_ = 15;


/**
 * Default arrow style
 * @const
 * @private
 */
InfoBubble.prototype.ARROW_STYLE_ = 0;


/**
 * Default shadow style
 * @const
 * @private
 */
InfoBubble.prototype.SHADOW_STYLE_ = 1;


/**
 * Default min width
 * @const
 * @private
 */
InfoBubble.prototype.MIN_WIDTH_ = 50;


/**
 * Default arrow position
 * @const
 * @private
 */
InfoBubble.prototype.ARROW_POSITION_ = 50;


/**
 * Default padding
 * @const
 * @private
 */
InfoBubble.prototype.PADDING_ = 10;


/**
 * Default border width
 * @const
 * @private
 */
InfoBubble.prototype.BORDER_WIDTH_ = 1;


/**
 * Default border color
 * @const
 * @private
 */
InfoBubble.prototype.BORDER_COLOR_ = '#ccc';


/**
 * Default border radius
 * @const
 * @private
 */
InfoBubble.prototype.BORDER_RADIUS_ = 10;


/**
 * Default background color
 * @const
 * @private
 */
InfoBubble.prototype.BACKGROUND_COLOR_ = '#fff';


/**
 * Extends a objects prototype by anothers.
 *
 * @param {Object} obj1 The object to be extended.
 * @param {Object} obj2 The object to extend with.
 * @return {Object} The new extended object.
 * @ignore
 */
InfoBubble.prototype.extend = function(obj1, obj2) {
  return (function(object) {
    for (var property in object.prototype) {
      this.prototype[property] = object.prototype[property];
    }
    return this;
  }).apply(obj1, [obj2]);
};


/**
 * Builds the InfoBubble dom
 * @private
 */
InfoBubble.prototype.buildDom_ = function() {
  var bubble = this.bubble_ = document.createElement('DIV');
  bubble.style['position'] = 'absolute';
  bubble.style['zIndex'] = this.baseZIndex_;

  var tabsContainer = this.tabsContainer_ = document.createElement('DIV');
  tabsContainer.style['position'] = 'relative';

  // Close button
  var close = this.close_ = document.createElement('IMG');
  close.style['position'] = 'absolute';
  close.style['width'] = this.px(12);
  close.style['height'] = this.px(12);
  close.style['border'] = 0;
  close.style['zIndex'] = this.baseZIndex_ + 1;
  close.style['cursor'] = 'pointer';
  close.src = 'http://maps.gstatic.com/intl/en_us/mapfiles/iw_close.gif';

  var that = this;
  google.maps.event.addDomListener(close, 'click', function() {
    that.close();
    google.maps.event.trigger(that, 'closeclick');
  });

  // Content area
  var contentContainer = this.contentContainer_ = document.createElement('DIV');
  contentContainer.style['overflowX'] = 'auto';
  contentContainer.style['overflowY'] = 'auto';
  contentContainer.style['cursor'] = 'default';
  contentContainer.style['clear'] = 'both';
  contentContainer.style['position'] = 'relative';

  var content = this.content_ = document.createElement('DIV');
  contentContainer.appendChild(content);

  // Arrow
  var arrow = this.arrow_ = document.createElement('DIV');
  arrow.style['position'] = 'relative';

  var arrowOuter = this.arrowOuter_ = document.createElement('DIV');
  var arrowInner = this.arrowInner_ = document.createElement('DIV');

  var arrowSize = this.getArrowSize_();

  arrowOuter.style['position'] = arrowInner.style['position'] = 'absolute';
  arrowOuter.style['left'] = arrowInner.style['left'] = '50%';
  arrowOuter.style['height'] = arrowInner.style['height'] = '0';
  arrowOuter.style['width'] = arrowInner.style['width'] = '0';
  arrowOuter.style['marginLeft'] = this.px(-arrowSize);
  arrowOuter.style['borderWidth'] = this.px(arrowSize);
  arrowOuter.style['borderBottomWidth'] = 0;

  // Shadow
  var bubbleShadow = this.bubbleShadow_ = document.createElement('DIV');
  bubbleShadow.style['position'] = 'absolute';

  // Hide the InfoBubble by default
  bubble.style['display'] = bubbleShadow.style['display'] = 'none';

  bubble.appendChild(this.tabsContainer_);
  bubble.appendChild(close);
  bubble.appendChild(contentContainer);
  arrow.appendChild(arrowOuter);
  arrow.appendChild(arrowInner);
  bubble.appendChild(arrow);

  var stylesheet = document.createElement('style');
  stylesheet.setAttribute('type', 'text/css');

  /**
   * The animation for the infobubble
   * @type {string}
   */
  this.animationName_ = '_ibani_' + Math.round(Math.random() * 10000);

  var css = '.' + this.animationName_ + '{-webkit-animation-name:' +
      this.animationName_ + ';-webkit-animation-duration:0.5s;' +
      '-webkit-animation-iteration-count:1;}' +
      '@-webkit-keyframes ' + this.animationName_ + ' {from {' +
      '-webkit-transform: scale(0)}50% {-webkit-transform: scale(1.2)}90% ' +
      '{-webkit-transform: scale(0.95)}to {-webkit-transform: scale(1)}}';

  stylesheet.textContent = css;
  document.getElementsByTagName('head')[0].appendChild(stylesheet);
};


/**
 * Sets the background class name
 *
 * @param {string} className The class name to set.
 */
InfoBubble.prototype.setBackgroundClassName = function(className) {
  this.set('backgroundClassName', className);
};
InfoBubble.prototype['setBackgroundClassName'] =
    InfoBubble.prototype.setBackgroundClassName;


/**
 * changed MVC callback
 */
InfoBubble.prototype.backgroundClassName_changed = function() {
  this.content_.className = this.get('backgroundClassName');
};
InfoBubble.prototype['backgroundClassName_changed'] =
    InfoBubble.prototype.backgroundClassName_changed;


/**
 * Sets the class of the tab
 *
 * @param {string} className the class name to set.
 */
InfoBubble.prototype.setTabClassName = function(className) {
  this.set('tabClassName', className);
};
InfoBubble.prototype['setTabClassName'] =
    InfoBubble.prototype.setTabClassName;


/**
 * tabClassName changed MVC callback
 */
InfoBubble.prototype.tabClassName_changed = function() {
  this.updateTabStyles_();
};
InfoBubble.prototype['tabClassName_changed'] =
    InfoBubble.prototype.tabClassName_changed;


/**
 * Gets the style of the arrow
 *
 * @private
 * @return {number} The style of the arrow.
 */
InfoBubble.prototype.getArrowStyle_ = function() {
  return parseInt(this.get('arrowStyle'), 10) || 0;
};


/**
 * Sets the style of the arrow
 *
 * @param {number} style The style of the arrow.
 */
InfoBubble.prototype.setArrowStyle = function(style) {
  this.set('arrowStyle', style);
};
InfoBubble.prototype['setArrowStyle'] =
    InfoBubble.prototype.setArrowStyle;


/**
 * Arrow style changed MVC callback
 */
InfoBubble.prototype.arrowStyle_changed = function() {
  this.arrowSize_changed();
};
InfoBubble.prototype['arrowStyle_changed'] =
    InfoBubble.prototype.arrowStyle_changed;


/**
 * Gets the size of the arrow
 *
 * @private
 * @return {number} The size of the arrow.
 */
InfoBubble.prototype.getArrowSize_ = function() {
  return parseInt(this.get('arrowSize'), 10) || 0;
};


/**
 * Sets the size of the arrow
 *
 * @param {number} size The size of the arrow.
 */
InfoBubble.prototype.setArrowSize = function(size) {
  this.set('arrowSize', size);
};
InfoBubble.prototype['setArrowSize'] =
    InfoBubble.prototype.setArrowSize;


/**
 * Arrow size changed MVC callback
 */
InfoBubble.prototype.arrowSize_changed = function() {
  this.borderWidth_changed();
};
InfoBubble.prototype['arrowSize_changed'] =
    InfoBubble.prototype.arrowSize_changed;


/**
 * Set the position of the InfoBubble arrow
 *
 * @param {number} pos The position to set.
 */
InfoBubble.prototype.setArrowPosition = function(pos) {
  this.set('arrowPosition', pos);
};
InfoBubble.prototype['setArrowPosition'] =
    InfoBubble.prototype.setArrowPosition;


/**
 * Get the position of the InfoBubble arrow
 *
 * @private
 * @return {number} The position..
 */
InfoBubble.prototype.getArrowPosition_ = function() {
  return parseInt(this.get('arrowPosition'), 10) || 0;
};


/**
 * arrowPosition changed MVC callback
 */
InfoBubble.prototype.arrowPosition_changed = function() {
  var pos = this.getArrowPosition_();
  this.arrowOuter_.style['left'] = this.arrowInner_.style['left'] = pos + '%';

  this.redraw_();
};
InfoBubble.prototype['arrowPosition_changed'] =
    InfoBubble.prototype.arrowPosition_changed;


/**
 * Set the zIndex of the InfoBubble
 *
 * @param {number} zIndex The zIndex to set.
 */
InfoBubble.prototype.setZIndex = function(zIndex) {
  this.set('zIndex', zIndex);
};
InfoBubble.prototype['setZIndex'] = InfoBubble.prototype.setZIndex;


/**
 * Get the zIndex of the InfoBubble
 *
 * @return {number} The zIndex to set.
 */
InfoBubble.prototype.getZIndex = function() {
  return parseInt(this.get('zIndex'), 10) || this.baseZIndex_;
};


/**
 * zIndex changed MVC callback
 */
InfoBubble.prototype.zIndex_changed = function() {
  var zIndex = this.getZIndex();

  this.bubble_.style['zIndex'] = this.baseZIndex_ = zIndex;
  this.close_.style['zIndex'] = zIndex + 1;
};
InfoBubble.prototype['zIndex_changed'] = InfoBubble.prototype.zIndex_changed;


/**
 * Set the style of the shadow
 *
 * @param {number} shadowStyle The style of the shadow.
 */
InfoBubble.prototype.setShadowStyle = function(shadowStyle) {
  this.set('shadowStyle', shadowStyle);
};
InfoBubble.prototype['setShadowStyle'] = InfoBubble.prototype.setShadowStyle;


/**
 * Get the style of the shadow
 *
 * @private
 * @return {number} The style of the shadow.
 */
InfoBubble.prototype.getShadowStyle_ = function() {
  return parseInt(this.get('shadowStyle'), 10) || 0;
};


/**
 * shadowStyle changed MVC callback
 */
InfoBubble.prototype.shadowStyle_changed = function() {
  var shadowStyle = this.getShadowStyle_();

  var display = '';
  var shadow = '';
  var backgroundColor = '';
  switch (shadowStyle) {
    case 0:
      display = 'none';
      break;
    case 1:
      shadow = '40px 15px 10px rgba(33,33,33,0.3)';
      backgroundColor = 'transparent';
      break;
    case 2:
      shadow = '0 0 2px rgba(33,33,33,0.3)';
      backgroundColor = 'rgba(33,33,33,0.35)';
      break;
  }
  this.bubbleShadow_.style['boxShadow'] =
      this.bubbleShadow_.style['webkitBoxShadow'] =
      this.bubbleShadow_.style['MozBoxShadow'] = shadow;
  this.bubbleShadow_.style['backgroundColor'] = backgroundColor;
  if (this.isOpen_) {
    this.bubbleShadow_.style['display'] = display;
    this.draw();
  }
};
InfoBubble.prototype['shadowStyle_changed'] =
    InfoBubble.prototype.shadowStyle_changed;


/**
 * Show the close button
 */
InfoBubble.prototype.showCloseButton = function() {
  this.set('hideCloseButton', false);
};
InfoBubble.prototype['showCloseButton'] = InfoBubble.prototype.showCloseButton;


/**
 * Hide the close button
 */
InfoBubble.prototype.hideCloseButton = function() {
  this.set('hideCloseButton', true);
};
InfoBubble.prototype['hideCloseButton'] = InfoBubble.prototype.hideCloseButton;


/**
 * hideCloseButton changed MVC callback
 */
InfoBubble.prototype.hideCloseButton_changed = function() {
  this.close_.style['display'] = this.get('hideCloseButton') ? 'none' : '';
};
InfoBubble.prototype['hideCloseButton_changed'] =
    InfoBubble.prototype.hideCloseButton_changed;


/**
 * Set the background color
 *
 * @param {string} color The color to set.
 */
InfoBubble.prototype.setBackgroundColor = function(color) {
  if (color) {
    this.set('backgroundColor', color);
  }
};
InfoBubble.prototype['setBackgroundColor'] =
    InfoBubble.prototype.setBackgroundColor;


/**
 * backgroundColor changed MVC callback
 */
InfoBubble.prototype.backgroundColor_changed = function() {
  var backgroundColor = this.get('backgroundColor');
  this.contentContainer_.style['backgroundColor'] = backgroundColor;

  this.arrowInner_.style['borderColor'] = backgroundColor +
      ' transparent transparent';
  this.updateTabStyles_();
};
InfoBubble.prototype['backgroundColor_changed'] =
    InfoBubble.prototype.backgroundColor_changed;


/**
 * Set the border color
 *
 * @param {string} color The border color.
 */
InfoBubble.prototype.setBorderColor = function(color) {
  if (color) {
    this.set('borderColor', color);
  }
};
InfoBubble.prototype['setBorderColor'] = InfoBubble.prototype.setBorderColor;


/**
 * borderColor changed MVC callback
 */
InfoBubble.prototype.borderColor_changed = function() {
  var borderColor = this.get('borderColor');

  var contentContainer = this.contentContainer_;
  var arrowOuter = this.arrowOuter_;
  contentContainer.style['borderColor'] = borderColor;

  arrowOuter.style['borderColor'] = borderColor +
      ' transparent transparent';

  contentContainer.style['borderStyle'] =
      arrowOuter.style['borderStyle'] =
      this.arrowInner_.style['borderStyle'] = 'solid';

  this.updateTabStyles_();
};
InfoBubble.prototype['borderColor_changed'] =
    InfoBubble.prototype.borderColor_changed;


/**
 * Set the radius of the border
 *
 * @param {number} radius The radius of the border.
 */
InfoBubble.prototype.setBorderRadius = function(radius) {
  this.set('borderRadius', radius);
};
InfoBubble.prototype['setBorderRadius'] = InfoBubble.prototype.setBorderRadius;


/**
 * Get the radius of the border
 *
 * @private
 * @return {number} The radius of the border.
 */
InfoBubble.prototype.getBorderRadius_ = function() {
  return parseInt(this.get('borderRadius'), 10) || 0;
};


/**
 * borderRadius changed MVC callback
 */
InfoBubble.prototype.borderRadius_changed = function() {
  var borderRadius = this.getBorderRadius_();
  var borderWidth = this.getBorderWidth_();

  this.contentContainer_.style['borderRadius'] =
      this.contentContainer_.style['MozBorderRadius'] =
      this.contentContainer_.style['webkitBorderRadius'] =
      this.bubbleShadow_.style['borderRadius'] =
      this.bubbleShadow_.style['MozBorderRadius'] =
      this.bubbleShadow_.style['webkitBorderRadius'] = this.px(borderRadius);

  this.tabsContainer_.style['paddingLeft'] =
      this.tabsContainer_.style['paddingRight'] =
      this.px(borderRadius + borderWidth);

  this.redraw_();
};
InfoBubble.prototype['borderRadius_changed'] =
    InfoBubble.prototype.borderRadius_changed;


/**
 * Get the width of the border
 *
 * @private
 * @return {number} width The width of the border.
 */
InfoBubble.prototype.getBorderWidth_ = function() {
  return parseInt(this.get('borderWidth'), 10) || 0;
};


/**
 * Set the width of the border
 *
 * @param {number} width The width of the border.
 */
InfoBubble.prototype.setBorderWidth = function(width) {
  this.set('borderWidth', width);
};
InfoBubble.prototype['setBorderWidth'] = InfoBubble.prototype.setBorderWidth;


/**
 * borderWidth change MVC callback
 */
InfoBubble.prototype.borderWidth_changed = function() {
  var borderWidth = this.getBorderWidth_();

  this.contentContainer_.style['borderWidth'] = this.px(borderWidth);
  this.tabsContainer_.style['top'] = this.px(borderWidth);

  this.updateArrowStyle_();
  this.updateTabStyles_();
  this.borderRadius_changed();
  this.redraw_();
};
InfoBubble.prototype['borderWidth_changed'] =
    InfoBubble.prototype.borderWidth_changed;


/**
 * Update the arrow style
 * @private
 */
InfoBubble.prototype.updateArrowStyle_ = function() {
  var borderWidth = this.getBorderWidth_();
  var arrowSize = this.getArrowSize_();
  var arrowStyle = this.getArrowStyle_();
  var arrowOuterSizePx = this.px(arrowSize);
  var arrowInnerSizePx = this.px(Math.max(0, arrowSize - borderWidth));

  var outer = this.arrowOuter_;
  var inner = this.arrowInner_;

  this.arrow_.style['marginTop'] = this.px(-borderWidth);
  outer.style['borderTopWidth'] = arrowOuterSizePx;
  inner.style['borderTopWidth'] = arrowInnerSizePx;

  // Full arrow or arrow pointing to the left
  if (arrowStyle == 0 || arrowStyle == 1) {
    outer.style['borderLeftWidth'] = arrowOuterSizePx;
    inner.style['borderLeftWidth'] = arrowInnerSizePx;
  } else {
    outer.style['borderLeftWidth'] = inner.style['borderLeftWidth'] = 0;
  }

  // Full arrow or arrow pointing to the right
  if (arrowStyle == 0 || arrowStyle == 2) {
    outer.style['borderRightWidth'] = arrowOuterSizePx;
    inner.style['borderRightWidth'] = arrowInnerSizePx;
  } else {
    outer.style['borderRightWidth'] = inner.style['borderRightWidth'] = 0;
  }

  if (arrowStyle < 2) {
    outer.style['marginLeft'] = this.px(-(arrowSize));
    inner.style['marginLeft'] = this.px(-(arrowSize - borderWidth));
  } else {
    outer.style['marginLeft'] = inner.style['marginLeft'] = 0;
  }

  // If there is no border then don't show thw outer arrow
  if (borderWidth == 0) {
    outer.style['display'] = 'none';
  } else {
    outer.style['display'] = '';
  }
};


/**
 * Set the padding of the InfoBubble
 *
 * @param {number} padding The padding to apply.
 */
InfoBubble.prototype.setPadding = function(padding) {
  this.set('padding', padding);
};
InfoBubble.prototype['setPadding'] = InfoBubble.prototype.setPadding;


/**
 * Set the padding of the InfoBubble
 *
 * @private
 * @return {number} padding The padding to apply.
 */
InfoBubble.prototype.getPadding_ = function() {
  return parseInt(this.get('padding'), 10) || 0;
};


/**
 * padding changed MVC callback
 */
InfoBubble.prototype.padding_changed = function() {
  var padding = this.getPadding_();
  this.contentContainer_.style['padding'] = this.px(padding);
  this.updateTabStyles_();

  this.redraw_();
};
InfoBubble.prototype['padding_changed'] = InfoBubble.prototype.padding_changed;


/**
 * Add px extention to the number
 *
 * @param {number} num The number to wrap.
 * @return {string|number} A wrapped number.
 */
InfoBubble.prototype.px = function(num) {
  if (num) {
    // 0 doesn't need to be wrapped
    return num + 'px';
  }
  return num;
};


/**
 * Add events to stop propagation
 * @private
 */
InfoBubble.prototype.addEvents_ = function() {
  // We want to cancel all the events so they do not go to the map
  var events = ['mousedown', 'mousemove', 'mouseover', 'mouseout', 'mouseup',
      'mousewheel', 'DOMMouseScroll', 'touchstart', 'touchend', 'touchmove',
      'dblclick', 'contextmenu', 'click'];

  var bubble = this.bubble_;
  this.listeners_ = [];
  for (var i = 0, event; event = events[i]; i++) {
    this.listeners_.push(
      google.maps.event.addDomListener(bubble, event, function(e) {
        e.cancelBubble = true;
        if (e.stopPropagation) {
          e.stopPropagation();
        }
      })
    );
  }
};


/**
 * On Adding the InfoBubble to a map
 * Implementing the OverlayView interface
 */
InfoBubble.prototype.onAdd = function() {
  if (!this.bubble_) {
    this.buildDom_();
  }

  this.addEvents_();

  var panes = this.getPanes();
  if (panes) {
    panes.floatPane.appendChild(this.bubble_);
    panes.floatShadow.appendChild(this.bubbleShadow_);
  }
};
InfoBubble.prototype['onAdd'] = InfoBubble.prototype.onAdd;


/**
 * Draw the InfoBubble
 * Implementing the OverlayView interface
 */
InfoBubble.prototype.draw = function() {
  var projection = this.getProjection();

  if (!projection) {
    // The map projection is not ready yet so do nothing
    return;
  }

  var latLng = /** @type {google.maps.LatLng} */ (this.get('position'));

  if (!latLng) {
    this.close();
    return;
  }

  var tabHeight = 0;

  if (this.activeTab_) {
    tabHeight = this.activeTab_.offsetHeight;
  }

  var anchorHeight = this.getAnchorHeight_();
  var arrowSize = this.getArrowSize_();
  var arrowPosition = this.getArrowPosition_();

  arrowPosition = arrowPosition / 100;

  var pos = projection.fromLatLngToDivPixel(latLng);
  var width = this.contentContainer_.offsetWidth;
  var height = this.bubble_.offsetHeight;

  if (!width) {
    return;
  }

  // Adjust for the height of the info bubble
  var top = pos.y - (height + arrowSize);

  if (anchorHeight) {
    // If there is an anchor then include the height
    top -= anchorHeight;
  }

  var left = pos.x - (width * arrowPosition);

  this.bubble_.style['top'] = this.px(top);
  this.bubble_.style['left'] = this.px(left);

  var shadowStyle = parseInt(this.get('shadowStyle'), 10);

  switch (shadowStyle) {
    case 1:
      // Shadow is behind
      this.bubbleShadow_.style['top'] = this.px(top + tabHeight - 1);
      this.bubbleShadow_.style['left'] = this.px(left);
      this.bubbleShadow_.style['width'] = this.px(width);
      this.bubbleShadow_.style['height'] =
          this.px(this.contentContainer_.offsetHeight - arrowSize);
      break;
    case 2:
      // Shadow is below
      width = width * 0.8;
      if (anchorHeight) {
        this.bubbleShadow_.style['top'] = this.px(pos.y);
      } else {
        this.bubbleShadow_.style['top'] = this.px(pos.y + arrowSize);
      }
      this.bubbleShadow_.style['left'] = this.px(pos.x - width * arrowPosition);

      this.bubbleShadow_.style['width'] = this.px(width);
      this.bubbleShadow_.style['height'] = this.px(2);
      break;
  }
};
InfoBubble.prototype['draw'] = InfoBubble.prototype.draw;


/**
 * Removing the InfoBubble from a map
 */
InfoBubble.prototype.onRemove = function() {
  if (this.bubble_ && this.bubble_.parentNode) {
    this.bubble_.parentNode.removeChild(this.bubble_);
  }
  if (this.bubbleShadow_ && this.bubbleShadow_.parentNode) {
    this.bubbleShadow_.parentNode.removeChild(this.bubbleShadow_);
  }

  for (var i = 0, listener; listener = this.listeners_[i]; i++) {
    google.maps.event.removeListener(listener);
  }
};
InfoBubble.prototype['onRemove'] = InfoBubble.prototype.onRemove;


/**
 * Is the InfoBubble open
 *
 * @return {boolean} If the InfoBubble is open.
 */
InfoBubble.prototype.isOpen = function() {
  return this.isOpen_;
};
InfoBubble.prototype['isOpen'] = InfoBubble.prototype.isOpen;


/**
 * Close the InfoBubble
 */
InfoBubble.prototype.close = function() {
  if (this.bubble_) {
    this.bubble_.style['display'] = 'none';
    // Remove the animation so we next time it opens it will animate again
    this.bubble_.className =
        this.bubble_.className.replace(this.animationName_, '');
  }

  if (this.bubbleShadow_) {
    this.bubbleShadow_.style['display'] = 'none';
    this.bubbleShadow_.className =
        this.bubbleShadow_.className.replace(this.animationName_, '');
  }
  this.isOpen_ = false;
};
InfoBubble.prototype['close'] = InfoBubble.prototype.close;


/**
 * Open the InfoBubble
 *
 * @param {google.maps.Map=} opt_map Optional map to open on.
 * @param {google.maps.MVCObject=} opt_anchor Optional anchor to position at.
 */
InfoBubble.prototype.open = function(opt_map, opt_anchor) {
  if (opt_map) {
    this.setMap(opt_map);
  }

  if (opt_anchor) {
    this.set('anchor', opt_anchor);
    this.bindTo('anchorPoint', opt_anchor);
    this.bindTo('position', opt_anchor);
  }

  // Show the bubble and the show
  this.bubble_.style['display'] = this.bubbleShadow_.style['display'] = '';
  var animation = !this.get('disableAnimation');

  if (animation) {
    // Add the animation
    this.bubble_.className += ' ' + this.animationName_;
    this.bubbleShadow_.className += ' ' + this.animationName_;
  }

  this.redraw_();
  this.isOpen_ = true;

  var pan = !this.get('disableAutoPan');
  if (pan) {
    var that = this;
    window.setTimeout(function() {
      // Pan into view, done in a time out to make it feel nicer :)
      that.panToView();
    }, 200);
  }
};
InfoBubble.prototype['open'] = InfoBubble.prototype.open;


/**
 * Set the position of the InfoBubble
 *
 * @param {google.maps.LatLng} position The position to set.
 */
InfoBubble.prototype.setPosition = function(position) {
  if (position) {
    this.set('position', position);
  }
};
InfoBubble.prototype['setPosition'] = InfoBubble.prototype.setPosition;


/**
 * Returns the position of the InfoBubble
 *
 * @return {google.maps.LatLng} the position.
 */
InfoBubble.prototype.getPosition = function() {
  return /** @type {google.maps.LatLng} */ (this.get('position'));
};
InfoBubble.prototype['getPosition'] = InfoBubble.prototype.getPosition;


/**
 * position changed MVC callback
 */
InfoBubble.prototype.position_changed = function() {
  this.draw();
};
InfoBubble.prototype['position_changed'] =
    InfoBubble.prototype.position_changed;


/**
 * Pan the InfoBubble into view
 */
InfoBubble.prototype.panToView = function() {
  var projection = this.getProjection();

  if (!projection) {
    // The map projection is not ready yet so do nothing
    return;
  }

  if (!this.bubble_) {
    // No Bubble yet so do nothing
    return;
  }

  var anchorHeight = this.getAnchorHeight_();
  var height = this.bubble_.offsetHeight + anchorHeight;
  var map = this.get('map');
  var mapDiv = map.getDiv();
  var mapHeight = mapDiv.offsetHeight;

  var latLng = this.getPosition();
  var centerPos = projection.fromLatLngToContainerPixel(map.getCenter());
  var pos = projection.fromLatLngToContainerPixel(latLng);

  // Find out how much space at the top is free
  var spaceTop = centerPos.y - height;

  // Fine out how much space at the bottom is free
  var spaceBottom = mapHeight - centerPos.y;

  var needsTop = spaceTop < 0;
  var deltaY = 0;

  if (needsTop) {
    spaceTop *= -1;
    deltaY = (spaceTop + spaceBottom) / 2;
  }

  pos.y -= deltaY;
  latLng = projection.fromContainerPixelToLatLng(pos);

  if (map.getCenter() != latLng) {
    map.panTo(latLng);
  }
};
InfoBubble.prototype['panToView'] = InfoBubble.prototype.panToView;


/**
 * Converts a HTML string to a document fragment.
 *
 * @param {string} htmlString The HTML string to convert.
 * @return {Node} A HTML document fragment.
 * @private
 */
InfoBubble.prototype.htmlToDocumentFragment_ = function(htmlString) {
  htmlString = htmlString.replace(/^\s*([\S\s]*)\b\s*$/, '$1');
  var tempDiv = document.createElement('DIV');
  tempDiv.innerHTML = htmlString;
  if (tempDiv.childNodes.length == 1) {
    return /** @type {!Node} */ (tempDiv.removeChild(tempDiv.firstChild));
  } else {
    var fragment = document.createDocumentFragment();
    while (tempDiv.firstChild) {
      fragment.appendChild(tempDiv.firstChild);
    }
    return fragment;
  }
};


/**
 * Removes all children from the node.
 *
 * @param {Node} node The node to remove all children from.
 * @private
 */
InfoBubble.prototype.removeChildren_ = function(node) {
  if (!node) {
    return;
  }

  var child;
  while (child = node.firstChild) {
    node.removeChild(child);
  }
};


/**
 * Sets the content of the infobubble.
 *
 * @param {string|Node} content The content to set.
 */
InfoBubble.prototype.setContent = function(content) {
  this.set('content', content);
};
InfoBubble.prototype['setContent'] = InfoBubble.prototype.setContent;


/**
 * Get the content of the infobubble.
 *
 * @return {string|Node} The marker content.
 */
InfoBubble.prototype.getContent = function() {
  return /** @type {Node|string} */ (this.get('content'));
};
InfoBubble.prototype['getContent'] = InfoBubble.prototype.getContent;


/**
 * Sets the marker content and adds loading events to images
 */
InfoBubble.prototype.content_changed = function() {
  if (!this.content_) {
    // The Content area doesnt exist.
    return;
  }

  this.removeChildren_(this.content_);
  var content = this.getContent();
  if (content) {
    if (typeof content == 'string') {
      content = this.htmlToDocumentFragment_(content);
    }
    this.content_.appendChild(content);

    var that = this;
    var images = this.content_.getElementsByTagName('IMG');
    for (var i = 0, image; image = images[i]; i++) {
      // Because we don't know the size of an image till it loads, add a
      // listener to the image load so the marker can resize and reposition
      // itself to be the correct height.
      google.maps.event.addDomListener(image, 'load', function() {
        that.imageLoaded_();
      });
    }
    google.maps.event.trigger(this, 'domready');
  }
  this.redraw_();
};
InfoBubble.prototype['content_changed'] =
    InfoBubble.prototype.content_changed;


/**
 * Image loaded
 * @private
 */
InfoBubble.prototype.imageLoaded_ = function() {
  var pan = !this.get('disableAutoPan');
  this.redraw_();
  if (pan && (this.tabs_.length == 0 || this.activeTab_.index == 0)) {
    this.panToView();
  }
};

/**
 * Updates the styles of the tabs
 * @private
 */
InfoBubble.prototype.updateTabStyles_ = function() {
  if (this.tabs_ && this.tabs_.length) {
    for (var i = 0, tab; tab = this.tabs_[i]; i++) {
      this.setTabStyle_(tab.tab);
    }
    this.activeTab_.style['zIndex'] = this.baseZIndex_;
    var borderWidth = this.getBorderWidth_();
    var padding = this.getPadding_() / 2;
    this.activeTab_.style['borderBottomWidth'] = 0;
    this.activeTab_.style['paddingBottom'] = this.px(padding + borderWidth);
  }
};


/**
 * Sets the style of a tab
 * @private
 * @param {Element} tab The tab to style.
 */
InfoBubble.prototype.setTabStyle_ = function(tab) {
  var backgroundColor = this.get('backgroundColor');
  var borderColor = this.get('borderColor');
  var borderRadius = this.getBorderRadius_();
  var borderWidth = this.getBorderWidth_();
  var padding = this.getPadding_();

  var marginRight = this.px(-(Math.max(padding, borderRadius)));
  var borderRadiusPx = this.px(borderRadius);

  var index = this.baseZIndex_;
  if (tab.index) {
    index -= tab.index;
  }

  // The styles for the tab
  var styles = {
    'cssFloat': 'left',
    'position': 'relative',
    'cursor': 'pointer',
    'backgroundColor': backgroundColor,
    'border': this.px(borderWidth) + ' solid ' + borderColor,
    'padding': this.px(padding / 2) + ' ' + this.px(padding),
    'marginRight': marginRight,
    'whiteSpace': 'nowrap',
    'borderRadiusTopLeft': borderRadiusPx,
    'MozBorderRadiusTopleft': borderRadiusPx,
    'webkitBorderTopLeftRadius': borderRadiusPx,
    'borderRadiusTopRight': borderRadiusPx,
    'MozBorderRadiusTopright': borderRadiusPx,
    'webkitBorderTopRightRadius': borderRadiusPx,
    'zIndex': index,
    'display': 'inline'
  };

  for (var style in styles) {
    tab.style[style] = styles[style];
  }

  var className = this.get('tabClassName');
  if (className != undefined) {
    tab.className += ' ' + className;
  }
};


/**
 * Add user actions to a tab
 * @private
 * @param {Object} tab The tab to add the actions to.
 */
InfoBubble.prototype.addTabActions_ = function(tab) {
  var that = this;
  tab.listener_ = google.maps.event.addDomListener(tab, 'click', function() {
    that.setTabActive_(this);
  });
};


/**
 * Set a tab at a index to be active
 *
 * @param {number} index The index of the tab.
 */
InfoBubble.prototype.setTabActive = function(index) {
  var tab = this.tabs_[index - 1];

  if (tab) {
    this.setTabActive_(tab.tab);
  }
};
InfoBubble.prototype['setTabActive'] = InfoBubble.prototype.setTabActive;


/**
 * Set a tab to be active
 * @private
 * @param {Object} tab The tab to set active.
 */
InfoBubble.prototype.setTabActive_ = function(tab) {
  if (!tab) {
    this.setContent('');
    return;
  }

  var padding = this.getPadding_() / 2;
  var borderWidth = this.getBorderWidth_();

  if (this.activeTab_) {
    var activeTab = this.activeTab_;
    activeTab.style['zIndex'] = this.baseZIndex_ - activeTab.index;
    activeTab.style['paddingBottom'] = this.px(padding);
    activeTab.style['borderBottomWidth'] = this.px(borderWidth);
  }

  tab.style['zIndex'] = this.baseZIndex_;
  tab.style['borderBottomWidth'] = 0;
  tab.style['marginBottomWidth'] = '-10px';
  tab.style['paddingBottom'] = this.px(padding + borderWidth);

  this.setContent(this.tabs_[tab.index].content);

  this.activeTab_ = tab;

  this.redraw_();
};


/**
 * Set the max width of the InfoBubble
 *
 * @param {number} width The max width.
 */
InfoBubble.prototype.setMaxWidth = function(width) {
  this.set('maxWidth', width);
};
InfoBubble.prototype['setMaxWidth'] = InfoBubble.prototype.setMaxWidth;


/**
 * maxWidth changed MVC callback
 */
InfoBubble.prototype.maxWidth_changed = function() {
  this.redraw_();
};
InfoBubble.prototype['maxWidth_changed'] =
    InfoBubble.prototype.maxWidth_changed;


/**
 * Set the max height of the InfoBubble
 *
 * @param {number} height The max height.
 */
InfoBubble.prototype.setMaxHeight = function(height) {
  this.set('maxHeight', height);
};
InfoBubble.prototype['setMaxHeight'] = InfoBubble.prototype.setMaxHeight;


/**
 * maxHeight changed MVC callback
 */
InfoBubble.prototype.maxHeight_changed = function() {
  this.redraw_();
};
InfoBubble.prototype['maxHeight_changed'] =
    InfoBubble.prototype.maxHeight_changed;


/**
 * Set the min width of the InfoBubble
 *
 * @param {number} width The min width.
 */
InfoBubble.prototype.setMinWidth = function(width) {
  this.set('minWidth', width);
};
InfoBubble.prototype['setMinWidth'] = InfoBubble.prototype.setMinWidth;


/**
 * minWidth changed MVC callback
 */
InfoBubble.prototype.minWidth_changed = function() {
  this.redraw_();
};
InfoBubble.prototype['minWidth_changed'] =
    InfoBubble.prototype.minWidth_changed;


/**
 * Set the min height of the InfoBubble
 *
 * @param {number} height The min height.
 */
InfoBubble.prototype.setMinHeight = function(height) {
  this.set('minHeight', height);
};
InfoBubble.prototype['setMinHeight'] = InfoBubble.prototype.setMinHeight;


/**
 * minHeight changed MVC callback
 */
InfoBubble.prototype.minHeight_changed = function() {
  this.redraw_();
};
InfoBubble.prototype['minHeight_changed'] =
    InfoBubble.prototype.minHeight_changed;


/**
 * Add a tab
 *
 * @param {string} label The label of the tab.
 * @param {string|Element} content The content of the tab.
 */
InfoBubble.prototype.addTab = function(label, content) {
  var tab = document.createElement('DIV');
  tab.innerHTML = label;

  this.setTabStyle_(tab);
  this.addTabActions_(tab);

  this.tabsContainer_.appendChild(tab);

  this.tabs_.push({
    label: label,
    content: content,
    tab: tab
  });

  tab.index = this.tabs_.length - 1;
  tab.style['zIndex'] = this.baseZIndex_ - tab.index;

  if (!this.activeTab_) {
    this.setTabActive_(tab);
  }

  tab.className = tab.className + ' ' + this.animationName_;

  this.redraw_();
};
InfoBubble.prototype['addTab'] = InfoBubble.prototype.addTab;

/**
 * Update a tab at a speicifc index
 *
 * @param {number} index The index of the tab.
 * @param {?string} opt_label The label to change to.
 * @param {?string} opt_content The content to update to.
 */
InfoBubble.prototype.updateTab = function(index, opt_label, opt_content) {
  if (!this.tabs_.length || index < 0 || index >= this.tabs_.length) {
    return;
  }

  var tab = this.tabs_[index];
  if (opt_label != undefined) {
    tab.tab.innerHTML = tab.label = opt_label;
  }

  if (opt_content != undefined) {
    tab.content = opt_content;
  }

  if (this.activeTab_ == tab.tab) {
    this.setContent(tab.content);
  }
  this.redraw_();
};
InfoBubble.prototype['updateTab'] = InfoBubble.prototype.updateTab;


/**
 * Remove a tab at a specific index
 *
 * @param {number} index The index of the tab to remove.
 */
InfoBubble.prototype.removeTab = function(index) {
  if (!this.tabs_.length || index < 0 || index >= this.tabs_.length) {
    return;
  }

  var tab = this.tabs_[index];
  tab.tab.parentNode.removeChild(tab.tab);

  google.maps.event.removeListener(tab.tab.listener_);

  this.tabs_.splice(index, 1);

  delete tab;

  for (var i = 0, t; t = this.tabs_[i]; i++) {
    t.tab.index = i;
  }

  if (tab.tab == this.activeTab_) {
    // Removing the current active tab
    if (this.tabs_[index]) {
      // Show the tab to the right
      this.activeTab_ = this.tabs_[index].tab;
    } else if (this.tabs_[index - 1]) {
      // Show a tab to the left
      this.activeTab_ = this.tabs_[index - 1].tab;
    } else {
      // No tabs left to sho
      this.activeTab_ = undefined;
    }

    this.setTabActive_(this.activeTab_);
  }

  this.redraw_();
};
InfoBubble.prototype['removeTab'] = InfoBubble.prototype.removeTab;


/**
 * Get the size of an element
 * @private
 * @param {Node|string} element The element to size.
 * @param {number=} opt_maxWidth Optional max width of the element.
 * @param {number=} opt_maxHeight Optional max height of the element.
 * @return {google.maps.Size} The size of the element.
 */
InfoBubble.prototype.getElementSize_ = function(element, opt_maxWidth,
                                                opt_maxHeight) {
  var sizer = document.createElement('DIV');
  sizer.style['display'] = 'inline';
  sizer.style['position'] = 'absolute';
  sizer.style['visibility'] = 'hidden';

  if (typeof element == 'string') {
    sizer.innerHTML = element;
  } else {
    sizer.appendChild(element.cloneNode(true));
  }

  document.body.appendChild(sizer);
  var size = new google.maps.Size(sizer.offsetWidth, sizer.offsetHeight);

  // If the width is bigger than the max width then set the width and size again
  if (opt_maxWidth && size.width > opt_maxWidth) {
    sizer.style['width'] = this.px(opt_maxWidth);
    size = new google.maps.Size(sizer.offsetWidth, sizer.offsetHeight);
  }

  // If the height is bigger than the max height then set the height and size
  // again
  if (opt_maxHeight && size.height > opt_maxHeight) {
    sizer.style['height'] = this.px(opt_maxHeight);
    size = new google.maps.Size(sizer.offsetWidth, sizer.offsetHeight);
  }

  document.body.removeChild(sizer);
  delete sizer;
  return size;
};


/**
 * Redraw the InfoBubble
 * @private
 */
InfoBubble.prototype.redraw_ = function() {
  this.figureOutSize_();
  this.positionCloseButton_();
  this.draw();
};


/**
 * Figure out the optimum size of the InfoBubble
 * @private
 */
InfoBubble.prototype.figureOutSize_ = function() {
  var map = this.get('map');

  if (!map) {
    return;
  }

  var padding = this.getPadding_();
  var borderWidth = this.getBorderWidth_();
  var borderRadius = this.getBorderRadius_();
  var arrowSize = this.getArrowSize_();

  var mapDiv = map.getDiv();
  var gutter = arrowSize * 2;
  var mapWidth = mapDiv.offsetWidth - gutter;
  var mapHeight = mapDiv.offsetHeight - gutter - this.getAnchorHeight_();
  var tabHeight = 0;
  var width = /** @type {number} */ (this.get('minWidth') || 0);
  var height = /** @type {number} */ (this.get('minHeight') || 0);
  var maxWidth = /** @type {number} */ (this.get('maxWidth') || 0);
  var maxHeight = /** @type {number} */ (this.get('maxHeight') || 0);

  maxWidth = Math.min(mapWidth, maxWidth);
  maxHeight = Math.min(mapHeight, maxHeight);

  var tabWidth = 0;
  if (this.tabs_.length) {
    // If there are tabs then you need to check the size of each tab's content
    for (var i = 0, tab; tab = this.tabs_[i]; i++) {
      var tabSize = this.getElementSize_(tab.tab, maxWidth, maxHeight);
      var contentSize = this.getElementSize_(tab.content, maxWidth, maxHeight);

      if (width < tabSize.width) {
        width = tabSize.width;
      }

      // Add up all the tab widths because they might end up being wider than
      // the content
      tabWidth += tabSize.width;

      if (height < tabSize.height) {
        height = tabSize.height;
      }

      if (tabSize.height > tabHeight) {
        tabHeight = tabSize.height;
      }

      if (width < contentSize.width) {
        width = contentSize.width;
      }

      if (height < contentSize.height) {
        height = contentSize.height;
      }
    }
  } else {
    var content = /** @type {string|Node} */ (this.get('content'));
    if (typeof content == 'string') {
      content = this.htmlToDocumentFragment_(content);
    }
    if (content) {
      var contentSize = this.getElementSize_(content, maxWidth, maxHeight);

      if (width < contentSize.width) {
        width = contentSize.width;
      }

      if (height < contentSize.height) {
        height = contentSize.height;
      }
    }
  }

  if (maxWidth) {
    width = Math.min(width, maxWidth);
  }

  if (maxHeight) {
    height = Math.min(height, maxHeight);
  }

  width = Math.max(width, tabWidth);

  if (width == tabWidth) {
    width = width + 2 * padding;
  }

  arrowSize = arrowSize * 2;
  width = Math.max(width, arrowSize);

  // Maybe add this as a option so they can go bigger than the map if the user
  // wants
  if (width > mapWidth) {
    width = mapWidth;
  }

  if (height > mapHeight) {
    height = mapHeight - tabHeight;
  }

  if (this.tabsContainer_) {
    this.tabHeight_ = tabHeight;
    this.tabsContainer_.style['width'] = this.px(tabWidth);
  }

  this.contentContainer_.style['width'] = this.px(width);
  this.contentContainer_.style['height'] = this.px(height);
};


/**
 *  Get the height of the anchor
 *
 *  This function is a hack for now and doesn't really work that good, need to
 *  wait for pixelBounds to be correctly exposed.
 *  @private
 *  @return {number} The height of the anchor.
 */
InfoBubble.prototype.getAnchorHeight_ = function() {
  var anchor = this.get('anchor');
  if (anchor) {
    var anchorPoint = /** @type google.maps.Point */(this.get('anchorPoint'));

    if (anchorPoint) {
      return -1 * anchorPoint.y;
    }
  }
  return 0;
};

InfoBubble.prototype.anchorPoint_changed = function() {
  this.draw();
};
InfoBubble.prototype['anchorPoint_changed'] = InfoBubble.prototype.anchorPoint_changed;


/**
 * Position the close button in the right spot.
 * @private
 */
InfoBubble.prototype.positionCloseButton_ = function() {
  var br = this.getBorderRadius_();
  var bw = this.getBorderWidth_();

  var right = 2;
  var top = 2;

  if (this.tabs_.length && this.tabHeight_) {
    top += this.tabHeight_;
  }

  top += bw;
  right += bw;

  var c = this.contentContainer_;
  if (c && c.clientHeight < c.scrollHeight) {
    // If there are scrollbars then move the cross in so it is not over
    // scrollbar
    right += 15;
  }

  this.close_.style['right'] = this.px(right);
  this.close_.style['top'] = this.px(top);
};

(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Google Maps API v3 must be included *before* this code
*/
var h=!0,i=null,m=!1,n,p={}.hasOwnProperty,q=[].slice;
if(((n=this.google)!=i?n.maps:void 0)!=i){var t=function(b,c){var a,e,d,f,g=this;this.map=b;c==i&&(c={});for(a in c)p.call(c,a)&&(e=c[a],this[a]=e);this.e=new this.constructor.g(this.map);this.n();this.b={};f=["click","zoom_changed","maptypeid_changed"];e=0;for(d=f.length;e<d;e++)a=f[e],r.addListener(this.map,a,function(){return g.unspiderfy()})},r,u,v,w,y,z,A;z=t.prototype;z.VERSION="0.2.9";u=google.maps;r=u.event;y=u.MapTypeId;A=2*Math.PI;z.keepSpiderfied=m;z.markersWontHide=m;z.markersWontMove=
m;z.nearbyDistance=20;z.circleSpiralSwitchover=9;z.circleFootSeparation=23;z.circleStartAngle=A/12;z.spiralFootSeparation=26;z.spiralLengthStart=11;z.spiralLengthFactor=4;z.spiderfiedZIndex=1E3;z.usualLegZIndex=10;z.highlightedLegZIndex=20;z.legWeight=1.5;z.legColors={usual:{},highlighted:{}};w=z.legColors.usual;v=z.legColors.highlighted;w[y.HYBRID]=w[y.SATELLITE]="#fff";v[y.HYBRID]=v[y.SATELLITE]="#f00";w[y.TERRAIN]=w[y.ROADMAP]="#444";v[y.TERRAIN]=v[y.ROADMAP]="#f00";z.n=function(){this.a=[];this.j=
[]};z.addMarker=function(b){var c,a=this;if(b._oms!=i)return this;b._oms=h;c=[r.addListener(b,"click",function(){return a.F(b)})];this.markersWontHide||c.push(r.addListener(b,"visible_changed",function(){return a.o(b,m)}));this.markersWontMove||c.push(r.addListener(b,"position_changed",function(){return a.o(b,h)}));this.j.push(c);this.a.push(b);return this};z.o=function(b,c){if(b._omsData!=i&&(c||!b.getVisible())&&!(this.s!=i||this.t!=i))return this.H(c?b:i)};z.getMarkers=function(){return this.a.slice(0)};
z.removeMarker=function(b){var c,a,e,d,f;b._omsData!=i&&this.unspiderfy();c=this.m(this.a,b);if(0>c)return this;e=this.j.splice(c,1)[0];d=0;for(f=e.length;d<f;d++)a=e[d],r.removeListener(a);delete b._oms;this.a.splice(c,1);return this};z.clearMarkers=function(){var b,c,a,e,d,f,g,j;this.unspiderfy();j=this.a;b=e=0;for(f=j.length;e<f;b=++e){a=j[b];c=this.j[b];d=0;for(g=c.length;d<g;d++)b=c[d],r.removeListener(b);delete a._oms}this.n();return this};z.addListener=function(b,c){var a,e;((e=(a=this.b)[b])!=
i?e:a[b]=[]).push(c);return this};z.removeListener=function(b,c){var a;a=this.m(this.b[b],c);0>a||this.b[b].splice(a,1);return this};z.clearListeners=function(b){this.b[b]=[];return this};z.trigger=function(){var b,c,a,e,d,f;c=arguments[0];b=2<=arguments.length?q.call(arguments,1):[];c=(a=this.b[c])!=i?a:[];f=[];e=0;for(d=c.length;e<d;e++)a=c[e],f.push(a.apply(i,b));return f};z.u=function(b,c){var a,e,d,f,g;d=this.circleFootSeparation*(2+b)/A;e=A/b;g=[];for(a=f=0;0<=b?f<b:f>b;a=0<=b?++f:--f)a=this.circleStartAngle+
a*e,g.push(new u.Point(c.x+d*Math.cos(a),c.y+d*Math.sin(a)));return g};z.v=function(b,c){var a,e,d,f,g;d=this.spiralLengthStart;a=0;g=[];for(e=f=0;0<=b?f<b:f>b;e=0<=b?++f:--f)a+=this.spiralFootSeparation/d+5E-4*e,e=new u.Point(c.x+d*Math.cos(a),c.y+d*Math.sin(a)),d+=A*this.spiralLengthFactor/a,g.push(e);return g};z.F=function(b){var c,a,e,d,f,g,j,l,k;d=b._omsData!=i;(!d||!this.keepSpiderfied)&&this.unspiderfy();if(d||this.map.getStreetView().getVisible())return this.trigger("click",b);d=[];f=[];c=
this.nearbyDistance;g=c*c;e=this.c(b.position);k=this.a;j=0;for(l=k.length;j<l;j++)c=k[j],c.map!=i&&c.getVisible()&&(a=this.c(c.position),this.f(a,e)<g?d.push({A:c,p:a}):f.push(c));return 1===d.length?this.trigger("click",b):this.G(d,f)};z.willSpiderfy=function(b){var c,a,e,d,f,g,j,l;if(this.e.getProjection()==i)throw"Must wait for 'idle' event on map before calling willSpiderfy";a=this.nearbyDistance;e=a*a;a=this.c(b.position);g=this.a;d=0;for(f=g.length;d<f;d++)if(c=g[d],!(c===b||c.map==i||!c.getVisible()))if(c=
this.c((j=(l=c._omsData)!=i?l.l:void 0)!=i?j:c.position),this.f(c,a)<e)return h;return m};z.markersThatWillAndWontSpiderfy=function(){var b,c,a,e,d,f,g,j,l,k,s,x;if(this.e.getProjection()==i)throw"Must wait for 'idle' event on map before calling markersThatWillAndWontSpiderfy";f=this.nearbyDistance;b=f*f;e=this.a;f=[];k=0;for(a=e.length;k<a;k++)c=e[k],f.push({q:this.c((g=(j=c._omsData)!=i?j.l:void 0)!=i?g:c.position),d:m});k=this.a;c=g=0;for(j=k.length;g<j;c=++g)if(a=k[c],a.map!=i&&a.getVisible()&&
(e=f[c],!e.d)){x=this.a;a=l=0;for(s=x.length;l<s;a=++l)if(d=x[a],a!==c&&(d.map!=i&&d.getVisible())&&(d=f[a],(!(a<c)||d.d)&&this.f(e.q,d.q)<b)){e.d=d.d=h;break}}g=[];j=[];e=this.a;b=k=0;for(a=e.length;k<a;b=++k)c=e[b],(f[b].d?g:j).push(c);return[g,j]};z.z=function(b){var c=this;return{h:function(){return b._omsData.i.setOptions({strokeColor:c.legColors.highlighted[c.map.mapTypeId],zIndex:c.highlightedLegZIndex})},k:function(){return b._omsData.i.setOptions({strokeColor:c.legColors.usual[c.map.mapTypeId],
zIndex:c.usualLegZIndex})}}};z.G=function(b,c){var a,e,d,f,g,j;this.s=h;d=b.length;a=this.C(function(){var a,c,d;d=[];a=0;for(c=b.length;a<c;a++)j=b[a],d.push(j.p);return d}());d=d>=this.circleSpiralSwitchover?this.v(d,a).reverse():this.u(d,a);var l,k,s,x=this;s=[];l=0;for(k=d.length;l<k;l++)e=d[l],a=this.D(e),g=this.B(b,function(a){return x.f(a.p,e)}),g=g.A,f=new u.Polyline({map:this.map,path:[g.position,a],strokeColor:this.legColors.usual[this.map.mapTypeId],strokeWeight:this.legWeight,zIndex:this.usualLegZIndex}),
g._omsData={l:g.position,i:f},this.legColors.highlighted[this.map.mapTypeId]!==this.legColors.usual[this.map.mapTypeId]&&(f=this.z(g),g._omsData.w={h:r.addListener(g,"mouseover",f.h),k:r.addListener(g,"mouseout",f.k)}),g.setPosition(a),g.setZIndex(Math.round(this.spiderfiedZIndex+e.y)),s.push(g);delete this.s;this.r=h;return this.trigger("spiderfy",s,c)};z.unspiderfy=function(b){var c,a,e,d,f,g,j;b==i&&(b=i);if(this.r==i)return this;this.t=h;d=[];e=[];j=this.a;f=0;for(g=j.length;f<g;f++)a=j[f],a._omsData!=
i?(a._omsData.i.setMap(i),a!==b&&a.setPosition(a._omsData.l),a.setZIndex(i),c=a._omsData.w,c!=i&&(r.removeListener(c.h),r.removeListener(c.k)),delete a._omsData,d.push(a)):e.push(a);delete this.t;delete this.r;this.trigger("unspiderfy",d,e);return this};z.f=function(b,c){var a,e;a=b.x-c.x;e=b.y-c.y;return a*a+e*e};z.C=function(b){var c,a,e,d,f;d=a=e=0;for(f=b.length;d<f;d++)c=b[d],a+=c.x,e+=c.y;b=b.length;return new u.Point(a/b,e/b)};z.c=function(b){return this.e.getProjection().fromLatLngToDivPixel(b)};
z.D=function(b){return this.e.getProjection().fromDivPixelToLatLng(b)};z.B=function(b,c){var a,e,d,f,g,j;d=g=0;for(j=b.length;g<j;d=++g)if(f=b[d],f=c(f),!("undefined"!==typeof a&&a!==i)||f<e)e=f,a=d;return b.splice(a,1)[0]};z.m=function(b,c){var a,e,d,f;if(b.indexOf!=i)return b.indexOf(c);a=d=0;for(f=b.length;d<f;a=++d)if(e=b[a],e===c)return a;return-1};t.g=function(b){return this.setMap(b)};t.g.prototype=new u.OverlayView;t.g.prototype.draw=function(){};this.OverlappingMarkerSpiderfier=t};}).call(this);
/* Thu 18 Oct 2012 15:26:03 BST */


